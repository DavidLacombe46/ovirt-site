<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Virtual Machine Management Guide | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Virtual Machine Management Guide" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2676/documentation/virtual_machine_management_guide/" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2676/documentation/virtual_machine_management_guide/" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Virtual Machine Management Guide" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2676/images/logo.svg"}},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Virtual Machine Management Guide","url":"https://ovirt.github.io/ovirt-site/previews/2676/documentation/virtual_machine_management_guide/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2676/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2676/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2676/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2676/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2676/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2676/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2676/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2676/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2676/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2676/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2676/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2676/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2676/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2676/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2676/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2676/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2676/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2676/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2676/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2676/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2676/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2676/download/'>Download</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2676/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2676/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2676/documentation/">
              <span property="name">Documentation</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#chap-Introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#Audience">1.1. Audience</a></li>
<li><a href="#Supported_virtual_machines">1.2. Supported Virtual Machine Operating Systems</a></li>
<li><a href="#Virtual_machine_performance_parameters">1.3. Virtual Machine Performance Parameters</a></li>
<li><a href="#sect-Installing_Supporting_Components">1.4. Installing Supporting Components on Client Machines</a>
<ul class="sectlevel3">
<li><a href="#sect-Installing_Console_Components">1.4.1. Installing Console Components</a></li>
<li><a href="#Installing_usbdk_on_Windows">1.4.2. Installing usbdk on Windows</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Installing_Red_Hat_Enterprise_Linux_Virtual_Machines">2. Installing Enterprise Linux Virtual Machines</a>
<ul class="sectlevel2">
<li><a href="#Creating_a_virtual_machine_linux_vm">2.1. Creating a virtual machine</a></li>
<li><a href="#Starting_the_Virtual_Machine">2.2. Starting the Virtual Machine</a>
<ul class="sectlevel3">
<li><a href="#Powering_on_a_virtual_machine">2.2.1. Starting a Virtual Machine</a></li>
<li><a href="#Opening_a_Console_to_a_Virtual_Machine_linux_vm">2.2.2. Opening a console to a virtual machine</a></li>
</ul>
</li>
<li><a href="#Enabling_the_Required_Repositories">2.3. Enabling the Required Repositories</a></li>
<li><a href="#Installing_Guest_Agents_and_Drivers_Linux">2.4. Installing Guest Agents and Drivers</a>
<ul class="sectlevel3">
<li><a href="#Red_Hat_Virtualization_Guest_Agents_and_Drivers_linux_vm">2.4.1. oVirt Guest agents, tools, and drivers</a></li>
<li><a href="#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">2.4.2. Installing the Guest Agents and Drivers on Enterprise Linux</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Installing_Windows_Virtual_Machines">3. Installing Windows virtual machines</a>
<ul class="sectlevel2">
<li><a href="#Creating_a_virtual_machine_windows_vm">3.1. Creating a virtual machine</a></li>
<li><a href="#sect-Starting_the_Virtual_Machine_Using_the_Run_Once_Option">3.2. Starting the virtual machine using Run Once</a>
<ul class="sectlevel3">
<li><a href="#Installing_Windows_on_Virtio_Optimized_Hardware">3.2.1. Installing Windows on VirtIO-optimized hardware</a></li>
<li><a href="#Opening_a_Console_to_a_Virtual_Machine_windows_vm">3.2.2. Opening a console to a virtual machine</a></li>
</ul>
</li>
<li><a href="#Installing_Guest_Agents_and_Drivers_Windows">3.3. Installing guest agents and drivers</a>
<ul class="sectlevel3">
<li><a href="#Red_Hat_Virtualization_Guest_Agents_and_Drivers_windows_vm">3.3.1. oVirt Guest agents, tools, and drivers</a></li>
<li><a href="#Installing_the_Guest_Agents_and_Drivers_on_Windows">3.3.2. Installing the guest agents, tools, and drivers on Windows</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Additional_Configuration">4. Additional Configuration</a>
<ul class="sectlevel2">
<li><a href="#Configuring_operating_systems_with_osinfo">4.1. Configuring Operating Systems with osinfo</a></li>
<li><a href="#sect-Configuring_Single_Sign-On_for_Virtual_Machines">4.2. Configuring Single Sign-On for Virtual Machines</a>
<ul class="sectlevel3">
<li><a href="#Configuring_Single_Sign-On_for_Red_Hat_Enterprise_Linux_Virtual_Machines">4.2.1. Configuring Single Sign-On for Enterprise Linux Virtual Machines Using IPA (IdM)</a></li>
<li><a href="#Configuring_Single_Sign_On_for_Windows_Virtual_Machines">4.2.2. Configuring single sign-on for Windows virtual machines</a></li>
<li><a href="#Disabling_Single_Sign-on_for_Virtual_Machines">4.2.3. Disabling Single Sign-on for Virtual Machines</a></li>
</ul>
</li>
<li><a href="#sect-Configuring_USB_Devices">4.3. Configuring USB Devices</a>
<ul class="sectlevel3">
<li><a href="#Using_USB_Devices_on_a_Windows_Client">4.3.1. Using USB Devices on a Windows Client</a></li>
<li><a href="#Using_USB_Devices_on_a_Red_Hat_Enterprise_Linux_Client">4.3.2. Using USB Devices on a Enterprise Linux Client</a></li>
</ul>
</li>
<li><a href="#sect-Configuring_Multiple_Monitors">4.4. Configuring Multiple Monitors</a>
<ul class="sectlevel3">
<li><a href="#Configuring_Multiple_Displays_for_Red_Hat_Enterprise_Linux_Guest_Virtual_Machines">4.4.1. Configuring Multiple Displays for Enterprise Linux Virtual Machines</a></li>
<li><a href="#Configuring_Multiple_Displays_for_Windows_Virtual_Machines">4.4.2. Configuring Multiple Displays for Windows Virtual Machines</a></li>
</ul>
</li>
<li><a href="#sect-Configuring_Console_Options">4.5. Configuring Console Options</a>
<ul class="sectlevel3">
<li><a href="#sect-Console_Options">4.5.1. Console Options</a></li>
<li><a href="#Accessing_console_options">4.5.2. Accessing Console Options</a></li>
<li><a href="#SPICE_Console_Options">4.5.3. SPICE Console Options</a></li>
<li><a href="#VNC_Console_Options">4.5.4. VNC Console Options</a></li>
<li><a href="#RDP_Console_Options">4.5.5. RDP Console Options</a></li>
<li><a href="#sect-Remote_Viewer_Options">4.5.6. Remote Viewer Options</a></li>
</ul>
</li>
<li><a href="#sect-Configuring_a_Watchdog">4.6. Configuring a Watchdog</a>
<ul class="sectlevel3">
<li><a href="#Adding_a_Watchdog_Card_to_a_Virtual_machine">4.6.1. Adding a Watchdog Card to a Virtual Machine</a></li>
<li><a href="#Installing_a_Watchdog">4.6.2. Installing a Watchdog</a></li>
<li><a href="#Confirming_Watchdog_Functionality">4.6.3. Confirming Watchdog Functionality</a></li>
<li><a href="#Parameters_for_Watchdogs_in_watchdog_conf">4.6.4. Parameters for Watchdogs in watchdog.conf</a></li>
</ul>
</li>
<li><a href="#Configuring_virtual_numa">4.7. Configuring Virtual NUMA</a></li>
<li><a href="#Configuring_Satellite_Errata">4.8. Configuring Satellite errata viewing for a virtual machine</a></li>
<li><a href="#Configuring_Headless_Machines">4.9. Configuring Headless Virtual Machines</a></li>
<li><a href="#Configuring_High_Performance_Virtual_Machines_Templates_and_Pools">4.10. Configuring High Performance Virtual Machines, Templates, and Pools</a>
<ul class="sectlevel3">
<li><a href="#creating-a-high-performance-virtual-machine-template-or-pool">4.10.1. Creating a High Performance Virtual Machine, Template, or Pool</a></li>
<li><a href="#Configuring_Recommended_Manual_Settings">4.10.2. Configuring the Recommended Manual Settings</a></li>
</ul>
</li>
<li><a href="#Configuring_timezones">4.11. Configuring the time zone</a></li>
<li><a href="#systemctl-start-ovirt-guest-agent">4.12. systemctl start ovirt-guest-agent</a></li>
<li><a href="#grubby-update-kernelall-argsmovable_node">4.13. grubby --update-kernel=ALL --args="movable_node"</a></li>
<li><a href="#dnf-groupinstall-smart-card-support">4.14. dnf groupinstall "Smart card support"</a></li>
<li><a href="#modutil-dbdir-etcpkinssdb-add-module-name-libfile-pathtolibrary-so">4.15. modutil -dbdir /etc/pki/nssdb -add "<em>module name</em>" -libfile <em>/path/to/library</em>.so</a></li>
<li><a href="#echo-module-pathtolibrary-so-etcpkcs11modulesmy-module">4.16. echo "module: /path/to/library.so" &gt; /etc/pkcs11/modules/my.module</a></li>
<li><a href="#yum-update-ovirt-guest-agent-common">4.17. yum update ovirt-guest-agent-common</a></li>
<li><a href="#service-ovirt-guest-agent-restart">4.18. service ovirt-guest-agent restart</a></li>
<li><a href="#systemctl-restart-ovirt-guest-agent-service">4.19. systemctl restart ovirt-guest-agent.service</a></li>
<li><a href="#dnf-upgrade-y-virtio-win">4.20. dnf upgrade -y virtio-win</a></li>
<li><a href="#chown-3636-path_to_ova_filefile-ova">4.21. chown 36:36 <em>path_to_OVA_file/file.OVA</em></a></li>
<li><a href="#sudo-u-vdsm-ssh-keygen">4.22. sudo -u vdsm ssh-keygen</a></li>
<li><a href="#sudo-u-vdsm-ssh-copy-id-rootxenhost-example-com">4.23. sudo -u vdsm ssh-copy-id root@<em>xenhost.example.com</em></a></li>
<li><a href="#sudo-u-vdsm-ssh-rootxenhost-example-com">4.24. sudo -u vdsm ssh root@<em>xenhost.example.com</em></a></li>
<li><a href="#sudo-u-vdsm-ssh-keygen-2">4.25. sudo -u vdsm ssh-keygen</a></li>
<li><a href="#sudo-u-vdsm-ssh-copy-id-rootxenhost-example-com-2">4.26. sudo -u vdsm ssh-copy-id root@<em>xenhost.example.com</em></a></li>
<li><a href="#sudo-u-vdsm-ssh-rootxenhost-example-com-2">4.27. sudo -u vdsm ssh root@<em>xenhost.example.com</em></a></li>
<li><a href="#virt-v2v-copy-to-local-ic-xensshrootxenhost-example-com-vmname">4.28. virt-v2v-copy-to-local -ic xen+ssh://root@<em>xenhost.example.com</em> <em>vmname</em></a></li>
<li><a href="#virt-v2v-i-libvirtxml-vmname-xml-o-rhev-of-raw-os-storage-example-comexportdomain">4.29. virt-v2v -i libvirtxml <em>vmname</em>.xml -o rhev -of raw -os <em>storage.example.com:/exportdomain</em></a></li>
<li><a href="#sudo-u-vdsm-ssh-keygen-3">4.30. sudo -u vdsm ssh-keygen</a></li>
<li><a href="#sudo-u-vdsm-ssh-copy-id-rootkvmhost-example-com">4.31. sudo -u vdsm ssh-copy-id root@<em>kvmhost.example.com</em></a></li>
<li><a href="#sudo-u-vdsm-ssh-rootkvmhost-example-com">4.32. sudo -u vdsm ssh root@<em>kvmhost.example.com</em></a></li>
<li><a href="#yum-install-xorg-x11-drv-qxl">4.33. yum install xorg-x11-drv-qxl</a></li>
<li><a href="#cp-etcx11xorg-conf-etcx11xorg-conf-backup">4.34. cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup</a></li>
<li><a href="#sbinlsusb-v-grep-qemu-usb-tablet">4.35. /sbin/lsusb -v | grep 'QEMU USB Tablet'</a></li>
<li><a href="#cp-etcx11xorg-conf-etcx11xorg-conf-backup-2">4.36. cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup</a></li>
<li><a href="#service-ntpd-start">4.37. service ntpd start</a></li>
<li><a href="#chkconfig-ntpd-on">4.38. chkconfig ntpd on</a></li>
<li><a href="#systemctl-start-ntpd-service">4.39. systemctl start ntpd.service</a></li>
<li><a href="#systemctl-enable-ntpd-service">4.40. systemctl enable ntpd.service</a></li>
<li><a href="#windows711-ostype-windows-falsefalse">4.41. Windows7(11, OsType.Windows, false),false</a></li>
<li><a href="#subscription-manager-repos">4.42. subscription-manager repos \</a></li>
<li><a href="#subscription-manager-repos-2">4.43. subscription-manager repos \</a></li>
<li><a href="#dnf-install-cloud-init">4.44. dnf install cloud-init</a></li>
<li><a href="#windows711-ostype-windows-falsefalse-2">4.45. Windows7(11, OsType.Windows, false),false</a></li>
<li><a href="#virt-sysprep-list-operations">4.46. virt-sysprep --list-operations</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<h1 id="virtual-machine-management-guide" class="discrete">Virtual Machine Management Guide</h1>
</div>
</div>
<div class="sect1">
<h2 id="chap-Introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A virtual machine is a software implementation of a computer. The oVirt environment enables you to create virtual desktops and virtual servers.</p>
</div>
<div class="paragraph">
<p>Virtual machines consolidate computing tasks and workloads. In traditional computing environments, workloads usually run on individually administered and upgraded servers. Virtual machines reduce the amount of hardware and administration required to run the same computing tasks and workloads.</p>
</div>
<div class="sect2">
<h3 id="Audience">1.1. Audience</h3>
<div class="paragraph">
<p>Most virtual machine tasks in oVirt can be performed in both the VM Portal and Administration Portal. However, the user interface differs between each portal, and some administrative tasks require access to the Administration Portal. Tasks that can only be performed in the Administration Portal will be described as such in this book. Which portal you use, and which tasks you can perform in each portal, is determined by your level of permissions. Virtual machine permissions are explained in <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#sect-Virtual_Machines_and_Permissions">Virtual Machines and Permissions</a>.</p>
</div>
<div class="paragraph">
<p>The VM Portal&#8217;s user interface is described in the <a href="https://ovirt.org/documentation/introduction_to_the_vm_portal/index#">Introduction to the VM Portal</a>.</p>
</div>
<div class="paragraph">
<p>The Administration Portal&#8217;s user interface is described in the <a href="https://ovirt.org/documentation/administration_guide/index#">Administration Guide</a>.</p>
</div>
<div class="paragraph">
<p>The creation and management of virtual machines through the oVirt REST API is documented in the <a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index">REST API Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Supported_virtual_machines">1.2. Supported Virtual Machine Operating Systems</h3>
<div class="paragraph">
<p>For information on the operating systems that can be virtualized as guest operating systems in oVirt, see <a href="https://access.redhat.com/articles/973163" class="bare">https://access.redhat.com/articles/973163</a>.</p>
</div>
<div class="paragraph">
<p>For information on customizing the operating systems, see <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Configuring_operating_systems_with_osinfo">Configuring operating systems with osinfo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Virtual_machine_performance_parameters">1.3. Virtual Machine Performance Parameters</h3>
<div class="paragraph">
<p>For information on the parameters that oVirt virtual machines can support, see <a href="https://access.redhat.com/articles/rhel-limits">Enterprise Linux technology capabilities and limits</a> and <a href="https://access.redhat.com/articles/906543">Virtualization limits for oVirt</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Installing_Supporting_Components">1.4. Installing Supporting Components on Client Machines</h3>
<div class="sect3">
<h4 id="sect-Installing_Console_Components">1.4.1. Installing Console Components</h4>
<div class="paragraph">
<p>A console is a graphical window that allows you to view the start up screen, shut down screen, and desktop of a virtual machine, and to interact with that virtual machine in a similar way to a physical machine. In oVirt, the default application for opening a console to a virtual machine is Remote Viewer, which must be installed on the client machine prior to use.</p>
</div>
<div class="sect4">
<h5 id="Installing_Remote_Viewer_on_Linux">Installing Remote Viewer on Enterprise Linux</h5>
<div class="paragraph">
<p>The Remote Viewer application provides users with a graphical console for connecting to virtual machines. Once installed, it is called automatically when attempting to open a SPICE session with a virtual machine. Alternatively, it can also be used as a standalone application. Remote Viewer is included in the <code>virt-viewer</code> package provided by the base Enterprise Linux Workstation and Enterprise Linux Server repositories.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>virt-viewer</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install virt-viewer</pre>
</div>
</div>
</li>
<li>
<p>Restart your browser for the changes to take effect.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now connect to your virtual machines using either the SPICE protocol or the VNC protocol.</p>
</div>
</div>
<div class="sect4">
<h5 id="Installing_Remote_Viewer_on_Windows">Installing Remote Viewer on Windows</h5>
<div class="paragraph">
<p>The Remote Viewer application provides users with a graphical console for connecting to virtual machines. Once installed, it is called automatically when attempting to open a SPICE session with a virtual machine. Alternatively, it can also be used as a standalone application.</p>
</div>
<div class="paragraph">
<p><strong>Installing Remote Viewer on Windows</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser and download one of the following installers according to the architecture of your system.</p>
<div class="ulist">
<ul>
<li>
<p>Virt Viewer for 32-bit Windows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>your-manager-fqdn</em>/ovirt-engine/services/files/spice/virt-viewer-x86.msi</pre>
</div>
</div>
</li>
<li>
<p>Virt Viewer for 64-bit Windows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>your-manager-fqdn</em>/ovirt-engine/services/files/spice/virt-viewer-x64.msi</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Open the folder where the file was saved.</p>
</li>
<li>
<p>Double-click the file.</p>
</li>
<li>
<p>Click <strong>Run</strong> if prompted by a security warning.</p>
</li>
<li>
<p>Click <strong>Yes</strong> if prompted by User Account Control.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Remote Viewer is installed and can be accessed via <code>Remote Viewer</code> in the <strong>VirtViewer</strong> folder of <strong>All Programs</strong> in the start menu.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Installing_usbdk_on_Windows">1.4.2. Installing usbdk on Windows</h4>
<div class="paragraph">
<p><code>usbdk</code> is a driver that enables <code>remote-viewer</code> exclusive access to USB devices on Windows operating systems. Installing <code>usbdk</code> requires Administrator privileges. Note that the previously supported <code>USB Clerk</code> option has been deprecated and is no longer supported.</p>
</div>
<div class="paragraph">
<p><strong>Installing usbdk on Windows</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a web browser and download one of the following installers according to the architecture of your system.</p>
<div class="ulist">
<ul>
<li>
<p><code>usbdk</code> for 32-bit Windows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>[your manager&#8217;s address]</em>/ovirt-engine/services/files/spice/usbdk-x86.msi</pre>
</div>
</div>
</li>
<li>
<p><code>usbdk</code> for 64-bit Windows:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">https://<em>[your manager&#8217;s address]</em>/ovirt-engine/services/files/spice/usbdk-x64.msi</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Open the folder where the file was saved.</p>
</li>
<li>
<p>Double-click the file.</p>
</li>
<li>
<p>Click <strong>Run</strong> if prompted by a security warning.</p>
</li>
<li>
<p>Click <strong>Yes</strong> if prompted by User Account Control.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Installing_Red_Hat_Enterprise_Linux_Virtual_Machines">2. Installing Enterprise Linux Virtual Machines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Installing a Enterprise Linux virtual machine involves the following key steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Creating_a_virtual_machine_linux_vm">Create a virtual machine.</a> You must add a virtual disk for storage, and a network interface to connect the virtual machine to the network.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Starting_the_Virtual_Machine">Start the virtual machine</a> and install an operating system. See your operating system&#8217;s documentation for instructions.</p>
<div class="ulist">
<ul>
<li>
<p>Enterprise Linux 6: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/Installation_Guide/index.html" class="bare">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/Installation_Guide/index.html</a></p>
</li>
<li>
<p>Enterprise Linux 7: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Installation_Guide/index.html" class="bare">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Installation_Guide/index.html</a></p>
</li>
<li>
<p>Enterprise Linux Atomic Host 7: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/html-single/installation_and_configuration_guide/index" class="bare">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux_atomic_host/7/html-single/installation_and_configuration_guide/index</a></p>
</li>
<li>
<p>Enterprise Linux 8: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/index" class="bare">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/index</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Enabling_the_Required_Repositories">Enable the required repositories</a> for your operating system.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Installing_Guest_Agents_and_Drivers_Linux">Install guest agents and drivers</a> for additional virtual machine functionality.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Creating_a_virtual_machine_linux_vm">2.1. Creating a virtual machine</h3>
<div class="paragraph">
<p>When creating a new virtual machine, you specify its settings. You can edit some of these settings later, including the chipset and BIOS type. For more information, see <a href="https://ovirt.org/documentation//administration_guide/index#About_UEFI_Q35-cluster_opt_settings">UEFI and the Q35 chipset</a> in the <em>Administration Guide</em>.
.Prerequisites</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before you can use this virtual machine, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install an operating system</p>
<div class="ulist">
<ul>
<li>
<p>Use a pre-installed image by <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Creating_a_cloned_virtual_machine_based_on_a_template">Creating a Cloned Virtual Machine Based on a Template</a></p>
</li>
<li>
<p>Use a pre-installed image from an attached pre-installed Disk</p>
</li>
<li>
<p>Install an operating system through the PXE boot menu or from an ISO file</p>
</li>
</ul>
</div>
</li>
<li>
<p>Register with the Content Delivery Network</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Click <b class="button">New</b>. This opens the <strong>New Virtual Machine</strong> window.</p>
</li>
<li>
<p>Select an <strong>Operating System</strong> from the drop-down list.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you selected <strong>Enterprise Linux CoreOS</strong> as the operating system, you may need to set the initialization method by configuring <strong>Ignition</strong> settings in the <strong>Advanced Options</strong>  <code>Initial Run</code> tab. See <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Configuring_Ignition">Configuring Ignition</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter a <strong>Name</strong> for the virtual machine.</p>
</li>
<li>
<p>Add storage to the virtual machine: under <strong>Instance Images</strong>, click <b class="button">Attach</b> or <b class="button">Create</b> to select or create a virtual disk .</p>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Attach</strong> and select an existing virtual disk.</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Click <strong>Create</strong> and enter a <strong>Size(GB)</strong> and <strong>Alias</strong> for a new virtual disk. You can accept the default settings for all other fields, or change them if required. See <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Add_Virtual_Disk_dialogue_entries">Explanation of settings in the New Virtual Disk and Edit Virtual Disk windows</a> for more details on the fields for all disk types.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Connect the virtual machine to the network. Add a network interface by selecting a vNIC profile from the <strong>nic1</strong> drop-down list at the bottom of the <strong>General</strong> tab.</p>
</li>
<li>
<p>Specify the virtual machine&#8217;s <strong>Memory Size</strong> on the <strong>System</strong> tab.</p>
</li>
<li>
<p>In the <strong>Boot Options</strong> tab, choose the <strong>First Device</strong> that the virtual machine will use to boot.</p>
</li>
<li>
<p>You can accept the default settings for all other fields, or change them if required. For more details on all fields in the <strong>New Virtual Machine</strong> window, see <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#sect-Explanation_of_Settings_in_the_New_Virtual_Machine_and_Edit_Virtual_Machine_Windows">Explanation of settings in the New Virtual Machine and Edit Virtual Machine Windows</a>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new virtual machine is created and displays in the list of virtual machines with a status of <code>Down</code>.</p>
</div>
<div id="Configuring_Ignition" class="paragraph">
<div class="title">Configuring Ignition</div>
<p>Ignition is the utility that is used by Enterprise Linux CoreOS to manipulate disks during initial configuration. It completes common disk tasks, including partitioning disks, formatting partitions, writing files, and configuring users. On first boot, Ignition reads its configuration from the installation media or the location that you specify and applies the configuration to the machines.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Once Ignition has been configured as the initialization method, it cannot be reversed or re-configured.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <code>Add Virtual Machine</code> or <code>Edit Virtual Machine</code> screen, click <b class="button">Show Advanced Options</b>.</p>
</li>
<li>
<p>In the <code>Initial Run</code> tab, select the <strong>Ignition 2.3.0</strong> option and enter the <strong>VM Hostname</strong>.</p>
</li>
<li>
<p>Expand the <strong>Authorization</strong> option, enter a hashed (SHA-512) password, and enter the password again to verify.</p>
</li>
<li>
<p>If you are using SSH keys for authorization, enter them in the space provided.</p>
</li>
<li>
<p>You can also enter a custom Ignition script in JSON format in the <strong>Ignition Script</strong> field. This script will run on the virtual machine when it starts. The scripts you enter in this field are custom JSON sections that are added to those produced by the Engine, and allow you to use custom Ignition instructions.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the Enterprise Linux CoreOS image you are using contains an Ignition version different than 2.3.0, you need to use a script in the <strong>Ignition Script</strong> field to enforce the Ignition version included in your Enterprise Linux CoreOS image.</p>
</div>
<div class="paragraph">
<p>When you use an Ignition script, the script instructions take precedence over and override any conflicting Ignition settings you configured in the UI.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Starting_the_Virtual_Machine">2.2. Starting the Virtual Machine</h3>
<div class="sect3">
<h4 id="Powering_on_a_virtual_machine">2.2.1. Starting a Virtual Machine</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine with a status of <code>Down</code>.</p>
</li>
<li>
<p>Click <b class="button">Run</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>Status</strong> of the virtual machine changes to <code>Up</code>, and the operating system installation begins. Open a console to the virtual machine if one does not open automatically.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A virtual machine will not start on a host with an overloaded CPU. By default, a host&#8217;s CPU is considered overloaded if it has a load of more than 80% for 5 minutes, but these values can be changed using scheduling policies. See <a href="https://ovirt.org/documentation/administration_guide/index#sect-Scheduling_Policies">Scheduling Policies</a> in the <em>Administration Guide</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Troubleshooting</div>
<p>Scenario - the virtual machine fails to boot with the following error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Boot failed: not a bootable disk - No Bootable device</pre>
</div>
</div>
<div class="paragraph">
<p>Possible solutions to this problem:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure that <strong>hard disk</strong> is selected in the boot sequence, and the disk that the virtual machine is booting from must be set as <strong>Bootable</strong>.</p>
</li>
<li>
<p>Create a <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Creating_a_cloned_virtual_machine_based_on_a_template">Cloned Virtual Machine Based on a Template</a>.</p>
</li>
<li>
<p>Create a new virtual machine with a local boot disk managed by oVirt that contains the OS and application binaries.</p>
</li>
<li>
<p>Install the OS by booting from the <strong>Network (PXE)</strong> boot option.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Opening_a_Console_to_a_Virtual_Machine_linux_vm">2.2.2. Opening a console to a virtual machine</h4>
<div class="paragraph">
<p>Use Remote Viewer to connect to a virtual machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install Remote Viewer if it is not already installed. See <a href="#sect-Installing_Console_Components">Installing Console Components</a>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">Console</b>. By default, the browser prompts you to download a file named <code>console.vv</code>. When you click to open the file, a console window opens for the virtual machine. You can configure your browser to automatically open these files, such that clicking <b class="button">Console</b> simply opens the console.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>console.vv</code> expires after 120 seconds. If more than 120 seconds elapse between the time the file is downloaded and the time that you open the file, click <b class="button">Console</b> again.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Automatically_connecting_to_a_Virtual_Machine">Automatically Connecting to a Virtual Machine</a></p>
</li>
<li>
<p><a href="#sect-Configuring_Console_Options">Configuring Console Options</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Opening_a_Serial_Console_to_a_Virtual_Machine">Opening a Serial Console to a Virtual Machine</h5>
<div class="paragraph">
<p>You can access a virtual machine&#8217;s serial console from the command line instead of opening a console from the Administration Portal or the VM Portal. The serial console is emulated through VirtIO channels, using SSH and key pairs. The Engine acts as a proxy for the connection, provides information about virtual machine placement, and stores the authentication keys. You can add public keys for each user from either the Administration Portal or the VM Portal. You can access serial consoles for only those virtual machines for which you have appropriate permissions.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To access the serial console of a virtual machine, the user must have <strong>UserVmManager</strong>, <strong>SuperUser</strong>, or <strong>UserInstanceManager</strong> permission on that virtual machine. These permissions must be explicitly defined for each user. It is not enough to assign these permissions to <strong>Everyone</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The serial console is accessed through TCP port 2222 on the Engine. This port is opened during <code>engine-setup</code> on new installations. To change the port, see <a href="https://github.com/oVirt/ovirt-vmconsole/blob/master/README#L116">ovirt-vmconsole/README</a>.</p>
</div>
<div class="paragraph">
<p>Using a serial console requires configuring the firewall rules. For more information, see:
* <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#RHV-manager-firewall-requirements_RHV_planning">Rule "M3" in the oVirt Engine Firewall Requirements</a>
* <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#host-firewall-requirements_RHV_planning">Rule "H2" in the Host Firewall Requirements</a></p>
</div>
<div class="paragraph">
<p>The serial console relies on the <code>ovirt-vmconsole</code> package and the <code>ovirt-vmconsole-proxy</code> on the Engine, and the <code>ovirt-vmconsole</code> package and the <code>ovirt-vmconsole-host</code> package on the virtualization hosts. These packages are installed by default on new installations. To install the packages on existing installations, reinstall the host. See <a href="https://ovirt.org/documentation/administration_guide/index#Reinstalling_Hosts">Reinstalling Hosts</a> in the <em>Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p><strong>Enabling a Virtual Machine&#8217;s Serial Console</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the virtual machine whose serial console you are accessing, add the following lines to <strong>/etc/default/grub</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GRUB_CMDLINE_LINUX_DEFAULT="console=tty0 console=ttyS0,115200n8"
GRUB_TERMINAL="console serial"
GRUB_SERIAL_COMMAND="serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>GRUB_CMDLINE_LINUX_DEFAULT</code> applies this configuration only to the default menu entry. Use <code>GRUB_CMDLINE_LINUX</code> to apply the configuration to all the menu entries.</p>
</div>
<div class="paragraph">
<p>If these lines already exist in <strong>/etc/default/grub</strong>, update them. Do not duplicate them.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Rebuild <strong>/boot/grub2/grub.cfg</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>BIOS-based machines:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grub2-mkconfig -o /boot/grub2/grub.cfg</pre>
</div>
</div>
</li>
<li>
<p>UEFI-based machines:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grub2-mkconfig -o /boot/efi/EFI/redhat/grub.cfg</pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-working_with_the_grub_2_boot_loader#sec-GRUB_2_over_a_Serial_Console">GRUB 2 over a Serial Console</a> in the <em>Enterprise Linux 7 System Administrator&#8217;s Guide</em> for details.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>On the client machine from which you are accessing the virtual machine serial console, generate an SSH key pair. The Engine supports standard SSH key types, for example, an RSA key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh-keygen -t rsa -b 2048 -C "<em>user@domain</em>" -f .ssh/serialconsolekey</pre>
</div>
</div>
<div class="paragraph">
<p>This command generates a public key and a private key.</p>
</div>
</li>
<li>
<p>In the Administration Portal or the VM Portal, click the name of the signed-in user on the header bar and click <strong>Options</strong>. This opens the <strong>Edit Options</strong> window.</p>
</li>
<li>
<p>In the <strong>User&#8217;s Public Key</strong> text field, paste the public key of the client machine that will be used to access the serial console.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>In the <strong>Console</strong> tab of the <strong>Edit Virtual Machine</strong> window, select the <strong>Enable VirtIO serial console</strong> check box.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Connecting to a Virtual Machine&#8217;s Serial Console</strong></p>
</div>
<div class="paragraph">
<p>On the client machine, connect to the virtual machine&#8217;s serial console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a single virtual machine is available, this command connects the user to that virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh -t -p 2222 ovirt-vmconsole@<em>Manager_FQDN</em> -i .ssh/serialconsolekey
Enterprise Linux Server release 6.7 (Santiago)
Kernel 2.6.32-573.3.1.el6.x86_64 on an x86_64
<em>USER</em> login:</pre>
</div>
</div>
</li>
<li>
<p>If more than one virtual machine is available, this command lists the available virtual machines and their IDs:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh -t -p 2222 ovirt-vmconsole@<em>Manager_FQDN</em> -i .ssh/serialconsolekey list
1. vm1 [vmid1]
2. vm2 [vmid2]
3. vm3 [vmid3]
&gt; 2
Enterprise Linux Server release 6.7 (Santiago)
Kernel 2.6.32-573.3.1.el6.x86_64 on an x86_64
<em>USER</em> login:</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the number of the machine to which you want to connect, and press <code>Enter</code>.</p>
</div>
</li>
<li>
<p>Alternatively, connect directly to a virtual machine using its unique identifier or its name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh -t -p 2222 ovirt-vmconsole@<em>Manager_FQDN</em> connect --vm-id <em>vmid1</em></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh -t -p 2222 ovirt-vmconsole@<em>Manager_FQDN</em> connect --vm-name <em>vm1</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Disconnecting from a Virtual Machine&#8217;s Serial Console</strong></p>
</div>
<div class="paragraph">
<p>Press any key followed by <strong><code>~ .</code></strong> to close a serial console session.</p>
</div>
<div class="paragraph">
<p>If the serial console session is disconnected abnormally, a TCP timeout occurs. You will be unable to reconnect to the virtual machine&#8217;s serial console until the timeout period expires.</p>
</div>
</div>
<div class="sect4">
<h5 id="Automatically_connecting_to_a_Virtual_Machine">Automatically Connecting to a Virtual Machine</h5>
<div class="paragraph">
<p>Once you have logged in, you can automatically connect to a single running virtual machine. This can be configured in the VM Portal.</p>
</div>
<div class="paragraph">
<p><strong>Automatically Connecting to a Virtual Machine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Virtual Machines page, click the name of the virtual machine to go to the details view.</p>
</li>
<li>
<p>Click the pencil icon beside <strong>Console</strong> and set <strong>Connect automatically</strong> to <strong>ON</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next time you log into the VM Portal, if you have only one running virtual machine, you will automatically connect to that machine.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_the_Required_Repositories">2.3. Enabling the Required Repositories</h3>
<div class="paragraph">
<p>To install packages signed by Red Hat you must register the target system to the Content Delivery Network. Then, use an entitlement from your subscription pool and enable the required repositories.</p>
</div>
<div class="paragraph">
<p><strong>Enabling the Required Repositories Using Subscription Engine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register your system with the Content Delivery Network, entering your Customer Portal user name and password when prompted:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager register</pre>
</div>
</div>
</li>
<li>
<p>Locate the relevant subscription pools and note down the pool identifiers:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager list --available</pre>
</div>
</div>
</li>
<li>
<p>Use the pool identifiers to attach the required subscriptions:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager attach --pool=<em>pool_id</em></pre>
</div>
</div>
</li>
<li>
<p>When a system is attached to a subscription pool with multiple repositories, only the main repository is enabled by default. Others are available, but disabled. Enable any additional repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=<em>repository</em></pre>
</div>
</div>
</li>
<li>
<p>Ensure that all packages currently installed are up to date:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade --nobest</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For versions of Enterprise Linux earlier than 8, use the command <code>yum update</code> instead of <code>dnf upgrade</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
<div class="paragraph">
<p>See also <a href="https://access.redhat.com/solutions/5480561">Cannot perform yum update on my RHV manager (ansible conflict)</a></p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Guest_Agents_and_Drivers_Linux">2.4. Installing Guest Agents and Drivers</h3>
<div class="sect3">
<h4 id="Red_Hat_Virtualization_Guest_Agents_and_Drivers_linux_vm">2.4.1. oVirt Guest agents, tools, and drivers</h4>
<div class="paragraph">
<p>The oVirt guest agents, tools, and drivers provide additional functionality for virtual machines, such as gracefully shutting down or rebooting virtual machines from the VM Portal and Administration Portal. The tools and agents also provide information for virtual machines, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource usage</p>
</li>
<li>
<p>IP addresses</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The guest agents, tools and drivers are distributed as an ISO file that you can attach to virtual machines. This ISO file is packaged as an RPM file that you can install and upgrade from the Engine machine.</p>
</div>
<div class="paragraph">
<p>You need to install the guest agents and drivers on a virtual machine to enable this functionality for that machine.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. oVirt Guest drivers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Driver</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Works on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-net</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized network driver provides enhanced performance over emulated devices like rtl.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-block</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized HDD driver offers increased I/O performance over emulated devices like IDE by optimizing the coordination and communication between the virtual machine and the hypervisor. The driver complements the software implementation of the virtio-device used by the host to play the role of a hardware device.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-scsi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized iSCSI HDD driver offers similar functionality to the virtio-block device, with some additional enhancements. In particular, this driver supports adding hundreds of devices, and names devices using the standard SCSI device naming scheme.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-serial</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtio-serial provides support for multiple serial ports. The improved performance is used for fast communication between the virtual machine and the host that avoids network complications. This fast communication is required for the guest agents and for other features such as clipboard copy-paste between the virtual machine and the host and logging.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-balloon</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtio-balloon is used to control the amount of memory a virtual machine actually accesses. It offers improved memory overcommitment.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qxl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A paravirtualized display driver reduces CPU usage on the host and provides better performance through reduced network bandwidth on most workloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. oVirt Guest agents and tools</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Guest agent/tool</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Works on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qemu-guest-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used instead of <code>ovirt-guest-agent-common</code> on Enterprise Linux 8 virtual machines. It is installed and enabled by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spice-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SPICE agent supports multiple monitors and is responsible for client-mouse-mode support to provide a better user experience and improved responsiveness than the QEMU emulation. Cursor capture is not needed in client-mouse-mode. The SPICE agent reduces bandwidth usage when used over a wide area network by reducing the display level, including color depth, disabling wallpaper, font smoothing, and animation. The SPICE agent enables clipboard support allowing cut and paste operations for both text and images between client and virtual machine, and automatic guest display setting according to client-side settings. On Windows-based virtual machines, the SPICE agent consists of vdservice and vdagent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">2.4.2. Installing the Guest Agents and Drivers on Enterprise Linux</h4>
<div class="paragraph">
<p>The oVirt guest agents and drivers are provided by the oVirt Agent repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enterprise Linux 8 virtual machines use the <code>qemu-guest-agent</code> service, which is installed and enabled by default, instead of the <code>ovirt-guest-agent</code> service. If you need to manually install the guest agent on RHEL 8, follow the procedure below.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Enterprise Linux virtual machine.</p>
</li>
<li>
<p>Enable the oVirt Agent repository:</p>
<div class="ulist">
<ul>
<li>
<p>For Enterprise Linux 6</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-6-server-rhv-4-agent-rpms</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux 7</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-7-server-rh-common-rpms</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux 8</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-8-for-x86_64-appstream-rpms</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Install the guest agent and dependencies:</p>
<div class="ulist">
<ul>
<li>
<p>For Enterprise Linux 6 or 7, install the ovirt guest agent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ovirt-guest-agent-common</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux 8, install the qemu guest agent:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install qemu-guest-agent</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Start and enable the <code>ovirt-guest-agent</code> service:</p>
<div class="ulist">
<ul>
<li>
<p>For Enterprise Linux 6</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># service ovirt-guest-agent start
# chkconfig ovirt-guest-agent on</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux 7</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start ovirt-guest-agent
# systemctl enable ovirt-guest-agent</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Start and enable the <code>qemu-guest-agent</code> service:</p>
<div class="ulist">
<ul>
<li>
<p>For Enterprise Linux 6</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># service qemu-ga start
# chkconfig qemu-ga on</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux 7 or 8</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start qemu-guest-agent
# systemctl enable qemu-guest-agent</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The guest agent now passes usage information to the oVirt Engine. You can configure the guest agent in the <code>/etc/ovirt-guest-agent.conf</code> file.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Installing_Windows_Virtual_Machines">3. Installing Windows virtual machines</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Installing a Windows virtual machine involves the following key steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a blank virtual machine on which to install an operating system.</p>
</li>
<li>
<p>Add a virtual disk for storage.</p>
</li>
<li>
<p>Add a network interface to connect the virtual machine to the network.</p>
</li>
<li>
<p>Attach the Windows guest tools CD to the virtual machine so that VirtIO-optimized device drivers can be installed during the operating system installation.</p>
</li>
<li>
<p>Install a Windows operating system on the virtual machine. See your operating system&#8217;s documentation for instructions.</p>
</li>
<li>
<p>During the installation, install guest agents and drivers for additional virtual machine functionality.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When all of these steps are complete, the new virtual machine is functional and ready to perform tasks.</p>
</div>
<div class="sect2">
<h3 id="Creating_a_virtual_machine_windows_vm">3.1. Creating a virtual machine</h3>
<div class="paragraph">
<p>When creating a new virtual machine, you specify its settings. You can edit some of these settings later, including the chipset and BIOS type. For more information, see <a href="https://ovirt.org/documentation//administration_guide/index#About_UEFI_Q35-cluster_opt_settings">UEFI and the Q35 chipset</a> in the <em>Administration Guide</em>.
.Prerequisites</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before you can use this virtual machine, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install an operating system</p>
</li>
<li>
<p>Install a VirtIO-optimized disk and network drivers</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>You can change the default virtual machine name length with the <code>engine-config</code> tool. Run the following command on the Engine machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --set MaxVmNameLength=<em>integer</em></pre>
</div>
</div>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Click <b class="button">New</b>. This opens the <strong>New Virtual Machine</strong> window.</p>
</li>
<li>
<p>Select an <strong>Operating System</strong> from the drop-down list.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the virtual machine.</p>
</li>
<li>
<p>Add storage to the virtual machine: under <strong>Instance Images</strong>, click <b class="button">Attach</b> or <b class="button">Create</b> to select or create a virtual disk .</p>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Attach</strong> and select an existing virtual disk.</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Click <strong>Create</strong> and enter a <strong>Size(GB)</strong> and <strong>Alias</strong> for a new virtual disk. You can accept the default settings for all other fields, or change them if required. See <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#Add_Virtual_Disk_dialogue_entries">Explanation of settings in the New Virtual Disk and Edit Virtual Disk windows</a> for more details on the fields for all disk types.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Connect the virtual machine to the network. Add a network interface by selecting a vNIC profile from the <strong>nic1</strong> drop-down list at the bottom of the <strong>General</strong> tab.</p>
</li>
<li>
<p>Specify the virtual machine&#8217;s <strong>Memory Size</strong> on the <strong>System</strong> tab.</p>
</li>
<li>
<p>In the <strong>Boot Options</strong> tab, choose the <strong>First Device</strong> that the virtual machine will use to boot.</p>
</li>
<li>
<p>You can accept the default settings for all other fields, or change them if required. For more details on all fields in the <strong>New Virtual Machine</strong> window, see <a href="https://ovirt.org/documentation//virtual_machine_management_guide/index#sect-Explanation_of_Settings_in_the_New_Virtual_Machine_and_Edit_Virtual_Machine_Windows">Explanation of settings in the New Virtual Machine and Edit Virtual Machine Windows</a>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new virtual machine is created and displays in the list of virtual machines with a status of <code>Down</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Starting_the_Virtual_Machine_Using_the_Run_Once_Option">3.2. Starting the virtual machine using Run Once</h3>
<div class="sect3">
<h4 id="Installing_Windows_on_Virtio_Optimized_Hardware">3.2.1. Installing Windows on VirtIO-optimized hardware</h4>
<div class="paragraph">
<p>Install VirtIO-optimized disk and network device drivers during your Windows installation by attaching the <code>virtio-win<em>_version</em>.iso</code> file to your virtual machine. These drivers provide a performance improvement over emulated device drivers.</p>
</div>
<div class="paragraph">
<p>Use the <strong>Run Once</strong> option to attach the <code>virtio-win<em>_version</em>.iso</code> file in a one-off boot different from the <strong>Boot Options</strong> defined in the <strong>New Virtual Machine</strong> window.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>The following items have been added to the virtual machine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <strong>Red Hat VirtIO</strong> network interface.</p>
</li>
<li>
<p>a disk that uses the <strong>VirtIO</strong> interface. This disk can be on a</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can upload <code>virtio-win<em>_version</em>.iso</code> to a data storage domain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt recommends uploading ISO images to the data domain with the Administration Portal or with the REST API. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</a> in the <em>Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p>If necessary, you can upload the <code>virtio-win</code> ISO file to an ISO storage domain that is hosted on the Engine. The ISO storage domain type is deprecated. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#Copy_ISO_to_ISO_domain-storage_tasks">Uploading images to an ISO domain</a> in the <em>Administration Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install the virtio-win drivers when installing Windows, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Run</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Run Once</b></span>.</p>
</li>
<li>
<p>Expand the <strong>Boot Options</strong> menu.</p>
</li>
<li>
<p>Select the <strong>Attach CD</strong> check box, and select a Windows ISO from the drop-down list.</p>
</li>
<li>
<p>Select the <strong>Attach Windows guest tools CD</strong> check box.</p>
</li>
<li>
<p>Move <strong>CD-ROM</strong> to the top of the <strong>Boot Sequence</strong> field.</p>
</li>
<li>
<p>Configure other <strong>Run Once</strong> options as required. See <a href="#Virtual_Machine_Run_Once_settings_explained">[Virtual_Machine_Run_Once_settings_explained]</a> for more details.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The status of the virtual machine changes to <strong>Up</strong>, and the operating system installation begins.</p>
<div class="paragraph">
<p>Open a console to the virtual machine if one does not open automatically during the Windows installation.</p>
</div>
</li>
<li>
<p>When prompted to select a drive onto which you want to install Windows, click <b class="button">Load driver</b> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Under <strong>Select the driver to install</strong>, select the appropriate driver for the version of Windows. For example, for Windows Server 2019, select <strong>Red Hat VirtIO SCSI controller (E:\amd64\2k19\viostor.inf)</strong></p>
</li>
<li>
<p>Click Next.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The rest of the installation proceeds as normal.</p>
</div>
</div>
<div class="sect3">
<h4 id="Opening_a_Console_to_a_Virtual_Machine_windows_vm">3.2.2. Opening a console to a virtual machine</h4>
<div class="paragraph">
<p>Use Remote Viewer to connect to a virtual machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install Remote Viewer if it is not already installed. See <a href="#sect-Installing_Console_Components">Installing Console Components</a>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">Console</b>. By default, the browser prompts you to download a file named <code>console.vv</code>. When you click to open the file, a console window opens for the virtual machine. You can configure your browser to automatically open these files, such that clicking <b class="button">Console</b> simply opens the console.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>console.vv</code> expires after 120 seconds. If more than 120 seconds elapse between the time the file is downloaded and the time that you open the file, click <b class="button">Console</b> again.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Automatically_connecting_to_a_Virtual_Machine">Automatically Connecting to a Virtual Machine</a></p>
</li>
<li>
<p><a href="#sect-Configuring_Console_Options">Configuring Console Options</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Guest_Agents_and_Drivers_Windows">3.3. Installing guest agents and drivers</h3>
<div class="sect3">
<h4 id="Red_Hat_Virtualization_Guest_Agents_and_Drivers_windows_vm">3.3.1. oVirt Guest agents, tools, and drivers</h4>
<div class="paragraph">
<p>The oVirt guest agents, tools, and drivers provide additional functionality for virtual machines, such as gracefully shutting down or rebooting virtual machines from the VM Portal and Administration Portal. The tools and agents also provide information for virtual machines, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource usage</p>
</li>
<li>
<p>IP addresses</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The guest agents, tools and drivers are distributed as an ISO file that you can attach to virtual machines. This ISO file is packaged as an RPM file that you can install and upgrade from the Engine machine.</p>
</div>
<div class="paragraph">
<p>You need to install the guest agents and drivers on a virtual machine to enable this functionality for that machine.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. oVirt Guest drivers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Driver</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Works on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-net</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized network driver provides enhanced performance over emulated devices like rtl.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-block</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized HDD driver offers increased I/O performance over emulated devices like IDE by optimizing the coordination and communication between the virtual machine and the hypervisor. The driver complements the software implementation of the virtio-device used by the host to play the role of a hardware device.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-scsi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized iSCSI HDD driver offers similar functionality to the virtio-block device, with some additional enhancements. In particular, this driver supports adding hundreds of devices, and names devices using the standard SCSI device naming scheme.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-serial</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtio-serial provides support for multiple serial ports. The improved performance is used for fast communication between the virtual machine and the host that avoids network complications. This fast communication is required for the guest agents and for other features such as clipboard copy-paste between the virtual machine and the host and logging.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-balloon</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtio-balloon is used to control the amount of memory a virtual machine actually accesses. It offers improved memory overcommitment.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qxl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A paravirtualized display driver reduces CPU usage on the host and provides better performance through reduced network bandwidth on most workloads.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. oVirt Guest agents and tools</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Guest agent/tool</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Works on</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qemu-guest-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used instead of <code>ovirt-guest-agent-common</code> on Enterprise Linux 8 virtual machines. It is installed and enabled by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spice-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SPICE agent supports multiple monitors and is responsible for client-mouse-mode support to provide a better user experience and improved responsiveness than the QEMU emulation. Cursor capture is not needed in client-mouse-mode. The SPICE agent reduces bandwidth usage when used over a wide area network by reducing the display level, including color depth, disabling wallpaper, font smoothing, and animation. The SPICE agent enables clipboard support allowing cut and paste operations for both text and images between client and virtual machine, and automatic guest display setting according to client-side settings. On Windows-based virtual machines, the SPICE agent consists of vdservice and vdagent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server and Desktop.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Installing_the_Guest_Agents_and_Drivers_on_Windows">3.3.2. Installing the guest agents, tools, and drivers on Windows</h4>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install the guest agents, tools, and drivers on a Windows virtual machine, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine machine, install the <code>virtio-win</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install virtio-win*</pre>
</div>
</div>
<div class="paragraph">
<p>After you install the package, the ISO file is located in <code class="filename">/usr/share/virtio-win/virtio-win<em>_version</em>.iso</code> on the Engine machine.</p>
</div>
</li>
<li>
<p>Upload <code class="filename">virtio-win<em>_version</em>.iso</code> to a data storage domain. See <a href="https://ovirt.org/documentation/administration_guide/index#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</a> in the <em>Administration Guide</em> for details.</p>
</li>
<li>
<p>In the Administration or VM Portal, if the virtual machine is running, use the <strong>Change CD</strong> button to attach the <code class="filename">virtio-win<em>_version</em>.iso</code> file to each of your virtual machines. If the virtual machine is powered off, click the <strong>Run Once</strong> button and attach the ISO as a CD.</p>
</li>
<li>
<p>Log in to the virtual machine.</p>
</li>
<li>
<p>Select the CD Drive containing the <code class="filename">virtio-win<em>_version</em>.iso</code> file. You can complete the installation with either the GUI or the command line.</p>
</li>
<li>
<p>Run the installer.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">To install with the GUI, complete the following steps</dt>
<dd>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Double-click <code>virtio-win-gt-x64.msi</code> or <code>virtio-win-gt-x86.msi</code>.</p>
</li>
<li>
<p>Click <b class="button">Next</b> at the welcome screen.</p>
</li>
<li>
<p>Follow the prompts in the installation wizard.</p>
</li>
<li>
<p>When installation is complete, select <strong>Yes, I want to restart my computer now</strong> and click <strong>Finish</strong> to apply the changes.</p>
</li>
<li>
<p>After the virtual machine reboots, open the CD-ROM and go to the <code class="filename">guest-agent</code> directory and double-click <code class="filename">qemu-ga-x86_64.msi</code> or <code class="filename">qemu-ga-i386.msi</code>, to install qemu-ga, the Qemu guest agent.</p>
</li>
</ol>
</div>
</dd>
<dt class="hdlist1">To install silently with the command line, complete the following steps</dt>
<dd>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open a command prompt with Administrator privileges.</p>
</li>
<li>
<p>Enter the <code class="cmd">msiexec</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">D:\ msiexec /i "<em>PATH_TO_MSI</em>" /qn [/l*v "<em>PATH_TO_LOG</em>"][/norestart] ADDLOCAL=ALL</pre>
</div>
</div>
<div class="paragraph">
<p>Other possible values for ADDLOCAL are listed below.</p>
</div>
<div class="paragraph">
<p>For example, to run the installation when <code>virtio-win-gt-x64.msi</code> is on the <code>D:\</code> drive, without saving the log, and then immediately restart the virtual machine, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">D:\ msiexec /i "virtio-win-gt-x64.msi" /qn ADDLOCAL=ALL</pre>
</div>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After installation completes, the guest agents and drivers pass usage information to the oVirt Engine and enable you to access USB devices and other functionality.</p>
</div>
<div class="sect4">
<h5 id="values-for-addlocal-to-customize-virtio-win-command-line-installation">Values for ADDLOCAL to customize virtio-win command-line installation</h5>
<div class="paragraph">
<p>When installing <code class="filename">virtio-win-gt-x64.msi</code> or <code class="filename">virtio-win-gt-x32.msi</code> with the command line, you can install any one driver, or any combination of drivers.</p>
</div>
<div class="paragraph">
<p>You can also install specific agents, but you must also install each agent&#8217;s corresponding drivers.</p>
</div>
<div class="paragraph">
<p>The <code>ADDLOCAL</code> parameter of the <code class="cmd">msiexec</code> command enables you to specify which drivers or agents to install. <code>ADDLOCAL=ALL</code> installs all drivers and agents. Other values are listed in the following tables.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Possible values for ADDLOCAL to install drivers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value for ADDLOCAL</th>
<th class="tableblock halign-left valign-top">Driver Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_network_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-net</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized network driver provides enhanced performance over emulated devices like rtl.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_balloon_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtio-balloon</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the amount of memory a virtual machine actually accesses. It offers improved memory overcommitment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_pvpanic_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pvpanic</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QEMU pvpanic device driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_qemufwcfg_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qemufwcfg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QEMU FWCfg device driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_qemupciserial_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qemupciserial</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QEMU PCI serial device driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_spice_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Spice Driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A paravirtualized display driver reduces CPU usage on the host and provides better performance through reduced network bandwidth on most workloads.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_vioinput_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vioinput</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Input Driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_viorng_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viorng</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO RNG device driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_vioscsi_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vioscsi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO SCSI pass-through controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_vioserial_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vioserial</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Serial device driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_viostor_driver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>viostor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VirtIO Block driver.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Possible values for ADDLOCAL to install agents and required corresponding drivers</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Agent</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Corresponding driver(s)</th>
<th class="tableblock halign-left valign-top">Value for <code>ADDLOCAL</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spice Agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supports multiple monitors, responsible for client-mouse-mode support, reduces bandwidth usage, enables clipboard support between client and virtual machine, provide a better user experience and improved responsiveness.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vioserial</code> and Spice driver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FE_spice_Agent,FE_vioserial_driver,FE_spice_driver</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Examples</div>
<p>The following command installs only the VirtIO SCSI pass-through controller, the VirtIO Serial device driver, and the VirtIO Block driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">D:\ msiexec /i "virtio-win-gt-x64.msi" /qn ADDLOCAL=`FE_vioscsi_driver,FE_vioserial_driver,FE_viostor_driver</pre>
</div>
</div>
<div class="paragraph">
<p>The following command installs only the Spice Agent and its required corresponding drivers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">D:\ msiexec /i "virtio-win-gt-x64.msi" /qn ADDLOCAL = FE_spice_Agent,FE_vioserial_driver,FE_spice_driver</pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Updating_Win_Guest_Drivers_with_Windows_Updates">[Updating_Win_Guest_Drivers_with_Windows_Updates]</a></p>
</li>
<li>
<p><a href="#Updating_the_Guest_Agents_and_Drivers_on_Windows">[Updating_the_Guest_Agents_and_Drivers_on_Windows]</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Microsoft Developer website:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/msi/windows-installer-portal">Windows Installer</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/msi/command-line-options">Command-Line Options</a> for the Windows installer</p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/windows/win32/msi/property-reference">Property Reference</a> for the Windows installer</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Additional_Configuration">4. Additional Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Configuring_operating_systems_with_osinfo">4.1. Configuring Operating Systems with osinfo</h3>
<div class="paragraph">
<p>oVirt stores operating system configurations for virtual machines in <strong>/etc/ovirt-engine/osinfo.conf.d/00-defaults.properties</strong>. This file contains default values such as <code>os.other.devices.display.protocols.value = spice/qxl,vnc/vga,vnc/qxl</code>.</p>
</div>
<div class="paragraph">
<p>There are only a limited number of scenarios in which you would change these values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Adding an operating system that does not appear in the list of supported guest operating systems</p>
</li>
<li>
<p>Adding a product key (for example, <code>os.windows_10x64.productKey.value =</code>)</p>
</li>
<li>
<p>Configuring the <code>sysprep</code> path for a Windows virtual machine (for example, <code>os.windows_10x64.sysprepPath.value = ${ENGINE_USR}/conf/sysprep/sysprep.w10x64</code>)</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not edit the actual <strong>00-defaults.properties</strong> file. Changes will be overwritten if you upgrade or restore the Engine.</p>
</div>
<div class="paragraph">
<p>Do not change values that come directly from the operating system or the Engine, such as maximum memory size.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To change the operating system configurations, create an override file in <strong>/etc/ovirt-engine/osinfo.conf.d/</strong>. The file name must begin with a value greater than <code>00</code>, so that the file appears after <strong>/etc/ovirt-engine/osinfo.conf.d/00-defaults.properties</strong>, and ends with the extension, <strong>.properties</strong>.</p>
</div>
<div class="paragraph">
<p>For example, <strong>10-productkeys.properties</strong> overrides the default file, <strong>00-defaults.properties</strong>. The last file in the file list has precedence over earlier files.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Configuring_Single_Sign-On_for_Virtual_Machines">4.2. Configuring Single Sign-On for Virtual Machines</h3>
<div class="paragraph">
<p>Configuring single sign-on, also known as password delegation, allows you to automatically log in to a virtual machine using the credentials you use to log in to the VM Portal. Single sign-on can be used on both Enterprise Linux and Windows virtual machines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Single sign-on is not supported for virtual machines running Enterprise Linux 8.0.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If single sign-on to the VM Portal is enabled, single sign-on to virtual machines will not be possible. With single sign-on to the VM Portal enabled, the VM Portal does not need to accept a password, thus the password cannot be delegated to sign in to virtual machines.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="Configuring_Single_Sign-On_for_Red_Hat_Enterprise_Linux_Virtual_Machines">4.2.1. Configuring Single Sign-On for Enterprise Linux Virtual Machines Using IPA (IdM)</h4>
<div class="paragraph">
<p>To configure single sign-on for Enterprise Linux virtual machines using GNOME and KDE graphical desktop environments and IPA (IdM) servers, you must install the <code>ovirt-guest-agent</code> package on the virtual machine and install the packages associated with your window manager.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following procedure assumes that you have a working IPA configuration and that the IPA domain is already joined to the Engine. You must also ensure that the clocks on the Engine, the virtual machine and the system on which IPA (IdM) is hosted are synchronized using NTP.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Single Sign-On (SSO) is deprecated for virtual machines running Enterprise Linux version 7 or earlier.</p>
</div>
<div class="paragraph">
<p>SSO is not supported for virtual machines running Enterprise Linux 8 or later, or for Windows operating systems.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="configure-sso-linux-74" class="paragraph">
<p>Configuring Single Sign-On for Enterprise Linux Virtual Machines</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Enterprise Linux virtual machine.</p>
</li>
<li>
<p>Enable the repository:</p>
<div class="ulist">
<ul>
<li>
<p>For Enterprise Linux 6:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-6-server-rhv-4-agent-rpms</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --enable=rhel-7-server-rh-common-rpms</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Download and install the guest agent, single sign-on, and IPA packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ovirt-guest-agent-common ovirt-guest-agent-pam-module ovirt-guest-agent-gdm-plugin ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Run the following command and follow the prompts to configure <code>ipa-client</code> and join the virtual machine to the domain:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install --permit --mkhomedir</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In environments that use DNS obfuscation, this command should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install --domain=<em>FQDN</em> --server=<em>FQDN</em></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For Enterprise Linux 7.2 and later:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># authconfig --enablenis --update</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enterprise Linux 7.2 has a new version of the System Security Services Daemon (SSSD), which introduces configuration that is incompatible with the oVirt Engine guest agent single sign-on implementation. This command ensures that single sign-on works.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Fetch the details of an IPA user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># getent passwd <em>ipa-user</em></pre>
</div>
</div>
</li>
<li>
<p>Record the IPA user&#8217;s UID and GID:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>ipa-user</em>:*:936600010:936600001::/home/<em>ipa-user</em>:/bin/sh</pre>
</div>
</div>
</li>
<li>
<p>Create a home directory for the IPA user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /home/<em>ipa-user</em></pre>
</div>
</div>
</li>
<li>
<p>Assign ownership of the directory to the IPA user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown 936600010:936600001 /home/<em>ipa-user</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Log in to the VM Portal using the user name and password of a user configured to use single sign-on and connect to the console of the virtual machine. You will be logged in automatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Single_Sign_On_for_Windows_Virtual_Machines">4.2.2. Configuring single sign-on for Windows virtual machines</h4>
<div class="paragraph">
<p>To configure single sign-on for Windows virtual machines, the Windows guest agent must be installed on the guest virtual machine. The virtio-win ISO image provides this agent. If the <code>virtio-win<em>_version</em>.iso</code> image is not available in your storage domain, contact your system administrator.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the Windows virtual machine. Ensure the machine is powered up.</p>
</li>
<li>
<p>Click <strong>Change CD</strong>.</p>
</li>
<li>
<p>Select <code>virtio-win<em>_version</em>.iso</code> from the list of images.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <b class="button">Console</b> and log in to the virtual machine.</p>
</li>
<li>
<p>On the virtual machine, locate the CD drive to access the contents of the guest tools ISO file and launch <code>virtio-win<em>_version</em>.iso</code>. After the tools have been installed, you will be prompted to restart the machine to apply the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Log in to the VM Portal using the user name and password of a user configured to use single sign-on and connect to the console of the virtual machine. You will be logged in automatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="Disabling_Single_Sign-on_for_Virtual_Machines">4.2.3. Disabling Single Sign-on for Virtual Machines</h4>
<div class="paragraph">
<p>The following procedure explains how to disable single sign-on for a virtual machine.</p>
</div>
<div class="paragraph">
<p><strong>Disabling Single Sign-On for Virtual Machines</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select a virtual machine and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click the <strong>Console</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Disable Single Sign On</strong> check box.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Configuring_USB_Devices">4.3. Configuring USB Devices</h3>
<div class="paragraph">
<p>A virtual machine connected with the SPICE protocol can be configured to connect directly to USB devices.</p>
</div>
<div class="paragraph">
<p>The USB device will only be redirected if the virtual machine is active, in focus and is run from the VM Portal. USB redirection can be manually enabled each time a device is plugged in or set to automatically redirect to active virtual machines in the Console Options window.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note the distinction between the client machine and guest machine. The client is the hardware from which you access a guest. The guest is the virtual desktop or virtual server which is accessed through the VM Portal or Administration Portal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>USB redirection <strong>Enabled</strong> mode allows KVM/SPICE USB redirection for Linux and Windows virtual machines. Virtual (guest) machines require no guest-installed agents or drivers for native USB. On Enterprise Linux clients, all packages required for USB redirection are provided by the <code>virt-viewer</code> package. On Windows clients, you must also install the <code>usbdk</code> package. Enabled USB mode is supported on the following clients and guests:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have a 64-bit architecture PC, you must use the 64-bit version of Internet Explorer to install the 64-bit version of the USB driver. The USB redirection will not work if you install the 32-bit version on a 64-bit architecture. As long as you initially install the correct USB type, you can access USB redirection from both 32- and 64-bit browsers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="Using_USB_Devices_on_a_Windows_Client">4.3.1. Using USB Devices on a Windows Client</h4>
<div class="paragraph">
<p>The <code>usbdk</code> driver must be installed on the Windows client for the USB device to be redirected to the guest. Ensure the version of <code>usbdk</code> matches the architecture of the client machine. For example, the 64-bit version of <code>usbdk</code> must be installed on 64-bit Windows machines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>USB redirection is only supported when you open the virtual machine from the VM Portal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>When the <code>usbdk</code> driver is installed, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine that is configured to use the SPICE protocol.</p>
</li>
<li>
<p>Click the <strong>Console</strong> tab.</p>
</li>
<li>
<p>Select the <strong>USB enabled</strong> checkbox and click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Console</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Console Options</b></span>.</p>
</li>
<li>
<p>Select the <strong>Enable USB Auto-Share</strong> check box and click <b class="button">OK</b>.</p>
</li>
<li>
<p>Start the virtual machine from the VM Portal and click <b class="button">Console</b> to connect to that virtual machine.</p>
</li>
<li>
<p>Plug your USB device into the client machine to make it appear automatically on the guest machine.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Using_USB_Devices_on_a_Red_Hat_Enterprise_Linux_Client">4.3.2. Using USB Devices on a Enterprise Linux Client</h4>
<div class="paragraph">
<p>The <code>usbredir</code> package enables USB redirection from Enterprise Linux clients to virtual machines. <code>usbredir</code> is a dependency of the <code>virt-viewer</code> package, and is automatically installed together with that package.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>USB redirection is only supported when you open the virtual machine from the VM Portal.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Select a virtual machine that has been configured to use the SPICE protocol and click <b class="button">Edit</b>. This opens the <strong>Edit Virtual Machine</strong> window.</p>
</li>
<li>
<p>Click the <strong>Console</strong> tab.</p>
</li>
<li>
<p>Select the <strong>USB enabled</strong> checkbox and click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Console</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Console Options</b></span>.</p>
</li>
<li>
<p>Select the <strong>Enable USB Auto-Share</strong> check box and click <b class="button">OK</b>.</p>
</li>
<li>
<p>Start the virtual machine from the VM Portal and click <b class="button">Console</b> to connect to that virtual machine.</p>
</li>
<li>
<p>Plug your USB device into the client machine to make it appear automatically on the guest machine.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Configuring_Multiple_Monitors">4.4. Configuring Multiple Monitors</h3>
<div class="sect3">
<h4 id="Configuring_Multiple_Displays_for_Red_Hat_Enterprise_Linux_Guest_Virtual_Machines">4.4.1. Configuring Multiple Displays for Enterprise Linux Virtual Machines</h4>
<div class="paragraph">
<p>A maximum of four displays can be configured for a single Enterprise Linux virtual machine when connecting to the virtual machine using the SPICE protocol.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a SPICE session with the virtual machine.</p>
</li>
<li>
<p>Open the <strong>View</strong> drop-down menu at the top of the SPICE client window.</p>
</li>
<li>
<p>Open the <strong>Display</strong> menu.</p>
</li>
<li>
<p>Click the name of a display to enable or disable that display.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, <strong>Display 1</strong> is the only display that is enabled on starting a SPICE session with a virtual machine. If no other displays are enabled, disabling this display will close the session.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Multiple_Displays_for_Windows_Virtual_Machines">4.4.2. Configuring Multiple Displays for Windows Virtual Machines</h4>
<div class="paragraph">
<p>A maximum of four displays can be configured for a single Windows virtual machine when connecting to the virtual machine using the SPICE protocol.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>With the virtual machine in a powered-down state, click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click the <strong>Console</strong> tab.</p>
</li>
<li>
<p>Select the number of displays from the <strong>Monitors</strong> drop-down list.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This setting controls the maximum number of displays that can be enabled for the virtual machine. While the virtual machine is running, additional displays can be enabled up to this number.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Start a SPICE session with the virtual machine.</p>
</li>
<li>
<p>Open the <strong>View</strong> drop-down menu at the top of the SPICE client window.</p>
</li>
<li>
<p>Open the <strong>Display</strong> menu.</p>
</li>
<li>
<p>Click the name of a display to enable or disable that display.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, <strong>Display 1</strong> is the only display that is enabled on starting a SPICE session with a virtual machine. If no other displays are enabled, disabling this display will close the session.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Configuring_Console_Options">4.5. Configuring Console Options</h3>
<div class="sect3">
<h4 id="sect-Console_Options">4.5.1. Console Options</h4>
<div class="paragraph">
<p>Connection protocols are the underlying technology used to provide graphical consoles for virtual machines and allow users to work with virtual machines in a similar way as they would with physical machines. oVirt currently supports the following connection protocols:</p>
</div>
<div class="paragraph">
<p><strong>SPICE</strong></p>
</div>
<div class="paragraph">
<p>Simple Protocol for Independent Computing Environments (SPICE) is the recommended connection protocol for both Linux virtual machines and Windows virtual machines. To open a console to a virtual machine using SPICE, use Remote Viewer.</p>
</div>
<div class="paragraph">
<p><strong>VNC</strong></p>
</div>
<div class="paragraph">
<p>Virtual Network Computing (VNC) can be used to open consoles to both Linux virtual machines and Windows virtual machines. To open a console to a virtual machine using VNC, use Remote Viewer or a VNC client.</p>
</div>
<div class="paragraph">
<p><strong>RDP</strong></p>
</div>
<div class="paragraph">
<p>Remote Desktop Protocol (RDP) can only be used to open consoles to Windows virtual machines, and is only available when you access a virtual machines from a Windows machine on which Remote Desktop has been installed. Before you can connect to a Windows virtual machine using RDP, you must set up remote sharing on the virtual machine and configure the firewall to allow remote desktop connections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SPICE is not supported on virtual machines running Windows 8 or Windows 8.1. If a virtual machine running one of these operating systems is configured to use the SPICE protocol, it detects the absence of the required SPICE drivers and runs in VGA compatibility mode.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Accessing_console_options">4.5.2. Accessing Console Options</h4>
<div class="paragraph">
<p>You can configure several options for opening graphical consoles for virtual machines in the Administration Portal.</p>
</div>
<div class="paragraph">
<p><strong>Accessing Console Options</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a running virtual machine.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Console</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Console Options</b></span>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can configure the connection protocols and video type in the <strong>Console</strong> tab of the <strong>Edit Virtual Machine</strong> window in the Administration Portal. Additional options specific to each of the connection protocols, such as the keyboard layout when using the VNC connection protocol, can be configured. See <a href="#Virtual_Machine_Console_settings_explained">[Virtual_Machine_Console_settings_explained]</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="SPICE_Console_Options">4.5.3. SPICE Console Options</h4>
<div class="paragraph">
<p>When the SPICE connection protocol is selected, the following options are available in the <strong>Console Options</strong> window.</p>
</div>
<div class="paragraph">
<p>SPICE Options</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Map control-alt-del shortcut to ctrl+alt+end</strong>: Select this check box to map the <code>Ctrl</code> + <code>Alt</code> + <code>Del</code> key combination to <code>Ctrl</code> + <code>Alt</code> + <code>End</code> inside the virtual machine.</p>
</li>
<li>
<p><strong>Enable USB Auto-Share</strong>: Select this check box to automatically redirect USB devices to the virtual machine. If this option is not selected, USB devices will connect to the client machine instead of the guest virtual machine. To use the USB device on the guest machine, manually enable it in the SPICE client menu.</p>
</li>
<li>
<p><strong>Open in Full Screen</strong>: Select this check box for the virtual machine console to automatically open in full screen when you connect to the virtual machine. Press <code>SHIFT</code> + <code>F11</code> to toggle full screen mode on or off.</p>
</li>
<li>
<p><strong>Enable SPICE Proxy</strong>: Select this check box to enable the SPICE proxy.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="VNC_Console_Options">4.5.4. VNC Console Options</h4>
<div class="paragraph">
<p>When the VNC connection protocol is selected, the following options are available in the <strong>Console Options</strong> window.</p>
</div>
<div class="paragraph">
<p><strong>Console Invocation</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Native Client</strong>: When you connect to the console of the virtual machine, a file download dialog provides you with a file that opens a console to the virtual machine via Remote Viewer.</p>
</li>
<li>
<p><strong>noVNC</strong>: When you connect to the console of the virtual machine, a browser tab is opened that acts as the console.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>VNC Options</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Map control-alt-delete shortcut to ctrl+alt+end</strong>: Select this check box to map the <code>Ctrl</code> + <code>Alt</code> + <code>Del</code> key combination to <code>Ctrl</code> + <code>Alt</code> + <code>End</code> inside the virtual machine.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="RDP_Console_Options">4.5.5. RDP Console Options</h4>
<div class="paragraph">
<p>When the RDP connection protocol is selected, the following options are available in the <strong>Console Options</strong> window.</p>
</div>
<div class="paragraph">
<p><strong>Console Invocation</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Auto</strong>: The Engine automatically selects the method for invoking the console.</p>
</li>
<li>
<p><strong>Native client</strong>: When you connect to the console of the virtual machine, a file download dialog provides you with a file that opens a console to the virtual machine via Remote Desktop.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>RDP Options</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Use Local Drives</strong>: Select this check box to make the drives on the client machine accessible on the guest virtual machine.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="sect-Remote_Viewer_Options">4.5.6. Remote Viewer Options</h4>
<div class="sect4">
<h5 id="Remote_Viewer_Options">Remote Viewer Options</h5>
<div class="paragraph">
<p>When you specify the <strong>Native client</strong> console invocation option, you will connect to virtual machines using Remote Viewer. The Remote Viewer window provides a number of options for interacting with the virtual machine to which it is connected.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Remote Viewer Options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Hotkey</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Screenshot</strong>: Takes a screen capture of the active window and saves it in a location of your specification.</p>
</li>
<li>
<p><strong>USB device selection</strong>: If USB redirection has been enabled on your virtual machine, the USB device plugged into your client machine can be accessed from this menu.</p>
</li>
<li>
<p><strong>Quit</strong>: Closes the console. The hot key for this option is <code>Shift</code> + <code>Ctrl</code> + <code>Q</code>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Full screen</strong>: Toggles full screen mode on or off. When enabled, full screen mode expands the virtual machine to fill the entire screen. When disabled, the virtual machine is displayed as a window. The hot key for enabling or disabling full screen is <code>SHIFT</code> + <code>F11</code>.</p>
</li>
<li>
<p><strong>Zoom</strong>: Zooms in and out of the console window. <code>Ctrl</code> + <code>+</code> zooms in, <code>Ctrl</code> + <code>-</code> zooms out, and <code>Ctrl</code> + <code>0</code> returns the screen to its original size.</p>
</li>
<li>
<p><strong>Automatically resize</strong>: Select to enable the guest resolution to automatically scale according to the size of the console window.</p>
</li>
<li>
<p><strong>Displays</strong>: Allows users to enable and disable displays for the guest virtual machine.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send key</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>Del</code>: On a Enterprise Linux virtual machine, it displays a dialog with options to suspend, shut down or restart the virtual machine. On a Windows virtual machine, it displays the task manager or Windows Security dialog.</p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>Backspace</code>: On a Enterprise Linux virtual machine, it restarts the X sever. On a Windows virtual machine, it does nothing.</p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F1</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F2</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F3</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F4</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F5</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F6</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F7</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F8</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F9</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F10</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F11</code></p>
</li>
<li>
<p><code>Ctrl</code> + <code>Alt</code> + <code>F12</code></p>
</li>
<li>
<p><code>Printscreen</code>: Passes the <strong>Printscreen</strong> keyboard option to the virtual machine.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <strong>About</strong> entry displays the version details of Virtual Machine Viewer that you are using.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release Cursor from Virtual Machine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SHIFT</code> + <code>F12</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="Remote_Viewer_Hotkeys">Remote Viewer Hotkeys</h5>
<div class="paragraph">
<p>You can access the hotkeys for a virtual machine in both full screen mode and windowed mode. If you are using full screen mode, you can display the menu containing the button for hotkeys by moving the mouse pointer to the middle of the top of the screen. If you are using windowed mode, you can access the hotkeys via the <strong>Send key</strong> menu on the virtual machine window title bar.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>vdagent</code> is not running on the client machine, the mouse can become captured in a virtual machine window if it is used inside a virtual machine and the virtual machine is not in full screen. To unlock the mouse, press <code>Shift</code> + <code>F12</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="Manually_Associating_console.vv_Files_with_Remote_Viewer">Manually Associating console.vv Files with Remote Viewer</h5>
<div class="paragraph">
<p>If you are prompted to download a <strong>console.vv</strong> file when attempting to open a console to a virtual machine using the native client console option, and Remote Viewer is already installed, then you can manually associate <strong>console.vv</strong> files with Remote Viewer so that Remote Viewer can automatically use those files to open consoles.</p>
</div>
<div class="paragraph">
<p><strong>Manually Associating console.vv Files with Remote Viewer</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start the virtual machine.</p>
</li>
<li>
<p>Open the <strong>Console Options</strong> window:</p>
<div class="ulist">
<ul>
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Console</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Console Options</b></span>.</p>
</li>
<li>
<p>In the VM Portal, click the virtual machine name and click the pencil icon beside <strong>Console</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Change the console invocation method to <strong>Native client</strong> and click <b class="button">OK</b>.</p>
</li>
<li>
<p>Attempt to open a console to the virtual machine, then click <strong>Save</strong> when prompted to open or save the <strong>console.vv</strong> file.</p>
</li>
<li>
<p>Click the location on your local machine where you saved the file.</p>
</li>
<li>
<p>Double-click the <strong>console.vv</strong> file and select <strong>Select a program from a list of installed programs</strong> when prompted.</p>
</li>
<li>
<p>In the <strong>Open with</strong> window, select <strong>Always use the selected program to open this kind of file</strong> and click the <strong>Browse</strong> button.</p>
</li>
<li>
<p>Click the <strong>C:\Users_[user name]_\AppData\Local\virt-viewer\bin</strong> directory and select <strong>remote-viewer.exe</strong>.</p>
</li>
<li>
<p>Click <strong>Open</strong> and then click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you use the native client console invocation option to open a console to a virtual machine, Remote Viewer will automatically use the <strong>console.vv</strong> file that the oVirt Engine provides to open a console to that virtual machine without prompting you to select the application to use.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Configuring_a_Watchdog">4.6. Configuring a Watchdog</h3>
<div class="sect3">
<h4 id="Adding_a_Watchdog_Card_to_a_Virtual_machine">4.6.1. Adding a Watchdog Card to a Virtual Machine</h4>
<div class="paragraph">
<p>You can add a watchdog card to a virtual machine to monitor the operating system&#8217;s responsiveness.</p>
</div>
<div class="paragraph">
<p><strong>Adding Watchdog Cards to Virtual Machines</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click the <strong>High Availability</strong> tab.</p>
</li>
<li>
<p>Select the watchdog model to use from the <strong>Watchdog Model</strong> drop-down list.</p>
</li>
<li>
<p>Select an action from the <strong>Watchdog Action</strong> drop-down list. This is the action that the virtual machine takes when the watchdog is triggered.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Installing_a_Watchdog">4.6.2. Installing a Watchdog</h4>
<div class="paragraph">
<p>To activate a watchdog card attached to a virtual machine, you must install the <code>watchdog</code> package on that virtual machine and start the <code>watchdog</code> service.</p>
</div>
<div class="paragraph">
<p><strong>Installing Watchdogs</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the virtual machine on which the watchdog card is attached.</p>
</li>
<li>
<p>Install the <code>watchdog</code> package and dependencies:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install watchdog</pre>
</div>
</div>
</li>
<li>
<p>Edit the <strong>/etc/watchdog.conf</strong> file and uncomment the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">watchdog-device = /dev/watchdog</pre>
</div>
</div>
</li>
<li>
<p>Save the changes.</p>
</li>
<li>
<p>Start the <code>watchdog</code> service and ensure this service starts on boot:</p>
<div class="ulist">
<ul>
<li>
<p>Enterprise Linux 6:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># service watchdog start
# chkconfig watchdog on</pre>
</div>
</div>
</li>
<li>
<p>Enterprise Linux 7:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start watchdog.service
# systemctl enable watchdog.service</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Confirming_Watchdog_Functionality">4.6.3. Confirming Watchdog Functionality</h4>
<div class="paragraph">
<p>Confirm that a watchdog card has been attached to a virtual machine and that the <code>watchdog</code> service is active.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This procedure is provided for testing the functionality of watchdogs only and must not be run on production machines.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Confirming Watchdog Functionality</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the virtual machine on which the watchdog card is attached.</p>
</li>
<li>
<p>Confirm that the watchdog card has been identified by the virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># lspci | grep watchdog -i</pre>
</div>
</div>
</li>
<li>
<p>Run one of the following commands to confirm that the watchdog is active:</p>
<div class="ulist">
<ul>
<li>
<p>Trigger a kernel panic:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo c &gt; /proc/sysrq-trigger</pre>
</div>
</div>
</li>
<li>
<p>Terminate the <code>watchdog</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kill -9 <code>pgrep watchdog</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The watchdog timer can no longer be reset, so the watchdog counter reaches zero after a short period of time. When the watchdog counter reaches zero, the action specified in the <strong>Watchdog Action</strong> drop-down menu for that virtual machine is performed.</p>
</div>
</div>
<div class="sect3">
<h4 id="Parameters_for_Watchdogs_in_watchdog_conf">4.6.4. Parameters for Watchdogs in watchdog.conf</h4>
<div class="paragraph">
<p>The following is a list of options for configuring the <code>watchdog</code> service available in the <strong>/etc/watchdog.conf</strong> file. To configure an option, you must uncomment that option and restart the <code>watchdog</code> service after saving the changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a more detailed explanation of options for configuring the <code>watchdog</code> service and using the <code>watchdog</code> command, see the <code>watchdog</code> man page.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. watchdog.conf variables</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An IP address that the watchdog attempts to ping to verify whether that address is reachable. You can specify multiple IP addresses by adding additional <code>ping</code> lines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interface</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A network interface that the watchdog will monitor to verify the presence of network traffic. You can specify multiple network interfaces by adding additional <code>interface</code> lines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/log/messages</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A file on the local system that the watchdog will monitor for changes. You can specify multiple files by adding additional <code>file</code> lines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>change</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1407</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of watchdog intervals after which the watchdog checks for changes to files. A <code>change</code> line must be specified on the line directly after each <code>file</code> line, and applies to the <code>file</code> line directly above that <code>change</code> line.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-load-1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum average load that the virtual machine can sustain over a one-minute period. If this average is exceeded, then the watchdog is triggered. A value of <code>0</code> disables this feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-load-5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum average load that the virtual machine can sustain over a five-minute period. If this average is exceeded, then the watchdog is triggered. A value of <code>0</code> disables this feature. By default, the value of this variable is set to a value approximately three quarters that of <code>max-load-1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-load-15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum average load that the virtual machine can sustain over a fifteen-minute period. If this average is exceeded, then the watchdog is triggered. A value of <code>0</code> disables this feature. By default, the value of this variable is set to a value approximately one half that of <code>max-load-1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>min-memory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum amount of virtual memory that must remain free on the virtual machine. This value is measured in pages. A value of <code>0</code> disables this feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repair-binary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/usr/sbin/repair</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path and file name of a binary file on the local system that will be run when the watchdog is triggered. If the specified file resolves the issues preventing the watchdog from resetting the watchdog counter, then the watchdog action is not triggered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-binary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path and file name of a binary file on the local system that the watchdog will attempt to run during each interval. A test binary allows you to specify a file for running user-defined tests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>test-timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time limit, in seconds, for which user-defined tests can run. A value of <code>0</code> allows user-defined tests to continue for an unlimited duration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>temperature-device</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to and name of a device for checking the temperature of the machine on which the <code>watchdog</code> service is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max-temperature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>120</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum allowed temperature for the machine on which the <code>watchdog</code> service is running. The machine will be halted if this temperature is reached. Unit conversion is not taken into account, so you must specify a value that matches the watchdog card being used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>root</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email address to which email notifications are sent.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval, in seconds, between updates to the watchdog device. The watchdog device expects an update at least once every minute, and if there are no updates over a one-minute period, then the watchdog is triggered. This one-minute period is hard-coded into the drivers for the watchdog device, and cannot be configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logtick</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When verbose logging is enabled for the <code>watchdog</code> service, the <code>watchdog</code> service periodically writes log messages to the local system. The <code>logtick</code> value represents the number of watchdog intervals after which a message is written.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>realtime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>yes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the watchdog is locked in memory. A value of <code>yes</code> locks the watchdog in memory so that it is not swapped out of memory, while a value of <code>no</code> allows the watchdog to be swapped out of memory. If the watchdog is swapped out of memory and is not swapped back in before the watchdog counter reaches zero, then the watchdog is triggered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>priority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The schedule priority when the value of <code>realtime</code> is set to <code>yes</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pidfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/var/run/syslogd.pid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path and file name of a PID file that the watchdog monitors to see if the corresponding process is still active. If the corresponding process is not active, then the watchdog is triggered.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_virtual_numa">4.7. Configuring Virtual NUMA</h3>
<div class="paragraph">
<p>In the Administration Portal, you can configure virtual NUMA nodes on a virtual machine and pin them to physical NUMA nodes on one or more hosts. The host’s default policy is to schedule and run virtual machines on any available resources on the host. As a result, the resources backing a large virtual machine that cannot fit within a single host socket could be spread out across multiple NUMA nodes. Over time these resources may be moved around, leading to poor and unpredictable performance. Configure and pin virtual NUMA nodes to avoid this outcome and improve performance.</p>
</div>
<div class="paragraph">
<p>Configuring virtual NUMA requires a NUMA-enabled host. To confirm whether NUMA is enabled on a host, log in to the host and run <code>numactl --hardware</code>. The output of this command should show at least two NUMA nodes. You can also view the host&#8217;s NUMA topology in the Administration Portal by selecting the host from the <strong>Hosts</strong> tab and clicking <strong>NUMA Support</strong>. This button is only available when the selected host has at least two NUMA nodes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you define <strong>NUMA Pinning</strong>, the default migration mode is <strong>Allow manual migration only</strong> by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuring Virtual NUMA</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click <b class="button">Show Advanced Options</b>.</p>
</li>
<li>
<p>Click the <strong>Host</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Specific Host(s)</strong> radio button and select the host(s) from the list. The selected host(s) must have at least two NUMA nodes.</p>
</li>
<li>
<p>Click <strong>NUMA Pinning</strong>.</p>
</li>
<li>
<p>In the <strong>NUMA Topology</strong> window, click and drag virtual NUMA nodes from the box on the right to host NUMA nodes on the left as required, and click <b class="button">OK</b>.</p>
</li>
<li>
<p>Select <strong>Strict</strong>, <strong>Preferred</strong>, or <strong>Interleave</strong> from the <strong>Tune Mode</strong> drop-down list in each NUMA node. If the selected mode is <strong>Preferred</strong>, the <strong>NUMA Node Count</strong> must be set to <code>1</code>.</p>
</li>
<li>
<p>You can also set the NUMA pinning policy automatically by selecting an <strong>Auto Pinning Policy</strong> from the drop-down list:</p>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong> - makes no changes to the virtual machine.</p>
</li>
<li>
<p><strong>Resize and Pin</strong> - maximizes the CPU topology and generates the CPU pinning and NUMA pinning configurations.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not pin the virtual NUMA node to a host NUMA node, the system defaults to the NUMA node that contains the host device&#8217;s memory-mapped I/O (MMIO), provided that there are one or more host devices and all of those devices are from a single NUMA node.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Satellite_Errata">4.8. Configuring Satellite errata viewing for a virtual machine</h3>
<div class="paragraph">
<p>In the Administration Portal, you can configure a virtual machine to display the available errata. The virtual machine needs to be associated with a Red Hat Satellite server to show available errata.</p>
</div>
<div class="paragraph">
<p>oVirt 4.4 supports viewing errata with Red Hat Satellite 6.6.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Satellite server must be added as an external provider.</p>
</li>
<li>
<p>The Engine and any virtual machines on which you want to view errata must all be registered in the Satellite server by their respective FQDNs. This ensures that external content host IDs do not need to be maintained in oVirt.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Virtual machines added using an IP address cannot report errata.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The host that the virtual machine runs on also needs to be configured to receive errata information from Satellite.</p>
</li>
<li>
<p>The virtual machine must have the <code>ovirt-guest-agent</code> package installed. This package enables the virtual machine to report its host name to the oVirt Engine, which enables the Red Hat Satellite server to identify the virtual machine as a content host and report the applicable errata.</p>
</li>
<li>
<p>The virtual machine must be registered to the Red Hat Satellite server as a content host.</p>
</li>
<li>
<p>Use Red Hat Satellite remote execution to manage packages on hosts.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Katello agent is deprecated and will be removed in a future Satellite version. Migrate your processes to use the remote execution feature to update clients remotely.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click the <strong>Foreman/Satellite</strong> tab.</p>
</li>
<li>
<p>Select the required Satellite server from the <strong>Provider</strong> drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#Configuring_Satellite_Errata_Management_for_a_Host">Setting up Satellite errata viewing for a host</a> in the <em>Administration Guide</em></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">Installing the Guest Agents, Tools, and Drivers on Linux</a> in the <em>Virtual Machine Management Guide</em> for Enterprise Linux virtual machines.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Windows">Installing the Guest Agents, Tools, and Drivers on Windows</a> in the <em>Virtual Machine Management Guide</em> for Windows virtual machines.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Headless_Machines">4.9. Configuring Headless Virtual Machines</h3>
<div class="paragraph">
<p>You can configure a headless virtual machine when it is not necessary to access the machine via a graphical console. This headless machine will run without graphical and video devices. This can be  useful in situations where the host has limited resources, or to comply with virtual machine usage requirements such as real-time virtual machines.</p>
</div>
<div class="paragraph">
<p>Headless virtual machines can be administered via a Serial Console, SSH, or any other service for command line access. Headless mode is applied via the <strong>Console</strong> tab when creating or editing virtual machines and machine pools, and when editing templates. It is also available when creating or editing instance types.</p>
</div>
<div class="paragraph">
<p>If you are creating a new headless virtual machine, you can use the <strong>Run Once</strong> window to access the virtual machine via a graphical console for the first run only. See <a href="#Virtual_Machine_Run_Once_settings_explained">[Virtual_Machine_Run_Once_settings_explained]</a> for more details.</p>
</div>
<div class="paragraph">
<p>Prerequisites</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are editing an existing virtual machine, and the oVirt guest agent has not been installed, note the machine&#8217;s IP prior to selecting <strong>Headless Mode</strong>.</p>
</li>
<li>
<p>Before running a virtual machine in headless mode, the GRUB configuration for this machine must be set to console mode otherwise the guest operating system&#8217;s boot process will hang. To set console mode, comment out the spashimage flag in the GRUB menu configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> #splashimage=(hd0,0)/grub/splash.xpm.gz serial --unit=0 --speed=9600 --parity=no --stop=1 terminal --timeout=2 serial</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Restart the virtual machine if it is running when selecting the <strong>Headless Mode</strong> option.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuring a Headless Virtual Machine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click the <strong>Console</strong> tab.</p>
</li>
<li>
<p>Select <strong>Headless Mode</strong>. All other fields in the <strong>Graphical Console</strong> section are disabled.</p>
</li>
<li>
<p>Optionally, select <strong>Enable VirtIO serial console</strong> to enable communicating with the virtual machine via serial console. This is highly recommended.</p>
</li>
<li>
<p>Reboot the virtual machine if it is running. See <a href="#Rebooting_a_Virtual_Machine">[Rebooting_a_Virtual_Machine]</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_High_Performance_Virtual_Machines_Templates_and_Pools">4.10. Configuring High Performance Virtual Machines, Templates, and Pools</h3>
<div class="paragraph">
<p>You can configure a virtual machine for high performance, so that it runs with performance metrics as close to bare metal as possible. When you choose high performance optimization, the virtual machine is configured with a set of automatic, and recommended manual, settings for maximum efficiency.</p>
</div>
<div class="paragraph">
<p>The high performance option is only accessible in the Administration Portal, by selecting <strong>High Performance</strong> from the <strong>Optimized for</strong> dropdown list in the <strong>Edit</strong> or <strong>New</strong> virtual machine, template, or pool window. This option is not available in the VM Portal.</p>
</div>
<div class="paragraph">
<p>The high performance option is supported by oVirt 4.2 and later. It is not available for earlier versions.</p>
</div>
<div class="paragraph">
<p><strong>Virtual Machines</strong></p>
</div>
<div class="paragraph">
<p>If you change the optimization mode of a running virtual machine to high performance, some configuration changes require restarting the virtual machine.</p>
</div>
<div class="paragraph">
<p>To change the optimization mode of a new or existing virtual machine to high performance, you may need to make manual changes to the cluster and to the pinned host configuration first.</p>
</div>
<div class="paragraph">
<p>A high performance virtual machine has certain limitations, because enhanced performance has a trade-off in decreased flexibility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If pinning is set for CPU threads, I/O threads, emulator threads, or NUMA nodes, according to the recommended settings, only a subset of cluster hosts can be assigned to the high performance virtual machine.</p>
</li>
<li>
<p>Many devices are automatically disabled, which limits the virtual machine&#8217;s usability.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Templates and Pools</strong></p>
</div>
<div class="paragraph">
<p>High performance templates and pools are created and edited in the same way as virtual machines. If a high performance template or pool is used to create new virtual machines, those virtual machines inherits this property and its configurations. Certain settings, however, are not inherited and must be set manually:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU pinning</p>
</li>
<li>
<p>Virtual NUMA and NUMA pinning topology</p>
</li>
<li>
<p>I/O and emulator threads pinning topology</p>
</li>
<li>
<p>Pass-through Host CPU</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="creating-a-high-performance-virtual-machine-template-or-pool">4.10.1. Creating a High Performance Virtual Machine, Template, or Pool</h4>
<div class="paragraph">
<p>To create a high performance virtual machine, template, or pool:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>New</strong> or <strong>Edit</strong> window, select <strong>High Performance</strong> from the <strong>Optimized for</strong> drop-down menu.</p>
<div class="paragraph">
<p>Selecting this option automatically performs certain configuration changes to this virtual machine, which you can view by clicking different tabs. You can change them back to their original settings or override them. (See <a href="#Automatic_High_Performance_Configuration_Settings">Automatic High Performance Configuration Settings</a> for details.) If you change a setting, its latest value is saved.</p>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
<div class="paragraph">
<p>If you have not set any manual configurations, the <strong>High Performance Virtual Machine/Pool Settings</strong> screen describing the recommended manual configurations appears.</p>
</div>
<div class="paragraph">
<p>If you have set some of the manual configurations, the <strong>High Performance Virtual Machine/Pool Settings</strong> screen displays the settings you have not made.</p>
</div>
<div class="paragraph">
<p>If you have set all the recommended manual configurations, the <strong>High Performance Virtual Machine/Pool Settings</strong> screen does not appear.</p>
</div>
</li>
<li>
<p>If the <strong>High Performance Virtual Machine/Pool Settings</strong> screen appears, click <b class="button">Cancel</b> to return to the <strong>New</strong> or <strong>Edit</strong> window to perform the manual configurations. See <a href="#Configuring_Recommended_Manual_Settings">Configuring the Recommended Manual Settings</a> for details.</p>
<div class="paragraph">
<p>Alternatively, click <b class="button">OK</b> to ignore the recommendations. The result may be a drop in the level of performance.</p>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
<div class="paragraph">
<p>You can view the optimization type in the <strong>General</strong> tab of the details view of the virtual machine, pool, or template.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Certain configurations can override the high performance settings. For example, if you select an instance type for a virtual machine before selecting <strong>High Performance</strong> from the <strong>Optimized for</strong> drop-down menu and performing the manual configuration, the instance type configuration will not affect the high performance configuration. If, however, you select the instance type after the high performance configurations, you should verify the final configuration in the different tabs to ensure that the high performance configurations have not been overridden by the instance type.</p>
</div>
<div class="paragraph">
<p>The last-saved configuration usually takes priority.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Support for instance types is now deprecated, and will be removed in a future release.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="Automatic_High_Performance_Configuration_Settings">Automatic High Performance Configuration Settings</h5>
<div class="paragraph">
<p>The following table summarizes the automatic settings. The <strong>Enabled (Y/N)</strong> column indicates configurations that are enabled or disabled. The <strong>Applies to</strong> column indicates the relevant resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VM - Virtual machine</p>
</li>
<li>
<p>T - Template</p>
</li>
<li>
<p>P - Pool</p>
</li>
<li>
<p>C - Cluster</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Automatic High Performance Configuration Settings</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-center valign-top">Enabled (Y/N)</th>
<th class="tableblock halign-center valign-top">Applies to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Headless Mode</strong> (Console tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>USB Enabled</strong> (Console tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Smartcard Enabled</strong> (Console tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Soundcard Enabled</strong> (Console tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable VirtIO serial console</strong> (Console tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow manual migration only</strong> (Host tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Pass-Through Host CPU</strong> (Host tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Highly Available</strong> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> (High Availability tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>No-Watchdog</strong> (High Availability tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Memory Balloon Device</strong> (Resource Allocation tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I/O Threads Enabled</strong> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> (Resource Allocation tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Paravirtualized Random Number Generator PCI (virtio-rng) device (Random Generator tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">I/O and emulator threads pinning topology</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU cache layer 3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="IO_and_Emulator_Threads_Pinning_Topology">I/O and Emulator Threads Pinning Topology (Automatic Settings)</h5>
<div class="paragraph">
<p>The I/O and emulator threads pinning topology is a new configuration setting for oVirt 4.2. It requires that I/O threads, NUMA nodes, and NUMA pinning be enabled and set for the virtual machine. Otherwise, a warning will appear in the engine log.</p>
</div>
<div class="paragraph">
<p>Pinning topology:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first two CPUs of each NUMA node are pinned.</p>
</li>
<li>
<p>If all vCPUs fit into one NUMA node of the host:</p>
<div class="ulist">
<ul>
<li>
<p>The first two vCPUs are automatically reserved/pinned</p>
</li>
<li>
<p>The remaining vCPUs are available for manual vCPU pinning</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the virtual machine spans more than one NUMA node:</p>
<div class="ulist">
<ul>
<li>
<p>The first two CPUs of the NUMA node with the most pins are reserved/pinned</p>
</li>
<li>
<p>The remaining pinned NUMA node(s) are for vCPU pinning only</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pools do not support I/O and emulator threads pinning.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a host CPU is pinned to both a vCPU and I/O and emulator threads, a warning will appear in the log and you will be asked to consider changing the CPU pinning topology to avoid this situation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="high-performance-icons">High Performance Icons</h5>
<div class="paragraph">
<p>The following icons indicate the states of a high performance virtual machine in the <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> screen.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. High Performance Icons</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Icon</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/hp_vm.png" alt="hp vm"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High performance virtual machine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/hp_vm_next_run.png" alt="hp vm next run"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High performance virtual machine with Next Run configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/stateless_hp_vm.png" alt="stateless hp vm"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stateless, high performance virtual machine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/stateless_hp_vm_next_run.png" alt="stateless hp vm next run"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stateless, high performance virtual machine with Next Run configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/vm_hp_pool.png" alt="vm hp pool"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine in a high performance pool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/vm_hp_pool_next_run.png" alt="vm hp pool next run"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine in a high performance pool with Next Run configuration</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Recommended_Manual_Settings">4.10.2. Configuring the Recommended Manual Settings</h4>
<div class="paragraph">
<p>You can configure the recommended manual settings in either the <strong>New</strong> or the <strong>Edit</strong> windows.</p>
</div>
<div class="paragraph">
<p>If a recommended setting is not performed, the <strong>High Performance Virtual Machine/Pool Settings</strong> screen displays the recommended setting when you save the resource.</p>
</div>
<div class="paragraph">
<p>The recommended manual settings are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Pinning_CPU">Pinning CPUs</a></p>
</li>
<li>
<p><a href="#Setting_NUMA_Nodes">Setting the NUMA Pinning Policy</a></p>
</li>
<li>
<p><a href="#Configuring_Huge_Pages">Configuring Huge Pages</a></p>
</li>
<li>
<p><a href="#Disabling_KSM">Disabling KSM</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Manual_High_Performance_Configuration_Settings">Manual High Performance Configuration Settings</h5>
<div class="paragraph">
<p>The following table summarizes the recommended manual settings. The <strong>Enabled (Y/N)</strong> column indicates configurations that should be enabled or disabled. The <strong>Applies to</strong> column indicates the relevant resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VM - Virtual machine</p>
</li>
<li>
<p>T - Template</p>
</li>
<li>
<p>P - Pool</p>
</li>
<li>
<p>C - Cluster</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Manual High Performance Configuration Settings</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-center valign-top">Enabled (Y/N)</th>
<th class="tableblock halign-center valign-top">Applies to</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NUMA Node Count</strong> (Host tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Tune Mode</strong> (NUMA Pinning screen)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NUMA Pinning</strong> (Host tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Auto Pinning Policy</strong> (Host tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU Pinning topology</strong> (Resource Allocation tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>hugepages</strong> (Custom Properties tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Y</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>VM, T, P</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>KSM</strong> (Optimization tab)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>N</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="Pinning_CPU">Pinning CPUs</h5>
<div class="paragraph">
<p>To pin vCPUs to a specific host&#8217;s physical CPU:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Host</strong> tab, select the <strong>Specific Host(s)</strong> radio button.</p>
</li>
<li>
<p>In the <strong>Resource Allocation</strong> tab, enter the <strong>CPU Pinning Topology</strong>, verifying that the configuration fits the pinned host&#8217;s configuration. See <a href="#Virtual_Machine_Resource_Allocation_settings_explained">[Virtual_Machine_Resource_Allocation_settings_explained]</a> for information about the syntax of this field.</p>
<div class="paragraph">
<p>This field is populated automatically and the CPU topology is updated when automatic NUMA pinning is activated.</p>
</div>
</li>
<li>
<p>Verify that the virtual machine configuration is compatible with the host configuration:</p>
<div class="ulist">
<ul>
<li>
<p>A virtual machine&#8217;s number of sockets must not be greater than the host&#8217;s number of sockets.</p>
</li>
<li>
<p>A virtual machine&#8217;s number of cores per virtual socket must not be greater than the host&#8217;s number of cores.</p>
</li>
<li>
<p>CPU-intensive workloads perform best when the host and virtual machine expect the same cache usage. To achieve the best performance, a virtual machine&#8217;s number of threads per core must not be greater than that of the host.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CPU pinning has the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the host is NUMA-enabled, the host&#8217;s NUMA settings (memory and CPUs) must be considered because the virtual machine has to fit the host&#8217;s NUMA configuration.</p>
</li>
<li>
<p>The <a href="#IO_and_Emulator_Threads_Pinning_Topology">I/O and emulator threads pinning topology</a> must be considered.</p>
</li>
<li>
<p>CPU pinning can only be set for virtual machines and pools, but not for templates. Therefore, you must set CPU pinning manually whenever you create a high performance virtual machine or pool, even if they are based on a high performance template.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="Setting_NUMA_Nodes">Setting the NUMA Pinning Policy</h5>
<div class="paragraph">
<p>To set the NUMA Pinning Policy, you need a NUMA-enabled pinned host with at least two NUMA nodes.
You can configure the NUMA topology manually, or use the <strong>Auto Pinning Policy</strong> option to configure the topology automatically.</p>
</div>
<div class="olist arabic">
<div class="title">To set the NUMA pinning policy manually:</div>
<ol class="arabic">
<li>
<p>Click <b class="button">NUMA Pinning</b>.</p>
</li>
<li>
<p>In the <strong>NUMA Topology</strong> window, click and drag virtual NUMA nodes from the box on the right to the host&#8217;s physical NUMA nodes on the left as required.</p>
</li>
<li>
<p>Select <strong>Strict</strong>, <strong>Preferred</strong>, or <strong>Interleave</strong> from the <strong>Tune Mode</strong> drop-down list in each NUMA node. If the selected mode is <strong>Preferred</strong>, the <strong>NUMA Node Count</strong> must be set to <code>1</code>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">To set the NUMA pinning policy automatically:</div>
<ol class="arabic">
<li>
<p>In the <strong>Host</strong> tab, select the <strong>Specific Host(s)</strong> radio button and select the host(s) from the list. The selected host(s) must have at least two NUMA nodes.</p>
</li>
<li>
<p>Under <strong>Configure NUMA:</strong> select an <strong>Auto Pinning Policy</strong> from the drop-down list:</p>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong> - makes no changes to the virtual machine.</p>
</li>
<li>
<p><strong>Resize and Pin</strong> - maximizes the CPU topology and generates the CPU pinning and NUMA pinning configurations.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Engine calculates the CPU Pinning Topology, updates the CPU topology fields (Total Virtual CPUs, Cores per Virtual Socket, Threads per Core), and enters the topology configuration string in the <strong>CPU Pinning Topology</strong> field of the virtual machine.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The number of declared virtual NUMA nodes and the NUMA pinning policy must take into account:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host&#8217;s NUMA settings (memory and CPUs)</p>
</li>
<li>
<p>The NUMA node in which the host devices are declared</p>
</li>
<li>
<p>The CPU pinning topology</p>
</li>
<li>
<p>The <a href="#IO_and_Emulator_Threads_Pinning_Topology">IO and emulator threads pinning topology</a></p>
</li>
<li>
<p>Huge page sizes</p>
</li>
<li>
<p>NUMA pinning can only be set for virtual machines, not for pools or templates. You must set NUMA pinning manually when you create a high performance virtual machine based on a template.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="Configuring_Huge_Pages">Configuring Huge Pages</h5>
<div class="paragraph">
<p>Huge pages are pre-allocated when a virtual machine starts to run (dynamic allocation is disabled by default).</p>
</div>
<div class="paragraph">
<p>To configure huge pages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Custom Properties</strong> tab, select <strong>hugepages</strong> from the custom properties list, which displays <strong>Please select a key&#8230;&#8203;</strong> by default.</p>
</li>
<li>
<p>Enter the huge page size in KB.</p>
<div class="paragraph">
<p>You should set the huge page size to the largest size supported by the pinned host. The recommended size for x86_64 is 1 GiB.</p>
</div>
<div class="paragraph">
<p>The huge page size has the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The virtual machine&#8217;s huge page size must be the same size as the pinned host&#8217;s huge page size.</p>
</li>
<li>
<p>The virtual machine&#8217;s memory size must fit into the selected size of the pinned host&#8217;s free huge pages.</p>
</li>
<li>
<p>The NUMA node size must be a multiple of the huge page&#8217;s selected size.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To enable dynamic allocation of huge pages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable the HugePages filter in the scheduler.</p>
</li>
<li>
<p>In the <code>[performance]</code> section in <code>/etc/vdsm/vdsm.conf</code> set the following:</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>use_dynamic_hugepages = true</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Comparison between dynamic and static hugepages</div>
<p>The following table outlines advantages and disadvantages of dynamic and static hugepages.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Dynamic vs static hugepages</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 16.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Advantages</th>
<th class="tableblock halign-left valign-top">Disadvantages</th>
<th class="tableblock halign-left valign-top">Recommendations</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>dynamic hugepages</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Less configuration required</p>
</li>
<li>
<p>Less wasted memory (i.e. hugepages free on a host waiting for possible incoming migrations)</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Failure to allocate due to fragmentation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use 2MB hugepages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>static hugepages</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Predictable results</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Requires a kernel command line in the Edit Host configuration in the Administraion Portal. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#types-operating_system-attributes-custom_kernel_cmdline">Custom kernel command line</a></p>
</li>
<li>
<p>Requires a host reboot.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following limitations apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Memory hotplug/unplug is disabled</p>
</li>
<li>
<p>The host&#8217;s memory resource is limited</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="Disabling_KSM">Disabling KSM</h5>
<div class="paragraph">
<p>To disable Kernel Same-page Merging (KSM) for the cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> and select the cluster.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>In the <strong>Optimization</strong> tab, clear the <strong>Enable KSM</strong> check box.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_timezones">4.11. Configuring the time zone</h3>
<div class="paragraph">
<p>oVirt stores time zone configurations for virtual machines in <code>/etc/ovirt-engine/conf/00-timezone.properties</code>. This file contains default time zone values such as <code>Etc/GMT=Greenwich Standard Time</code>. It features mappings that are valid for Windows and non-Windows time zones.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not edit the actual <code>00-timezone.properties</code> file. Changes will be overwritten if you upgrade or restore the Engine.</p>
</div>
<div class="paragraph">
<p>Do not change values that come directly from the operating system or the Engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an override file in <code>/etc/ovirt-engine/conf/</code>. The file name must begin with a value greater than <code>00</code>, so that the file appears after <code>/etc/ovirt-engine/conf/00-timezone.properties</code>, and ends with the extension, <code>.properties</code>.</p>
<div class="paragraph">
<p>For example, <code>10-timezone.properties</code> overrides the default file, <code>00-timezone.properties</code>. The last file in the file list has precedence over earlier files.</p>
</div>
</li>
<li>
<p>Add new time zones to that file. Be sure each key is a valid General time zone from the <a href="https://en.wikipedia.org/wiki/Tz_database">time zone database</a> and the value is a valid Windows time zone:</p>
<div class="dlist">
<dl>
<dt class="hdlist1">General</dt>
<dd>
<p>Time zones used for non-Windows operating system types, must follow the standard time zone format for example, <code>Etc/GMT</code> or <code>Asia/Jerusalem</code>.</p>
</dd>
<dt class="hdlist1">Windows</dt>
<dd>
<p>Time zones specifically supported on <a href="https://docs.microsoft.com/en-us/previous-versions/windows/embedded/ms912391(v=winembedded.11)?redirectedfrom=MSDN">Windows</a> for example, <code>GMT Standard Time</code> or <code>Israel Standard Time</code>.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine

:leveloffset: 1

// Very basic attribute, since I assume this section could one day be its own assembly and this attribute will therefore not be needed.
:vmm:

:leveloffset!:

<a id="chap-Editing_Virtual_Machines"></a>
== Editing Virtual Machines

<a id="Editing_Virtual_Machine_Properties"></a>
=== Editing Virtual Machine Properties

Changes to storage, operating system, or networking parameters can adversely affect the virtual machine. Ensure that you have the correct details before attempting to make any changes. Virtual machines can be edited while running, and some changes (listed in the procedure below) will be applied immediately. To apply all other changes, the virtual machine must be shut down and restarted.

[NOTE]
====
External virtual machines (marked with the prefix <strong>external</strong>) cannot be edited through the oVirt Engine.
====

<strong>Editing Virtual Machines</strong>

. Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.
. Select the virtual machine to be edited.
. Click <b class="button">Edit</b>.
. Change settings as required.
+
Changes to the following settings are applied immediately:

* <strong>Name</strong>

* <strong>Description</strong>

* <strong>Comment</strong>

* <strong>Optimized for</strong> (Desktop/Server/High Performance)

* <strong>Delete Protection</strong>

* <strong>Network Interfaces</strong>

* <strong>Memory Size</strong> (Edit this field to hot plug virtual memory. See <a href="#Hot_Plugging_Virtual_Memory">[Hot_Plugging_Virtual_Memory]</a>.)

* <strong>Virtual Sockets</strong> (Edit this field to hot plug CPUs. See <a href="#CPU_hot_plug">[CPU_hot_plug]</a>.)

* <strong>Highly Available</strong>

* <strong>Priority for Run/Migration queue</strong>

* <strong>Disable strict user checking</strong>

* <strong>Icon</strong>
+
. Click <b class="button">OK</b>.
. If the <strong>Next Start Configuration</strong> pop-up window appears, click <b class="button">OK</b>.


Some changes are applied immediately. All other changes are applied when you shut down and restart your virtual machine. Until then, the pending changes icon (<span class="image"><img src="common/images/pendingchanges.png" alt="pendingchanges"></span>) appears as a reminder to restart the virtual machine.

<a id="sect-Network_Interfaces"></a>
=== Network Interfaces

<a id="Adding_a_Network_Interface"></a>
==== Adding a New Network Interface

You can add multiple network interfaces to virtual machines. Doing so allows you to put your virtual machine on multiple logical networks.

[NOTE]
====
You can create an overlay network for your virtual machines, isolated from the hosts, by defining a logical network that is not attached to the physical interfaces of the host. For example, you can create a DMZ environment, in which the virtual machines communicate among themselves over the bridge created in the host.

The overlay network uses OVN, which must be installed as an external network provider. See the  <a href="https://ovirt.org/documentation/administration_guide/index#Adding_OVN_as_an_External_Network_Provider"><em>Administration Guide</em></a> for more information
====

<strong>Adding Network Interfaces to Virtual Machines</strong>

. Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.
. Click a virtual machine name to go to the details view.
. Click the <strong>Network Interfaces</strong> tab.
. Click <strong>New</strong>.
. Enter the <strong>Name</strong> of the network interface.
. Select the <strong>Profile</strong> and the <strong>Type</strong> of network interface from the drop-down lists. The <strong>Profile</strong> and <strong>Type</strong> drop-down lists are populated in accordance with the profiles and network types available to the cluster and the network interface cards available to the virtual machine.
. Select the <strong>Custom MAC address</strong> check box and enter a MAC address for the network interface card as required.
. Click <b class="button">OK</b>.


The new network interface is listed in the <strong>Network Interfaces</strong> tab in the details view of the virtual machine. The <strong>Link State</strong> is set to <strong>Up</strong> by default when the network interface card is defined on the virtual machine and connected to the network.

For more details on the fields in the <strong>New Network Interface</strong> window, see <a href="#Virtual_Machine_Network_Interface_dialogue_entries">[Virtual_Machine_Network_Interface_dialogue_entries]</a>.



<a id="Editing_network_interfaces"></a>
==== Editing a Network Interface

In order to change any network settings, you must edit the network interface. This procedure can be performed on virtual machines that are running, but some actions can be performed only on virtual machines that are not running.


<strong>Editing Network Interfaces</strong>

. Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.
. Click a virtual machine name to go to the details view.
. Click the <strong>Network Interfaces</strong> tab and select the network interface to edit.
. Click <b class="button">Edit</b>.
. Change settings as required. You can specify the <strong>Name</strong>, <strong>Profile</strong>, <strong>Type</strong>, and <strong>Custom MAC address</strong>. See <a href="#Adding_a_Network_Interface">[Adding_a_Network_Interface]</a>.
. Click <b class="button">OK</b>.



<a id="Hot_Plugging_Network_Interfaces"></a>
==== Hot Plugging a Network Interface

You can hot plug network interfaces. Hot plugging means enabling and disabling devices while a virtual machine is running.

[NOTE]
====
The guest operating system must support hot plugging network interfaces.
====


<strong>Hot Plugging Network Interfaces</strong>

. Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.
. Click the virtual machine&#8217;s name to go to the details view.
. Click the <strong>Network Interfaces</strong> tab and select the network interface to hot plug.
. Click <b class="button">Edit</b>.
. Set the <strong>Card Status</strong> to <strong>Plugged</strong> to enable the network interface, or set it to <strong>Unplugged</strong> to disable the network interface.
. Click <b class="button">OK</b>.

<a id="Removing_a_Network_Interface"></a>
==== Removing a Network Interface



<strong>Removing Network Interfaces</strong>

. Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.
. Click a virtual machine name to go to the details view.
. Click the <strong>Network Interfaces</strong> tab and select the network interface to remove.
. Click <b class="button">Remove</b>.
. Click <b class="button">OK</b>.

<a id="Blacklisting_Network_Interfaces"></a>
==== Blacklisting Network Interfaces

You can configure the <code>ovirt-guest-agent</code> on a virtual machine to ignore certain NICs. This prevents IP addresses associated with network interfaces created by certain software from appearing in reports. You must specify the name and number of the network interface you want to blacklist (for example, <code>eth0</code>, <code>docker0</code>).
// Note that once <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1546675" class="bare">https://bugzilla.redhat.com/show_bug.cgi?id=1546675</a> is resolved, this procedure can be simplified (it won&#8217;t require configuring the blacklist before first start of the agent)
[IMPORTANT]
====
You must blacklist NICs on the virtual machine before the guest agent is started for the first time.
====

<strong>Blacklisting Network Interfaces</strong>

. In the <code>/etc/ovirt-guest-agent.conf</code> configuration file on the virtual machine, insert the following line, with the NICs to be ignored separated by spaces:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
<div class="paragraph">
<p>ignored_nics = <em>first_NIC_to_ignore</em> <em>second_NIC_to_ignore</em></p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>+
. Start the agent:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="systemctl-start-ovirt-guest-agent">4.12. systemctl start ovirt-guest-agent</h3>
<div class="listingblock">
<div class="content">
<pre>[NOTE]
====
Some virtual machine operating systems automatically start the guest agent during installation.

If your virtual machine's operating system automatically starts the guest agent or if you need to configure the blacklist on many virtual machines, use the configured virtual machine as a template for creating additional virtual machines. See xref:Creating_a_template_from_an_existing_virtual_machine[] for details.
====

[[sect-Virtual_Disks]]
=== Virtual Disks

[[Adding_a_Virtual_Disk]]
==== Adding a New Virtual Disk

You can add multiple virtual disks to a virtual machine.

*Image* is the default type of disk. You can also add a *Direct LUN* disk. *Image* disk creation is managed entirely by the {engine-name}. *Direct LUN* disks require externally prepared targets that already exist. Existing disks are either floating disks or shareable disks attached to virtual machines.


*Adding Disks to Virtual Machines*

. Click menu:Compute[Virtual Machines].
. Click a virtual machine name to go to the details view.
. Click the *Disks* tab.
. Click btn:[New].
. Use the appropriate radio buttons to switch between *Image* and *Direct LUN*.
. Enter a *Size(GB)*, *Alias*, and *Description* for the new disk.
. Use the drop-down lists and check boxes to configure the disk. See xref:Add_Virtual_Disk_dialogue_entries[] for more details on the fields for all disk types.
. Click btn:[OK].


The new disk appears in the details view after a short time.

[[Associating_a_Virtual_Disk_with_a_Virtual_Machine]]
==== Attaching an Existing Disk to a Virtual Machine

Floating disks are disks that are not associated with any virtual machine.

Floating disks can minimize the amount of time required to set up virtual machines. Designating a floating disk as storage for a virtual machine makes it unnecessary to wait for disk preallocation at the time of a virtual machine's creation.

Floating disks can be attached to a single virtual machine, or to multiple virtual machines if the disk is shareable. Each virtual machine that uses the shared disk can use a different disk interface type.

Once a floating disk is attached to a virtual machine, the virtual machine can access it.


*Attaching Virtual Disks to Virtual Machines*

. Click menu:Compute[Virtual Machines].
. Click a virtual machine name to go to the details view.
. Click the *Disks* tab.
. Click btn:[Attach].
. Select one or more virtual disks from the list of available disks and select the required interface from the *Interface* drop-down.
. Click btn:[OK].



[NOTE]
====
No Quota resources are consumed by attaching virtual disks to, or detaching virtual disks from, virtual machines.
====


[[Extending_the_Available_Size_of_a_Virtual_Disk]]
==== Extending the Available Size of a Virtual Disk

You can extend the available size of a virtual disk while the virtual disk is attached to a virtual machine. Resizing a virtual disk does not resize the underlying partitions or file systems on that virtual disk. Use the `fdisk` utility to resize the partitions and file systems as required. See link:https://access.redhat.com/articles/1190213[How to Resize a Partition using fdisk] for more information.


*Extending the Available Size of Virtual Disks*

. Click menu:Compute[Virtual Machines].
. Click a virtual machine name to go to the details view.
. Click the *Disks* tab and select the disk to edit.
. Click btn:[Edit].
. Enter a value in the `Extend size by(GB)` field.
. Click btn:[OK].


The target disk's status becomes `locked` for a short time, during which the drive is resized. When the resizing of the drive is complete, the status of the drive becomes `OK`.

[[Hot_Plugging_a_Virtual_Disk]]
==== Hot Plugging a Virtual Disk

You can hot plug virtual disks. Hot plugging means enabling or disabling devices while a virtual machine is running.

[NOTE]
====
The guest operating system must support hot plugging virtual disks.
====


*Hot Plugging Virtual Disks*

. Click menu:Compute[Virtual Machines].
. Click a virtual machine name to go to the details view.
. Click the *Disks* tab and select the virtual disk to hot plug.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Activate* to enable the disk, or *Deactivate* to disable the disk.
. Click btn:[OK].

[[Removing_Virtual_Disks_From_Virtual_Machines]]
==== Removing a Virtual Disk from a Virtual Machine

*Removing Virtual Disks From Virtual Machines*

. Click menu:Compute[Virtual Machines].
. Click a virtual machine name to go to the details view.
. Click the *Disks* tab and select the virtual disk to remove.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Deactivate*.
. Click btn:[OK].
. Click btn:[Remove].
. Optionally, select the *Remove Permanently* check box to completely remove the virtual disk from the environment. If you do not select this option - for example, because the disk is a shared disk - the virtual disk will remain in menu:Storage[Disks].
. Click btn:[OK].


If the disk was created as block storage, for example iSCSI, and the *Wipe After Delete* check box was selected when creating the disk, you can view the log file on the host to confirm that the data has been wiped after permanently removing the disk. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Settings_to_Wipe_Virtual_Disks_After_Deletion[Settings to Wipe Virtual Disks After Deletion] in the _Administration Guide_.

If the disk was created as block storage, for example iSCSI, and the *Discard After Delete* check box was selected on the storage domain before the disk was removed, a `blkdiscard` command is called on the logical volume when it is removed and the underlying storage is notified that the blocks are free. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Setting_Discard_After_Delete_for_a_Storage_Domain[Setting Discard After Delete for a Storage Domain] in the _Administration Guide_. A `blkdiscard` is also called on the logical volume when a virtual disk is removed if the virtual disk is attached to at least one virtual machine with the *Enable Discard* check box selected.

==== Importing a Disk Image from an Imported Storage Domain

You can import floating virtual disks from an imported storage domain.

This procedure requires access to the Administration Portal.

[NOTE]
====
Only QEMU-compatible disks can be imported into the {engine-name}.
====


*Importing a Disk Image*

. Click menu:Storage[Domains].
. Click an imported storage domain to go to the details view.
. Click *Disk Import*.
. Select one or more disk images and click *Import*. This opens the *Import Disk(s)* window.
. Select the appropriate *Disk Profile* for each disk.
. Click btn:[OK] to import the selected disks.

==== Importing an Unregistered Disk Image from an Imported Storage Domain

You can import floating virtual disks from a storage domain. Floating disks created outside of a {virt-product-fullname} environment are not registered with the {engine-name}. Scan the storage domain to identify unregistered floating disks to be imported.

This procedure requires access to the Administration Portal.

[NOTE]
====
Only QEMU-compatible disks can be imported into the {engine-name}.
====


*Importing a Disk Image*

. Click menu:Storage[Domains].
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Scan Disks* so that the {engine-name} can identify unregistered disks.
. Select an unregistered disk name and click *Disk Import*.
. Select one or more disk images and click *Import*. This opens the *Import Disk(s)* window.
. Select the appropriate *Disk Profile* for each disk.
. Click btn:[OK] to import the selected disks.

[[sect-Virtual_Memory]]
=== Virtual Memory

[[Hot_Plugging_Virtual_Memory]]
==== Hot Plugging Virtual Memory

You can hot plug virtual memory. Hot plugging means enabling or disabling devices while a virtual machine is running. Each time memory is hot plugged, it appears as a new memory device in the *Vm Devices* tab in the details view of the virtual machine, up to a maximum of 16 available slots. When the virtual machine is restarted, these devices are cleared from the *Vm Devices* tab without reducing the virtual machine's memory, allowing you to hot plug more memory devices. If the hot plug fails (for example, if there are no more available slots), the memory increase will be applied when the virtual machine is restarted.

[IMPORTANT]
====
This feature is currently not supported for the self-hosted engine {engine-name} virtual machine.
====

[NOTE]
====
If you might need to later hot unplug the memory that you are now hot plugging, see link:{URL_virt_product_docs}{URL_format}virtual_machine_management_guide/index#Hot_Unplugging_Virtual_Memory[Hot Unplugging Virtual Memory].
====

.Procedure

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click btn:[Edit].
. Click the *System* tab.
. Increase the *Memory Size* by entering the total amount required. Memory can be added in multiples of 256 MB. By default, the maximum memory allowed for the virtual machine is set to 4x the memory size specified. Though the value is changed in the user interface, the maximum value is not hot plugged, and you will see the pending changes icon (image:common/images/pendingchanges.png[]). To avoid that, you can change the maximum memory back to the original value.
. Click btn:[OK].
+
This action opens the *Pending Virtual Machine changes* window, as some values such as *maxMemorySizeMb* and *minAllocatedMem* will not change until the virtual machine is restarted. However, the hot plug action is triggered by the change to the *Memory Size* value, which can be applied immediately.
. Click btn:[OK].


The virtual machine's *Defined Memory* is updated in the *General* tab in the details view. You can see the newly added memory device in the *Vm Devices* tab in the details view.

[[Hot_Unplugging_Virtual_Memory]]
==== Hot Unplugging Virtual Memory

You can hot unplug virtual memory. Hot unplugging disables devices while a virtual machine is running.

.Prerequisites

* Only memory added with hot plugging can be hot unplugged.
* The virtual machine's operating system must support memory hot unplugging.
* The virtual machine must not have a memory balloon device enabled. This feature is disabled by default.
* All blocks of the hot-plugged memory must be set to *online_movable* in the virtual machine's device management rules. In virtual machines running up-to-date versions of {enterprise-linux} or CoreOS, this rule is set by default. For information on device management rules, consult the documentation for the virtual machine's operating system.
* To ensure that hot plugged memory can be hot unplugged later, add the `movable_node` option to the kernel command line of the virtual machine as follows and reboot the virtual machine:
+
[source, terminal]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="grubby-update-kernelall-argsmovable_node">4.13. grubby --update-kernel=ALL --args="movable_node"</h3>
<div class="listingblock">
<div class="content">
<pre>For more information, see link:{URL_rhel_docs_latest}/html-single/managing_monitoring_and_updating_the_kernel/configuring-kernel-command-line-parameters_managing-monitoring-and-updating-the-kernel#setting-kernel-command-line-parameters_configuring-kernel-command-line-parameters[Setting kernel command-line parameters] in the RHEL 8 document _Managing, monitoring and updating the kernel_.

.Procedure

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click the *Vm Devices* tab.
. In the *Hot Unplug* column, click btn:[Hot Unplug] beside the memory device to be removed.
. Click btn:[OK] in the *Memory Hot Unplug* window.
+
The *Physical Memory Guaranteed* value for the virtual machine is decremented automatically if necessary.

[[CPU_hot_plug]]
=== Hot Plugging vCPUs

You can hot plug vCPUs. Hot plugging means enabling or disabling devices while a virtual machine is running.

[IMPORTANT]
====
Hot unplugging a vCPU is only supported if the vCPU was previously hot plugged. A virtual machine's vCPUs cannot be hot unplugged to less vCPUs than it was originally created with.
====
The following prerequisites apply:


* The virtual machine's *Operating System* must be explicitly set in the *New Virtual Machine* or *Edit Virtual Machine* window.

* The virtual machine's operating system must support CPU hot plug. See the table below for support details.

* Windows virtual machines must have the guest agents installed. See xref:Installing_the_Guest_Agents_and_Drivers_on_Windows[].



.Hot Plugging vCPUs

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click btn:[Edit].
. Click the *System* tab.
. Change the value of *Virtual Sockets* as required.
. Click btn:[OK].



[[CPU_hotplug_OS_support]]

.Operating System Support Matrix for vCPU Hot Plug
[options="header"]
|===
|Operating System |Version |Architecture |Hot Plug Supported |Hot Unplug Supported
|{enterprise-linux} Atomic Host 7 | |x86 |Yes |Yes
|{enterprise-linux} 6.3+ | |x86 |Yes |Yes
|{enterprise-linux} 7.0+ | |x86 |Yes |Yes
|{enterprise-linux} 7.3+ | |PPC64 |Yes |Yes
|{enterprise-linux} 8.0+ | |x86 |Yes |Yes
|Microsoft Windows Server 2012 R2 |All |x64 |Yes |No
|Microsoft Windows Server 2016 |Standard, Datacenter |x64 |Yes |No
|Microsoft Windows Server 2019 |Standard, Datacenter |x64 |Yes |No
|Microsoft Windows 8.x |All |x86 |Yes |No
|Microsoft Windows 8.x |All |x64 |Yes |No
|Microsoft Windows 10 |All |x86 |Yes |No
|Microsoft Windows 10 |All |x64 |Yes |No
|===

[[Pinning_a_Virtual_Machine_to_Multiple_Hosts]]
=== Pinning a Virtual Machine to Multiple Hosts

Virtual machines can be pinned to multiple hosts. Multi-host pinning allows a virtual machine to run on a specific subset of hosts within a cluster, instead of one specific host or all hosts in the cluster. The virtual machine cannot run on any other hosts in the cluster even if all of the specified hosts are unavailable. Multi-host pinning can be used to limit virtual machines to hosts with, for example, the same physical hardware configuration.

If a host fails, a highly available virtual machine is automatically restarted on one of the other hosts to which the virtual machine is pinned.

*Pinning Virtual Machines to Multiple Hosts*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Edit].
. Click the *Host* tab.
. Select the *Specific Host(s)* radio button under *Start Running On* and select two or more hosts from the list.
. Click the *High Availability* tab.
. Select the *Highly Available* check box.
. Select *Low*, *Medium*, or *High* from the *Priority* drop-down list. When migration is triggered, a queue is created in which the high priority virtual machines are migrated first. If a cluster is running low on resources, only the high priority virtual machines are migrated.
. Click btn:[OK].



[[Viewing_Virtual_Machines_Pinned_to_a_Host]]
=== Viewing Virtual Machines Pinned to a Host

You can view virtual machines pinned to a host even while the virtual machines are offline. Use the *Pinned to Host* list to see which virtual machines will be affected and which virtual machines will require a manual restart after the host becomes active again.

*Viewing Virtual Machines Pinned to a Host*

. Click menu:Compute[Hosts].
. Click a host name to go to the details view.
. Click the *Virtual Machines* tab.
. Click btn:[Pinned to Host].

[[Changing_the_CD_for_a_Virtual_Machine]]
=== Changing the CD for a Virtual Machine

You can change the CD accessible to a virtual machine while that virtual machine is running, using ISO images that have been uploaded to the data domain of the virtual machine's cluster. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Uploading_Images_to_a_Data_Storage_Domain[Uploading Images to a Data Storage Domain] in the _Administration Guide_ for details.

*Changing the CD for a Virtual Machine*

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Change CD*.
. Select an option from the drop-down list:
* Select an ISO file from the list to eject the CD currently accessible to the virtual machine and mount that ISO file as a CD.
* Select *[Eject]* from the list to eject the CD currently accessible to the virtual machine.
. Click btn:[OK].

[[Enabling_and_Disabling_Smartcards]]
=== Smart Card Authentication

Smart cards are an external hardware security feature, most commonly seen in credit cards, but also used by many businesses as authentication tokens. Smart cards can be used to protect {virt-product-fullname} virtual machines.


*Enabling Smart Cards*

. Ensure that the smart card hardware is plugged into the client machine and is installed according to manufacturer's directions.
. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Edit].
. Click the *Console* tab and select the *Smartcard enabled* check box.
. Click btn:[OK].
. Connect to the running virtual machine by clicking the *Console* button. Smart card authentication is now passed from the client hardware to the virtual machine.



[IMPORTANT]
====
If the Smart card hardware is not correctly installed, enabling the Smart card feature will result in the virtual machine failing to load properly.
====


*Disabling Smart Cards*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Edit].
. Click the *Console* tab, and clear the *Smartcard enabled* check box.
. Click btn:[OK].




*Configuring Client Systems for Smart Card Sharing*

* Smart cards may require certain libraries in order to access their certificates. These libraries must be visible to the NSS library, which `spice-gtk` uses to provide the smart card to the guest. NSS expects the libraries to provide the PKCS #11 interface.
* Make sure that the module architecture matches the  `spice-gtk` / `remote-viewer` architecture. For instance, if you have only the 32b PKCS #11 library available, you must install the 32b build of virt-viewer in order for smart cards to work.

*Configuring RHEL Clients for Smart Card support*

{enterprise-linux} provides support for Smart cards. Install the `Smart card support` group. If the Smart Card Support group is installed on a {enterprise-linux} system, smart cards are redirected to the guest when Smart Cards are enabled.

. To install the `Smart card support` group, run the following command:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dnf-groupinstall-smart-card-support">4.14. dnf groupinstall "Smart card support"</h3>
<div class="listingblock">
<div class="content">
<pre>*Configuring RHEL Clients with Other Smart Card Middleware*

////
Register the library in the system's NSS database. Run the following command as root:

[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modutil-dbdir-etcpkinssdb-add-module-name-libfile-pathtolibrary-so">4.15. modutil -dbdir /etc/pki/nssdb -add "<em>module name</em>" -libfile <em>/path/to/library</em>.so</h3>
<div class="listingblock">
<div class="content">
<pre>////

{enterprise-linux} provides a system-wide registry of pkcs11 modules in the *p11-kit*, and these are accessible to all applications.

. To register the third party PKCS#11 library in the p11-kit database, run the following command as root:
+</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="echo-module-pathtolibrary-so-etcpkcs11modulesmy-module">4.16. echo "module: /path/to/library.so" &gt; /etc/pkcs11/modules/my.module</h3>
<div class="listingblock">
<div class="content">
<pre>+
. To verify the Smart card is visible for p11-kit through this library run the following command:
+</pre>
</div>
</div>
<div class="paragraph">
<p>$ p11-kit list-modules</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*Configuring Windows Clients*

Red Hat does not provide PKCS #11 support to Windows clients. Libraries that provide PKCS #11 support must be obtained from third parties.

. When such libraries are obtained, register them by running the following command as a user with elevated privileges:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
<div class="paragraph">
<p>modutil -dbdir %PROGRAMDATA%\pki\nssdb -add "<em>module name</em>" -libfile C:_\Path\to\module_.dll</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[chap-Administrative_Tasks]]
== Administrative Tasks

:context: vm_guide_administrative_tasks

[[Shutting_down_a_virtual_machine]]
=== Shutting Down a Virtual Machine

You can turn off a virtual machine using *Shutdown* or *Power Off*. *Shutdown* gracefully shuts down a virtual machine. *Power Off* executes a hard shutdown. A graceful shutdown is usually preferable to a hard shutdown.

[NOTE]
====
If an exclamation point appears next to the virtual machine, a snapshot deletion process has failed, and you may not be able to restart the machine after shutting it down. Try to delete the snapshot again and ensure that the explanation mark disappears before shutting down the virtual machine. See xref:Deleting_a_snapshot[] for more information.
====

.Procedure

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click btn:[Shutdown] or right-click the virtual machine and select *Shutdown* from the pop-up menu.
. Optionally in the Administration Portal, enter a *Reason* for shutting down the virtual machine in the *Shut down Virtual Machine(s)* confirmation window. This allows you to provide an explanation for the shutdown, which will appear in the logs and when the virtual machine is powered on again.
+
[NOTE]
====
The virtual machine shutdown *Reason* field will only appear if it has been enabled in the cluster settings. For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#sect-Cluster_Tasks[Explanation of Settings and Controls in the New Cluster and Edit Cluster Windows] in the _Administration Guide_.
====
+
. Click btn:[OK] in the *Shut down Virtual Machine(s)* confirmation window.


If the virtual machine gracefully shuts down, the *Status* of the virtual machine changes to `Down`. If the virtual machine does not gracefully shut down, click the down arrow next to btn:[Shutdown] and then click btn:[Power Off] to execute a hard shutdown, or right-click the virtual machine and select *Power Off* from the pop-up menu.

[[Suspending_a_virtual_machine]]
=== Suspending a Virtual Machine

Suspending a virtual machine is equal to placing that virtual machine into *Hibernate* mode.


*Suspending a Virtual Machine*

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click btn:[Suspend] or right-click the virtual machine and select *Suspend* from the pop-up menu.

The *Status* of the virtual machine changes to `Suspended`.

[[Rebooting_a_Virtual_Machine]]
=== Rebooting or Resetting a Virtual Machine

You can restart your virtual machines in two different ways; either using reboot or reset.

Several situations can occur where you need to reboot the virtual machine, such as after an update or configuration change. When you reboot, the virtual machine's console remains open while the guest operating system is restarted.

If a guest operating system can not be loaded or has become unresponsive, you need to reset the virtual machine. When you reset, the virtual machine's console remains open while the guest operating system is restarted.

[NOTE]
====
The reset reset operation can only be performed from the Administration Portal.
====

*Rebooting a Virtual Machine*

To reboot a virtual machine:

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click btn:[Reboot] or right-click the virtual machine and select *Reboot* from the pop-up menu.
. Click btn:[OK] in the *Reboot Virtual Machine(s)* confirmation window.

*Resetting a Virtual Machine*

To reset a virtual machine:

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click the down arrow next to btn:[Reboot], then click *Reset*, or right-click the virtual machine and select *Reset* from the pop-up menu.
. Click btn:[OK] in the *Reset Virtual Machine(s)* confirmation window.

During reboot and reset operations, the *Status* of the virtual machine changes to `Reboot In Progress` before returning to `Up`.

[[Removing_a_virtual_machine]]
=== Removing a Virtual Machine


[IMPORTANT]
====
The btn:[Remove] button is disabled while virtual machines are running; you must shut down a virtual machine before you can remove it.
====


*Removing Virtual Machines*

. Click menu:Compute[Virtual Machines] and select the virtual machine to remove.
. Click btn:[Remove].
. Optionally, select the *Remove Disk(s)* check box to remove the virtual disks attached to the virtual machine together with the virtual machine. If the *Remove Disk(s)* check box is cleared, then the virtual disks remain in the environment as floating disks.
. Click btn:[OK].



[[Cloning_a_Virtual_Machine]]
=== Cloning a Virtual Machine

You can clone virtual machines without having to create a template or a snapshot first.

[IMPORTANT]
====
The *Clone VM* button is disabled while virtual machines are running; you must shut down a virtual machine before you can clone it.
====


*Cloning Virtual Machines*

. Click menu:Compute[Virtual Machines] and select the virtual machine to clone.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Clone VM*.
. Enter a *Clone Name* for the new virtual machine.
. Click btn:[OK].

[[sect-Updating_Virtual_Machine_Guest_Agents_and_Drivers]]
=== Updating Virtual Machine Guest Agents and Drivers

The {virt-product-fullname} guest agents, tools, and drivers provide additional functionality for virtual machines, such as gracefully shutting down or rebooting virtual machines from the VM Portal and Administration Portal. The tools and agents also provide information for virtual machines, including:

* Resource usage
* IP addresses
* Installed applications

The guest tools are distributed as an ISO file that you can attach to virtual machines. This ISO file is packaged as an RPM file that you can install and update from the {engine-name} machine.

[[Updating_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux]]
==== Updating the Guest Agents and Drivers on {enterprise-linux}

Update the guest agents and drivers on your {enterprise-linux} virtual machines to use the latest version.


*Updating the Guest Agents and Drivers on {enterprise-linux}*

. Log in to the {enterprise-linux} virtual machine.
. Update the `ovirt-guest-agent-common` package:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="yum-update-ovirt-guest-agent-common">4.17. yum update ovirt-guest-agent-common</h3>
<div class="listingblock">
<div class="content">
<pre>+
. Restart the service:


* For {enterprise-linux} 6
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-ovirt-guest-agent-restart">4.18. service ovirt-guest-agent restart</h3>
<div class="listingblock">
<div class="content">
<pre>* For {enterprise-linux} 7
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="systemctl-restart-ovirt-guest-agent-service">4.19. systemctl restart ovirt-guest-agent.service</h3>
<div class="listingblock">
<div class="content">
<pre>:leveloffset: +3

[id="Updating_Win_Guest_Drivers_with_Windows_Updates"]
= Updating Windows drivers with Windows Update

When you need to update the drivers for a Windows virtual machine, the simplest method is to use Windows Update.

.Procedure

. Log in to the virtual machine.
. Ensure that Windows Update is enabled so you can get updates.
. Check Windows Update for updates from *Red Hat, Inc*.
. Manually install any updates that have not been automatically installed.

.Additional resources

* xref:Updating_the_Guest_Agents_and_Drivers_on_Windows[Updating Windows guest agents and drivers using the command prompt]
* See the Microsoft documentation for details on using Windows Update.

:leveloffset: 2

:leveloffset: +3

[id="Updating_the_Guest_Agents_and_Drivers_on_Windows"]
= Updating Windows guest agents and drivers using the command prompt

When you do not have access to Windows Update to update Windows drivers, or when you need to update the Windows guest agents, you can do so from the `virtio-win` package by using the virtual machine's command prompt. During this procedure, you must remove and reinstall the drivers, which can lead to network disruption. This procedure restores your settings after reinstalling the drivers.

.Procedure

. If you are updating the drivers, on the Windows virtual machine, use the `netsh` utility to save TCP settings before uninstalling the netkvm driver:
+</pre>
</div>
</div>
<div class="paragraph">
<p>C:\WINDOWS\system32&gt;netsh dump &gt; filename.txt</p>
</div>
<div class="listingblock">
<div class="content">
<pre>. On the {engine-name} machine, update the `virtio-win` package to the latest version:
+</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dnf-upgrade-y-virtio-win">4.20. dnf upgrade -y virtio-win</h3>
<div class="listingblock">
<div class="content">
<pre>+
The `virtio-win___version__.iso` file is located in `/usr/share/virtio-win/` on the {engine-name} machine.

. Upload the ISO file to a data domain. For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks[Uploading Images to a Data Storage Domain] in the _Administration Guide_.

. In the Administration or VM Portal, if the virtual machine is running, use the *Change CD* drop-down list to attach the virtio-win___version__.iso file to each of your virtual machines. If the virtual machine is powered off, click the btn:[Run Once] button and attach the ISO as a CD.

. Log in to the virtual machine.

. Select the CD Drive (`D:\` for this example) containing the virtio-win___version__.iso file.

. Reinstall the guest agents or drivers:
** To reinstall only the guest agents, use `qemu-ga-x86_64.msi`:
+</pre>
</div>
</div>
<div class="paragraph">
<p>C:\WINDOWS\system32&gt;msiexec.exe /i D:\guest-agent\qemu-ga-x86_64.msi /passive /norestart</p>
</div>
<div class="listingblock">
<div class="content">
<pre>** To install the guest agents and drivers, or just the drivers, use `virtio-win-gt-x64.msi`:
+</pre>
</div>
</div>
<div class="paragraph">
<p>C:\WINDOWS\system32&gt;msiexec.exe /i D:\virtio-win-gt-x64.msi /passive /norestart</p>
</div>
<div class="listingblock">
<div class="content">
<pre>. If you are updating the drivers, restore the settings you saved using `netsh`:
+</pre>
</div>
</div>
<div class="paragraph">
<p>C:\WINDOWS\system32&gt;netsh -f filename.txt</p>
</div>
<div class="listingblock">
<div class="content">
<pre>:leveloffset: 2

[[Viewing_Satellite_Errata]]
=== Viewing Red Hat Satellite Errata for a Virtual Machine

Errata for each virtual machine can be viewed after the {virt-product-fullname} virtual machine has been configured to receive errata information from the Red Hat Satellite server.

For more information on configuring a virtual machine to display available errata see xref:Configuring_Satellite_Errata[]


*Viewing Red Hat Satellite Errata*

. Click menu:Compute[Virtual Machines].
. Click the virtual machine's name to go to the details view.
. Click *Errata*.



[[sect-Virtual_Machines_and_Permissions]]
=== Virtual Machines and Permissions

[[Managing_System_Permissions_for_a_Virtual_Machine]]
==== Managing System Permissions for a Virtual Machine

As the *SuperUser*, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a *DataCenterAdmin* role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a *ClusterAdmin* has administrator privileges only for the assigned cluster.

A *UserVmManager* is a system administration role for virtual machines in a data center. This role can be applied to specific virtual machines, to a data center, or to the whole virtualized environment; this is useful to allow different users to manage certain virtual resources.

The user virtual machine administrator role permits the following actions:

* Create, edit, and remove virtual machines.

* Run, suspend, shutdown, and stop virtual machines.



[NOTE]
====
You can only assign roles and permissions to existing users.
====
Many end users are concerned solely with the virtual machine resources of the virtualized environment. As a result, {virt-product-fullname} provides several user roles which enable the user to manage virtual machines specifically, but not other resources in the data center.

[[Virtual_Machine_Administrator_Roles_Explained]]
==== Virtual Machine Administrator Roles Explained

The table below describes the administrator roles and privileges applicable to virtual machine administration.

[[Virtual_Machine_Administrator_Roles]]

.{virt-product-fullname} System Administrator Roles
[options="header"]
|===
|Role |Privileges |Notes
|DataCenterAdmin |Data Center Administrator |Possesses administrative permissions for all objects underneath a specific data center except for storage.
|ClusterAdmin |Cluster Administrator |Possesses administrative permissions for all objects underneath a specific cluster.
|NetworkAdmin |Network Administrator |Possesses administrative permissions for all operations on a specific logical network. Can configure and manage networks attached to virtual machines. To configure port mirroring on a virtual machine network, apply the *NetworkAdmin* role on the network and the *UserVmManager* role on the virtual machine.
|===

==== Virtual Machine User Roles Explained

The table below describes the user roles and privileges applicable to virtual machine users. These roles allow access to the VM Portal for managing and accessing virtual machines, but they do not confer any permissions for the Administration Portal.

.{virt-product-fullname} System User Roles
[options="header"]
|===
|Role |Privileges |Notes
|UserRole |Can access and use virtual machines and pools. |Can log in to the VM Portal and use virtual machines and pools.
|PowerUserRole |Can create and manage virtual machines and templates. |Apply this role to a user for the whole environment with the *Configure* window, or for specific data centers or clusters. For example, if a PowerUserRole is applied on a data center level, the PowerUser can create virtual machines and templates in the data center. Having a *PowerUserRole* is equivalent to having the *VmCreator*, *DiskCreator*, and *TemplateCreator* roles.
|UserVmManager |System administrator of a virtual machine. |Can manage virtual machines and create and use snapshots. A user who creates a virtual machine in the VM Portal is automatically assigned the UserVmManager role on the machine.
|UserTemplateBasedVm |Limited privileges to only use Templates. |Level of privilege to create a virtual machine by means of a template.
|VmCreator |Can create virtual machines in the VM Portal. |This role is not applied to a specific virtual machine; apply this role to a user for the whole environment with the *Configure* window. When applying this role to a cluster, you must also apply the *DiskCreator* role on an entire data center, or on specific storage domains.
|VnicProfileUser |Logical network and network interface user for virtual machines. |If the *Allow all users to use this Network* option was selected when a logical network is created, *VnicProfileUser* permissions are assigned to all users for the logical network. Users can then attach or detach virtual machine network interfaces to or from the logical network.
|===

[[Assigning_virtual_machines_to_users]]
==== Assigning Virtual Machines to Users

If you are creating virtual machines for users other than yourself, you have to assign roles to the users before they can use the virtual machines. Note that permissions can only be assigned to existing users. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#chap-Users_and_Roles[Users and Roles] in the _Administration Guide_ for details on creating user accounts.

The VM Portal supports three default roles: User, PowerUser and UserVmManager. However, customized roles can be configured via the Administration Portal. The default roles are described below.


* A *User* can connect to and use virtual machines. This role is suitable for desktop end users performing day-to-day tasks.

* A *PowerUser* can create virtual machines and view virtual resources. This role is suitable if you are an administrator or manager who needs to provide virtual resources for your employees.

* A *UserVmManager* can edit and remove virtual machines, assign user permissions, use snapshots and use templates. It is suitable if you need to make configuration changes to your virtual environment.

When you create a virtual machine, you automatically inherit *UserVmManager* privileges. This enables you to make changes to the virtual machine and assign permissions to the users you manage, or users who are in your Identity Management (IdM) or RHDS group. See the  link:{URL_virt_product_docs}{URL_format}administration_guide/index#Introduction_to_Directory_Servers[_Administration Guide_] for more information.


*Assigning Permissions to Users*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click the virtual machine's name to go to the details view.
. Click the *Permissions* tab.
. Click btn:[Add].
. Enter a name, or user name, or part thereof in the *Search* text box, and click *Go*. A list of possible matches display in the results list.
. Select the check box of the user to be assigned the permissions.
. Select *UserRole* from the *Role to Assign* drop-down list.
. Click btn:[OK].


The user's name and role display in the list of users permitted to access this virtual machine.

[NOTE]
====
If a user is assigned permissions to only one virtual machine, single sign-on (SSO) can be configured for the virtual machine. With single sign-on enabled, when a user logs in to the VM Portal, and then connects to a virtual machine through, for example, a SPICE console, users are automatically logged in to the virtual machine and do not need to type in the user name and password again. Single sign-on can be enabled or disabled on a per virtual machine basis. See xref:sect-Configuring_Single_Sign-On_for_Virtual_Machines[] for more information on how to enable and disable single sign-on for virtual machines.
====

[[Removing_Access_to_Virtual_Machines_from_Users]]
==== Removing Access to Virtual Machines from Users


*Removing Access to Virtual Machines from Users*

. Click menu:Compute[Virtual Machines].
. Click the virtual machine's name to go to the details view.
. Click *Permissions*.
. Click btn:[Remove]. A warning message displays, asking you to confirm removal of the selected permissions.
. To proceed, click btn:[OK]. To abort, click *Cancel*.



[[sect-Snapshots]]
=== Snapshots

[[Creating_a_snapshot_of_a_virtual_machine]]
==== Creating a Snapshot of a Virtual Machine

A snapshot is a view of a virtual machine's operating system and applications on any or all available disks at a given point in time. Take a snapshot of a virtual machine before you make a change to it that may have unintended consequences. You can use a snapshot to return a virtual machine to a previous state.


*Creating a Snapshot of a Virtual Machine*

. Click menu:Compute[Virtual Machines].
. Click a virtual machine's name to go to the details view.
. Click the *Snapshots* tab and click *Create*.
. Enter a description for the snapshot.
. Select *Disks to include* using the check boxes.
+
[NOTE]
====
If no disks are selected, a partial snapshot of the virtual machine, without a disk, is created. You can preview this snapshot to view the configuration of the virtual machine. Note that committing a partial snapshot will result in a virtual machine without a disk.
====

. Select *Save Memory* to include a running virtual machine's memory in the snapshot.
. Click btn:[OK].


The virtual machine's operating system and applications on the selected disk(s) are stored in a snapshot that can be previewed or restored. The snapshot is created with a status of `Locked`, which changes to `Ok`. When you click the snapshot, its details are shown on the *General*, *Disks*, *Network Interfaces*, and *Installed Applications* drop-down views in the *Snapshots* tab.

[[Using_a_snapshot_to_restore_a_virtual_machine]]
==== Using a Snapshot to Restore a Virtual Machine

A snapshot can be used to restore a virtual machine to its previous state.


*Using Snapshots to Restore Virtual Machines*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click the virtual machine's name to go to the details view.
. Click the *Snapshots* tab to list the available snapshots.
. Select a snapshot to restore in the upper pane. The snapshot details display in the lower pane.
. Click the btn:[Preview drop-down menu] button and select *Custom*.
. Use the check boxes to select the *VM Configuration*, *Memory*, and disk(s) you want to restore, then click btn:[OK]. This allows you to create and restore from a customized snapshot using the configuration and disk(s) from multiple snapshots.
+
The status of the snapshot changes to `Preview Mode`. The status of the virtual machine briefly changes to `Image Locked` before returning to `Down`.
. Shut down the virtual machine.
. Start the virtual machine; it runs using the disk image of the snapshot.
. Click *Commit* to permanently restore the virtual machine to the condition of the snapshot. Any subsequent snapshots are erased.
+
Alternatively, click the *Undo* button to deactivate the snapshot and return the virtual machine to its previous state.

[id='Creating_a_Virtual_Machine_from_a_Snapshot_{context}']
==== Creating a Virtual Machine from a Snapshot

You can use a snapshot to create another virtual machine.

*Creating a Virtual Machine from a Snapshot*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click the virtual machine's name to go to the details view.
. Click the *Snapshots* tab to list the available snapshots.
. Select a snapshot in the list displayed and click *Clone*.
. Enter the *Name* of the virtual machine.
. Click btn:[OK].


After a short time, the cloned virtual machine appears in the *Virtual Machines* tab in the navigation pane with a status of `Image Locked`. The virtual machine remains in this state until {virt-product-fullname} completes the creation of the virtual machine. A virtual machine with a preallocated 20 GB hard drive takes about fifteen minutes to create. Sparsely-allocated virtual disks take less time to create than do preallocated virtual disks.

When the virtual machine is ready to use, its status changes from `Image Locked` to `Down` in menu:Compute[Virtual Machines].

[[Deleting_a_snapshot]]
==== Deleting a Snapshot

You can delete a virtual machine snapshot and permanently remove it from your {virt-product-fullname} environment.

////
[IMPORTANT]
====
When you delete a snapshot from an image chain, there must be enough free space in the storage domain to temporarily accommodate both the original volume and the newly merged volume. Otherwise, snapshot deletion will fail and you will need to export and re-import the volume to remove snapshots. This is due to the data from the two volumes being merged in the resized volume and the resized volume growing to accommodate the total size of the two merged images.


* If the snapshot being deleted is contained in a base image, the volume subsequent to the volume containing the snapshot being deleted is extended to include the base volume.

* If the snapshot being deleted is contained in a QCOW2 (thin provisioned), non-base image hosted on internal storage, the successor volume is extended to include the volume containing the snapshot being deleted.

====
////

*Deleting a Snapshot*

. Click menu:Compute[Virtual Machines].
. Click the virtual machine's name to go to the details view.
. Click the *Snapshots* tab to list the snapshots for that virtual machine.
. Select the snapshot to delete.
. Click *Delete*.
. Click btn:[OK].



[NOTE]
====
If the deletion fails, fix the underlying problem (for example, a failed host, an inaccessible storage device, or a temporary network issue) and try again.
====

[[sect-Host_Devices]]
=== Host Devices

[[Adding_Host_Devices_to_a_Virtual_Machine]]
==== Adding a Host Device to a Virtual Machine

To improve performance, you can attach a host device to a virtual machine.

Host devices are physical devices connected to a particular host machine, such as:

* SCSI tape drives, disks, and changers
* PCI NICs, GPUs, and HBAs
* USB mice, cameras, and disks

To add a host device to a virtual machine, you use the virtual machine's *Host Devices* properties. First, you select one of the cluster hosts and a device type. Then, you choose and attach one or more of the host devices on that host.

[IMPORTANT]
====
When you change the *Pinned Host* setting, it removes the current host devices. When you save these changes, in the virtual machine's *Host* settings, it sets *Start Running On* to *Specific Host(s)* and specifies the host you selected earlier using the *Pinned Host* setting.
====

When you finish attaching one or more host devices, you run the virtual machine to apply the changes. The virtual machine starts on the host that has the attached host devices.

If the virtual machine cannot start on the specified host or access the host device, it cancels the start operation and produces an error message with information about the cause.

.Prerequisites

* The state of the host is `Up`.
* The host is configured for direct device assignment.

.Procedure

. In the Administration Portal, click menu:Compute[Virtual Machines].
. Shut down the virtual machine.
. Click the name of the virtual machine to go to the details view.
. Click the *Host Devices* tab.
. Click btn:[Add device]. This opens the *Add Host Devices* pane.
. Use *Pinned Host* to select the host where the virtual machine runs.
. Use *Capability* to list `pci`, `scsi`, `nvdimm`, or `usb_device` devices.
+
[NOTE]
====
The `nvdimm` option is a technical preview feature. For more information, see xref:conc-nvdimm-host-devices_{context}[].
====
. Use *Available Host Devices* to select devices.
. Click the down arrow to move devices to *Host Devices to be attached*.
. Click btn:[OK] to attach these devices to the virtual machine and close the window.
. Optional: If you attach a SCSI host device, configure the optimal driver.
.. Click the btn:[Edit] button. This opens the *Edit Virtual Machine* pane.
.. Click the *Custom Properties* tab.
.. Click the *Please select a key* and select *scsi_hostdev* from the bottom of the drop-down list.
.. In most cases, select *scsi-hd*. Otherwise, for tape or CD changer devices, select the *scsi_generic* option. For more details, see link:{URL_virt_product_docs}{URL_format}virtual_machine_management_guide/index#Virtual_Machine_Custom_Properties_settings_explained[Virtual Machine Custom Properties Settings Explained].
.. Click the btn:[OK] button.
. Run the virtual machine.
. While the virtual machine starts running, watch for *Operation Canceled* error messages.

.Troubleshooting

If you cannot add a host device to a virtual machine, or a virtual machine cannot start running with the attached host devices, it generates *Operation Canceled* error messages. For example:</pre>
</div>
</div>
<div class="paragraph">
<p>Operation Canceled
Error while executing action:</p>
</div>
<div class="paragraph">
<p>&lt;vm name&gt;:
* Cannot run VM. There is no host that satisfies current scheduling constraints. See below for details:
* The host &lt;first_hostname&gt; did not satisfy internal filter HostDevice because it does not support host device passthrough.
* The host &lt;second_hostname&gt; did not satisfy internal filter HostDevice because the host does not provide requested host devices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>You can fix the error by removing the host device from the virtual machine or correcting the issues the error message describes. For example:

* Respond to a `The host &lt;hostname&gt; did not satisfy internal filter HostDevice because it does not support host device passthrough` message by configuring the host for device passthrough and restarting the virtual machine.
* Respond to the `The host &lt;hostname&gt; did not satisfy internal filter HostDevice because the host does not provide requested host devices` message by adding the host device to the host.
* Respond to a `Cannot add Host devices because the VM is in Up status` message by shutting down the virtual machine before adding a host device.
* Verify that the state of the host is `Up`.

.Additional resources
* link:{URL_virt_product_docs}{URL_format}virtual_machine_management_guide/index#sect-host_devices[Host Devices] in the _Virtual Machine Management Guide_.
* link:{URL_virt_product_docs}{URL_format}virtual_machine_management_guide/index#pinning_a_virtual_machine_to_multiple_hosts[Pinning a Virtual Machine to Multiple Hosts]
* link:{URL_virt_product_docs}{URL_format}administration_guide/index#Configuring_a_Host_for_PCI_Passthrough_host_tasks[Configuring a Host for PCI Passthrough]
* link:{URL_downstream_virt_product_docs}hardware_considerations_for_implementing_sr-iov/[Additional Hardware Considerations for Using Device Assignment] in _Hardware Considerations for Implementing SR-IOV_.
* xref:conc-nvdimm-host-devices_{context}[]

[[Removing_Host_Devices_from_a_Virtual_Machine]]
==== Removing Host Devices from a Virtual Machine

If you are removing all host devices directly attached to the virtual machine in order to add devices from a different host, you can instead add the devices from the desired host, which will automatically remove all of the devices already attached to the virtual machine.


.Procedure

. Click menu:Compute[Virtual Machines].
. Select a virtual machine to go to the details view.
. Click the *Host Devices* tab to list the host devices attached to the virtual machine.
. Select the host device to detach from the virtual machine, or hold `Ctrl` to select multiple devices, and click btn:[Remove device]. This opens the *Remove Host Device(s)* window.
. Click btn:[OK] to confirm and detach these devices from the virtual machine.

[[Pinning_a_Virtual_Machine_to_Another_Host]]
==== Pinning a Virtual Machine to Another Host

You can use the *Host Devices* tab in the details view of a virtual machine to pin it to a specific host.

If the virtual machine has any host devices attached to it, pinning it to another host automatically removes the host devices from the virtual machine.


*Pinning a Virtual Machine to a Host*

. Click a virtual machine name and click the *Host Devices* tab.
. Click *Pin to another host*. This opens the *Pin VM to Host* window.
. Use the *Host* drop-down menu to select a host.
. Click btn:[OK] to pin the virtual machine to the selected host.



:leveloffset: +3

// Module included in the following assemblies:
//
// doc-Virtual_Machine_Management_Guide/chap-Administrative_Tasks.adoc

[id="conc-nvdimm-host-devices_{context}"]
= NVDIMM host devices

[NOTE]
====
NVDIMM devices are Technology Preview features only. Technology Preview features are not supported with Red Hat production service-level agreements (SLAs) and might not be functionally complete, and Red Hat does not recommend using them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information, see link:https://access.redhat.com/support/offerings/techpreview/[Red Hat Technology Preview Features Support Scope].
====

You can add emulated NVDIMM devices to virtual machines. Elsewhere, this type of memory is also known as _virtual NVDIMM_ or _vNVDIMM_.

The emulated NVDIMM you can attach to a virtual machine is backed by real NVDIMM on the host machine where the virtual machine runs. Therefore, when you attach NVDIMM to a virtual machine, you also pin the virtual machine to a specific host.

You can reconfigure the mode, partitioning, and other properties of the emulated NVDIMM device in the virtual machine without affecting the settings of the physical NVDIMM on the host device.

To add emulated NVDIMM to a virtual machine, see xref:Adding_Host_Devices_to_a_Virtual_Machine[]

.Limitations

* Memory snapshots are disabled when an NVDIMM device is present in a virtual machine. There is no way to make a snapshot of NVDIMM content, and a memory snapshot cannot work correctly without having the corresponding NVDIMM data.

* In {virt-product-shortname}, each NVDIMM device passed to a virtual machine has an automatically-assigned label area with a fixed size of 128 KB. IBM POWER hardware, and 128 KB is the minimum label size allowed by QEMU.

* By default, the virtual machine uses the whole NVDIMM device. You cannot configure the size of the NVDIMM from the virtual machine. To configure its size, partition the NVDIMM device on the host and add the partition to the virtual machine.

* The size of the NVDIMM device on the virtual machine may be slightly lower than on the host to comply with libvirt and QEMU alignment and size adjustments. Precise sizing is also needed to make memory hotplug work.

* libvirt and QEMU adjust their size and label placement. If those internal arrangements change, it can cause data loss.

* NVDIMM hotplug is not supported by the platform.

* Virtual machines with NVDIMM devices cannot migrate because they are pinned to a host.

* SELinux currently prevents access to NVDIMM devices in `devdax` mode, see https://bugzilla.redhat.com/1855336.

[IMPORTANT]
====
Avoid using NVDIMM on IBM POWER hardware. This combination is currently not expected to be stable until further work is completed.
====

.Additional resources

* link:https://github.com/qemu/qemu/blob/master/docs/nvdimm.txt[QEMU NVDIMM documentation]
* xref:Adding_Host_Devices_to_a_Virtual_Machine[]

:leveloffset: 2


[[sect-Affinity_Groups]]
=== Affinity Groups

Affinity groups help you determine where selected virtual machines run in relation to each other and specified hosts. This capability helps manage workload scenarios such as licensing requirements, high-availability workloads, and disaster recovery.

.The VM Affinity Rule
When you create an affinity group, you select the virtual machines that belong to the group. To define _where these virtual machines can run in relation to each other_, you enable a *VM Affinity Rule*: A positive rule tries to run the virtual machines together on a single host; a negative affinity rule tries to run the virtual machines apart on separate hosts. If the rule cannot be fulfilled, the outcome depends on whether the weight or filter module is enabled.

.The Host Affinity Rule
Optionally, you can add hosts to the affinity group. To define _where virtual machines in the group can run in relation to hosts in the group_, you enable a *Host Affinity Rule*: A positive rule tries to run the virtual machines on hosts in the affinity group; a negative affinity rule tries to run the virtual machines on hosts that are not in the affinity group. If the rule cannot be fulfilled, the outcome depends on whether the weight or filter module is enabled.

.The Default Weight Module
By default, both rules apply the _weight module_ in the cluster's scheduling policy. With the weight module, the scheduler attempts to fulfill a rule, but allows the virtual machines in the affinity group to run anyway if the rule cannot be fulfilled.

For example, with a positive *VM Affinity Rule* and the weight module enabled, the scheduler _tries_ to run all of the affinity group's virtual machines on a single host. However, if a single host does not have sufficient resources for this, the scheduler runs the virtual machines on multiple hosts.

For this module to work, the *weight module* section of the scheduling policies must contain the `VmAffinityGroups` and `VmToHostsAffinityGroups` keywords.


.The Enforcing Option and Filter Module
Both rules have an *Enforcing* option which applies the _filter module_ in the cluster's scheduling policy. The filter module overrides the weight module. With the filter module enabled, the scheduler _requires_ that a rule be fulfilled. If a rule cannot be fulfilled, the filter module prevents the virtual machines in the affinity group from running.

For example, with a positive *Host Affinity Rule* and *Enforcing* enabled (the filter module enabled), the scheduler _requires_ the affinity group's virtual machines to run on hosts that are part of the affinity group. However, if those hosts are down, the scheduler does not run the virtual machines at all.

For this module to work, the *filter module* section of the scheduling policies must contain the `VmAffinityGroups` and `VmToHostsAffinityGroups` keywords.

.Examples
To see how these rules and options can be used with one another, see xref:Affinity_groups_examples[].

[WARNING]
====
* An _affinity label_ is functionally the same as an affinity group with a positive *Host Affinity Rule* and *Enforcing* enabled.
* For affinity labels to work, the *filter module* section of the scheduling policies must contain `Label`.
* If an affinity group and affinity label conflict with each other, the affected virtual machines do not run. To help prevent, troubleshoot, and resolve conflicts, see xref:Affinity_groups_troubleshooting[].

====

[IMPORTANT]
====
Each rule is affected by the weight and filter modules in the cluster's scheduling policy.

* For the *VM Affinity Rule* rule to work, the scheduling policy must have the `VmAffinityGroups` keyword in its *Weight module* and *Filter module* sections.
* For the *Host Affinity Rule* to work, the scheduling policy must have the `VmToHostsAffinityGroups` keyword in its *Weight module* and *Filter module* sections.

For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#sect-scheduling_policies[Scheduling Policies] in the _Administration Guide_.

====

[NOTE]
====
* Affinity groups apply to virtual machines in a cluster. Moving a virtual machine from one cluster to another removes it from the affinity groups in the original cluster.
* Virtual machines do not have to restart for the affinity group rules to take effect.

====

[[Creating_an_Affinity_Group]]
==== Creating an Affinity Group

You can create new affinity groups in the Administration Portal.


*Creating Affinity Groups*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click the virtual machine's name to go to the details view.
. Click the *Affinity Groups* tab.
. Click *New*.
. Enter a *Name* and *Description* for the affinity group.
. From the *VM Affinity Rule* drop-down, select *Positive* to apply positive affinity or *Negative* to apply negative affinity. Select *Disable* to disable the affinity rule.
. Select the *Enforcing* check box to apply hard enforcement, or ensure this check box is cleared to apply soft enforcement.
. Use the drop-down list to select the virtual machines to be added to the affinity group. Use the *+* and *-* buttons to add or remove additional virtual machines.
. Click btn:[OK].



[[Editing_an_Affinity_Group]]
==== Editing an Affinity Group



*Editing Affinity Groups*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click the virtual machine's name to go to the details view.
. Click the *Affinity Groups* tab.
. Click btn:[Edit].
. Change the *VM Affinity Rule* drop-down and *Enforcing* check box to the preferred values and use the *+* and *-* buttons to add or remove virtual machines to or from the affinity group.
. Click btn:[OK].



[[Removing_an_Affinity_Group]]
==== Removing an Affinity Group



*Removing Affinity Groups*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click the virtual machine's name to go to the details view.
. Click the *Affinity Groups* tab.
. Click btn:[Remove].
. Click btn:[OK].


The affinity policy that applied to the virtual machines that were members of that affinity group no longer applies.

[[Affinity_groups_examples]]
==== Affinity Groups Examples

The following examples illustrate how to apply affinity rules for various scenarios, using the different features of the affinity group capability described in this chapter.

[[Affinity_high_availability]]
.High Availability
====
Dalia is the DevOps engineer for a startup. For high availability, a particular system's two virtual machines should run on separate hosts anywhere in the cluster.

Dalia creates an affinity group named "high availability" and does the following:

* Adds the two virtual machines, *VM01* and *VM02*, to the affinity group.
* Sets *VM Affinity* to *Negative* so the virtual machines try to run on separate hosts.
* Leaves *Enforcing* cleared (disabled) so that both virtual machines can continue running in case only one host is available during an outage.
* Leaves the *Hosts* list empty so the virtual machines run on any host in the cluster.

====

[[Affinity_performance]]
.Performance
====
Sohni is a software developer who uses two virtual machines to build and test his software many times each day. There is heavy network traffic between these two virtual machines. Running the machines on the same host reduces both network traffic and the effects of network latency on the build and test process. Using high-specification hosts (faster CPUs, SSDs, and more memory) further accelerates this process.

Sohni creates an affinity group called "build and test" and does the following:

* Adds *VM01* and *VM02*, the build and test virtual machines, to the affinity group.
* Adds the high-specification hosts, *host03*, *host04*, and *host05*, to the affinity group.
* Sets *VM affinity* to *Positive* so the virtual machines try to run on the same host, reducing network traffic and latency effects.
* Sets *Host affinity* to *Positive* so the virtual machines try to run on the high specification hosts, accelerating the process.
* Leaves *Enforcing* cleared (disabled) for both rules so the virtual machines can run if the high-specification hosts are not available.

====

[[Affinity_licensing]]
.Licensing
====
Bandile, a software asset manager, helps his organization comply with the restrictive licensing requirements of a 3D imaging software vendor. These terms require the virtual machines for its licensing server, *VM-LS*, and imaging workstations, *VM-WS__#__*, to run on the same host. Additionally, the physical CPU-based licensing model requires that the workstations run on either of two GPU-equipped hosts, *host-gpu-primary* or *host-gpu-backup*.

To meet these requirements, Bandile creates an affinity group called "3D seismic imaging" and does the following:

* Adds the previously mentioned virtual machines and hosts to the affinity group.
* Sets *VM affinity* to *Positive* and selects *Enforcing* so the licensing server and workstations _must_ run together on one of the hosts, not on multiple hosts.
* Sets *Host affinity* to *Positive* and selects *Enforcing* so the virtual machines _must_ run on either of the GPU-equipped the hosts, not other hosts in the cluster.

====

[[Affinity_groups_troubleshooting]]
==== Affinity Groups Troubleshooting

.To help prevent problems with affinity groups

* Plan and document the scenarios and outcomes you expect when using affinity groups.
* Verify and test the outcomes under a range of conditions.
* Follow change management best practices.
* Only use the *Enforcing* option if it is required.

.If you observe problems with virtual machines not running

* Verify that the cluster has a scheduling policy whose *weight module* and *filter module* sections contain `VmAffinityGroups` and `VmToHostsAffinityGroups`. For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#Explanation_of_Settings_in_the_New_Scheduling_Policy_and_Edit_Scheduling_Policy_Window[Explanation of Settings in the New Scheduling Policy and Edit Scheduling Policy Window] in the _Administration Guide_.
* Check for conflicts between affinity labels and affinity groups.

.For possible conflicts between affinity labels and affinity groups

* Understand that an _affinity label_ is the equivalent of an affinity group with a *Host affinity rule* that is *Positive* and has *Enforcing* enabled.
* Understand that if an affinity label and affinity group conflict with each other, the intersecting set of virtual machines do not run.
* Determine whether a conflict is possible:
** Inspect the *filter module* section of the cluster's scheduling policies. These must contain both a `Label` keyword and a `VmAffinityGroups` OR `VmToHostsAffinityGroups` keyword. Otherwise, a conflict is _not possible_. (The presence of `VmAffinityGroups` and `VmToHostsAffinityGroups` in the *weight module* section does not matter because `Label` in a *filter module* section would override them.)
** Inspect the affinity groups. They must contain a rule that has *Enforcing* enabled. Otherwise, a conflict is _not possible_.
* If a conflict is possible, identify the set of virtual machines that might be involved:
** Inspect the affinity labels and groups. Make a list of virtual machines that are members of both an affinity label *and* an affinity group with an *Enforcing* option enabled.
** For each host and virtual machine in this intersecting set, analyze the conditions under which a potential conflict occurs.
* Determine whether the actual non-running virtual machines match the ones in the analysis.
* Finally, restructure the affinity groups and affinity labels to help avoid unintended conflicts.
* Verify that any changes produce the expected results under a range of conditions.
* If you have overlapping affinity groups and affinity labels, it can be easier to view them in one place as affinity groups. Consider converting an affinity label into an equivalent affinity group, which has a *Host affinity rule* with *Positive* selected and *Enforcing* enabled.


[[sect-Affinity_Labels]]
[[Affinity_Labels]]
=== Affinity Labels

You can create and modify affinity labels in the Administration Portal.

Affinity labels are used to set hard (Enforced) positive affinity between virtual machines and hosts. See the xref:sect-Affinity_Groups[Affinity Groups] section for more information about affinity hardness and polarity.

Labels function identically to a hard positive affinity group, but simplify configuration in certain use cases. For example, if you have virtual machines that require specific host hardware, you can use affinity labels to ensure that those virtual machines run on the required hosts. If you use software that is license-limited to a certain number of physical machines, you can use affinity labels to ensure that virtual machines running that software are limited to the required physical hosts.

[WARNING]
====
Affinity labels are a subset of affinity groups and can conflict with them. If there is a conflict, the virtual machine will not start.
====

[[Creating_an_Affinity_Label]]
==== Creating an Affinity Label

You can create affinity labels from the details view of a virtual machine, host, or cluster. This procedure uses the cluster details view.

*Creating an Affinity Label*

. Click menu:Compute[Clusters] and select the appropriate cluster.
. Click the cluster's name to go to the details view.
. Click the *Affinity Labels* tab.
. Click *New*.
. Enter a *Name* for the affinity label.
. Use the drop-down lists to select the virtual machines and hosts to be associated with the label. Use the *+* button to add additional virtual machines and hosts.
. Click btn:[OK].

[[Editing_an_Affinity_Label]]
==== Editing an Affinity Label

You can edit affinity labels from the details view of a virtual machine, host, or cluster. This procedure uses the cluster details view.

*Editing an Affinity Label*

. Click menu:Compute[Clusters] and select the appropriate cluster.
. Click the cluster's name to go to the details view.
. Click the *Affinity Labels* tab.
. Select the label you want to edit.
. Click btn:[Edit].
. Use the *+* and *-* buttons to add or remove virtual machines and hosts to or from the affinity label.
. Click btn:[OK].

[[Removing_an_Affinity_Label]]
==== Removing an Affinity Label

You can remove affinity labels only from the details view of a cluster.

*Removing an Affinity Label*

. Click menu:Compute[Clusters] and select the appropriate cluster.
. Click the cluster's name to go to the details view.
. Click the *Affinity Labels* tab.
. Select the label you want to remove.
. Click btn:[Edit].
. Use the *-* buttons to remove all virtual machines and hosts from the label.
. Click btn:[OK].
. Click btn:[Delete].
. Click btn:[OK].

[[sect-Exporting_and_Importing_Virtual_Machines_and_Templates]]
=== Exporting and Importing Virtual Machines and Templates


[NOTE]
====
The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center. See the link:{URL_virt_product_docs}{URL_format}administration_guide#sect-Importing_Existing_Storage_Domains[Importing Existing Storage Domains] section in the _{virt-product-fullname} Administration Guide_ for information on importing storage domains.
====
You can export virtual machines and templates from, and import them to, data centers in the same or different Red Hat Virtualization environment. You can export or import virtual machines by using an export domain, a data domain, or by using a Red Hat Virtualization host.

When you export or import a virtual machine or template, properties including basic details such as the name and description, resource allocation, and high availability settings of that virtual machine or template are preserved.

The permissions and user roles of virtual machines and templates are included in the OVF files, so that when a storage domain is detached from one data center and attached to another, the virtual machines and templates can be imported with their original permissions and user roles. In order for permissions to be registered successfully, the users and roles related to the permissions of the virtual machines or templates must exist in the data center before the registration process.

You can also use the V2V feature to import virtual machines from other virtualization providers, such as RHEL 5 Xen or VMware, or import Windows virtual machines. V2V converts virtual machines so that they can be hosted by {virt-product-fullname}. For more information on installing and using V2V, see link:https://access.redhat.com/articles/1351473[Converting Virtual Machines from Other Hypervisors to KVM with virt-v2v].

[IMPORTANT]
====
Virtual machines must be shut down before being imported.
====

[[Exporting_individual_virtual_machines_to_the_export_domain]]
==== Exporting a Virtual Machine to the Export Domain

Export a virtual machine to the export domain so that it can be imported into a different data center. Before you begin, the export domain must be attached to the data center that contains the virtual machine to be exported.

*Exporting a Virtual Machine to the Export Domain*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Export to Export Domain*.
. Optionally, select the following check boxes in the *Export Virtual Machine* window:

* *Force Override*: overrides existing images of the virtual machine on the export domain.

* *Collapse Snapshots*: creates a single export volume per disk. This option removes snapshot restore points and includes the template in a template-based virtual machine, and removes any dependencies a virtual machine has on a template. For a virtual machine that is dependent on a template, either select this option, export the template with the virtual machine, or make sure the template exists in the destination data center.
+
[NOTE]
====
When you create a virtual machine from a template by clicking menu:Compute[Templates] and clicking btn:[New VM], you wll see two storage allocation options in the *Storage Allocation* section in the *Resource Allocation* tab:

* If *Clone* is  selected, the virtual machine is not dependent on the template. The template does not have to exist in the destination data center.

* If *Thin* is selected, the virtual machine is dependent on the template, so the template must exist in the destination data center or be exported with the virtual machine. Alternatively, select the *Collapse Snapshots* check box to collapse the template disk and virtual disk into a single disk.

To check which option was selected, click a virtual machine's name and click the *General* tab in the details view.
====
+
. Click btn:[OK].

The export of the virtual machine begins. The virtual machine displays in menu:Compute[Virtual Machines] with an `Image Locked` status while it is exported. Depending on the size of your virtual machine hard disk images, and your storage hardware, this can take up to an hour. Click the *Events* tab to view  progress. When complete, the virtual machine has been exported to the export domain and displays in the *VM Import* tab of the export domain's details view.

:leveloffset: +3

[id='proc_Exporting_individual_virtual_machines_to_a_data_domain_{context}']
= Exporting a Virtual Machine to a Data Domain

You can export a virtual machine to a data domain to store a clone of the virtual machine as a backup.

When you export a virtual machine that is dependent on a template, the target storage domain should include that template.

[NOTE]
====
When you create a virtual machine from a template, you can choose from either of two storage allocation options:

* *Clone*: The virtual machine is not dependent on the template. The template does not have to exist in the destination storage domain.

* *Thin*: The virtual machine is dependent on the template, so the template must exist in the destination storage domain.

To check which option is selected, click a virtual machine's name and click the *General* tab in the details view.
====

.Prerequisites

* The data domain is attached to a data center.
* The virtual machine is powered off.
+

.Procedure
. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Export].
. Specify a name for the exported virtual machine.
. Select a target storage domain from the *Storage domain* pop-up menu.
. (Optional) Check *Collapse snapshots* to export the virtual machine without any snapshots.
. Click btn:[OK].

The {engine-name} clones the virtual machine, including all its disks, to the target domain.

[NOTE]
====
When you move a disk from one type of data domain another, the disk format changes accordingly. For example, if the disk is on an NFS data domain, and it is in sparse format, then if you move the disk to an iSCSI domain its format changes to preallocated. This is different from using an export domain, because an export domain is NFS.
====

The virtual machine appears with an *Image Locked* status while it is exported. Depending on the size of your virtual machine hard disk images, and your storage hardware, this can take up to an hour. Click the *Events* tab to view  progress. When complete, the virtual machine has been exported to the data domain and appears in the list of virtual machines.

.Additional resources
* link:{URL_virt_product_docs}{URL_format}virtual_machine_management_guide/index#Creating_a_Virtual_Machine_Based_on_a_Template[Creating a Virtual Machine Based on a Template] in the _Virtual Machine Management Guide_

:leveloffset: 2

[[Importing_the_virtual_machine_from_the_export_domain]]
==== Importing a Virtual Machine from the Export Domain

You have a virtual machine on an export domain. Before the virtual machine can be imported to a new data center, the export domain must be attached to the destination data center.


*Importing a Virtual Machine into the Destination Data Center*

. Click menu:Storage[Domains] and select the export domain. The export domain must have a status of `Active`.
. Click the export domain's name to go to the details view.
. Click the *VM Import* tab to list the available virtual machines to import.
. Select one or more virtual machines to import and click btn:[Import].
. Select the *Target Cluster*.
. Select the *Collapse Snapshots* check box to remove snapshot restore points and include templates in template-based virtual machines.
. Click the virtual machine to be imported and click the *Disks* sub-tab. From this tab, you can use the *Allocation Policy* and *Storage Domain* drop-down lists to select whether the disk used by the virtual machine will be thinly provisioned or preallocated, and can also select the storage domain on which the disk will be stored. An icon is also displayed to indicate which of the disks to be imported acts as the boot disk for that virtual machine.
. Click btn:[OK] to import the virtual machines.
+
The *Import Virtual Machine Conflict* window opens if the virtual machine exists in the virtualized environment.
+
Choose one of the following radio buttons:

* *Don't import*
* *Import as cloned* and enter a unique name for the virtual machine in the *New Name* field.

. Optionally select the *Apply to all* check box to import all duplicated virtual machines with the same suffix, and then enter a suffix in the *Suffix to add to the cloned VMs* field.
. Click btn:[OK].



[IMPORTANT]
====
During a single import operation, you can only import virtual machines that share the same architecture. If any of the virtual machines to be imported have a different architecture to that of the other virtual machines to be imported, a warning will display and you will be prompted to change your selection so that only virtual machines with the same architecture will be imported.
====

:leveloffset: +3

[[Importing_a_Virtual_Machine_from_a_Data_Domain]]
= Importing a Virtual Machine from a Data Domain

You can import a virtual machine into one or more clusters from a data storage domain.

.Prerequisite

* If you are importing a virtual machine from an imported data storage domain, the imported storage domain must be attached to a data center and activated.


.Procedure

. Click menu:Storage[Domains].
. Click the imported storage domain's name. This opens the details view.
. Click the *VM Import* tab.
. Select one or more virtual machines to import.
. Click *Import*.
. For each virtual machine in the *Import Virtual Machine(s)* window, ensure the correct target cluster is selected in the *Cluster* list.
. Map external virtual machine vNIC profiles to profiles that are present on the target cluster(s):
.. Click *vNic Profiles Mapping*.
.. Select the vNIC profile to use from the *Target vNic Profile* drop-down list.
.. If multiple target clusters are selected in the *Import Virtual Machine(s)* window, select each target cluster in the *Target Cluster* drop-down list and ensure the mappings are correct.
.. Click btn:[OK].
. If a MAC address conflict is detected, an exclamation mark appears next to the name of the virtual machine. Mouse over the icon to view a tooltip displaying the type of error that occurred.
+
Select the *Reassign Bad MACs* check box to reassign new MAC addresses to all problematic virtual machines. Alternatively, you can select the *Reassign* check box per virtual machine.
+
[NOTE]
====
If there are no available addresses to assign, the import operation will fail. However, in the case of MAC addresses that are outside the cluster's MAC address pool range, it is possible to import the virtual machine without reassigning a new MAC address.
====
+
. Click btn:[OK].

The imported virtual machines no longer appear in the list under the *VM Import* tab.

:leveloffset: 2

[[Importing_a_Virtual_Machine_from_a_VMware_Provider]]
==== Importing a Virtual Machine from a VMware Provider

Import virtual machines from a VMware vCenter provider to your {virt-product-fullname} environment. You can import from a VMware provider by entering its details in the *Import Virtual Machine(s)* window during each import operation, or you can add the VMware provider as an external provider, and select the preconfigured provider during import operations. To add an external provider, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#sect-Adding_External_Providers[Adding a VMware Instance as a Virtual Machine Provider].

{virt-product-fullname} uses V2V to import VMware virtual machines. For OVA files, the only disk format {virt-product-fullname} supports is VMDK.

[NOTE]
====
The `virt-v2v` package is not available on the ppc64le architecture and these hosts cannot be used as proxy hosts.
====

[NOTE]
====
If the import fails, refer to the relevant log file in `/var/log/vdsm/import/` and to `/var/log/vdsm/vdsm.log` on the proxy host for details.
====

.Prerequisites

* The `virt-v2v` package must be installed on at least one host, referred to in this procedure as the proxy host. The `virt-v2v` package is available by default on {hypervisor-fullname}s and is installed on {enterprise-linux-host-fullname}s as a dependency of VDSM when added to the {virt-product-fullname} environment.

* {enterprise-linux-host-fullname}s must be {enterprise-linux} 7.2 or later.

* At least one data and one ISO storage domain are connected to the data center.
+
[NOTE]
====
You can only migrate to shared storage, such as NFS, iSCSI, or FCP. Local storage is not supported.

Although the ISO storage domain has been deprecated, it is required for migration.
====

* The `virtio-win___version__.iso` image file for Windows virtual machines is uploaded to the ISO storage domain. This image includes the guest tools that are required for migrating Windows virtual machines.

* The virtual machine must be shut down before being imported. Starting the virtual machine through VMware during the import process can result in data corruption.

* An import operation can only include virtual machines that share the same architecture. If any virtual machine to be imported has a different architecture, a warning appears and you are prompted to change your selection to include only virtual machines with the same architecture.

.Procedure

. Click menu:Compute[Virtual Machines].
. Click *More Actions* (image:common/images/moreactions.png[]) and select *Import*. This opens the *Import Virtual Machine(s)* window.
. Select *VMware* from the *Source* list.
. If you have configured a VMware provider as an external provider, select it from the *External Provider* list. Verify that the provider credentials are correct. If you did not specify a destination data center or proxy host when configuring the external provider, select those options now.
. If you have not configured a VMware provider, or want to import from a new VMware provider, provide the following details:
.. Select from the list the *Data Center* in which the virtual machine will be available.
.. Enter the IP address or fully qualified domain name of the VMware vCenter instance in the *vCenter* field.
.. Enter the IP address or fully qualified domain name of the host from which the virtual machines will be imported in the *ESXi* field.
.. Enter the name of the data center and the cluster in which the specified ESXi host resides in the *Data Center* field.
.. If you have exchanged the SSL certificate between the ESXi host and the {engine-name}, leave *Verify server's SSL certificate* checked to verify the ESXi host's certificate. If not, clear the option.
.. Enter the *Username* and *Password* for the VMware vCenter instance. The user must have access to the VMware data center and ESXi host on which the virtual machines reside.
.. Select a host in the chosen data center with `virt-v2v` installed to serve as the *Proxy Host* during virtual machine import operations. This host must also be able to connect to the network of the VMware vCenter external provider.
. Click *Load* to list the virtual machines on the VMware provider that can be imported.
. Select one or more virtual machines from the *Virtual Machines on Source* list, and use the arrows to move them to the *Virtual Machines to Import* list. Click btn:[Next].
+
[NOTE]
====
If a virtual machine's network device uses the driver type e1000 or rtl8139, the virtual machine will use the same driver type after it has been imported to {virt-product-fullname}.

If required, you can change the driver type to VirtIO manually after the import. To change the driver type after a virtual machine has been imported, see xref:Editing_network_interfaces[]. If the network device uses driver types other than e1000 or rtl8139, the driver type is changed to VirtIO automatically during the import. The *Attach VirtIO-drivers* option allows the VirtIO drivers to be injected to the imported virtual machine files so that when the driver is changed to VirtIO, the device will be properly detected by the operating system.
====
+
. Select the *Cluster* in which the virtual machines will reside.
. Select a *CPU Profile* for the virtual machines.
. Select the *Collapse Snapshots* check box to remove snapshot restore points and include templates in template-based virtual machines.
. Select the *Clone* check box to change the virtual machine name and MAC addresses, and clone all disks, removing all snapshots. If a virtual machine appears with a warning symbol beside its name or has a tick in the *VM in System* column, you must clone the virtual machine and change its name.
. Click each virtual machine to be imported and click the *Disks* sub-tab. Use the *Allocation Policy* and *Storage Domain* lists to select whether the disk used by the virtual machine will be thinly provisioned or preallocated, and select the storage domain on which the disk will be stored. An icon is also displayed to indicate which of the disks to be imported acts as the boot disk for that virtual machine.
. If you selected the *Clone* check box, change the name of the virtual machine in the *General* sub-tab.
. Click btn:[OK] to import the virtual machines.

The CPU type of the virtual machine must be the same as the CPU type of the cluster into which it is being imported. To view the cluster's *CPU Type* in the Administration Portal:

. Click menu:Compute[Clusters].
. Select a cluster.
. Click btn:[Edit].
. Click the *General* tab.

If the CPU type of the virtual machine is different, configure the imported virtual machine's CPU type:

. Click menu:Compute[Virtual Machines].
. Select the virtual machine.
. Click btn:[Edit].
. Click the *System* tab.
. Click the *Advanced Parameters* arrow.
. Specify the *Custom CPU Type* and click btn:[OK].

[[Exporting_a_virtual_machine_to_a_host]]
==== Exporting a Virtual Machine to a Host

You can export a virtual machine to a specific path or mounted NFS shared storage on a host in the {virt-product-fullname} data center. The export will produce an Open Virtual Appliance (OVA) package.

*Exporting a Virtual Machine to a Host*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Export to OVA*.
. Select the host from the *Host* drop-down list.
. Enter the absolute path to the export directory in the *Directory* field, including the trailing slash. For example: [filename]`/images2/ova/`
. Optionally change the default name of the file in the *Name* field.
. Click btn:[OK]

The status of the export can be viewed in the *Events* tab.

[[Importing_a_virtual_machine_from_a_host]]
==== Importing a Virtual Machine from a Host

Import an Open Virtual Appliance (OVA) file into your {virt-product-fullname} environment. You can import the file from any {hypervisor-fullname} in the data center.

[IMPORTANT]
====
Currently, only {virt-product-fullname} and VMware OVAs can be imported. KVM and Xen are not supported.

The import process uses `virt-v2v`. Only virtual machines running operating systems compatible with `virt-v2v` can be successfully imported. For a current list of compatible operating systems, see link:https://access.redhat.com/articles/1351473[].
====

*Importing an OVA File*

. Copy the OVA file to a host in your cluster, in a file system location such as */var/tmp*.
+
[NOTE]
====
The location can be a local directory or a remote nfs mount, as long as it has sufficient space and is accessible to the qemu user (UID 36).
====
+
. Ensure that the OVA file has permissions allowing read/write access to the *qemu* user (UID 36) and the *kvm* group (GID 36):
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chown-3636-path_to_ova_filefile-ova">4.21. chown 36:36 <em>path_to_OVA_file/file.OVA</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
. Click menu:Compute[Virtual Machines].
. Click *More Actions* (image:common/images/moreactions.png[]) and select *Import*. This opens the *Import Virtual Machine(s)* window.
.. Select *Virtual Appliance (OVA)* from the *Source* list.
.. Select a host from the *Host* list.
.. In the *Path* field, specify the absolute path of the OVA file.
.. Click *Load* to list the virtual machine to be imported.
.. Select the virtual machine from the *Virtual Machines on Source* list, and use the arrows to move it to the *Virtual Machines to Import* list.
. Click btn:[Next].
.. Select the *Storage Domain* for the virtual machine.
.. Select the *Target Cluster* where the virtual machines will reside.
.. Select the *CPU Profile* for the virtual machines.
.. Select the *Allocation Policy* for the virtual machines.
.. Optionally, select the *Attach VirtIO-Drivers* check box and select the appropriate image on the list to add VirtIO drivers.
.. Select the *Allocation Policy* for the virtual machines.
.. Select the virtual machine, and on the *General* tab select the *Operating System*.
.. On the *Network Interfaces* tab, select the *Network Name* and *Profile Name*.
.. Click the *Disks* tab to view the *Alias*, *Virtual Size*, and *Actual Size* of the virtual machine.
. Click btn:[OK] to import the virtual machines.

[[Importing_a_Virtual_Machine_from_Xen]]
==== Importing a virtual machine from a RHEL 5 Xen host

Import virtual machines from Xen on {enterprise-linux} 5 to your {virt-product-fullname} environment. {virt-product-fullname} uses V2V to import QCOW2 or raw virtual machine disk formats.

The `virt-v2v` package must be installed on at least one host (referred to in this procedure as the proxy host). The `virt-v2v` package is available by default on {hypervisor-fullname}s ({hypervisor-shortname}) and is installed on {enterprise-linux-host-fullname}s as a dependency of VDSM when added to the {virt-product-fullname} environment. {enterprise-linux-host-fullname}s must be {enterprise-linux} 7.2 or later.

[WARNING]
====
If you are importing a Windows virtual machine from a RHEL 5 Xen host and you are using VirtIO devices, install the VirtIO drivers before importing the virtual machine. If the drivers are not installed, the virtual machine may not boot after import.

The VirtIO drivers can be installed from the `virtio-win___version__.iso` or the `RHV-toolsSetup___version__.iso`. See xref:Installing_the_Guest_Agents_and_Drivers_on_Windows[] for details.

If you are not using VirtIO drivers, review the configuration of the virutal machine before first boot to ensure that VirtIO devices are not being used.
====

[NOTE]
====
The `virt-v2v` package is not available on the ppc64le architecture and these hosts cannot be used as proxy hosts.
====

[IMPORTANT]
====
An import operation can only include virtual machines that share the same architecture. If any virtual machine to be imported has a different architecture, a warning appears and you are prompted to change your selection to include only virtual machines with the same architecture.
====

[NOTE]
====
If the import fails, refer to the relevant log file in `/var/log/vdsm/import/` and to `/var/log/vdsm/vdsm.log` on the proxy host for details.
====


.Procedure

To import a virtual machine from RHEL 5 Xen, follow these steps:

. Shut down the virtual machine. Starting the virtual machine through Xen during the import process can result in data corruption.
. Enable public key authentication between the proxy host and the RHEL 5 Xen host:
.. Log in to the proxy host and generate SSH keys for the *vdsm* user.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-keygen">4.22. sudo -u vdsm ssh-keygen</h3>
<div class="listingblock">
<div class="content">
<pre>+
.. Copy the *vdsm* user's public key to the RHEL 5 Xen host.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-copy-id-rootxenhost-example-com">4.23. sudo -u vdsm ssh-copy-id root@<em>xenhost.example.com</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
.. Log in to the RHEL 5 Xen host to verify that the login works correctly.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-rootxenhost-example-com">4.24. sudo -u vdsm ssh root@<em>xenhost.example.com</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
. Log in to the Administration Portal.
. Click menu:Compute[Virtual Machines].
. Click *More Actions* (image:common/images/moreactions.png[]) and select *Import*. This opens the *Import Virtual Machine(s)* window.
. Select the *Data Center* that contains the proxy host.
. Select *XEN (via RHEL)* from the *Source* drop-down list.
. Optionally, select a RHEL 5 Xen *External Provider* from the drop-down list. The URI will be pre-filled with the correct URI. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Adding_Xen_as_an_External_Provider[Adding a RHEL 5 Xen Host as a Virtual Machine Provider] in the _Administration Guide_ for more information.
. Enter the *URI* of the RHEL 5 Xen host. The required format is pre-filled; you must replace `&lt;hostname&gt;` with the host name of the RHEL 5 Xen host.
. Select the proxy host from the *Proxy Host* drop-down list.
. Click *Load* to list the virtual machines on the RHEL 5 Xen host that can be imported.
. Select one or more virtual machines from the *Virtual Machines on Source* list, and use the arrows to move them to the *Virtual Machines to Import* list.
+
[NOTE]
====
Due to current limitations, Xen virtual machines with block devices do not appear in the *Virtual Machines on Source* list. They must be imported manually. See xref:Importing_Block_Based_Virtual_Machine_from_Xen_host[].
====
+
. Click btn:[Next].
. Select the *Cluster* in which the virtual machines will reside.
. Select a *CPU Profile* for the virtual machines.
. Use the *Allocation Policy* and *Storage Domain* lists to select whether the disk used by the virtual machine will be thinly provisioned or preallocated, and select the storage domain on which the disk will be stored.
+
[NOTE]
====
The target storage domain must be a file-based domain. Due to current limitations, specifying a block-based domain causes the V2V operation to fail.
====
+
. If a virtual machine appears with a warning symbol beside its name, or has a tick in the *VM in System* column, select the *Clone* check box to clone the virtual machine.
+
[NOTE]
====
Cloning a virtual machine changes its name and MAC addresses and clones all of its disks, removing all snapshots.
====
+
. Click btn:[OK] to import the virtual machines.

The CPU type of the virtual machine must be the same as the CPU type of the cluster into which it is being imported. To view the cluster's *CPU Type* in the Administration Portal:

. Click menu:Compute[Clusters].
. Select a cluster.
. Click btn:[Edit].
. Click the *General* tab.

If the CPU type of the virtual machine is different, configure the imported virtual machine's CPU type:

. Click menu:Compute[Virtual Machines].
. Select the virtual machine.
. Click btn:[Edit].
. Click the *System* tab.
. Click the *Advanced Parameters* arrow.
. Specify the *Custom CPU Type* and click btn:[OK].

[id='Importing_Block_Based_Virtual_Machine_from_Xen_host']
.Importing a Block-Based Virtual Machine from a RHEL 5 Xen Host

. Enable public key authentication between the proxy host and the RHEL 5 Xen host:
.. Log in to the proxy host and generate SSH keys for the *vdsm* user.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-keygen-2">4.25. sudo -u vdsm ssh-keygen</h3>
<div class="listingblock">
<div class="content">
<pre>+
.. Copy the *vdsm* user's public key to the RHEL 5 Xen host.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-copy-id-rootxenhost-example-com-2">4.26. sudo -u vdsm ssh-copy-id root@<em>xenhost.example.com</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
.. Log in to the RHEL 5 Xen host to verify that the login works correctly.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-rootxenhost-example-com-2">4.27. sudo -u vdsm ssh root@<em>xenhost.example.com</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
. Attach an export domain. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Attaching_an_export_domain[Attaching an Existing Export Domain to a Data Center] in the _Administration Guide_ for details.
. On the proxy host, copy the virtual machine from the RHEL 5 Xen host:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virt-v2v-copy-to-local-ic-xensshrootxenhost-example-com-vmname">4.28. virt-v2v-copy-to-local -ic xen+ssh://root@<em>xenhost.example.com</em> <em>vmname</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
. Convert the virtual machine to libvirt XML and move the file to your export domain:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virt-v2v-i-libvirtxml-vmname-xml-o-rhev-of-raw-os-storage-example-comexportdomain">4.29. virt-v2v -i libvirtxml <em>vmname</em>.xml -o rhev -of raw -os <em>storage.example.com:/exportdomain</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
. In the Administration Portal, click menu:Storage[Domains], click the export domain's name, and click the *VM Import* tab in the details view to verify that the virtual machine is in your export domain.
. Import the virtual machine into the destination data domain. See xref:Importing_the_virtual_machine_from_the_export_domain[] for details.

[[Importing_a_Virtual_Machine_from_KVM]]
==== Importing a Virtual Machine from a KVM Host

Import virtual machines from KVM to your {virt-product-fullname} environment. {virt-product-fullname} converts KVM virtual machines to the correct format before they are imported. You must enable public key authentication between the KVM host and at least one host in the destination data center (this host is referred to in the following procedure as the proxy host).

[WARNING]
====
The virtual machine must be shut down before being imported. Starting the virtual machine through KVM during the import process can result in data corruption.
====

[IMPORTANT]
====
An import operation can only include virtual machines that share the same architecture. If any virtual machine to be imported has a different architecture, a warning appears and you are prompted to change your selection to include only virtual machines with the same architecture.
====

[NOTE]
====
If the import fails, refer to the relevant log file in */var/log/vdsm/import/* and to */var/log/vdsm/vdsm.log* on the proxy host for details.
====


*Importing a Virtual Machine from KVM*

. Enable public key authentication between the proxy host and the KVM host:
.. Log in to the proxy host and generate SSH keys for the *vdsm* user.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-keygen-3">4.30. sudo -u vdsm ssh-keygen</h3>
<div class="listingblock">
<div class="content">
<pre>+
.. Copy the *vdsm* user's public key to the KVM host. The proxy host's *known_hosts* file will also be updated to include the host key of the KVM host.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-copy-id-rootkvmhost-example-com">4.31. sudo -u vdsm ssh-copy-id root@<em>kvmhost.example.com</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
.. Log in to the KVM host to verify that the login works correctly.
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sudo-u-vdsm-ssh-rootkvmhost-example-com">4.32. sudo -u vdsm ssh root@<em>kvmhost.example.com</em></h3>
<div class="listingblock">
<div class="content">
<pre>+
. Log in to the Administration Portal.
. Click menu:Compute[Virtual Machines].
. Click *More Actions* (image:common/images/moreactions.png[]) and select *Import*. This opens the *Import Virtual Machine(s)* window.
. Select the *Data Center* that contains the proxy host.
. Select *KVM (via Libvirt)* from the *Source* drop-down list.
. Optionally, select a KVM provider *External Provider* from the drop-down list. The URI will be pre-filled with the correct URI. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Adding_KVM_as_an_External_Provider[Adding a KVM Host as a Virtual Machine Provider] in the _Administration Guide_ for more information.
. Enter the *URI* of the KVM host in the following format:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
<div class="paragraph">
<p>qemu+ssh://root@<em>kvmhost.example.com</em>/system</p>
</div>
<div class="listingblock">
<div class="content">
<pre>+
. Keep the *Requires Authentication* check box selected.
. Enter `root` in the *Username* field.
. Enter the *Password* of the KVM host's root user.
. Select the *Proxy Host* from the drop-down list.
. Click *Load* to list the virtual machines on the KVM host that can be imported.
. Select one or more virtual machines from the *Virtual Machines on Source* list, and use the arrows to move them to the *Virtual Machines to Import* list.
. Click btn:[Next].
. Select the *Cluster* in which the virtual machines will reside.
. Select a *CPU Profile* for the virtual machines.
. Optionally, select the *Collapse Snapshots* check box to remove snapshot restore points and include templates in template-based virtual machines.
. Optionally, select the *Clone* check box to change the virtual machine name and MAC addresses, and clone all disks, removing all snapshots. If a virtual machine appears with a warning symbol beside its name or has a tick in the *VM in System* column, you must clone the virtual machine and change its name.
. Click each virtual machine to be imported and click the *Disks* sub-tab. Use the *Allocation Policy* and *Storage Domain* lists to select whether the disk used by the virtual machine will be thin provisioned or preallocated, and select the storage domain on which the disk will be stored. An icon is also displayed to indicate which of the disks to be imported acts as the boot disk for that virtual machine. See link:{URL_downstream_virt_product_docs}technical_reference/index#Preallocated_Storage[Virtual Disk Storage Allocation Policies] in the _Technical Reference_ for more information.
. If you selected the *Clone* check box, change the name of the virtual machine in the *General* tab.
. Click btn:[OK] to import the virtual machines.

The CPU type of the virtual machine must be the same as the CPU type of the cluster into which it is being imported. To view the cluster's *CPU Type* in the Administration Portal:

. Click menu:Compute[Clusters].
. Select a cluster.
. Click btn:[Edit].
. Click the *General* tab.

If the CPU type of the virtual machine is different, configure the imported virtual machine's CPU type:

. Click menu:Compute[Virtual Machines].
. Select the virtual machine.
. Click btn:[Edit].
. Click the *System* tab.
. Click the *Advanced Parameters* arrow.
. Specify the *Custom CPU Type* and click btn:[OK].

[[Importing_a_Red_Hat_KVM_Guest_Image]]
==== Importing a Red Hat KVM Guest Image

You can import a Red Hat-provided KVM virtual machine image. This image is a virtual machine snapshot with a preconfigured instance of {enterprise-linux} installed.

You can configure this image with the *cloud-init* tool, and use it to provision new virtual machines. This eliminates the need to install and configure the operating system and provides virtual machines that are ready for use.


*Importing a Red Hat KVM Guest Image*

. Download the most recent KVM virtual machine image from the link:https://access.redhat.com/downloads/content/69/ver=/rhel---7/7.5/x86_64/product-software[Download {enterprise-linux}] list, in the Product Software tab.
. Upload the virtual machine image using the {engine-name} or the REST API. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Uploading_a_Disk_Image_to_a_Storage_Domain[Uploading a Disk Image to a Storage Domain] in the _Administration Guide_.
. Create a new virtual machine and attach the uploaded disk image to it. See xref:Creating_a_virtual_machine_linux_vm[].
. Optionally, use *cloud-init* to configure the virtual machine. See xref:Using_Cloud-Init_to_Automate_the_Configuration_of_Virtual_Machines[] for details.
. Optionally, create a template from the virtual machine. You can generate new virtual machines from this template. See xref:chap-Templates[] for information about creating templates and generating virtual machines from templates.

[[sect-Migrating_Virtual_Machines_Between_Hosts]]
=== Migrating Virtual Machines Between Hosts

Live migration provides the ability to move a running virtual machine between physical hosts with no interruption to service. The virtual machine remains powered on and user applications continue to run while the virtual machine is relocated to a new physical host. In the background, the virtual machine's RAM is copied from the source host to the destination host. Storage and network connectivity are not altered.

[NOTE]
====
A virtual machine that is using a vGPU cannot be migrated to a different host.
====

[[Live_migration_prerequisites]]
==== Live Migration Prerequisites

[NOTE]
====
This is one in a series of topics that show how to set up and configure SR-IOV on {virt-product-fullname}. For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#setting-up-and-configuring-sr-iov[Setting Up and Configuring SR-IOV]
====

You can use live migration to seamlessly move virtual machines to support a number of common maintenance tasks. Your {virt-product-fullname} environment must be correctly configured to support live migration well in advance of using it.

At a minimum, the following prerequisites must be met to enable successful live migration of virtual machines:

* The source and destination hosts are members of the same cluster, ensuring CPU compatibility between them.

[NOTE]
====
Live migrating virtual machines between different clusters is generally not recommended.
====

* The source and destination hosts' status is `Up`.

* The source and destination hosts have access to the same virtual networks and VLANs.

* The source and destination hosts have access to the data storage domain on which the virtual machine resides.

* The destination host has sufficient CPU capacity to support the virtual machine's requirements.

* The destination host has sufficient unused RAM to support the virtual machine's requirements.

* The migrating virtual machine does not have the `cache!=none` custom property set.

Live migration is performed using the management network and involves transferring large amounts of data between hosts. Concurrent migrations have the potential to saturate the management network. For best performance, create separate logical networks for management, storage, display, and virtual machine data to minimize the risk of network saturation.

[[Configuring_virtual_machines_with_SR-IOV-Enabled_vNICs]]
==== Configuring Virtual Machines with SR-IOV-Enabled vNICs to Reduce Network Outage during Migration

Virtual machines with vNICs that are directly connected to a virtual function (VF) of an SR-IOV-enabled host NIC can be further configured to reduce network outage during live migration:

. Ensure that the destination host has an available VF.
. Set the *Passthrough* and *Migratable* options in the passthrough vNIC's profile. See link:{URL_virt_product_docs}{URL_format}administration_guide/#Enabling_Passthrough_on_a_vNIC_Profile[Enabling Passthrough on a vNIC Profile] in the _Administration Guide_.
. Enable hotplugging for the virtual machine's network interface.
. Ensure that the virtual machine has a backup VirtIO vNIC, in addition to the passthrough vNIC, to maintain the virtual machine's network connection during migration.
. Set the VirtIO vNIC's `No Network Filter` option before configuring the bond. See link:{URL_virt_product_docs}{URL_format}administration_guide/#Explanation_of_Settings_in_the_VM_Interface_Profile_Window[Explanation of Settings in the VM Interface Profile Window] in the _Administration Guide_.
. Add both vNICs as slaves under an `active-backup` bond on the virtual machine, with the passthrough vNIC as the primary interface.
+
The bond and vNIC profiles can be configured in one of the following ways:

* The bond is not configured with `fail_over_mac=active` and the VF vNIC is the primary slave (recommended).
+
Disable the VirtIO vNIC profile's MAC-spoofing filter to ensure that traffic passing through the VirtIO vNIC is not dropped because it uses the VF vNIC MAC address.
//See link:{URL_rhel_docs_legacy}html-single/virtualization_deployment_and_administration_guide/index#sect-Virtual_Networking-Applying_network_filtering[Applying Network Filtering] in the _RHEL 7 Virtualization Deployment and Administration Guide_.
* The bond is configured with `fail_over_mac=active`.
+
This failover policy ensures that the MAC address of the bond is always the MAC address of the active slave. During failover, the virtual machine's MAC address changes, with a slight disruption in traffic.

[[Configuring_virtual_machines_with_SR-IOV-Enabled_vNICs_minimal_downtime]]
==== Configuring Virtual Machines with SR-IOV-Enabled vNICs with minimal downtime.
To configure virtual machines for migration with SR-IOV enabled vNICs and minimal downtime follow the procedure described below.
[NOTE]
====
The following steps are provided only as a Technology Preview. For more information see link:https://access.redhat.com/support/offerings/techpreview/[Red Hat Technology Preview Features Support Scope].
====

. Create a vNIC profile with SR-IOV enabled vNICS.
See link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/administration_guide/index#Creating_a_VNIC_Profile[Creating a vNIC profile] and link:https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html/administration_guide/sect-hosts_and_networking#setting-up-and-configuring-sr-iov[Setting up and configuring SR-IOV].
. In the Administration Portal, go to menu:Network[VNIC profiles], select the vNIC profile, click btn:[Edit] and select a `Failover vNIC profile` from the drop down list.
. Click btn:[OK] to save the profile settings.
. Hotplug a network interface with the failover vNIC profile you created into the virtual machine, or start a virtual machine with this network interface plugged in.
+
[NOTE]
====
The virtual machine will have three interfaces available, in order for migration to work properly, the main interface should be activated and used for connection. The main interface acts as a master for the remaining two interfaces.
====
+
. For automatic deployment of virtual machines with this configuration, use the following `udev` rule:
+</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>UBSYSTEM=="net",
ACTION=="add|change",
ENV{ID_NET_DRIVER}!="net_failover",
ENV{NM_UNMANAGED}="1",
RUN+="/bin/sh -c '/sbin/ip link set up $INTERFACE'"</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>+
This `udev` rule works only on systems that manage interfaces with `NetworkManager`. This rule ensures that only the master interface is activated.

// removed Optimizing live migration section - options no longer Existing

[[Guest_Agent_Hooks]]
==== Guest Agent Hooks

Hooks are scripts that trigger activity within a virtual machine when key events occur:

* Before migration

* After migration

* Before hibernation

* After hibernation

The hooks configuration base directory is `/etc/ovirt-guest-agent/hooks.d` on Linux systems.

Each event has a corresponding subdirectory: `before_migration` and `after_migration`, `before_hibernation` and `after_hibernation`. All files or symbolic links in that directory will be executed.

The executing user on Linux systems is `ovirtagent`. If the script needs `root` permissions, the elevation must be executed by the creator of the hook script.

[[Automatic_virtual_machine_migration]]
==== Automatic Virtual Machine Migration

{virt-product-fullname} {engine-name} automatically initiates live migration of all virtual machines running on a host when the host is moved into maintenance mode. The destination host for each virtual machine is assessed as the virtual machine is migrated, in order to spread the load across the cluster.

From version 4.3, all virtual machines defined with manual or automatic migration modes are migrated when the host is moved into maintenance mode. However, for high performance and/or pinned virtual machines, a *Maintenance Host* window is displayed, asking you to confirm the action because the performance on the target host may be less than the performance on the current host.

The {engine-name} automatically initiates live migration of virtual machines in order to maintain load-balancing or power-saving levels in line with scheduling policy. Specify the scheduling policy that best suits the needs of your environment. You can also disable automatic, or even manual, live migration of specific virtual machines where required.

If your virtual machines are configured for high performance, and/or if they have been pinned (by setting Passthrough Host CPU, CPU Pinning, or NUMA Pinning), the migration mode is set to *Allow manual migration only*. However, this can be changed to *Allow Manual and Automatic* mode if required. Special care should be taken when changing the default migration setting so that it does not result in a virtual machine migrating to a host that does not support high performance or pinning.

[[Preventing_automatic_migration_of_a_virtual_machine]]
==== Preventing Automatic Migration of a Virtual Machine

{virt-product-fullname} {engine-name} allows you to disable automatic migration of virtual machines. You can also disable manual migration of virtual machines by setting the virtual machine to run only on a specific host.

The ability to disable automatic migration and require a virtual machine to run on a particular host is useful when using application high availability products, such as Red Hat High Availability or Cluster Suite.


*Preventing Automatic Migration of Virtual Machines*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Edit].
. Click the *Host* tab.
. In the *Start Running On* section, select *Any Host in Cluster* or *Specific Host(s)*, which enables you to select multiple hosts.
+
[WARNING]
====
Explicitly assigning a virtual machine to a specific host and disabling migration are mutually exclusive with {virt-product-fullname} high availability.
====
+
[IMPORTANT]
====
If the virtual machine has host devices directly attached to it, and a different host is specified, the host devices from the previous host will be automatically removed from the virtual machine.
====
+
. Select *Allow manual migration only* or *Do not allow migration* from the *Migration Options* drop-down list.
. Click btn:[OK].

[[Manually_migrating_virtual_machines]]
==== Manually Migrating Virtual Machines

A running virtual machine can be live migrated to any host within its designated host cluster. Live migration of virtual machines does not cause any service interruption. Migrating virtual machines to a different host is especially useful if the load on a particular host is too high. For live migration prerequisites, see xref:Live_migration_prerequisites[].

For high performance virtual machines and/or virtual machines defined with *Pass-Through Host CPU*, *CPU Pinning*, or *NUMA Pinning*, the default migration mode is *Manual*. Select *Select Host Automatically* so that the virtual machine migrates to the host that offers the best performance.

[NOTE]
====
When you place a host into maintenance mode, the virtual machines running on that host are automatically migrated to other hosts in the same cluster. You do not need to manually migrate these virtual machines.
====

[NOTE]
====
Live migrating virtual machines between different clusters is generally not recommended. The only supported use case is documented at link:https://access.redhat.com/articles/1390733[].
====

.Procedure

. Click menu:Compute[Virtual Machines] and select a running virtual machine.
. Click btn:[Migrate].
. Use the radio buttons to select whether to *Select Host Automatically* or to *Select Destination Host*, specifying the host using the drop-down list.
+
[NOTE]
====
When the *Select Host Automatically* option is selected, the system determines the host to which the virtual machine is migrated according to the load balancing and power management rules set up in the scheduling policy.
====
+
. Click btn:[OK].


During migration, progress is shown in the *Migration* progress bar. Once migration is complete the *Host* column will update to display the host the virtual machine has been migrated to.

[[Setting_migration_priority]]
==== Setting Migration Priority

{virt-product-fullname} {engine-name} queues concurrent requests for migration of virtual machines off of a given host. The load balancing process runs every minute. Hosts already involved in a migration event are not included in the migration cycle until their migration event has completed. When there is a migration request in the queue and available hosts in the cluster to action it, a migration event is triggered in line with the load balancing policy for the cluster.

You can influence the ordering of the migration queue by setting the priority of each virtual machine; for example, setting mission critical virtual machines to migrate before others. Migrations will be ordered by priority; virtual machines with the highest priority will be migrated first.


*Setting Migration Priority*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Edit].
. Select the *High Availability* tab.
. Select *Low*, *Medium*, or *High* from the *Priority* drop-down list.
. Click btn:[OK].



[[Canceling_ongoing_virtual_machine_migrations]]
==== Canceling Ongoing Virtual Machine Migrations

A virtual machine migration is taking longer than you expected. You'd like to be sure where all virtual machines are running before you make any changes to your environment.


*Canceling Ongoing Virtual Machine Migrations*

. Select the migrating virtual machine. It is displayed in menu:Compute[Virtual Machines] with a status of *Migrating from*.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Cancel Migration*.

The virtual machine status returns from *Migrating from* to *Up*.

[[Event_and_Log_Notification_upon_Automatic_Migration_of_Highly_Available_Virtual_Servers]]
==== Event and Log Notification upon Automatic Migration of Highly Available Virtual Servers

When a virtual server is automatically migrated because of the high availability function, the details of an automatic migration are documented in the *Events* tab and in the engine log to aid in troubleshooting, as illustrated in the following examples:

.Notification in the Events Tab of the Administration Portal
====
Highly Available _Virtual_Machine_Name_ failed. It will be restarted automatically.

_Virtual_Machine_Name_ was restarted on Host _Host_Name_

====

.Notification in the {engine-name} engine.log
====
This log can be found on the {virt-product-fullname} {engine-name} at */var/log/ovirt-engine/engine.log*:

Failed to start Highly Available VM. Attempting to restart. VM Name: _Virtual_Machine_Name_, VM Id:_Virtual_Machine_ID_Number_

====

[[sect-Improving_Uptime_with_Virtual_Machine_High_Availability]]
=== Improving Uptime with Virtual Machine High Availability

[[What_is_high_availability]]
==== What is High Availability?

High availability is recommended for virtual machines running critical workloads. A highly available virtual machine is automatically restarted, either on its original host or another host in the cluster, if its process is interrupted, such as in the following scenarios:

* A host becomes non-operational due to hardware failure.

* A host is put into maintenance mode for scheduled downtime.

* A host becomes unavailable because it has lost communication with an external storage resource.

A highly available virtual machine is not restarted if it is shut down cleanly, such as in the following scenarios:

* The virtual machine is shut down from within the guest.

* The virtual machine is shut down from the {engine-name}.

* The host is shut down by an administrator without being put in maintenance mode first.

With storage domains V4 or later, virtual machines have the additional capability to acquire a lease on a special volume on the storage, enabling a virtual machine to start on another host even if the original host loses power. The functionality also prevents the virtual machine from being started on two different hosts, which may lead to corruption of the virtual machine disks.

With high availability, interruption to service is minimal because virtual machines are restarted within seconds with no user intervention required. High availability keeps your resources balanced by restarting guests on a host with low current resource utilization, or based on any workload balancing or power saving policies that you configure. This ensures that there is sufficient capacity to restart virtual machines at all times.

*High Availability and Storage I/O Errors*

If a storage I/O error occurs, the virtual machine is paused. You can define how the host handles highly available virtual machines after the connection with the storage domain is reestablished; they can either be resumed, ungracefully shut down, or remain paused. For more information about these options, see xref:Virtual_Machine_High_Availability_settings_explained[].

[[High_availability_considerations]]
==== High Availability Considerations

A highly available host requires a power management device and fencing parameters. In addition, for a virtual machine to be highly available when its host becomes non-operational, it needs to be started on another available host in the cluster. To enable the migration of highly available virtual machines:


* Power management must be configured for the hosts running the highly available virtual machines.

* The host running the highly available virtual machine must be part of a cluster which has other available hosts.

* The destination host must be running.

* The source and destination host must have access to the data domain on which the virtual machine resides.

* The source and destination host must have access to the same virtual networks and VLANs.

* There must be enough CPUs on the destination host that are not in use to support the virtual machine's requirements.

* There must be enough RAM on the destination host that is not in use to support the virtual machine's requirements.


[[Configuring_a_highly_available_virtual_machine]]
==== Configuring a Highly Available Virtual Machine

High availability must be configured individually for each virtual machine.


*Configuring a Highly Available Virtual Machine*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Edit].
. Click the *High Availability* tab.
. Select the *Highly Available* check box to enable high availability for the virtual machine.
. Select the storage domain to hold the virtual machine lease, or select *No VM Lease* to disable the functionality, from the *Target Storage Domain for VM Lease* drop-down list. See xref:What_is_high_availability[] for more information about virtual machine leases.
+
[IMPORTANT]
====
This functionality is only available on storage domains that are V4 or later.
====
+
. Select *AUTO_RESUME*, *LEAVE_PAUSED*, or *KILL* from the *Resume Behavior* drop-down list. If you defined a virtual machine lease, *KILL* is the only option available. For more information see xref:Virtual_Machine_High_Availability_settings_explained[].
+

. Select *Low*, *Medium*, or *High* from the *Priority* drop-down list. When migration is triggered, a queue is created in which the high priority virtual machines are migrated first. If a cluster is running low on resources, only the high priority virtual machines are migrated.
. Click btn:[OK].




[[sect-Other_Virtual_Machine_Tasks]]
=== Other Virtual Machine Tasks

[[Enabling_SAP_monitoring_for_a_virtual_machine_from_the_Administration_Portal]]
==== Enabling SAP Monitoring

Enable SAP monitoring on a virtual machine through the Administration Portal.

*Enabling SAP Monitoring on Virtual Machines*

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click btn:[Edit].
. Click the *Custom Properties* tab.
. Select `sap_agent` from the drop-down list. Ensure the secondary drop-down menu is set to *True*.
+
If previous properties have been set, select the plus sign to add a new property rule and select `sap_agent`.
. Click btn:[OK].




[[sect-Configuring_Red_Hat_Enterprise_Linux_5.4_and_Higher_Virtual_Machines_to_use_SPICE]]
==== Configuring {enterprise-linux} 5.4 and later Virtual Machines to use SPICE

SPICE is a remote display protocol designed for virtual environments, which enables you to view a virtualized desktop or server. SPICE delivers a high quality user experience, keeps CPU consumption low, and supports high quality video streaming.

Using SPICE on a Linux machine significantly improves the movement of the mouse cursor on the console of the virtual machine. To use SPICE, the X-Windows system requires additional QXL drivers. The QXL drivers are provided with {enterprise-linux} 5.4 and later. Earlier versions are not supported. Installing SPICE on a virtual machine running {enterprise-linux} significantly improves the performance of the graphical user interface.

[NOTE]
====
Typically, this is most useful for virtual machines where the user requires the use of the graphical user interface. System administrators who are creating virtual servers may prefer not to configure SPICE if their use of the graphical user interface is minimal.
====
[[Configuring_qxl_drivers_on_virtual_machines]]
===== Installing and Configuring QXL Drivers

You must manually install QXL drivers on virtual machines running {enterprise-linux} 5.4 or later. This is unnecessary for virtual machines running {enterprise-linux} 6 or {enterprise-linux} 7 as the QXL drivers are installed by default.


*Installing QXL Drivers*

. Log in to a {enterprise-linux} virtual machine.
. Install the QXL drivers:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="yum-install-xorg-x11-drv-qxl">4.33. yum install xorg-x11-drv-qxl</h3>
<div class="listingblock">
<div class="content">
<pre>You can configure QXL drivers using either a graphical interface or the command line. Perform only one of the following procedures.


*Configuring QXL drivers in GNOME*

. Click *System*.
. Click *Administration*.
. Click *Display*.
. Click the *Hardware* tab.
. Click *Video Cards Configure*.
. Select *qxl* and click btn:[OK].
. Restart X-Windows by logging out of the virtual machine and logging back in.




*Configuring QXL drivers on the command line*

. Back up */etc/X11/xorg.conf*:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cp-etcx11xorg-conf-etcx11xorg-conf-backup">4.34. cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup</h3>
<div class="listingblock">
<div class="content">
<pre>+
. Make the following change to the Device section of */etc/X11/xorg.conf*:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
<div class="paragraph">
<p>Section 	"Device"
Identifier	"Videocard0"
Driver		"qxl"
Endsection</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[Configuring_a_virtual_machines_tablet_and_mouse_to_use_SPICE]]
===== Configuring a Virtual Machine's Tablet and Mouse to use SPICE

Edit the `/etc/X11/xorg.conf` file to enable SPICE for your virtual machine's tablet devices.


*Configuring a Virtual Machine's Tablet and Mouse to use SPICE*

. Verify that the tablet device is available on your guest:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sbinlsusb-v-grep-qemu-usb-tablet">4.35. /sbin/lsusb -v | grep 'QEMU USB Tablet'</h3>
<div class="listingblock">
<div class="content">
<pre> If there is no output from the command, do not continue configuring the tablet.
. Back up `/etc/X11/xorg.conf`:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cp-etcx11xorg-conf-etcx11xorg-conf-backup-2">4.36. cp /etc/X11/xorg.conf /etc/X11/xorg.conf.$$.backup</h3>
<div class="listingblock">
<div class="content">
<pre>+
. Make the following changes to `/etc/X11/xorg.conf`:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
<div class="paragraph">
<p>Section "ServerLayout"
Identifier     "single head configuration"
Screen      0  "Screen0" 0 0
InputDevice    "Keyboard0" "CoreKeyboard"
InputDevice    "Tablet" "SendCoreEvents"
InputDevice    "Mouse" "CorePointer"
EndSection</p>
</div>
<div class="paragraph">
<p>Section "InputDevice"
Identifier  "Mouse"
Driver      "void"
#Option      "Device" "/dev/input/mice"
#Option      "Emulate3Buttons" "yes"
EndSection</p>
</div>
<div class="paragraph">
<p>Section "InputDevice"
Identifier  "Tablet"
Driver      "evdev"
Option      "Device" "/dev/input/event2"
Option "CorePointer" "true"
EndSection</p>
</div>
<div class="listingblock">
<div class="content">
<pre>. Log out and log back into the virtual machine to restart X-Windows.



[[KVM_virtual_machine_timing_management]]
==== KVM Virtual Machine Timing Management

Virtualization poses various challenges for virtual machine time keeping. Virtual machines which use the Time Stamp Counter (TSC) as a clock source may suffer timing issues as some CPUs do not have a constant Time Stamp Counter. Virtual machines running without accurate timekeeping can have serious affects on some networked applications as your virtual machine will run faster or slower than the actual time.

KVM works around this issue by providing virtual machines with a paravirtualized clock. The KVM `pvclock` provides a stable source of timing for KVM guests that support it.

Presently, only {enterprise-linux} 5.4 and later virtual machines fully support the paravirtualized clock.

Virtual machines can have several problems caused by inaccurate clocks and counters:


* Clocks can fall out of synchronization with the actual time which invalidates sessions and affects networks.

* Virtual machines with slower clocks may have issues migrating.

These problems exist on other virtualization platforms and timing should always be tested.

[IMPORTANT]
====
The Network Time Protocol (NTP) daemon should be running on the host and the virtual machines. Enable the `ntpd` service and add it to the default startup sequence:

* For {enterprise-linux} 6
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="service-ntpd-start">4.37. service ntpd start</h3>

</div>
<div class="sect2">
<h3 id="chkconfig-ntpd-on">4.38. chkconfig ntpd on</h3>
<div class="listingblock">
<div class="content">
<pre>* For {enterprise-linux} 7
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="systemctl-start-ntpd-service">4.39. systemctl start ntpd.service</h3>

</div>
<div class="sect2">
<h3 id="systemctl-enable-ntpd-service">4.40. systemctl enable ntpd.service</h3>
<div class="listingblock">
<div class="content">
<pre>Using the `ntpd` service should minimize the affects of clock skew in all cases.

The NTP servers you are trying to use must be operational and accessible to your hosts and virtual machines.
====

[[form-Virtualization-KVM_guest_timing_management-Determining_if_your_CPU_has_the_constant_Time_Stamp_Counter]]
*Determining if your CPU has the constant Time Stamp Counter*

Your CPU has a constant Time Stamp Counter if the `constant_tsc` flag is present. To determine if your CPU has the `constant_tsc` flag run the following command:

[options="nowrap" subs="normal"]</pre>
</div>
</div>
<div class="paragraph">
<p>$ cat /proc/cpuinfo | grep constant_tsc</p>
</div>
<div class="listingblock">
<div class="content">
<pre>If any output is given your CPU has the `constant_tsc` bit. If no output is given follow the instructions below.

[[form-Virtualization-KVM_guest_timing_management-Configuring_hosts_without_a_constant_Time_Stamp_Counter]]
*Configuring hosts without a constant Time Stamp Counter*

Systems without constant time stamp counters require additional configuration. Power management features interfere with accurate time keeping and must be disabled for virtual machines to accurately keep time with KVM.

[IMPORTANT]
====
These instructions are for AMD revision F CPUs only.
====
If the CPU lacks the `constant_tsc` bit, disable all power management features (link:https://bugzilla.redhat.com/show_bug.cgi?id=513138[BZ#513138]). Each system has several timers it uses to keep time. The TSC is not stable on the host, which is sometimes caused by `cpufreq` changes, deep C state, or migration to a host with a faster TSC. Deep C sleep states can stop the TSC. To prevent the kernel using deep C states append "`processor.max_cstate=1`" to the kernel boot options in the `grub.conf` file on the host:

[options="nowrap" subs="normal"]</pre>
</div>
</div>
<div class="paragraph">
<p>term Enterprise Linux Server (2.6.18-159.el5)
        root (hd0,0)
	kernel /vmlinuz-2.6.18-159.el5 ro root=/dev/VolGroup00/LogVol00 rhgb quiet <code>processor.max_cstate=1</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>Disable `cpufreq` (only necessary on hosts without the `constant_tsc`) by editing the `/etc/sysconfig/cpuspeed` configuration file and change the `MIN_SPEED` and `MAX_SPEED` variables to the highest frequency available. Valid limits can be found in the `/sys/devices/system/cpu/cpu/cpufreq/scaling_available_frequencies` files.

*Using the `engine-config` tool to receive alerts when hosts drift out of sync.*

You can use the `engine-config` tool to configure alerts when your hosts drift out of sync.

There are 2 relevant parameters for time drift on hosts: `EnableHostTimeDrift` and `HostTimeDriftInSec`. `EnableHostTimeDrift`, with a default value of false, can be enabled to receive alert notifications of host time drift. The `HostTimeDriftInSec` parameter is used to set the maximum allowable drift before alerts start being sent.

Alerts are sent once per hour per host.

[[form-Virtualization-KVM_guest_timing_management-Using_the_para_virtualized_clock_with_Red_Hat_Enterprise_Linux_guests]]
*Using the paravirtualized clock with {enterprise-linux} virtual machines*

For certain {enterprise-linux} virtual machines, additional kernel parameters are required. These parameters can be set by appending them to the end of the /kernel line in the /boot/grub/grub.conf file of the virtual machine.

[NOTE]
====
The process of configuring kernel parameters can be automated using the `ktune` package
====
The `ktune` package provides an interactive Bourne shell script, `fix_clock_drift.sh`. When run as the superuser, this script inspects various system parameters to determine if the virtual machine on which it is run is susceptible to clock drift under load. If so, it then creates a new `grub.conf.kvm` file in the `/boot/grub/` directory. This file contains a kernel boot line with additional kernel parameters that allow the kernel to account for and prevent significant clock drift on the KVM virtual machine. After running `fix_clock_drift.sh` as the superuser, and once the script has created the `grub.conf.kvm` file, then the virtual machine's current `grub.conf` file should be backed up manually by the system administrator, the new `grub.conf.kvm` file should be manually inspected to ensure that it is identical to `grub.conf` with the exception of the additional boot line parameters, the `grub.conf.kvm` file should finally be renamed `grub.conf`, and the virtual machine should be rebooted.

The table below lists versions of {enterprise-linux} and the parameters required for virtual machines on systems without a constant Time Stamp Counter.

[options="header"]
|===
|{enterprise-linux} |Additional virtual machine kernel parameters
|5.4 AMD64/Intel 64 with the paravirtualized clock |Additional parameters are not required
|5.4 AMD64/Intel 64 without the paravirtualized clock |notsc lpj=n
|5.4 x86 with the paravirtualized clock |Additional parameters are not required
|5.4 x86 without the paravirtualized clock |clocksource=acpi_pm lpj=n
|5.3 AMD64/Intel 64 |notsc
|5.3 x86 |clocksource=acpi_pm
|4.8 AMD64/Intel 64 |notsc
|4.8 x86 |clock=pmtmr
|3.9 AMD64/Intel 64 |Additional parameters are not required
|3.9 x86 |Additional parameters are not required
|===

[[Adding_TPM_devices]]

==== Adding a Trusted Platform Module device
Trusted Platform Module (TPM) devices provide a secure crypto-processor designed to carry out cryptographic operations such as generating cryptographic keys, random numbers, and hashes, or for storing data that can be used to verify software configurations securely. TPM devices are commonly used for disk encryption.

QEMU and libvirt implement support for emulated TPM 2.0 devices, which is what {virt-product-fullname} uses to add TPM devices to Virtual Machines.

Once an emulated TPM device is added to the virtual machine, it can be used as a normal TPM 2.0 device in the guest OS.

[IMPORTANT]
====
If there is TPM data stored for the virtual machine and the TPM device is disabled in the virtual machine, the TPM data is permanently removed.
====

*Enabling a TPM device*

. In the `Add Virtual Machine` or `Edit Virtual Machine` screen, click btn:[Show Advanced Options].
. In the `Resource Allocation` tab, select the *TPM Device Enabled* check box.

*Limitations*

The following limitations apply:

* TPM devices can only be used on x86_64 machines with UEFI firmware and PowerPC machines with pSeries firmware installed.
* Virtual machines with TPM devices can not have snapshots with memory.
* While the {engine-name} retrieves and stores TPM data periodically, there is no guarantee that the {engine-name} will always have the latest version of the TPM data.
+
[NOTE]
====
This process can take 120 seconds or more, and you must wait for the process to complete before you can take snapshot of a running virtual machine, clone a running virtual machine, or migrate a running virtual machine.
====
+
* TPM devices can only be enabled for VMs running RHEL 7 or newer and Windows 8.1 and newer.
* Virtual machines and templates with TPM data can not be exported or imported.

:context!: vm_guide_administrative_tasks

[[chap-Templates]]

== Templates

A template is a copy of a virtual machine that you can use to simplify the subsequent, repeated creation of similar virtual machines. Templates capture the configuration of software, configuration of hardware, and the software installed on the virtual machine on which the template is based. The virtual machine on which a template is based is known as the source virtual machine.

When you create a template based on a virtual machine, a read-only copy of the virtual machine's disk is created. This read-only disk becomes the base disk image of the new template, and of any virtual machines created based on the template. As such, the template cannot be deleted while any virtual machines created based on the template exist in the environment.

Virtual machines created based on a template use the same NIC type and driver as the original virtual machine, but are assigned separate, unique MAC addresses.

You can create a virtual machine directly from menu:Compute[Templates], as well as from menu:Compute[Virtual Machines]. In menu:Compute[Templates], select the required template and click *New VM*. For more information on selecting the settings and controls for the new virtual machine see xref:Virtual_Machine_General_settings_explained[].

[[Sealing_Virtual_Machines_in_Preparation_for_Deployment_as_Templates]]
=== Sealing Virtual Machines in Preparation for Deployment as Templates

This section describes procedures for sealing Linux and Windows virtual machines. Sealing is the process of removing all system-specific details from a virtual machine before creating a template based on that virtual machine. Sealing is necessary to prevent the same details from appearing on multiple virtual machines created based on the same template. It is also necessary to ensure the functionality of other features, such as predictable vNIC order.

[[Sealing_a_Linux_Virtual_Machine_for_Deployment_as_a_Template]]
==== Sealing a Linux Virtual Machine for Deployment as a Template

To seal a Linux virtual machine during the template creation process, select the *Seal Template* check box in the *New Template* window. See xref:Creating_a_template_from_an_existing_virtual_machine[] for details.

[NOTE]
====
In RHV 4.4, to seal a RHEL 8 virtual machine for a template, its cluster level must be 4.4 and all hosts in the cluster must be based on RHEL 8.
You cannot seal a RHEL 8 virtual machine if you have set its cluster level to 4.3 so it can run on RHEL 7 hosts.
====

[[Sealing_a_Windows_Virtual_Machine_for_Deployment_as_a_Template]]
==== Sealing a Windows Virtual Machine for Deployment as a Template

A template created for Windows virtual machines must be generalized (sealed) before being used to deploy virtual machines. This ensures that machine-specific settings are not reproduced in the template.

`Sysprep` is used to seal Windows templates before use. `Sysprep` generates a complete unattended installation answer file. Default values for several Windows operating systems are available in the */usr/share/ovirt-engine/conf/sysprep/* directory. These files act as templates for `Sysprep`. The fields in these files can be copied, pasted, and altered as required. This definition will override any values entered into the *Initial Run* fields of the *Edit Virtual Machine* window.

The Sysprep file can be edited to affect various aspects of the Windows virtual machines created from the template that the Sysprep file is attached to. These include the provisioning of Windows, setting up the required domain membership, configuring the hostname, and setting the security policy.

Replacement strings can be used to substitute values provided in the default files in the */usr/share/ovirt-engine/conf/sysprep/* directory.  For example, `"&lt;Domain&gt;&lt;![CDATA[$JoinDomain$]]&gt;&lt;/Domain&gt;"` can be used to indicate the domain to join.

[[Prerequisites_for_Sealing_a_Windows_Virtual_Machine]]
===== Prerequisites for Sealing a Windows Virtual Machine


[IMPORTANT]
====
Do not reboot the virtual machine while Sysprep is running.
====

Before starting `Sysprep`, verify that the following settings are configured:

* The Windows virtual machine parameters have been correctly defined.
* If not, click *Edit* in menu:Compute[Virtual Machines] and enter the required information in the *Operating System* and *Cluster* fields.
* The correct product key has been defined in an override file on the {engine-name}.

The override file must be created under */etc/ovirt-engine/osinfo.conf.d/*, have a filename that puts it after */etc/ovirt-engine/osinfo.conf.d/00-defaults.properties*, and ends in *.properties*. For example, */etc/ovirt-engine/osinfo.conf.d/10-productkeys.properties*. The last file will have precedence and override any other previous file.

If not, copy the default values for your Windows operating system from */etc/ovirt-engine/osinfo.conf.d/00-defaults.properties* into the override file, and input your values in the `productKey.value` and `sysprepPath.value` fields.

.Windows 7 Default Configuration Values
====

[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="windows711-ostype-windows-falsefalse">4.41. Windows7(11, OsType.Windows, false),false</h3>
<div class="paragraph">
<p>os.windows_7.id.value = 11
os.windows_7.name.value = Windows 7
os.windows_7.derivedFrom.value = windows_xp
os.windows_7.sysprepPath.value = ${ENGINE_USR}/conf/sysprep/sysprep.w7
os.windows_7.productKey.value =
os.windows_7.devices.audio.value = ich6
os.windows_7.devices.diskInterfaces.value.3.3 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.devices.diskInterfaces.value.3.4 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.devices.diskInterfaces.value.3.5 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.isTimezoneTypeInteger.value = false</p>
</div>
<div class="listingblock">
<div class="content">
<pre>====

[[Sealing_a_Windows_7_or_Windows_2008_template]]
===== Sealing a Windows 7, Windows 2008, or Windows 2012 Virtual Machine for Deployment as Template

Seal a Windows 7, Windows 2008, or Windows 2012 virtual machine before creating a template to use to deploy virtual machines.


*Sealing a Windows 7, Windows 2008, or Windows 2012 Virtual Machine for Deployment as a Template*

. On the Windows virtual machine, launch `Sysprep` from *C:\Windows\System32\sysprep\sysprep.exe*.
. Enter the following information into `Sysprep`:


* Under *System Cleanup Action*, select *Enter System Out-of-Box-Experience (OOBE)*.

* Select the *Generalize* check box if you need to change the computer's system identification number (SID).

* Under *Shutdown Options*, select *Shutdown*.

. Click btn:[OK] to complete the sealing process; the virtual machine shuts down automatically upon completion.


The Windows 7, Windows 2008, or Windows 2012 virtual machine is sealed and ready to create a template to use for deploying virtual machines.

[[Creating_a_template_from_an_existing_virtual_machine]]
=== Creating a Template

Create a template from an existing virtual machine to use as a blueprint for creating additional virtual machines.

[NOTE]
====
In RHV 4.4, to seal a RHEL 8 virtual machine for a template, its cluster level must be 4.4 and all hosts in the cluster must be based on RHEL 8.
You cannot seal a RHEL 8 virtual machine if you have set its cluster level to 4.3 so it can run on RHEL 7 hosts.
====

When you create a template, you specify the format of the disk to be raw or QCOW2:

* QCOW2 disks are thin provisioned.
* Raw disks on file storage are thin provisioned.
* Raw disks on block storage are preallocated.


*Creating a Template*

. Click menu:Compute[Virtual Machines] and select the source virtual machine.
. Ensure the virtual machine is powered down and has a status of `Down`.
. Click *More Actions* (image:common/images/moreactions.png[]), then click *Make Template*. For more details on all fields in the *New Template* window, see xref:Explanation_of_Settings_in_the_New_Template_and_Edit_Template_Windows[].
. Enter a *Name*, *Description*, and *Comment* for the template.
. Select the cluster with which to associate the template from the *Cluster* drop-down list. By default, this is the same as that of the source virtual machine.
. Optionally, select a CPU profile for the template from the *CPU Profile* drop-down list.
. Optionally, select the *Create as a Template Sub-Version* check box, select a *Root Template*, and enter a *Sub-Version Name* to create the new template as a sub-template of an existing template.
. In the *Disks Allocation* section, enter an alias for the disk in the *Alias* text field. Select the disk format in the *Format* drop-down, the storage domain on which to store the disk from the *Target* drop-down, and the disk profile in the *Disk Profile* drop-down. By default, these are the same as those of the source virtual machine.
. Select the *Allow all users to access this Template* check box to make the template public.
. Select the *Copy VM permissions* check box to copy the permissions of the source virtual machine to the template.
. Select the *Seal Template* check box (Linux only) to seal the template.
+
[NOTE]
====
Sealing, which uses the `virt-sysprep` command, removes system-specific details from a virtual machine before creating a template based on that virtual machine. This prevents the original virtual machine's details from appearing in subsequent virtual machines that are created using the same template. It also ensures the functionality of other features, such as predictable vNIC order. See xref:appe-virt_sysprep_operations[] for more information.
====
+
. Click btn:[OK].


The virtual machine displays a status of `Image Locked` while the template is being created. The process of creating a template may take up to an hour depending on the size of the virtual disk and the capabilities of your storage hardware. When complete, the template is added to the *Templates* tab. You can now create new virtual machines based on the template.


[NOTE]
====
When a template is made, the virtual machine is copied so that both the existing virtual machine and its template are usable after template creation.
====

[[Editing_a_Template]]
=== Editing a Template

Once a template has been created, its properties can be edited. Because a template is a copy of a virtual machine, the options available when editing a template are identical to those in the *Edit Virtual Machine* window.


*Editing a Template*

. Click menu:Compute[Templates] and select a template.
. Click btn:[Edit].
. Change the necessary properties. Click *Show Advanced Options* and edit the template's settings as required. The settings that appear in the *Edit Template* window are identical to those in the *Edit Virtual Machine* window, but with the relevant fields only. See xref:sect-Explanation_of_Settings_in_the_New_Virtual_Machine_and_Edit_Virtual_Machine_Windows[] for details.
. Click btn:[OK].



[[Deleting_a_template]]
=== Deleting a Template

If you have used a template to create a virtual machine using the thin provisioning storage allocation option, the template cannot be deleted as the virtual machine needs it to continue running. However, cloned virtual machines do not depend on the template they were cloned from and the template can be deleted.


*Deleting a Template*

. Click menu:Compute[Templates] and select a template.
. Click btn:[Remove].
. Click btn:[OK].



[[sect-Exporting_Templates]]
=== Exporting Templates

[[Migrating_Templates_to_the_Export_Domain]]
==== Migrating Templates to the Export Domain


[NOTE]
====
The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center. See the link:{URL_virt_product_docs}{URL_format}administration_guide#sect-Importing_Existing_Storage_Domains[Importing Existing Storage Domains] section in the _{virt-product-fullname} Administration Guide_ for information on importing storage domains.
====
Export templates into the export domain to move them to another data domain, either in the same {virt-product-fullname} environment, or another one. This procedure requires access to the Administration Portal.


*Exporting Individual Templates to the Export Domain*

. Click menu:Compute[Templates] and select a template.
. Click btn:[Export].
. Select the *Force Override* check box to replace any earlier version of the template on the export domain.
. Click btn:[OK] to begin exporting the template; this may take up to an hour, depending on the virtual disk size and your storage hardware.


Repeat these steps until the export domain contains all the templates to migrate before you start the import process.

. Click menu:Storage[Domains] and select the export domain.
. Click the domain name to see the details view.
. Click the *Template Import* tab to view all exported templates in the export domain.



[[Copying_a_Templates_Virtual_Hard_Disk]]
==== Copying a Template's Virtual Hard Disk

If you are moving a virtual machine that was created from a template with the thin provisioning storage allocation option selected, the template's disks must be copied to the same storage domain as that of the virtual disk. This procedure requires access to the Administration Portal.


*Copying a Virtual Hard Disk*

. Click menu:Storage[Disks].
. Select the template disk(s) to copy.
. Click btn:[Copy].
. Select the *Target* data domain from the drop-down list(s).
. Click btn:[OK].


A copy of the template's virtual hard disk has been created, either on the same, or a different, storage domain. If you were copying a template disk in preparation for moving a virtual hard disk, you can now move the virtual hard disk.

[[sect-Importing_Templates]]
=== Importing Templates

[[Importing_a_template_into_a_data_center]]
==== Importing a Template into a Data Center


[NOTE]
====
The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center. See the link:{URL_virt_product_docs}{URL_format}administration_guide#sect-Importing_Existing_Storage_Domains[Importing Existing Storage Domains] section in the _{virt-product-fullname} Administration Guide_ for information on importing storage domains.
====
Import templates from a newly attached export domain. This procedure requires access to the Administration Portal.


*Importing a Template into a Data Center*

. Click menu:Storage[Domains] and select the newly attached export domain.
. Click the domain name to go to the details view.
. Click the *Template Import* tab and select a template.
. Click btn:[Import].
. Use the drop-down lists to select the *Target Cluster* and *CPU Profile*.
. Select the template to view its details, then click the *Disks* tab and select the *Storage Domain* to import the template into.
. Click btn:[OK].
. If the *Import Template Conflict* window appears, enter a *New Name* for the template, or select the *Apply to all* check box and enter a *Suffix to add to the cloned Templates*. Click btn:[OK].
. Click btn:[Close].

The template is imported into the destination data center. This can take up to an hour, depending on your storage hardware. You can view the import progress in the *Events* tab.

Once the importing process is complete, the templates will be visible in menu:Compute[Templates]. The templates can create new virtual machines, or run existing imported virtual machines based on that template.

[[Importing_a_Virtual_Disk_from_an_OpenStack_Image_Service_as_a_Template]]
==== Importing a Virtual Disk from an OpenStack Image Service as a Template

Virtual disks managed by an OpenStack Image Service can be imported into the {virt-product-fullname} {engine-name} if that OpenStack Image Service has been added to the {engine-name} as an external provider. This procedure requires access to the Administration Portal.


. Click menu:Storage[Domains] and select the OpenStack Image Service domain.
. Click the storage domain name to go to the details view.
. Click the *Images* tab and select the image to import.
. Click *Import*.
+
[NOTE]
====
If you are importing an image from a Glance storage domain, you have the option of specifying the template name.
====

. Select the *Data Center* into which the virtual disk will be imported.
. Select the storage domain in which the virtual disk will be stored from the *Domain Name* drop-down list.
. Optionally, select a *Quota* to apply to the virtual disk.
. Select the *Import as Template* check box.
. Select the *Cluster* in which the virtual disk will be made available as a template.
. Click btn:[OK].


The image is imported as a template and is displayed in the *Templates* tab. You can now create virtual machines based on the template.

[[sect-Templates_and_Permissions]]
=== Templates and Permissions

[[Managing_System_Permissions_for_a_Template]]
==== Managing System Permissions for a Template

As the *SuperUser*, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a *DataCenterAdmin* role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a *ClusterAdmin* has administrator privileges only for the assigned cluster.

A template administrator is a system administration role for templates in a data center. This role can be applied to specific virtual machines, to a data center, or to the whole virtualized environment; this is useful to allow different users to manage certain virtual resources.

The template administrator role permits the following actions:

* Create, edit, export, and remove associated templates.

* Import and export templates.



[NOTE]
====
You can only assign roles and permissions to existing users.
====

[[Template_Administrator_Roles_Explained]]
==== Template Administrator Roles Explained

The table below describes the administrator roles and privileges applicable to template administration.

[[Template_Administrator_Roles]]

.{virt-product-fullname} System Administrator Roles
[options="header"]
|===
|Role |Privileges |Notes
|TemplateAdmin |Can perform all operations on templates. |Has privileges to create, delete and configure a template's storage domain and network details, and to move templates between domains.
|NetworkAdmin |Network Administrator |Can configure and manage networks attached to templates.
|===

[[Assigning_an_Administrator_or_User_Role_to_a_Resource]]
==== Assigning an Administrator or User Role to a Resource

Assign administrator or user roles to resources to allow users to access or manage that resource.


*Assigning a Role to a Resource*

. Use the resource tabs, tree mode, or the search function to find and select the resource in the results list.
. Click the resource's name to go to the details view.
. Click the *Permissions* tab to list the assigned users, the user's role, and the inherited permissions for the selected resource.
. Click btn:[Add].
. Enter the name or user name of an existing user into the *Search* text box and click *Go*. Select a user from the resulting list of possible matches.
. Select a role from the *Role to Assign:* drop-down list.
. Click btn:[OK].


You have assigned a role to a user; the user now has the inherited permissions of that role enabled for that resource.

[[Removing_an_Administrator_or_User_Role_from_a_Resource]]
==== Removing an Administrator or User Role from a Resource

Remove an administrator or user role from a resource; the user loses the inherited permissions associated with the role for that resource.


*Removing a Role from a Resource*

. Use the resource tabs, tree mode, or the search function to find and select the resource in the results list.
. Click the resource's name to go to the details view.
. Click the *Permissions* tab to list the assigned users, the user's role, and the inherited permissions for the selected resource.
. Select the user to remove from the resource.
. Click btn:[Remove]. The *Remove Permission* window opens to confirm permissions removal.
. Click btn:[OK].


You have removed the user's role, and the associated permissions, from the resource.

[[Using_Cloud-Init_to_Automate_the_Configuration_of_Virtual_Machines]]
=== Using Cloud-Init to Automate the Configuration of Virtual Machines

Cloud-Init is a tool for automating the initial setup of virtual machines such as configuring the host name, network interfaces, and authorized keys. It can be used when provisioning virtual machines that have been deployed based on a template to avoid conflicts on the network.

To use this tool, the `cloud-init` package must first be installed on the virtual machine. Once installed, the Cloud-Init service starts during the boot process to search for instructions on what to configure. You can then use options in the *Run Once* window to provide these instructions one time only, or options in the *New Virtual Machine*, *Edit Virtual Machine* and *Edit Template* windows to provide these instructions every time the virtual machine starts.

[NOTE]
====
Alternatively, you can configure Cloud-Init with link:https://docs.ansible.com/ansible/latest/modules/ovirt_vm_module.html#examples[Ansible], link:{URL_downstream_virt_product_docs}python_sdk_guide/index#Starting_a_Virtual_Machine_with_Cloud-Init[Python], link:https://github.com/oVirt/ovirt-engine-sdk-java/blob/master/sdk/src/test/java/org/ovirt/engine/sdk4/examples/StartVmWithCloudInit.java[Java], or link:{URL_downstream_virt_product_docs}ruby_sdk_guide/index#starting_a_virtual_machine_with_cloud_init[Ruby].
====

[[Cloud-Init_Use_Case_Scenarios]]
==== Cloud-Init Use Case Scenarios

Cloud-Init can be used to automate the configuration of virtual machines in a variety of scenarios. Several common scenarios are as follows:


* *Virtual Machines Created Based on Templates*
+
You can use the Cloud-Init options in the *Initial Run* section of the *Run Once* window to initialize a virtual machine that was created based on a template. This allows you to customize the virtual machine the first time that virtual machine is started.

* *Virtual Machine Templates*
+
You can use the *Use Cloud-Init/Sysprep* options in the *Initial Run* tab of the *Edit Template* window to specify options for customizing virtual machines created based on that template.

* *Virtual Machine Pools*
+
You can use the *Use Cloud-Init/Sysprep* options in the *Initial Run* tab of the *New Pool* window to specify options for customizing virtual machines taken from that virtual machine pool. This allows you to specify a set of standard settings that will be applied every time a virtual machine is taken from that virtual machine pool. You can inherit or override the options specified for the template on which the virtual machine is based, or specify options for the virtual machine pool itself.


[[Installing_Cloud-Init]]
==== Installing Cloud-Init

This procedure describes how to install Cloud-Init on a virtual machine. Once Cloud-Init is installed, you can create a template based on this virtual machine. Virtual machines created based on this template can leverage Cloud-Init functions, such as configuring the host name, time zone, root password, authorized keys, network interfaces, DNS service, etc on boot.


*Installing Cloud-Init*

. Log in to the virtual machine.
. Enable the repositories:

* For {enterprise-linux} 6:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="subscription-manager-repos">4.42. subscription-manager repos \</h3>
<div class="literalblock">
<div class="content">
<pre>--enable=rhel-6-server-rpms \
--enable=rhel-6-server-rh-common-rpms</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* For {enterprise-linux} 7:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="subscription-manager-repos-2">4.43. subscription-manager repos \</h3>
<div class="literalblock">
<div class="content">
<pre>--enable=rhel-7-server-rpms \
--enable=rhel-7-server-rh-common-rpms</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>+
* For {enterprise-linux} 8, you normally do not need to enable repositories to install Cloud-Init. The Cloud-Init package is part of the AppStream repo, `rhel-8-for-x86_64-appstream-rpms`, which is enabled by default in {enterprise-linux} 8.
+
. Install the `cloud-init` package and dependencies:
+
[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dnf-install-cloud-init">4.44. dnf install cloud-init</h3>
<div class="listingblock">
<div class="content">
<pre>+
[NOTE]
====
For versions of {enterprise-linux} earlier than version 8, use the command `yum install cloud-init` instead of `dnf install cloud-init`.
====

[[Using_Cloud-Init_to_Prepare_a_Template]]
==== Using Cloud-Init to Prepare a Template

As long as the `cloud-init` package is installed on a Linux virtual machine, you can use the virtual machine to make a cloud-init enabled template. Specify a set of standard settings to be included in a template as described in the following procedure or, alternatively, skip the Cloud-Init settings steps and configure them when creating a virtual machine based on this template.

[NOTE]
====
While the following procedure outlines how to use Cloud-Init when preparing a template, the same settings are also available in the *New Virtual Machine*, *Edit Template*, and *Run Once* windows.
====


*Using Cloud-Init to Prepare a Template*

. Click menu:Compute[Templates] and select a template.
. Click btn:[Edit].
. Click btn:[Show Advanced Options]
. Click the *Initial Run* tab and select the *Use Cloud-Init/Sysprep* check box.
. Enter a host name in the *VM Hostname* text field.
. Select the *Configure Time Zone* check box and select a time zone from the *Time Zone* drop-down list.
. Expand the *Authentication* section.
* Select the *Use already configured password* check box to use the existing credentials, or clear that check box and enter a root password in the *Password* and *Verify Password* text fields to specify a new root password.
* Enter any SSH keys to be added to the authorized hosts file on the virtual machine in the *SSH Authorized Keys* text area.
* Select the *Regenerate SSH Keys* check box to regenerate SSH keys for the virtual machine.
. Expand the *Networks* section.
* Enter any DNS servers in the *DNS Servers* text field.
* Enter any DNS search domains in the *DNS Search Domains* text field.
* Select the *In-guest Network Interface* check box and use the *+ Add new* and *- Renove selected* buttons to add or remove network interfaces to or from the virtual machine.
+
[IMPORTANT]
====
You must specify the correct network interface name and number (for example, `eth0`, `eno3`, `enp0s`). Otherwise, the virtual machine's interface connection will be up, but it will not have the *cloud-init* network configuration.
====

. Expand the *Custom Script* section and enter any custom scripts in the *Custom Script* text area.
. Click btn:[OK].


You can now provision new virtual machines using this template.

[[Using_Cloud-Init]]
==== Using Cloud-Init to Initialize a Virtual Machine

Use Cloud-Init to automate the initial configuration of a Linux virtual machine. You can use the Cloud-Init fields to configure a virtual machine's host name, time zone, root password, authorized keys, network interfaces, and DNS service. You can also specify a custom script, a script in YAML format, to run on boot. The custom script allows for additional Cloud-Init configuration that is supported by Cloud-Init but not available in the Cloud-Init fields. For more information on custom script examples, see link:http://cloudinit.readthedocs.org/en/latest/topics/examples.html[Cloud config examples].


*Using Cloud-Init to Initialize a Virtual Machine*

This procedure starts a virtual machine with a set of Cloud-Init settings. If the relevant settings are included in the template the virtual machine is based on, review the settings, make changes where appropriate, and click btn:[OK] to start the virtual machine.

. Click menu:Compute[Virtual Machines] and select a virtual machine.
. Click the btn:[Run] drop-down button and select *Run Once*.
. Expand the *Initial Run* section and select the *Cloud-Init* check box.
. Enter a host name in the *VM Hostname* text field.
. Select the *Configure Time Zone* check box and select a time zone from the *Time Zone* drop-down menu.
. Select the *Use already configured password* check box to use the existing credentials, or clear that check box and enter a root password in the *Password* and *Verify Password* text fields to specify a new root password.
. Enter any SSH keys to be added to the authorized hosts file on the virtual machine in the *SSH Authorized Keys* text area.
. Select the *Regenerate SSH Keys* check box to regenerate SSH keys for the virtual machine.
. Enter any DNS servers in the *DNS Servers* text field.
. Enter any DNS search domains in the *DNS Search Domains* text field.
. Select the *Network* check box and use the *+* and *-* buttons to add or remove network interfaces to or from the virtual machine.
+
[IMPORTANT]
====
You must specify the correct network interface name and number (for example, `eth0`, `eno3`, `enp0s`). Otherwise, the virtual machine's interface connection will be up, but the *cloud-init* network configuration will not be defined in it.
====

. Enter a custom script in the *Custom Script* text area. Make sure the values specified in the script are appropriate. Otherwise, the action will fail.
. Click btn:[OK].



[NOTE]
====
To check if a virtual machine has Cloud-Init installed, select a virtual machine and click the *Applications* sub-tab. Only shown if the guest agent is installed.
====

[[Using_Sysprep_to_Automate_the_Configuration_of_Virtual_Machines]]
=== Using Sysprep to Automate the Configuration of Virtual Machines

`Sysprep` is a tool used to automate the setup of Windows virtual machines, for example, configuring host names, network interfaces, authorized keys, set up users, or to connect to Active Directory. `Sysprep` is installed with every version of Windows.

{virt-product-fullname} enhances `Sysprep` by exploiting virtualization technology to deploy virtual workstations based on a single template. {virt-product-fullname} builds a tailored auto-answer file for each virtual workstation.

`Sysprep` generates a complete unattended installation answer file. Default values for several Windows operating systems are available in the */usr/share/ovirt-engine/conf/sysprep/* directory. You can also create a custom `Sysprep` file and reference it from the the *osinfo* file in the */etc/ovirt-engine/osinfo.conf.d/* directory. These files act as templates for `Sysprep`. The fields in these files can be copied and edited as required. This definition will override any values entered into the *Initial Run* fields of the *Edit Virtual Machine* window.

You can create a custom `sysprep` file when creating a pool of Windows virtual machines, to accommodate various operating systems and domains. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#Creating_a_VM_Pool[Creating a Virtual Machine Pool] in the _Administration Guide_ for details.

The override file must be created under */etc/ovirt-engine/osinfo.conf.d/*, have a filename that puts it after */etc/ovirt-engine/osinfo.conf.d/00-defaults.properties*, and ends in *.properties*. For example, */etc/ovirt-engine/osinfo.conf.d/10-productkeys.properties*. The last file will have precedence and override any other previous file.

Copy the default values for your Windows operating system from */etc/ovirt-engine/osinfo.conf.d/00-defaults.properties* into the override file, and input your values in the `productKey.value` and `sysprepPath.value` fields.

.Windows 7 Default Configuration Values
====

[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="windows711-ostype-windows-falsefalse-2">4.45. Windows7(11, OsType.Windows, false),false</h3>
<div class="paragraph">
<p>os.windows_7.id.value = 11
os.windows_7.name.value = Windows 7
os.windows_7.derivedFrom.value = windows_xp
os.windows_7.sysprepPath.value = ${ENGINE_USR}/conf/sysprep/sysprep.w7
os.windows_7.productKey.value =
os.windows_7.devices.audio.value = ich6
os.windows_7.devices.diskInterfaces.value.3.3 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.devices.diskInterfaces.value.3.4 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.devices.diskInterfaces.value.3.5 = IDE, VirtIO_SCSI, VirtIO
os.windows_7.isTimezoneTypeInteger.value = false</p>
</div>
<div class="listingblock">
<div class="content">
<pre>====

[[Configuring_Sysprep_on_a_Template]]
==== Configuring Sysprep on a Template

You can use this procedure to specify a set of standard `Sysprep` settings to include in the template, alternatively you can configure the `Sysprep` settings when creating a virtual machine based on this template.

Replacement strings can be used to substitute values provided in the default files in the */usr/share/ovirt-engine/conf/sysprep/* directory.  For example, *"&lt;Domain&gt;&lt;![CDATA[$JoinDomain$]]&gt;&lt;/Domain&gt;"* can be used to indicate the domain to join.

[IMPORTANT]
====
Do not reboot the virtual machine while `Sysprep` is running.
====

*Prerequisites*


* The Windows virtual machine parameters have been correctly defined.

+
If not, click menu:Compute[Virtual Machines], click btn:[Edit], and enter the required information in the *Operating System* and *Cluster* fields.


* The correct product key has been defined in an override file on the {engine-name}.



*Using `Sysprep` to Prepare a Template*

. Build the Windows virtual machine with the required patches and software.
. Seal the Windows virtual machine. See xref:Sealing_Virtual_Machines_in_Preparation_for_Deployment_as_Templates[]
. Create a template based on the Windows virtual machine. See xref:Creating_a_template_from_an_existing_virtual_machine[]
. Update the `Sysprep` file with a text editor if additional changes are required.


You can now provision new virtual machines using this template.

[[Using_Sysprep_to_Initialize_a_Virtual_Machine]]
==== Using Sysprep to Initialize a Virtual Machine

Use `Sysprep` to automate the initial configuration of a Windows virtual machine. You can use the *Sysprep* fields to configure a virtual machine's host name, time zone, root password, authorized keys, network interfaces, and DNS service.


.Using Sysprep to Initialize a Virtual Machine

This procedure starts a virtual machine with a set of `Sysprep` settings. If the relevant settings are included in the template the virtual machine is based on, review the settings and make changes where required.

. Create a new Windows virtual machine based on a template of the required Windows virtual machine. See xref:Creating_a_Virtual_Machine_Based_on_a_Template[].
. Click menu:Compute[Virtual Machines] and select the virtual machine.
. Click the btn:[Run] drop-down button and select *Run Once*.
. Expand the *Boot Options* section, select the *Attach Floppy* check box, and select the *[sysprep]* option.
. Select the *Attach CD* check box and select the required Windows ISO from the drop-down list.
. Move the *CD-ROM* to the top of the *Boot Sequence* field.
. Configure any further *Run Once* options as required. See xref:Virtual_Machine_Run_Once_settings_explained[] for more details.
. Click btn:[OK].



[[Creating_a_Virtual_Machine_Based_on_a_Template]]
=== Creating a Virtual Machine Based on a Template

Create a virtual machine from a template to enable the virtual machines to be pre-configured with an operating system, network interfaces, applications and other resources.

[NOTE]
====
Virtual machines created from a template depend on that template. So you cannot remove a template from the {engine-name} if a virtual machine was created from that template. However, you can clone a virtual machine from a template to remove the dependency on that template.
====

[NOTE]
====
If the BIOS type of the virtual machine differs from the BIOS type of the template, the {engine-name} might change devices in the virtual machine, possibly preventing the operating system from booting. For example, if the template uses IDE disks and the i440fx chipset, changing the BIOS type to the Q35 chipset automatically changes the IDE disks to SATA disks. So configure the chipset and BIOS type to match the chipset and BIOS type of the template.
====

*Creating a Virtual Machine Based on a Template*

. Click menu:Compute[Virtual Machines].
. Click btn:[New].
. Select the *Cluster* on which the virtual machine will run.
. Select a template from the *Template* list.
. Enter a *Name*, *Description*, and any *Comments*, and accept the default values inherited from the template in the rest of the fields. You can change them if needed.
. Click the *Resource Allocation* tab.
. Select the *Thin* or *Clone* radio button in the *Storage Allocation* area. If you select *Thin*, the disk format is QCOW2. If you select *Clone*, select either *QCOW2* or *Raw* for disk format.
. Use the *Target* drop-down list to select the storage domain on which the virtual machine's virtual disk will be stored.
. Click btn:[OK].


The virtual machine is displayed in the *Virtual Machines* tab.

.Additional Resources

* xref:Creating_a_cloned_virtual_machine_based_on_a_template[]
* link:{URL_virt_product_docs}{URL_format}administration_guide/index#About_UEFI_Q35-cluster_opt_settings[UEFI and the Q35 chipset] in the _Administration Guide_.

[[Creating_a_cloned_virtual_machine_based_on_a_template]]
=== Creating a Cloned Virtual Machine Based on a Template

Cloned virtual machines are based on templates and inherit the settings of the template. A cloned virtual machine does not depend on the template on which it was based after it has been created. This means the template can be deleted if no other dependencies exist.

[NOTE]
====
If you clone a virtual machine from a template, the name of the template on which that virtual machine was based is displayed in the *General* tab of the *Edit Virtual Machine* window for that virtual machine. If you change the name of that template, the name of the template in the *General* tab will also be updated. However, if you delete the template from the {engine-name}, the original name of that template will be displayed instead.
====

*Cloning a Virtual Machine Based on a Template*

. Click menu:Compute[Virtual Machines].
. Click btn:[New].
. Select the *Cluster* on which the virtual machine will run.
. Select a template from the *Based on Template* drop-down menu.
. Enter a *Name*, *Description* and any *Comments*. You can accept the default values inherited from the template in the rest of the fields, or change them if required.
. Click the *Resource Allocation* tab.
. Select the *Clone* radio button in the *Storage Allocation* area.
. Select the disk format from the *Format* drop-down list. This affects the speed of the clone operation and the amount of disk space the new virtual machine initially requires.

+
* *QCOW2* (Default)

** Faster clone operation
** Optimized use of storage capacity
** Disk space allocated only as required

* *Raw*

** Slower clone operation
** Optimized virtual machine read and write operations
** All disk space requested in the template is allocated at the time of the clone operation

. Use the *Target* drop-down menu to select the storage domain on which the virtual machine's virtual disk will be stored.
. Click btn:[OK].



[NOTE]
====
Cloning a virtual machine may take some time. A new copy of the template's disk must be created. During this time, the virtual machine's status is first *Image Locked*, then *Down*.
====
The virtual machine is created and displayed in the *Virtual Machines* tab. You can now assign users to it, and can begin using it when the clone operation is complete.

:numbered!:

[appendix]
[[appe-Reference_Settings_in_Administration_Portal_and_User_Portal_Windows]]
== Reference: Settings in Administration Portal and VM Portal Windows

[[sect-Explanation_of_Settings_in_the_New_Virtual_Machine_and_Edit_Virtual_Machine_Windows]]
=== Explanation of Settings in the New Virtual Machine and Edit Virtual Machine Windows

[[Virtual_Machine_General_settings_explained]]
==== Virtual Machine General Settings Explained

The following table details the options available on the *General* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_Fields]]

.Virtual Machine: General Settings
[cols="1,2,1", options="header"]
|===
|Field Name |Description | Power cycle required?
|*Cluster* |The name of the host cluster to which the virtual machine is attached. Virtual machines are hosted on any physical machine in that cluster in accordance with policy rules. | Yes. Cross-cluster migration is for emergency use only. Moving clusters requires the virtual machine to be down.
|*Template* |The template on which the virtual machine is based. This field is set to `Blank` by default, which allows you to create a virtual machine on which an operating system has not yet been installed. Templates are displayed as *Name \| Sub-version name (Sub-version number)*. Each new version is displayed with a number in brackets that indicates the relative order of the version, with a higher number indicating a more recent version.

The version name is displayed as `base version` if it is the root template of the template version chain.

When the virtual machine is stateless, there is an option to select the `latest` version of the template. This option means that anytime a new version of this template is created, the virtual machine is automatically recreated on restart based on the latest template. | Not applicable. This setting is for provisioning new virtual machines only.
|*Operating System* |The operating system. Valid values include a range of {enterprise-linux} and Windows variants. | Yes. Potentially changes the virtual hardware.
|*Instance Type* |The instance type on which the virtual machine's hardware configuration can be based. This field is set to *Custom* by default, which means the virtual machine is not connected to an instance type. The other options available from this drop down menu are *Large*, *Medium*, *Small*, *Tiny*, *XLarge*, and any custom instance types that the Administrator has created.

Other settings that have a chain link icon next to them are pre-filled by the selected instance type. If one of these values is changed, the virtual machine will be detached from the instance type and the chain icon will appear broken. However, if the changed setting is restored to its original value, the virtual machine will be reattached to the instance type and the links in the chain icon will rejoin.

*NOTE:* Support for instance types is now deprecated, and will be removed in a future release.

| Yes.
|*Optimized for* |The type of system for which the virtual machine is to be optimized. There are three options: *Server*, *Desktop*, and *High Performance*; by default, the field is set to *Server*. Virtual machines optimized to act as servers have no sound card, use a cloned disk image, and are not stateless. Virtual machines optimized to act as desktop machines do have a sound card, use an image (thin allocation), and are stateless. Virtual machines optimized for high performance have a number of configuration changes. See xref:Configuring_High_Performance_Virtual_Machines_Templates_and_Pools[]. | Yes.
|*Name* |The name of the virtual machine. The name must be a unique name within the data center and must not contain any spaces, and must contain at least one character from A-Z or 0-9. The maximum length of a virtual machine name is 255 characters. The name can be reused in different data centers in the environment. | Yes.
|*VM ID* |The virtual machine ID. The virtual machine's creator can set a custom ID for that virtual machine. The custom ID must contain only numbers, in the format, `00000000-0000-0000-0000-00000000`.

If no ID is specified during creation a UUID will be automatically assigned. For both custom and automatically-generated IDs, changes are not possible after virtual machine creation. | Yes.
|*Description* |A meaningful description of the new virtual machine. | No.
|*Comment* |A field for adding plain text human-readable comments regarding the virtual machine. | No.
|*Affinity Labels* |Add or remove a selected *Affinity Label*. | No.
|*Stateless* |Select this check box to run the virtual machine in stateless mode. This mode is used primarily for desktop virtual machines. Running a stateless desktop or server creates a new COW layer on the virtual machine hard disk image where new and changed data is stored. Shutting down the stateless virtual machine deletes the new COW layer which includes all data and configuration changes, and returns the virtual machine to its original state. Stateless virtual machines are useful when creating machines that need to be used for a short time, or by temporary staff. | Not applicable.
|*Start in Pause Mode* |Select this check box to always start the virtual machine in pause mode. This option is suitable for virtual machines which require a long time to establish a SPICE connection; for example, virtual machines in remote locations. | Not applicable.
|*Delete Protection* |Select this check box to make it impossible to delete the virtual machine. It is only possible to delete the virtual machine if this check box is not selected. | No.
|*Sealed* | Select this check box to seal the created virtual machine. This option eliminates machine-specific settings from virtual machines that are provisioned from the template. For more information about the sealing process, see link:{URL_virt_product_docs}{URL_format}virtual_machine_management_guide#Sealing_a_Windows_Virtual_Machine_for_Deployment_as_a_Template[Sealing a Windows Virtual Machine for Deployment as a Template]| No.
|*Instance Images* |Click *Attach* to attach a floating disk to the virtual machine, or click *Create* to add a new virtual disk. Use the plus and minus buttons to add or remove additional virtual disks.

Click btn:[Edit] to change the configuration of a virtual disk that has already been attached or created. | No.
|*Instantiate VM network interfaces by picking a vNIC profile.* |Add a network interface to the virtual machine by selecting a vNIC profile from the *nic1* drop-down list. Use the plus and minus buttons to add or remove additional network interfaces. | No.
|===

[[Virtual_Machine_System_Settings_Explained]]
==== Virtual Machine System Settings Explained

:context: vm_sys_settings
[id='CPU_Considerations_{context}']

*CPU Considerations*

* *For non-CPU-intensive workloads*, you can run virtual machines with a total number of processor cores greater than the number of cores in the host. Doing so enables the following:

** You can run a greater number of virtual machines, which reduces hardware requirements.
** You can configure virtual machines with CPU topologies that are otherwise not possible, such as when the number of virtual cores is between the number of host cores and the number of host threads.

* *For best performance, and especially for CPU-intensive workloads*, you should use the same topology in the virtual machine as in the host, so the host and the virtual machine expect the same cache usage. When the host has hyperthreading enabled, QEMU treats the host's hyperthreads as cores, so the virtual machine is not aware that it is running on a single core with multiple threads. This behavior might impact the performance of a virtual machine, because a virtual core that actually corresponds to a hyperthread in the host core might share a single cache with another hyperthread in the same host core, while the virtual machine treats it as a separate core.

The following table details the options available on the *System* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_Initial_Run-226]]

.Virtual Machine: System Settings
[cols="1,2,1", options="header"]
|===

|Field Name
|Description
|Power cycle required?


|*Memory Size*
|The amount of memory assigned to the virtual machine. When allocating memory, consider the processing and storage needs of the applications that are intended to run on the virtual machine.
|If OS supports hotplugging, no. Otherwise, yes.


|*Maximum Memory*
|The maximum amount of memory that can be assigned to the virtual machine. Maximum guest memory is also constrained by the selected guest architecture and the cluster compatibility level.
| If OS supports hotplugging, no. Otherwise, yes.


|*Total Virtual CPUs*
|The processing power allocated to the virtual machine as CPU Cores. For high performance, do not assign more cores to a virtual machine than are present on the physical host.
| If OS supports hotplugging, no. Otherwise, yes.


|*Virtual Sockets*
|The number of CPU sockets for the virtual machine. Do not assign more sockets to a virtual machine than are present on the physical host.
| If OS supports hotplugging, no. Otherwise, yes.


|*Cores per Virtual Socket*
|The number of cores assigned to each virtual socket.
| If OS supports hotplugging, no. Otherwise, yes.


|*Threads per Core*
|The number of threads assigned to each core. Increasing the value enables simultaneous multi-threading (SMT). IBM POWER8 supports up to 8 threads per core. For x86 and x86_64 (Intel and AMD) CPU types, the recommended value is 1, unless you want to replicate the exact host topology, which you can do using CPU pinning. For more information, see xref:Pinning_CPU[].
| If OS supports hotplugging, no. Otherwise, yes.


|*BIOS Type*
a|Specifies the chipset and BIOS type. Defaults to the cluster's default BIOS type. Options are:

* *Cluster default* The BIOS type defined under General cluster settings.
* *Q35 Chipset with Legacy BIOS* Legacy BIOS without UEFI (Default for clusters with compatibility version 4.4)
* *Q35 Chipset with UEFI BIOS* BIOS with UEFI
* *Q35 Chipset with SecureBoot* UEFI with SecureBoot, which authenticates the digital signatures of the boot loader
* *Legacy* i440fx chipset with legacy BIOS

For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#About_UEFI_Q35-cluster_opt_settings[UEFI and the Q35 chipset] in the _Administration Guide_.
| Yes.

|*Custom Emulated Machine*
|This option allows you to specify the machine type. If changed, the virtual machine will only run on hosts that support this machine type. Defaults to the cluster's default machine type.
| Yes.


|*Custom CPU Type*
|This option allows you to specify a CPU type. If changed, the virtual machine will only run on hosts that support this CPU type. Defaults to the cluster's default CPU type.
| Yes.


|*Hardware Clock Time Offset*
|This option sets the time zone offset of the guest hardware clock. For Windows, this should correspond to the time zone set in the guest. Most default Linux installations expect the hardware clock to be GMT+00:00.
| Yes.


|*Custom Compatibility Version*
|The compatibility version determines which features are supported by the cluster, as well as, the values of some properties and the emulated machine type. By default, the virtual machine is configured to run in the same compatibility mode as the cluster as the default is inherited from the cluster. In some situations the default compatibility mode needs to be changed. An example of this is if the cluster has been updated to a later compatibility version but the virtual machines have not been restarted. These virtual machines can be set to use a custom compatibility mode that is older than that of the cluster. See  link:{URL_virt_product_docs}{URL_format}administration_guide/index#Changing_the_Cluster_Compatibility_Version[Changing the Cluster Compatibility Version] in the _Administration Guide_ for more information.
| Yes.



|*Serial Number Policy*
a|Override the system-level and cluster-level policies for assigning a serial numbers to virtual machines. Apply a policy that is unique to this virtual machine:

* *System Default*: Use the system-wide defaults, which are configured in the {engine-name} database link:{URL_virt_product_docs}{URL_format}administration_guide/index#sect-The_Engine_Configuration_Tool[using the engine configuration tool] and the `DefaultSerialNumberPolicy` and `DefaultCustomSerialNumber` key names. The default value for `DefaultSerialNumberPolicy` is to use the Host ID. See link:{URL_virt_product_docs}{URL_format}administration_guide/index#sect-Scheduling_Policies[Scheduling Policies] in the _Administration Guide_ for more information.


* *Host ID*: Set this virtual machine's serial number to the UUID of the host.

* *Vm ID*: Set this virtual machine's serial number to the UUID of this virtual machine.

* *Custom serial number*: Set this virtual machine's serial number to the value you specify in the following *Custom Serial Number* parameter.
| Yes.


|*Custom Serial Number*
|Specify the custom serial number to apply to this virtual machine.
| Yes.


|===

[[Virtual_Machine_Initial_Run_settings_explained]]
==== Virtual Machine Initial Run Settings Explained

The following table details the options available on the *Initial Run* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows. The settings in this table are only visible if the *Use Cloud-Init/Sysprep* check box is selected, and certain options are only visible when either a Linux-based or Windows-based option has been selected in the *Operating System* list in the *General* tab, as outlined below.
[[New_VMs_Initial_Run-227]]

[NOTE]
This table does not include information on whether a power cycle is required because the settings apply to the virtual machine's _initial_ run; the virtual machine is not running when you configure these settings.

.Virtual Machine: Initial Run Settings
[cols="1,1,2", options="header"]
|===
|Field Name
|Operating System
|Description


|*Use Cloud-Init/Sysprep*
|Linux, Windows
|This check box toggles whether Cloud-Init or Sysprep will be used to initialize the virtual machine.


|*VM Hostname*
|Linux, Windows
|The host name of the virtual machine.


|*Domain*
|Windows
|The Active Directory domain to which the virtual machine belongs.


|*Organization Name*
|Windows
|The name of the organization to which the virtual machine belongs. This option corresponds to the text field for setting the organization name displayed when a machine running Windows is started for the first time.


|*Active Directory OU*
|Windows
|The organizational unit in the Active Directory domain to which the virtual machine belongs.


|*Configure Time Zone*
|Linux, Windows
|The time zone for the virtual machine. Select this check box and select a time zone from the *Time Zone* list.


|*Admin Password*
|Windows
a|The administrative user password for the virtual machine. Click the disclosure arrow to display the settings for this option.

* *Use already configured password*: This check box is automatically selected after you specify an initial administrative user password. You must clear this check box to enable the *Admin Password* and *Verify Admin Password* fields and specify a new password.

* *Admin Password*: The administrative user password for the virtual machine. Enter the password in this text field and the *Verify Admin Password* text field to verify the password.


|*Authentication*
|Linux
a|The authentication details for the virtual machine. Click the disclosure arrow to display the settings for this option.

* *Use already configured password*: This check box is automatically selected after you specify an initial root password. You must clear this check box to enable the *Password* and *Verify Password* fields and specify a new password.

* *Password*: The root password for the virtual machine. Enter the password in this text field and the *Verify Password* text field to verify the password.

* *SSH Authorized Keys*: SSH keys to be added to the authorized keys file of the virtual machine. You can specify multiple SSH keys by entering each SSH key on a new line.

* *Regenerate SSH Keys*: Regenerates SSH keys for the virtual machine.


|*Custom Locale*
|Windows
a|Custom locale options for the virtual machine. Locales must be in a format such as `en-US`. Click the disclosure arrow to display the settings for this option.

* *Input Locale*: The locale for user input.

* *UI Language*: The language used for user interface elements such as buttons and menus.

* *System Locale*: The locale for the overall system.

* *User Locale*: The locale for users.


|*Networks*
|Linux
a|Network-related settings for the virtual machine. Click the disclosure arrow to display the settings for this option.

* *DNS Servers*: The DNS servers to be used by the virtual machine.

* *DNS Search Domains*: The DNS search domains to be used by the virtual machine.

* *Network*: Configures network interfaces for the virtual machine. Select this check box and click *\+* or *-* to add or remove network interfaces to or from the virtual machine. When you click *+*, a set of fields becomes visible that can specify whether to use DHCP, and configure an IP address, netmask, and gateway, and specify whether the network interface will start on boot.


|*Custom Script*
|Linux
|Custom scripts that will be run on the virtual machine when it starts. The scripts entered in this field are custom YAML sections that are added to those produced by the {engine-name}, and allow you to automate tasks such as creating users and files, configuring `yum` repositories and running commands. For more information on the format of scripts that can be entered in this field, see the link:http://cloudinit.readthedocs.org/en/latest/topics/examples.html#yaml-examples[Custom Script] documentation.


|*Sysprep*
|Windows
|A custom Sysprep definition. The definition must be in the format of a complete unattended installation answer file. You can copy and paste the default answer files in the */usr/share/ovirt-engine/conf/sysprep/* directory on the machine on which the {virt-product-fullname} {engine-name} is installed and alter the fields as required. See xref:chap-Templates[] for more information.

|*Ignition 2.3.0*
|Red Hat Enterprise Linux CoreOS
|When Red Hat Enterprise Linux CoreOS is selected as Operating System, this check box toggles whether Ignition will be used to initialize the virtual machine.

|===

[[Virtual_Machine_Console_settings_explained]]
==== Virtual Machine Console Settings Explained

The following table details the options available on the *Console* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_Console]]

.Virtual Machine: Console Settings
[cols="1,2,1", options="header"]
|===
|Field Name
|Description
|Power cycle required?


|*Graphical Console Section*
|A group of settings.
|Yes.


|*Headless Mode*
a|Select this check box if you do not a require a graphical console for the virtual machine.

When selected, all other fields in the *Graphical Console* section are disabled. In the VM Portal, the *Console* icon in the virtual machine's details view is also disabled.

[IMPORTANT]
====
See xref:Configuring_Headless_Machines[] for more details and prerequisites for using headless mode.
====
| Yes.


|*Video Type*
|Defines the graphics device. *QXL* is the default and supports both graphic protocols. *VGA* supports only the VNC protocol.
| Yes.


|*Graphics protocol*
|Defines which display protocol to use. *SPICE* is the default protocol. *VNC* is an alternative option. To allow both protocols select *SPICE + VNC*.
| Yes.


|*VNC Keyboard Layout*
|Defines the keyboard layout for the virtual machine. This option is only available when using the VNC protocol.
| Yes.


|*USB enabled*
a|Defines SPICE USB redirection. This check box is not selected by default. This option is only available for virtual machines using the SPICE protocol:

* Disabled (check box is cleared) - USB controller devices are added according to the `devices.usb.controller` value in the *osinfo-defaults.properties* configuration file. The default for all x86 and x86_64 operating systems is `piix3-uhci`. For ppc64 systems, the default is `nec-xhci`.

* Enabled (check box is selected) - Enables native KVM/SPICE USB redirection for Linux and Windows virtual machines. Virtual machines do not require any in-guest agents or drivers for native USB.
| Yes.


|*Console Disconnect Action*
a|Defines what happens when the console is disconnected. This is only relevant with SPICE and VNC console connections. This setting can be changed while the virtual machine is running but will not take effect until a new console connection is established. Select either:

* *No action* - No action is taken.

* *Lock screen* - This is the default option. For all Linux machines and for Windows desktops this locks the currently active user session. For Windows servers, this locks the desktop and the currently active user.

* *Logout user* - For all Linux machines and Windows desktops, this logs out the currently active user session. For Windows servers, the desktop and the currently active user are logged out.

* *Shutdown virtual machine* - Initiates a graceful virtual machine shutdown.

* *Reboot virtual machine* - Initiates a graceful virtual machine reboot.

| No.


|*Monitors*
|The number of monitors for the virtual machine. This option is only available for virtual desktops using the SPICE display protocol. You can choose *1*, *2* or *4*. Note that multiple monitors are not supported for Windows systems with WDDMDoD drivers.
| Yes.


|*Smartcard Enabled*
|Smart cards are an external hardware security feature, most commonly seen in credit cards, but also used by many businesses as authentication tokens. Smart cards can be used to protect {virt-product-fullname} virtual machines. Select or clear the check box to activate and deactivate Smart card authentication for individual virtual machines.
| Yes.


|*Single Sign On method*
a|Enabling Single Sign On allows users to sign into the guest operating system when connecting to a virtual machine from the VM Portal using the Guest Agent.

* *Disable Single Sign On* - Select this option if you do not want the Guest Agent to attempt to sign into the virtual machine.

* *Use Guest Agent* - Enables Single Sign On to allow the Guest Agent to sign you into the virtual machine.
| If you select Use Guest Agent, no. Otherwise, yes.

|*Disable strict user checking*
|Click the *Advanced Parameters* arrow and select the check box to use this option. With this option selected, the virtual machine does not need to be rebooted when a different user connects to it.

By default, strict checking is enabled so that only one user can connect to the console of a virtual machine. No other user is able to open a console to the same virtual machine until it has been rebooted. The exception is that a *SuperUser* can connect at any time and replace a existing connection. When a *SuperUser* has connected, no normal user can connect again until the virtual machine is rebooted.

Disable strict checking with caution, because you can expose the previous user's session to the new user.
| No.


|*Soundcard Enabled*
|A sound card device is not necessary for all virtual machine use cases. If it is for yours, enable a sound card here.
| Yes.


|*Enable SPICE file transfer*
|Defines whether a user is able to drag and drop files from an external host into the virtual machine's SPICE console. This option is only available for virtual machines using the SPICE protocol. This check box is selected by default.
| No.


|*Enable SPICE clipboard copy and paste*
|Defines whether a user is able to copy and paste content from an external host into the virtual machine's SPICE console. This option is only available for virtual machines using the SPICE protocol. This check box is selected by default.
| No.


|*Serial Console Section*
|A group of settings.
|


|*Enable VirtIO serial console*
|The VirtIO serial console is emulated through VirtIO channels, using SSH and key pairs, and allows you to access a virtual machine's serial console directly from a client machine's command line, instead of opening a console from the Administration Portal or the VM Portal. The serial console requires direct access to the {engine-name}, since the {engine-name} acts as a proxy for the connection, provides information about virtual machine placement, and stores the authentication keys. Select the check box to enable the VirtIO console on the virtual machine. Requires a firewall rule. See xref:Opening_a_Serial_Console_to_a_Virtual_Machine[Opening a Serial Console to a Virtual Machine].
| Yes.

|===

[[Virtual_Machine_Host_settings_explained]]
==== Virtual Machine Host Settings Explained

The following table details the options available on the *Host* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_Host]]

.Virtual Machine: Host Settings
[cols="1,1,2,1", options="header"]
|===
|Field Name
|Sub-element
|Description
|Power cycle required?


|*Start Running On*
|
a|Defines the preferred host on which the virtual machine is to run. Select either:

* *Any Host in Cluster* - The virtual machine can start and run on any available host in the cluster.

* *Specific Host(s)* - The virtual machine will start running on a particular host in the cluster. However, the {engine-name} or an administrator can migrate the virtual machine to a different host in the cluster depending on the migration and high-availability settings of the virtual machine. Select the specific host or group of hosts from the list of available hosts.
| No. The virtual machine can migrate to that host while running.

|*CPU options*
|*Pass-Through Host CPU*
|When selected, allows virtual machines to use the host's CPU flags.
When selected, *Migration Options* is set to *Allow manual migration only*.
| Yes

|
|*Migrate only to hosts with the same TSC frequency*
|When selected, this virtual machine can only be migrated to a host with the same TSC frequency. THis option is only valid for High Performance virtual machines.
|Yes

|*Migration Options*
|*Migration mode*
a|Defines options to run and migrate the virtual machine. If the options here are not used, the virtual machine will run or migrate according to its cluster's policy.

* *Allow manual and automatic migration* - The virtual machine can be automatically migrated from one host to another in accordance with the status of the environment, or manually by an administrator.

* *Allow manual migration only* - The virtual machine can only be migrated from one host to another manually by an administrator.

* *Do not allow migration* - The virtual machine cannot be migrated, either automatically or manually.
| No

|
|*Migration policy*
a|Defines the migration convergence policy. If the check box is left unselected, the host determines the policy.

* *Cluster default (Minimal downtime)* - Overrides in `vdsm.conf` are still applied. The guest agent hook mechanism is disabled.

* *Minimal downtime* - Allows the virtual machine to migrate in typical situations. Virtual machines should not experience any significant downtime. The migration will be aborted if virtual machine migration does not converge after a long time (dependent on QEMU iterations, with a maximum of 500 milliseconds). The guest agent hook mechanism is enabled.

* *Post-copy migration* - When used, post-copy migration pauses the migrating virtual machine vCPUs on the source host, transfers only a minimum of memory pages, activates the virtual machine vCPUs on the destination host, and transfers the remaining memory pages while the virtual machine is running on the destination.
+
The post-copy policy first tries pre-copy to verify whether convergence can occur. The migration switches to post-copy if the virtual machine migration does not converge after a long time.
+
This significantly reduces the downtime of the migrated virtual machine, and also guarantees that the migration finishes regardless of how rapidly the memory pages of the source virtual machine change. It is optimal for migrating virtual machines in heavy continuous use, which would not be possible to migrate with standard pre-copy migration.
+
The disadvantage of this policy is that in the post-copy phase, the virtual machine may slow down significantly as the missing parts of memory are transferred between the hosts.
+
[WARNING]
====
If the network connection breaks prior to the completion of the post-copy process, the {engine-name} pauses and then kills the running VM. Do not use post-copy migration if the VM availability is critical or if the migration network is unstable.
====

* *Suspend workload if needed* - Allows the virtual machine to migrate in most situations, including when the virtual machine is running a heavy workload. Because of this, virtual machines may experience a more significant downtime than with some other settings. The migration may still be aborted for extreme workloads. The guest agent hook mechanism is enabled.
| No

|
|*Enable migration encryption*
a| Allows the virtual machine to be encrypted during migration.

* *Cluster default (Don't encrypt)*
* *Encrypt*
* *Don't encrypt*
|No

|*Configure NUMA*
|*NUMA Node Count*
|The number of virtual NUMA nodes available in a host that can be assigned to the virtual machine.
| No
|
|*NUMA Pinning*
|Opens the *NUMA Topology* window. This window shows the host's total CPUs, memory, and NUMA nodes, and the virtual machine's virtual NUMA nodes.
You can manually pin virtual NUMA nodes to host NUMA nodes by clicking and dragging each vNUMA from the box on the right to a NUMA node on the left.

You can also set *Tune Mode* for memory allocation:

*Strict* - Memory allocation will fail if the memory cannot be allocated on the target node.

*Preferred* - Memory is allocated from a single preferred node. If sufficient memory is not available, memory can be allocated from other nodes.

*Interleave* - Memory is allocated across nodes in a round-robin algorithm.

If you define NUMA pinning, *Migration Options* is set to *Allow manual migration only*.

| Yes

|
|*Auto Pinning Policy*
a| Allows you to set NUMA Pinning automatically.

* Select *None* to make no changes to the virtual machine.

//* Select *Pin* to use the existing CPU topology that has been set, in order to configure CPU pinning and NUMA pinning.

* Select *Resize and Pin* to maximize the CPU topology and generate the CPU pinning and NUMA pinning configurations.
|No

|===

[[Virtual_Machine_High_Availability_settings_explained]]
==== Virtual Machine High Availability Settings Explained

The following table details the options available on the *High Availability* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_HA]]

.Virtual Machine: High Availability Settings
[cols="1,2,1", options="header"]
|===
|Field Name |Description | Power cycle required?
|*Highly Available* |Select this check box if the virtual machine is to be highly available. For example, in cases of host maintenance, all virtual machines are automatically live migrated to another host. If the host crashes and is in a non-responsive state, only virtual machines with high availability are restarted on another host. If the host is manually shut down by the system administrator, the virtual machine is not automatically live migrated to another host.

Note that this option is unavailable for virtual machines defined as *Server* or *Desktop* if the *Migration Options* setting in the *Hosts* tab is set to *Do not allow migration*. For a virtual machine to be highly available, it must be possible for the {engine-name} to migrate the virtual machine to other available hosts as necessary.

However, for virtual machines defined as *High Performance*, you can define high availability regardless of the *Migration Options* setting.
 | Yes.

|*Target Storage Domain for VM Lease* a|Select the storage domain to hold a virtual machine lease, or select *No VM Lease* to disable the functionality. When a storage domain is selected, it will hold a virtual machine lease on a special volume that allows the virtual machine to be started on another host if the original host loses power or becomes unresponsive.

This functionality is only available on storage domain V4 or later.

[NOTE]
====
If you define a lease, the only *Resume Behavior* available is KILL.
====
 | Yes.

|*Resume Behavior* a|Defines the desired behavior of a virtual machine that is paused due to storage I/O errors, once a connection with the storage is reestablished. You can define the desired resume behavior even if the virtual machine is not highly available.

The following options are available:

* *AUTO_RESUME* - The virtual machine is automatically resumed, without requiring user intervention. This is recommended for virtual machines that are not highly available and that do not require user intervention after being in the paused state.

* *LEAVE_PAUSED* - The virtual machine remains in pause mode until it is manually resumed or restarted.

* *KILL* - The virtual machine is automatically resumed if the I/O error is remedied within 80 seconds. However, if more than 80 seconds pass, the virtual machine is ungracefully shut down. This is recommended for highly available virtual machines, to allow the {engine-name} to restart them on another host that is not experiencing the storage I/O error.
+
*KILL* is the only option available when using virtual machine leases.
 | No.

|*Priority for Run/Migration queue* |Sets the priority level for the virtual machine to be migrated or restarted on another host.
 | No.

|*Watchdog* a|Allows users to attach a watchdog card to a virtual machine. A watchdog is a timer that is used to automatically detect and recover from failures. Once set, a watchdog timer continually counts down to zero while the system is in operation, and is periodically restarted by the system to prevent it from reaching zero. If the timer reaches zero, it signifies that the system has been unable to reset the timer and is therefore experiencing a failure. Corrective actions are then taken to address the failure. This functionality is especially useful for servers that demand high availability.

*Watchdog Model*: The model of watchdog card to assign to the virtual machine. At current, the only supported model is *i6300esb*.

*Watchdog Action*: The action to take if the watchdog timer reaches zero. The following actions are available:

* *none* - No action is taken. However, the watchdog event is recorded in the audit log.

* *reset* - The virtual machine is reset and the {engine-name} is notified of the reset action.

* *poweroff* - The virtual machine is immediately shut down.

* *dump* - A dump is performed and the virtual machine is paused.

* *pause* - The virtual machine is paused, and can be resumed by users.
 | Yes.

|===

[[Virtual_Machine_Resource_Allocation_settings_explained]]
==== Virtual Machine Resource Allocation Settings Explained

The following table details the options available on the *Resource Allocation* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_Resource]]

.Virtual Machine: Resource Allocation Settings
[cols="1,1,2,1", options="header"]
|===
|Field Name
|Sub-element
|Description
|Power cycle required?


|*CPU Allocation*
|*CPU Profile*
|The CPU profile assigned to the virtual machine. CPU profiles define the maximum amount of processing capability a virtual machine can access on the host on which it runs, expressed as a percent of the total processing capability available to that host. CPU profiles are defined for a cluster, based on quality of service entries created for data centers.
| No.


|
|*CPU Shares*
a|Allows users to set the level of CPU resources a virtual machine can demand relative to other virtual machines.

* *Low* - 512

* *Medium* - 1024

* *High* - 2048

* *Custom* - A custom level of CPU shares defined by the user.
| No.


|
|*CPU Pinning topology*
a|Enables the virtual machine's virtual CPU (vCPU) to run on a specific physical CPU (pCPU) in a specific host. The syntax of CPU pinning is `v#p[_v#p]`, for example:

* `0#0` - Pins vCPU 0 to pCPU 0.

* `0#0_1#3` - Pins vCPU 0 to pCPU 0, and pins vCPU 1 to pCPU 3.

* `1#1-4,^2` - Pins vCPU 1 to one of the pCPUs in the range of 1 to 4, excluding pCPU 2.

The *CPU Pinning Topology* is populated automatically when automatic NUMA pinning is activated.

In order to pin a virtual machine to a host, you must also select the following on the *Host* tab:

* *Start Running On:* *Specific*

* *Pass-Through Host CPU*

If CPU pinning is set and you change *Start Running On: Specific* a *CPU pinning topology will be lost* window appears when you click btn:[OK].

When defined, *Migration Options* in the *Hosts* tab is set to *Allow manual migration only*.
| Yes.


|*Memory Allocation*
|*Physical Memory Guaranteed*
|The amount of physical memory guaranteed for this virtual machine. Should be any number between 0 and the defined memory for this virtual machine.
| If lowered, yes. Otherwise, no.

|
|*Memory Balloon Device Enabled*
|Enables the memory balloon device for this virtual machine. Enable this setting to allow memory overcommitment in a cluster. Enable this setting for applications that allocate large amounts of memory suddenly but set the guaranteed memory to the same value as the defined memory.Use ballooning for applications and loads that slowly consume memory, occasionally release memory, or stay dormant for long periods of time, such as virtual desktops. See link:{URL_virt_product_docs}{URL_format}administration_guide#Cluster_Optimization_Settings_Explained[Optimization Settings Explained] in the _Administration Guide_ for more information.
| Yes.

|*Trusted Platform Module*
|*TPM Device Enabled*
|Enables the addition of an emulated Trusted Platform Module (TPM) device. Select this check box to add an emulated Trusted Platform Module device to a virtual machine. TPM devices can only be used on x86_64 machines with UEFI firmware and PowerPC machines with pSeries firmware installed. See xref:Adding_TPM_devices[Adding Trusted Platform Module devices] for more information.
| Yes.

|*IO Threads*
|*IO Threads Enabled*
|Enables IO threads. Select this check box to improve the speed of disks that have a VirtIO interface by pinning them to a thread separate from the virtual machine's other functions. Improved disk performance increases a virtual machine's overall performance. Disks with VirtIO interfaces are pinned to an IO thread using a round-robin algorithm.
| Yes.


|*Queues*
|*Multi Queues Enabled*
|Enables multiple queues. This check box is selected by default. It creates up to four queues per vNIC, depending on how many vCPUs are available.

It is possible to define a different number of queues per vNIC by creating a custom property as follows:

`engine-config -s "CustomDeviceProperties={type=interface;prop={_other-nic-properties_;queues=[1-9][0-9]*}}"`

where _other-nic-properties_ is a semicolon-separated list of pre-existing NIC custom properties.
| Yes.


|
|*VirtIO-SCSI Enabled*
|Allows users to enable or disable the use of VirtIO-SCSI on the virtual machines.
| Not applicable.


|
|*VirtIO-SCSI Multi Queues Enabled*
|The *VirtIO-SCSI Multi Queues Enabled* option is only available when *VirtIO-SCSI Enabled* is selected. Select this check box to enable multiple queues in the VirtIO-SCSI driver. This setting can improve I/O throughput when multiple threads within the virtual machine access the virtual disks. It creates up to four queues per VirtIO-SCSI controller, depending on how many disks are connected to the controller and how many vCPUs are available.
| Not applicable.


|*Storage Allocation*
|
|The *Storage Allocation* option is only available when the virtual machine is created from a template.
| Not applicable.


|
|*Thin*
|Provides optimized usage of storage capacity. Disk space is allocated only as it is required. When selected, the format of the disks will be marked as QCOW2 and you will not be able to change it.
| Not applicable.


|
|*Clone*
|Optimized for the speed of guest read and write operations. All disk space requested in the template is allocated at the time of the clone operation. Possible disk formats are *QCOW2* or *Raw*.
| Not applicable.


|*Disk Allocation*
|
|The *Disk Allocation* option is only available when you are creating a virtual machine from a template.
| Not applicable.


|
|*Alias*
|An alias for the virtual disk. By default, the alias is set to the same value as that of the template.
| Not applicable.


|
|*Virtual Size*
|The total amount of disk space that the virtual machine based on the template can use. This value cannot be edited, and is provided for reference only.
| Not applicable.


|
|*Format*
|The format of the virtual disk. The available options are *QCOW2* and *Raw*. When *Storage Allocation* is *Thin*, the disk format is *QCOW2*. When Storage Allocation is *Clone*, select *QCOW2* or *Raw*.
| Not applicable.


|
|*Target*
|The storage domain on which the virtual disk is stored. By default, the storage domain is set to the same value as that of the template.
| Not applicable.


|
|*Disk Profile*
|The disk profile to assign to the virtual disk. Disk profiles are created based on storage profiles defined in the data centers. For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#Creating_a_Disk_Profile[Creating a Disk Profile].
| Not applicable.

|===

[[Virtual_Machine_Boot_Options_settings_explained]]
==== Virtual Machine Boot Options Settings Explained

The following table details the options available on the *Boot Options* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows
[[New_VMs_Boot_Options]]

.Virtual Machine: Boot Options Settings
[cols="1,2,1", options="header"]
|===

|Field Name
|Description
|Power cycle required?


|*First Device*
a|After installing a new virtual machine, the new virtual machine must go into Boot mode before powering up. Select the first device that the virtual machine must try to boot:

* *Hard Disk*

* *CD-ROM*

* *Network (PXE)*
| Yes.


|*Second Device*
|Select the second device for the virtual machine to use to boot if the first device is not available. The first device selected in the previous option does not appear in the options.
| Yes.


|*Attach CD*
|If you have selected *CD-ROM* as a boot device, select this check box and select a CD-ROM image from the drop-down menu. The images must be available in the ISO domain.
| Yes.


|*Enable menu to select boot device*
|Enables a menu to select the boot device. After the virtual machine starts and connects to the console, but before the virtual machine starts booting, a menu displays that allows you to select the boot device. This option should be enabled before the initial boot to allow you to select the required installation media.
| Yes.

|===

[[Virtual_Machine_Random_Generator_Settings_Explained]]
==== Virtual Machine Random Generator Settings Explained

The following table details the options available on the *Random Generator* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_Random_Generator]]

.Virtual Machine: Random Generator Settings
[cols="1,2,1", options="header"]
|===
|Field Name
|Description
|Power cycle required?


|*Random Generator enabled*
|Selecting this check box enables a paravirtualized Random Number Generator PCI device (virtio-rng). This device allows entropy to be passed from the host to the virtual machine in order to generate a more sophisticated random number. Note that this check box can only be selected if the RNG device exists on the host and is enabled in the host's cluster.
|Yes.


|*Period duration (ms)*
|Specifies the duration of the RNG's "full cycle" or "full period" in milliseconds. If omitted, the libvirt default of 1000 milliseconds (1 second) is used. If this field is filled,
*Bytes per period* must be filled also.
|Yes.


|*Bytes per period*
|Specifies how many bytes are permitted to be consumed per period.
|Yes.


|*Device source:*
a|The source of the random number generator. This is automatically selected depending on the source supported by the host's cluster.

* */dev/urandom source* - The Linux-provided random number generator.

* */dev/hwrng source* - An external hardware generator.
|Yes.


|===

[id="Virtual_Machine_Custom_Properties_settings_explained"]
==== Virtual Machine Custom Properties Settings Explained

The following table details the options available on the *Custom Properties* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.

[id="New_VMs_Custom_Properties"]
.Virtual Machine Custom Properties Settings
[cols="1,2,2,1", options="header"]
|===

|Field Name
|Description
|Recommendations and Limitations
|Power cycle required?


|*sndbuf*
|Enter the size of the buffer for sending the virtual machine's outgoing data over the socket. Default value is 0.
|-
| Yes


|*hugepages*
|Enter the huge page size in KB.
a|
* Set the huge page size to the largest size supported by the pinned host.
* The recommended size for x86_64 is 1 GB.
* The virtual machine’s huge page size must be the same size as the pinned host’s huge page size.
* The virtual machine’s memory size must fit into the selected size of the pinned host’s free huge pages. The NUMA node size must be a multiple of the huge page’s selected size.
| Yes


|*vhost*
a|Disables vhost-net, which is the kernel-based virtio network driver on virtual network interface cards attached to the virtual machine. To disable vhost, the format for this property is `_LogicalNetworkName_: false`.

This will explicitly start the virtual machine without the vhost-net setting on the virtual NIC attached to _LogicalNetworkName_.
|vhost-net provides better performance than virtio-net, and if it is present, it is enabled on all virtual machine NICs by default. Disabling this property makes it easier to isolate and diagnose performance issues, or to debug vhost-net errors; for example, if migration fails for virtual machines on which vhost does not exist.
| Yes


|*sap_agent*
|Enables SAP monitoring on the virtual machine. Set to *true* or *false*.
|-
| Yes


// |*nvram_template*
// |TBD
// |TBD
// |TBD


|*mdev_type*
|Enter the name of the mediated device, my_GPU, supported by the host’s kernel to enable the host to work with the device.
|-
|


|*viodiskcache*
|Caching mode for the virtio disk. *writethrough* writes data to the cache and the disk in parallel, *writeback* does not copy modifications from the cache to the disk, and *none* disables caching. See link:https://access.redhat.com/solutions/2361311[] for more information about the limitations of the `viodiskcache` custom property.
|In order to ensure data integrity in the event of a fault in storage, in the network, or in a host during migration, do not migrate virtual machines with viodiskcache enabled, unless virtual machine clustering or application-level clustering is also enabled.
| Yes


|*scsi_hostdev*
a|
Optionally, if you add a SCSI host device to a virtual machine, you can specify the optimal SCSI host device driver. For details, see link:{URL_virt_product_docs}{URL_format}virtual_machine_management_guide/index#Adding_Host_Devices_to_a_Virtual_Machine[Adding Host Devices to a Virtual Machine].

* *scsi_generic*: (Default) Enables the guest operating system to access OS-supported SCSI host devices attached to the host. Use this driver for SCSI media changers that require raw access, such as tape or CD changers.
* *scsi_block*: Similar to *scsi_generic* but better speed and reliability. Use for SCSI disk devices. If trim or discard for the underlying device is desired, and it’s a hard disk, use this driver.
* *scsi_hd*: Provides performance with lowered overhead. Supports large numbers of devices. Uses the standard SCSI device naming scheme. Can be used with aio-native. Use this driver for high-performance SSDs.
* *virtio_blk_pci*: Provides the highest performance without the SCSI overhead. Supports identifying devices by their serial numbers.
|If you are not sure, try *scsi_hd*.
|Yes
|===


[WARNING]
====
Increasing the value of the sndbuf custom property results in increased occurrences of communication failure between hosts and unresponsive virtual machines.
====

[[Virtual_Machine_Icon_Settings_Explained]]
==== Virtual Machine Icon Settings Explained

You can add custom icons to virtual machines and templates. Custom icons can help to differentiate virtual machines in the VM Portal. The following table details the options available on the *Icon* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows.
[[New_VMs_Icon]]

[NOTE]
This table does not include information on whether a power cycle is required because these settings apply to the virtual machine's _appearance in the Administration portal_, not to its configuration.


.Virtual Machine: Icon Settings
[cols="1,2", options="header"]
|===
|Button Name
|Description

|*Upload*
a|Click this button to select a custom image to use as the virtual machine's icon. The following limitations apply:

* Supported formats: jpg, png, gif

* Maximum size: 24 KB

* Maximum dimensions: 150px width, 120px height
|Power cycle required?


|*Use default*
|Click this button to set the operating system's default image as the virtual machine's icon.

|===

[[Virtual_Machine_Satellite_settings_explained]]
==== Virtual Machine Foreman/Satellite Settings Explained

The following table details the options available on the *Foreman/Satellite* tab of the *New Virtual Machine* and *Edit Virtual Machine* windows
[[New_VMs_Satellite_Options]]

.Virtual Machine:Foreman/Satellite Settings
[cols="1,2,1", options="header"]
|===
|Field Name
|Description
|Power cycle required?


|*Provider*
|If the virtual machine is running {enterprise-linux} and the system is configured to work with a Satellite server, select the name of the Satellite from the list. This enables you to use Satellite's content management feature to display the relevant Errata for this virtual machine. See xref:Configuring_Satellite_Errata[] for more details.
|Yes.
|===


[[Virtual_Machine_Run_Once_settings_explained]]
=== Explanation of settings in the Run Once window

The *Run Once* window defines one-off boot options for a virtual machine. For persistent boot options, use the *Boot Options* tab in the *New Virtual Machine* window. The *Run Once* window contains multiple sections that can be configured.

The standalone *Rollback this configuration during reboots* check box specifies whether reboots (initiated by the {engine-name}, or from within the guest) will be warm (soft) or cold (hard). Select this check box to configure a cold reboot that restarts the virtual machine with regular (non-*Run Once*) configuration. Clear this check box to configure a warm reboot that retains the virtual machine's *Run Once* configuration.

The *Boot Options* section defines the virtual machine's boot sequence, running options, and source images for installing the operating system and required drivers.

[NOTE]
The following tables do not include information on whether a power cycle is required because these _one-off boot options_ apply only when you reboot the virtual machine.

[[Boot_Options_Fields]]

.Boot Options Section
[cols="1,2", options="header"]
|===
|Field Name
|Description


|*Attach CD*
|Attaches an ISO image to the virtual machine. Use this option to install the virtual machine's operating system and applications. The CD image must reside in the ISO domain.


|*Attach Windows guest tools CD*
|Attaches a secondary virtual CD-ROM to the virtual machine with the virtio-win ISO image.
 Use this option to install Windows drivers. For information on installing the image, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#Uploading_the_VirtIO_and_Guest_Tool_Image_Files_to_an_ISO_Storage_Domain[Uploading the VirtIO and Guest Tool Image Files to a Storage Domain] in the _Administration Guide_.

|*Enable menu to select boot device*
|Enables a menu to select the boot device. After the virtual machine starts and connects to the console, but before the virtual machine starts booting, a menu displays that allows you to select the boot device. This option should be enabled before the initial boot to allow you to select the required installation media.


|*Start in Pause Mode*
|Starts and then pauses the virtual machine to enable connection to the console. Suitable for virtual machines in remote locations.


|*Predefined Boot Sequence*
|Determines the order in which the boot devices are used to boot the virtual machine. Select *Hard Disk*, *CD-ROM*, or *Network (PXE)*, and use *Up* and *Down* to move the option up or down in the list.


|*Run Stateless*
|Deletes all data and configuration changes to the virtual machine upon shutdown. This option is only available if a virtual disk is attached to the virtual machine.

|===

The *Linux Boot Options* section contains fields to boot a Linux kernel directly instead of through the BIOS bootloader.
[[Linux_Boot_Options_Fields]]

.Linux Boot Options Section
[cols="1,2", options="header"]
|===
|Field Name
|Description


|*kernel path*
|A fully qualified path to a kernel image to boot the virtual machine. The kernel image must be stored on either the ISO domain (path name in the format of *iso://path-to-image*) or on the host's local storage domain (path name in the format of */data/images*).


|*initrd path*
|A fully qualified path to a ramdisk image to be used with the previously specified kernel. The ramdisk image must be stored on the ISO domain (path name in the format of *iso://path-to-image*) or on the host's local storage domain (path name in the format of */data/images*).


|*kernel parameters*
|Kernel command line parameter strings to be used with the defined kernel on boot.

|===

The *Initial Run* section is used to specify whether to use Cloud-Init or Sysprep to initialize the virtual machine. For Linux-based virtual machines, you must select the *Use Cloud-Init* check box in the *Initial Run* tab to view the available options. For Windows-based virtual machines, you must attach the `[sysprep]` floppy by selecting the *Attach Floppy* check box in the *Boot Options* tab and selecting the floppy from the list.

The options that are available in the *Initial Run* section differ depending on the operating system that the virtual machine is based on.
[[Initial_Run_Fields_Linux]]

.Initial Run Section (Linux-based Virtual Machines)
[cols="1,2", options="header"]
|===
|Field Name
|Description


|*VM Hostname*
|The host name of the virtual machine.


|*Configure Time Zone*
|The time zone for the virtual machine. Select this check box and select a time zone from the *Time Zone* list.


|*Authentication*
|The authentication details for the virtual machine. Click the disclosure arrow to display the settings for this option.


|menu:Authentication[User Name]
|Creates a new user account on the virtual machine. If this field is not filled in, the default user is `root`.


|menu:Authentication[Use already configured password]
|This check box is automatically selected after you specify an initial root password. You must clear this check box to enable the *Password* and *Verify Password* fields and specify a new password.


|menu:Authentication[Password]
|The root password for the virtual machine. Enter the password in this text field and the *Verify Password* text field to verify the password.


|menu:Authentication[SSH Authorized Keys]
|SSH keys to be added to the authorized keys file of the virtual machine.


|menu:Authentication[Regenerate SSH Keys]
|Regenerates SSH keys for the virtual machine.


|*Networks*
|Network-related settings for the virtual machine. Click the disclosure arrow to display the settings for this option.


|menu:Networks[DNS Servers]
|The DNS servers to be used by the virtual machine.


|menu:Networks[DNS Search Domains]
|The DNS search domains to be used by the virtual machine.


|menu:Networks[Network]
|Configures network interfaces for the virtual machine. Select this check box and click *\+* or *-* to add or remove network interfaces to or from the virtual machine. When you click *+*, a set of fields becomes visible that can specify whether to use DHCP, and configure an IP address, netmask, and gateway, and specify whether the network interface will start on boot.


|*Custom Script*
|Custom scripts that will be run on the virtual machine when it starts. The scripts entered in this field are custom YAML sections that are added to those produced by the {engine-name}, and allow you to automate tasks such as creating users and files, configuring `yum` repositories and running commands. For more information on the format of scripts that can be entered in this field, see the link:http://cloudinit.readthedocs.io/en/latest/topics/examples.html#yaml-examples[Custom Script] documentation.

|===
[[Initial_Run_Fields_Win]]

.Initial Run Section (Windows-based Virtual Machines)
[cols="1,2", options="header"]
|===
|Field Name
|Description


|*VM Hostname*
|The host name of the virtual machine.


|*Domain*
|The Active Directory domain to which the virtual machine belongs.


|*Organization Name*
|The name of the organization to which the virtual machine belongs. This option corresponds to the text field for setting the organization name displayed when a machine running Windows is started for the first time.


|*Active Directory OU*
|The organizational unit in the Active Directory domain to which the virtual machine belongs. The distinguished name must be provided. For example `CN=Users,DC=lab,DC=local`


|*Configure Time Zone*
|The time zone for the virtual machine. Select this check box and select a time zone from the *Time Zone* list.


|*Admin Password*
|The administrative user password for the virtual machine. Click the disclosure arrow to display the settings for this option.


|menu:Admin Password[Use already configured password]
|This check box is automatically selected after you specify an initial administrative user password. You must clear this check box to enable the *Admin Password* and *Verify Admin Password* fields and specify a new password.


|menu:Admin Password[Admin Password]
|The administrative user password for the virtual machine. Enter the password in this text field and the *Verify Admin Password* text field to verify the password.


|*Custom Locale*
|Locales must be in a format such as `en-US`. Click the disclosure arrow to display the settings for this option.


|menu:Custom Locale[Input Locale]
|The locale for user input.


|menu:Custom Locale[UI Language]
|The language used for user interface elements such as buttons and menus.


|menu:Custom Locale[System Locale]
|The locale for the overall system.


|menu:Custom Locale[User Locale]
|The locale for users.


|*Sysprep*
|A custom Sysprep definition. The definition must be in the format of a complete unattended installation answer file. You can copy and paste the default answer files in the */usr/share/ovirt-engine/conf/sysprep/* directory on the machine on which the {virt-product-fullname} {engine-name} is installed and alter the fields as required. The definition will overwrite any values entered in the `Initial Run` fields. See xref:chap-Templates[] for more information.


|*Domain*
|The Active Directory domain to which the virtual machine belongs. If left blank, the value of the previous `Domain` field is used.


|*Alternate Credentials*
|Selecting this check box allows you to set a *User Name* and *Password* as alternative credentials.

|===

The *System* section enables you to define the supported machine type or CPU type.
[[System_Fields]]

.System Section
[cols="1,2", options="header"]
|===
|Field Name
|Description

|*Custom Emulated Machine*
|This option allows you to specify the machine type. If changed, the virtual machine will only run on hosts that support this machine type. Defaults to the cluster's default machine type.

|*Custom CPU Type*
|This option allows you to specify a CPU type. If changed, the virtual machine will only run on hosts that support this CPU type. Defaults to the cluster's default CPU type.
|===

The *Host* section is used to define the virtual machine's host.
[[Host_Fields]]

.Host Section
[cols="1,2", options="header"]
|===
|Field Name
|Description

|*Any host in cluster*
|Allocates the virtual machine to any available host.

|*Specific Host(s)*
|Specifies a user-defined host for the virtual machine.
|===

The *Console* section defines the protocol to connect to virtual machines.
[[Console_Fields]]

.Console Section
[cols="1,2", options="header"]
|===
|Field Name
|Description

|*Headless Mode*
|Select this option if you do not require a graphical console when running the machine for the first time. See xref:Configuring_Headless_Machines[] for more information.

|*VNC*
|Requires a VNC client to connect to a virtual machine using VNC. Optionally, specify *VNC Keyboard Layout* from the drop-down list.

|*SPICE*
|Recommended protocol for Linux and Windows virtual machines. Using SPICE protocol with QXLDOD drivers is supported for Windows 10 and Windows Server 2016 and later virtual machines.

|*Enable SPICE file transfer*
|Determines whether you can drag and drop files from an external host into the virtual machine's SPICE console. This option is only available for virtual machines using the SPICE protocol. This check box is selected by default.

|*Enable SPICE clipboard copy and paste*
|Defines whether you can copy and paste content from an external host into the virtual machine's SPICE console. This option is only available for virtual machines using the SPICE protocol. This check box is selected by default.
|===

The *Custom Properties* section contains additional VDSM options for running virtual machines. See xref:New_VMs_Custom_Properties[] for details.
[[Custom_Properties_Fields]]

[[Virtual_Machine_Network_Interface_dialogue_entries]]
=== Explanation of Settings in the New Network Interface and Edit Network Interface Windows

These settings apply when you are adding or editing a virtual machine network interface. If you have more than one network interface attached to a virtual machine, you can put the virtual machine on more than one logical network.


.Network Interface Settings
[cols="1,2,1", options="header"]
|===

|Field Name
|Description
|Power cycle required?


|*Name*
|The name of the network interface. This text field has a 21-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.
| No.

|*Profile*
|The vNIC profile and logical network that the network interface is placed on. By default, all network interfaces are put on the *ovirtmgmt* management network.
| No.


|*Type*
a|The virtual interface the network interface presents to virtual machines.

* *rtl8139* and *e1000* device drivers are included in most operating systems.

* *VirtIO* is faster but requires VirtIO drivers. {enterprise-linux} 5 and later include VirtIO drivers. Windows does not include VirtIO drivers, but they can be installed from the guest tools ISO or virtual floppy disk.

* *PCI Passthrough* enables the vNIC to be directly connected to a virtual function (VF) of an SR-IOV-enabled NIC. The vNIC will then bypass the software network virtualization and connect directly to the VF for direct device assignment. The selected vNIC profile must also have *Passthrough* enabled.
| Yes.


|*Custom MAC address*
|Choose this option to set a custom MAC address. The {virt-product-fullname} {engine-name} automatically generates a MAC address that is unique to the environment to identify the network interface. Having two devices with the same MAC address online in the same network causes networking conflicts.
| Yes.


|*Link State*
a|Whether or not the network interface is connected to the logical network.

* *Up*: The network interface is located on its slot.

** When the *Card Status* is *Plugged*, it means the network interface is connected to a network cable, and is active.

** When the *Card Status* is *Unplugged*, the network interface will automatically be connected to the network and become active once plugged.

* *Down*: The network interface is located on its slot, but it is not connected to any network. Virtual machines will not be able to run in this state.
| No.


|*Card Status*
a|Whether or not the network interface is defined on the virtual machine.

* `Plugged`: The network interface has been defined on the virtual machine.

** If its *Link State* is `Up`, it means the network interface is connected to a network cable, and is active.

** If its *Link State* is `Down`, the network interface is not connected to a network cable.

* `Unplugged`: The network interface is only defined on the {engine-name}, and is not associated with a virtual machine.

** If its *Link State* is `Up`, when the network interface is plugged it will automatically be connected to a network and become active.

** If its *Link State* is `Down`, the network interface is not connected to any network until it is defined on a virtual machine.
| No.

|===

[[Add_Virtual_Disk_dialogue_entries]]
=== Explanation of settings in the New Virtual Disk and Edit Virtual Disk windows

[NOTE]
====
The following tables do not include information on whether a power cycle is required because that information is not applicable to these scenarios.
====

.New Virtual Disk and Edit Virtual Disk settings: *Image*
[cols="1,2", options="header"]
|===
|Field Name |Description
|*Size(GB)* |The size of the new virtual disk in GB.
|*Alias* |The name of the virtual disk, limited to 40 characters.
|*Description* |A description of the virtual disk. This field is recommended but not mandatory.
|*Interface* |The virtual interface the disk presents to virtual machines. *VirtIO* is faster, but requires drivers. {enterprise-linux} 5 and later include these drivers. Windows does not include these drivers, but you can install them from the virtio-win ISO image. IDE and SATA devices do not require special drivers.

The interface type can be updated after stopping all virtual machines that the disk is attached to.
|*Data Center* |The data center in which the virtual disk will be available.
|*Storage Domain* |The storage domain in which the virtual disk will be stored. The drop-down list shows all storage domains available in the given data center, and also shows the total space and currently available space in the storage domain.
|*Allocation Policy* a|The provisioning policy for the new virtual disk.

* *Preallocated* allocates the entire size of the disk on the storage domain at the time the virtual disk is created. The virtual size and the actual size of a preallocated disk are the same. Preallocated virtual disks take more time to create than thin provisioned virtual disks, but have better read and write performance. Preallocated virtual disks are recommended for servers and other I/O intensive virtual machines. If a virtual machine is able to write more than 1 GB every four seconds, use preallocated disks where possible.

* *Thin Provision* allocates 1 GB at the time the virtual disk is created and sets a maximum limit on the size to which the disk can grow. The virtual size of the disk is the maximum limit; the actual size of the disk is the space that has been allocated so far. Thin provisioned disks are faster to create than preallocated disks and allow for storage over-commitment. Thin provisioned virtual disks are recommended for desktops.


|*Disk Profile* |The disk profile assigned to the virtual disk. Disk profiles define the maximum amount of throughput and the maximum level of input and output operations for a virtual disk in a storage domain. Disk profiles are defined on the storage domain level based on storage quality of service entries created for data centers.
|*Activate Disk(s)* |Activate the virtual disk immediately after creation. This option is not available when creating a floating disk.
|*Wipe After Delete* |Allows you to enable enhanced security for deletion of sensitive material when the virtual disk is deleted.
|*Bootable* |Enables the bootable flag on the virtual disk.
|*Shareable* |Attaches the virtual disk to more than one virtual machine at a time.
|*Read Only* |Allows you to set the disk as read-only. The same disk can be attached as read-only to one virtual machine, and as rewritable to another. This option is not available when creating a floating disk.
|*Enable Discard* |Allows you to shrink a thin provisioned disk while the virtual machine is up. For block storage, the underlying storage device must support discard calls, and the option cannot be used with *Wipe After Delete* unless the underlying storage supports the discard_zeroes_data property. For file storage, the underlying file system and the block device must support discard calls. If all requirements are met, SCSI UNMAP commands issued from guest virtual machines is passed on by QEMU to the underlying storage to free up the unused space.
|===


The *Direct LUN* settings can be displayed in either *Targets &gt; LUNs* or *LUNs &gt; Targets*. *Targets &gt; LUNs* sorts available LUNs according to the host on which they are discovered, whereas *LUNs &gt; Targets* displays a single list of LUNs.


.New Virtual Disk and Edit Virtual Disk settings: *Direct LUN*
[cols="1,2", options="header"]
|===
|Field Name |Description
|*Alias* |The name of the virtual disk, limited to 40 characters.
|*Description* |A description of the virtual disk. This field is recommended but not mandatory. By default the last 4 characters of the LUN ID is inserted into the field.

The default behavior can be configured by setting the `PopulateDirectLUNDiskDescriptionWithLUNId` configuration key to the appropriate value using the `engine-config` command.  The configuration key can be set to `-1` for the full LUN ID to be used, or `0` for this feature to be ignored. A positive integer populates the description with the corresponding number of characters of the LUN ID.
|*Interface* |The virtual interface the disk presents to virtual machines. *VirtIO* is faster, but requires drivers. {enterprise-linux} 5 and later include these drivers. Windows does not include these drivers, but you can install them from the virtio-win ISO image. IDE and SATA devices do not require special drivers.

The interface type can be updated after stopping all virtual machines that the disk is attached to.
|*Data Center* |The data center in which the virtual disk will be available.
|*Host* |The host on which the LUN will be mounted. You can select any host in the data center.
|*Storage Type* |The type of external LUN to add. You can select from either *iSCSI* or *Fibre Channel*.
|*Discover Targets* a|This section can be expanded when you are using iSCSI external LUNs and *Targets &gt; LUNs* is selected.

*Address* - The host name or IP address of the target server.

*Port* - The port by which to attempt a connection to the target server. The default port is 3260.

*User Authentication* - The iSCSI server requires User Authentication. The *User Authentication* field is visible when you are using iSCSI external LUNs.

*CHAP user name* - The user name of a user with permission to log in to LUNs. This field is accessible when the *User Authentication* check box is selected.

*CHAP password* - The password of a user with permission to log in to LUNs. This field is accessible when the *User Authentication* check box is selected.
|*Activate Disk(s)* |Activate the virtual disk immediately after creation. This option is not available when creating a floating disk.
|*Bootable* |Allows you to enable the bootable flag on the virtual disk.
|*Shareable* |Allows you to attach the virtual disk to more than one virtual machine at a time.
|*Read Only* |Allows you to set the disk as read-only. The same disk can be attached as read-only to one virtual machine, and as rewritable to another. This option is not available when creating a floating disk.
|*Enable Discard* |Allows you to shrink a thin provisioned disk while the virtual machine is up. With this option enabled, SCSI UNMAP commands issued from guest virtual machines is passed on by QEMU to the underlying storage to free up the unused space.
|*Enable SCSI Pass-Through* |Available when the *Interface* is set to *VirtIO-SCSI*. Selecting this check box enables passthrough of a physical SCSI device to the virtual disk. A VirtIO-SCSI interface with SCSI passthrough enabled automatically includes SCSI discard support. *Read Only* is not supported when this check box is selected.

When this check box is not selected, the virtual disk uses an emulated SCSI device. *Read Only* is supported on emulated VirtIO-SCSI disks.
|*Allow Privileged SCSI I/O* |Available when the *Enable SCSI Pass-Through* check box is selected. Selecting this check box enables unfiltered SCSI Generic I/O (SG_IO) access, allowing privileged SG_IO commands on the disk. This is required for persistent reservations.
|*Using SCSI Reservation* |Available when the *Enable SCSI Pass-Through* and *Allow Privileged SCSI I/O* check boxes are selected. Selecting this check box disables migration for any virtual machine using this disk, to prevent virtual machines that are using SCSI reservation from losing access to the disk.
|===


Fill in the fields in the *Discover Targets* section and click *Discover* to discover the target server. You can then click the *Login All* button to list the available LUNs on the target server and, using the radio buttons next to each LUN, select the LUN to add.

Using LUNs directly as virtual machine hard disk images removes a layer of abstraction between your virtual machines and their data.

The following considerations must be made when using a direct LUN as a virtual machine hard disk image:


* Live storage migration of direct LUN hard disk images is not supported.

* Direct LUN disks are not included in virtual machine exports.

* Direct LUN disks are not included in virtual machine snapshots.

[IMPORTANT]
====
Mounting a journaled file system requires read-write access. Using the *Read Only* option is not appropriate for virtual disks that contain such file systems (e.g. *EXT3*, *EXT4*, or *XFS*).
====

[[Explanation_of_Settings_in_the_New_Template_and_Edit_Template_Windows]]
=== Explanation of Settings in the New Template Window

The following table details the settings for the *New Template* window.

[NOTE]
The following tables do not include information on whether a power cycle is required because that information is not applicable to this scenario.


. New Template Settings
[cols="1,2", options="header"]
|===
|Field
|Description/Action

|*Name*
|The name of the template. This is the name by which the template is listed in the *Templates* tab in the Administration Portal and is accessed via the REST API. This text field has a 40-character limit and must be a unique name within the data center with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores. The name can be reused in different data centers in the environment.


|*Description*
|A description of the template. This field is recommended but not mandatory.


|*Comment*
|A field for adding plain text, human-readable comments regarding the template.


|*Cluster*
|The cluster with which the template is associated. This is the same as the original virtual machines by default. You can select any cluster in the data center.


|*CPU Profile*
|The CPU profile assigned to the template. CPU profiles define the maximum amount of processing capability a virtual machine can access on the host on which it runs, expressed as a percent of the total processing capability available to that host. CPU profiles are defined for a cluster based on quality of service entries created for data centers.


|*Create as a Template Sub-Version*
a|Specifies whether the template is created as a new version of an existing template. Select this check box to access the settings for configuring this option.

* *Root Template*: The template under which the sub-template is added.

* *Sub-Version Name*: The name of the template. This is the name by which the template is accessed when creating a new virtual machine based on the template. If the virtual machine is stateless, the list of sub-versions will contain a *latest* option rather than the name of the latest sub-version. This option automatically applies the latest template sub-version to the virtual machine upon reboot. Sub-versions are particularly useful when working with pools of stateless virtual machines.


|*Disks Allocation*
a|*Alias* - An alias for the virtual disk used by the template. By default, the alias is set to the same value as that of the source virtual machine.

*Virtual Size* - The total amount of disk space that a virtual machine based on the template can use. This value cannot be edited, and is provided for reference only. This value corresponds with the size, in GB, that was specified when the disk was created or edited.

*Format* - The format of the virtual disk used by the template. The available options are QCOW2 and Raw. By default, the format is set to Raw.

*Target* - The storage domain on which the virtual disk used by the template is stored. By default, the storage domain is set to the same value as that of the source virtual machine. You can select any storage domain in the cluster.

*Disk Profile* - The disk profile to assign to the virtual disk used by the template. Disk profiles are created based on storage profiles defined in the data centers.  For more information, see link:{URL_virt_product_docs}{URL_format}administration_guide/index#Creating_a_Disk_Profile[Creating a Disk Profile].


|*Allow all users to access this Template*
|Specifies whether a template is public or private. A public template can be accessed by all users, whereas a private template can only be accessed by users with the *TemplateAdmin* or *SuperUser* roles.


|*Copy VM permissions*
|Copies explicit permissions that have been set on the source virtual machine to the template.


|*Seal Template* (Linux only)
|Specifies whether a template is sealed. 'Sealing' is an operation that erases all machine-specific configurations from a filesystem, including SSH keys, UDEV rules, MAC addresses, system ID, and hostname. This setting prevents a virtual machine based on this template from inheriting the configuration of the source virtual machine.

|===

:numbered!:

[appendix]
[[appe-virt_sysprep_operations]]
== `virt-sysprep` Operations

The `virt-sysprep` command removes system-specific details.

Only operations marked with `*` are performed during the template sealing process.


[options="nowrap" subs="normal"]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="virt-sysprep-list-operations">4.46. virt-sysprep --list-operations</h3>
<div class="paragraph">
<p>abrt-data * Remove the crash data generated by ABRT
bash-history * Remove the bash history in the guest
blkid-tab * Remove blkid tab in the guest
ca-certificates   Remove CA certificates in the guest
crash-data * Remove the crash data generated by kexec-tools
cron-spool * Remove user at-jobs and cron-jobs
customize * Customize the guest
dhcp-client-state * Remove DHCP client leases
dhcp-server-state * Remove DHCP server leases
dovecot-data * Remove Dovecot (mail server) data
firewall-rules   Remove the firewall rules
flag-reconfiguration   Flag the system for reconfiguration
fs-uuids   Change filesystem UUIDs
kerberos-data   Remove Kerberos data in the guest
logfiles * Remove many log files from the guest
lvm-uuids * Change LVM2 PV and VG UUIDs
machine-id * Remove the local machine ID
mail-spool * Remove email from the local mail spool directory
net-hostname * Remove HOSTNAME in network interface configuration
net-hwaddr * Remove HWADDR (hard-coded MAC address) configuration
pacct-log * Remove the process accounting log files
package-manager-cache * Remove package manager cache
pam-data * Remove the PAM data in the guest
puppet-data-log * Remove the data and log files of puppet
rh-subscription-manager * Remove the RH subscription manager files
rhn-systemid * Remove the RHN system ID
rpm-db * Remove host-specific RPM database files
samba-db-log * Remove the database and log files of Samba
script * Run arbitrary scripts against the guest
smolt-uuid * Remove the Smolt hardware UUID
ssh-hostkeys * Remove the SSH host keys in the guest
ssh-userdir * Remove ".ssh" directories in the guest
sssd-db-log * Remove the database and log files of sssd
tmp-files * Remove temporary files
udev-persistent-net * Remove udev persistent net rules
user-account   Remove the user accounts in the guest
utmp * Remove the utmp file
yum-uuid * Remove the yum UUID</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[appendix]
== Legal notice

Certain portions of this text first appeared in link:{URL_downstream_virt_product_docs}virtual_machine_management_guide/index[Red Hat Virtualization {vernum_rhv} Virtual Machine Management Guide]. Copyright © 2021 Red Hat, Inc. Licensed under a link:https://creativecommons.org/licenses/by-sa/4.0/[Creative Commons Attribution-ShareAlike 4.0 Unported License].</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <code>Highly Available</code> is not automatically enabled. If you select it manually, high availability should be enabled for pinned hosts only.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Number of I/O threads = 1
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2676/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2676/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2676/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2676/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/documentation/virtual_machine_management_guide/&amp;template=issue_template_documentation.md' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/documentation/virtual_machine_management_guide/index.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
