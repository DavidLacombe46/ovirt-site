<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Get Route | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Get Route" />
<meta name="author" content="Lior Vernia" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2672/develop/release-management/features/network/get-route.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2672/develop/release-management/features/network/get-route.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Get Route" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Lior Vernia" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Lior Vernia"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2672/images/logo.svg"},"name":"Lior Vernia"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Get Route","url":"https://ovirt.github.io/ovirt-site/previews/2672/develop/release-management/features/network/get-route.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2672/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2672/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2672/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2672/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2672/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2672/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2672/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2672/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2672/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2672/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2672/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2672/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2672/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2672/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2672/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2672/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2672/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2672/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2672/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2672/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2672/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2672/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2672/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2672/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2672/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2672/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2672/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2672/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2672/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2672/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2672/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2672/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2672/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2672/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2672/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2672//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2672//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2672/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2672/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2672/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2672/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2672/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/9a2fc6e0042ddce31e9484d1ed181663?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/9a2fc6e0042ddce31e9484d1ed181663?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Lior Vernia</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/262851154d9e06625593cbf205f180cf?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/262851154d9e06625593cbf205f180cf?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Petr Horáček</span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2672/documentation/'>Documentation is available here.</a></div>

<h1 id="get-route">Get Route</h1>

<h3 id="summary">Summary</h3>

<p>New verb <code class="language-plaintext highlighter-rouge">getRoute</code> should return name of a device assigned to given IP address.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Petr Horacek (phoracek)</li>
</ul>

<!-- -->

<ul>
  <li>Email: <a href="mailto:phoracek@redhat.com">phoracek@redhat.com</a></li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>During deployment of a new host, Engine needs to know which of the host’s interfaces is used to connect to Engine. Currently, this is exposed by the `lastClientIface` element of `getVdsCaps` verb. However, this approach is problematic, as we plant to remove the requirement of direct Engine-Vdsm TCP connection, without which, Vdsm cannot compute this element.</p>

<p>Instead, it is suggested that Vdsm would expose the output of `ip route get <addr>\`, so that Engine would be able to guess which on top of which host should it configure the management network. Note that this would only be a guess, as Vdsm may sit behind NAT with no route to Engine. In that case, automatic deployment of the management network would be skipped.</addr></p>

<h2 id="engine">Engine</h2>

<p><b>Overview:</b> Currently, the engine stores a host’s “Active NIC”, and uses it to decide on which interface it should set up the management network as part of the “Install Host” flow. This “Active NIC” is reported by VDSM as part of <code class="language-plaintext highlighter-rouge">getVdsCaps</code> (in the <code class="language-plaintext highlighter-rouge">lastClientIface</code> entry). With the introduction of the <code class="language-plaintext highlighter-rouge">getRoute</code> verb, the engine could use it for VDSM versions compatible with cluster &gt;= 3.6 instead of the mentioned entry in <code class="language-plaintext highlighter-rouge">getVdsCaps</code>.</p>

<p><b>Details:</b>This can be done by wrapping <code class="language-plaintext highlighter-rouge">getRoute</code> in its own VdsCommand class (e.g. <code class="language-plaintext highlighter-rouge">GetRouteVdsCommand</code>), and run that as part of <code class="language-plaintext highlighter-rouge">CollectVdsNetworkDataAfterInstallationVDSCommand.executeVdsBrokerCommand()</code> if the host’s reported versions are compatible - then call <code class="language-plaintext highlighter-rouge">VDS.setActiveNic()</code> with the result. Similarly, the code setting the active NIC in <code class="language-plaintext highlighter-rouge">VdsBrokerObjectBuilder.updateNetworkData()</code> may be made dependent on older VDSM versions (this is likely optional - it might just be stored as null and overwritten later according to the result of <code class="language-plaintext highlighter-rouge">getRoute</code>), and removed when that API is officially deprecated.</p>

<h2 id="vdsm">VDSM</h2>

<p>To implement this new verb we could use <code class="language-plaintext highlighter-rouge">netinfo.getRouteDeviceTo(ip_address)</code> function, which uses <code class="language-plaintext highlighter-rouge">ipwrapper</code> to do route handling.</p>

<h2 id="documentation--external-references">Documentation / External references</h2>

<ul>
  <li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1117303">add a new getRoute() verb</a></li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2672/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2672/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2672/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2672/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/get-route.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/get-route.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
