<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Power Management | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Power Management" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2776/documentation/doc-Technical_Reference/chap-Power_Management.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2776/documentation/doc-Technical_Reference/chap-Power_Management.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Power Management" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2776/images/logo.svg"}},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Power Management","url":"https://ovirt.github.io/ovirt-site/previews/2776/documentation/doc-Technical_Reference/chap-Power_Management.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2776/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2776/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2776/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2776/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2776/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2776/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2776/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2776/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2776/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2776/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2776/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2776/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2776/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2776/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2776/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2776/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2776/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2776/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2776/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2776/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2776/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2776/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2776/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2776/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2776/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2776/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2776/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2776/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2776/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2776/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2776/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2776/download/'>Download</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2776/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2776/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2776/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2776//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2776//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2776/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2776/documentation/">
              <span property="name">Documentation</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2776/documentation/doc-Technical_Reference/">
              <span property="name">Technical Reference</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div class="sect1">
<h2 id="Power_Management_and_Fencing">Introduction to Power Management and Fencing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The {virt-product-fullname} environment is most flexible and resilient when power management and fencing have been configured. Power management allows the {virt-product-fullname} {engine-name} to control host power cycle operations, most importantly to reboot hosts on which problems have been detected. Fencing is used to isolate problem hosts from a functional {virt-product-fullname} environment by rebooting them, in order to prevent performance degradation. Fenced hosts can then be returned to responsive status through administrator action and be reintegrated into the environment.</p>
</div>
<div class="paragraph">
<p>Power management and fencing make use of special dedicated hardware in order to restart hosts independently of host operating systems. The {virt-product-fullname} {engine-name} connects to a power management devices using a network IP address or hostname. In the context of {virt-product-fullname}, a power management device and a fencing device are the same thing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Power_Management_by_Proxy_in_Red_Hat_Enterprise_Virtualization">Power Management by Proxy in {virt-product-fullname}</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The {virt-product-fullname} {engine-name} does not communicate directly with fence agents. Instead, the {engine-name} uses a proxy to send power management commands to a host power management device. The {engine-name} uses VDSM to execute power management device actions, so another host in the environment is used as a fencing proxy.</p>
</div>
<div class="paragraph">
<p>You can select between:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any host in the same cluster as the host requiring fencing.</p>
</li>
<li>
<p>Any host in the same data center as the host requiring fencing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A viable fencing proxy host has a status of either <strong>UP</strong> or <strong>Maintenance</strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Power_Management">Power Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The {virt-product-fullname} {engine-name} is capable of rebooting hosts that have entered a non-operational or non-responsive state, as well as preparing to power off under-utilized hosts to save power. This functionality depends on a properly configured power management device. The {virt-product-fullname} environment supports the following power management devices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>American Power Conversion (<code>apc</code>)</p>
</li>
<li>
<p>IBM Bladecenter (<code>Bladecenter</code>)</p>
</li>
<li>
<p>Cisco Unified Computing System (<code>cisco_ucs</code>)</p>
</li>
<li>
<p>Dell Remote Access Card 5 (<code>drac5</code>)</p>
</li>
<li>
<p>Dell Remote Access Card 7 (<code>drac7</code>)</p>
</li>
<li>
<p>Electronic Power Switch (<code>eps</code>)</p>
</li>
<li>
<p>HP BladeSystem (<code>hpblade</code>)</p>
</li>
<li>
<p>Integrated Lights Out (<code>ilo</code>, <code>ilo2</code>, <code>ilo3</code>, <code>ilo4</code>)</p>
</li>
<li>
<p>Intelligent Platform Management Interface (<code>ipmilan</code>)</p>
</li>
<li>
<p>Remote Supervisor Adapter (<code>rsa</code>)</p>
</li>
<li>
<p>Fujitsu-Siemens RSB (<code>rsb</code>)</p>
</li>
<li>
<p>Western Telematic, Inc (<code>wti</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HP servers should use <code>ilo3</code> or <code>ilo4</code>, Dell servers use <code>drac5</code> or Integrated Dell Remote Access Controllers (<code>idrac</code>), and IBM servers use <code>ipmilan</code>. Integrated Management Module (IMM) uses the IPMI protocol, and therefore IMM users can use <code>ipmilan</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>APC 5.x power management devices are not supported by the <strong>apc</strong> fence agent. Use the <strong>apc_snmp</strong> fence agent instead.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to communicate with the listed power management devices, the {virt-product-fullname} {engine-name} makes use of fence agents. The {virt-product-fullname} {engine-name} allows administrators to configure a fence agent for the power management device in their environment with parameters the device will accept and respond to. Basic configuration options can be configured using the graphical user interface. Special configuration options can also be entered, and are passed un-parsed to the fence device. Special configuration options are specific to a given fence device, while basic configuration options are for functionalities provided by all supported power management devices. The basic functionalities provided by all power management devices are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Status</strong>: check the status of the host.</p>
</li>
<li>
<p><strong>Start</strong>: power on the host.</p>
</li>
<li>
<p><strong>Stop</strong>: power down the host.</p>
</li>
<li>
<p><strong>Restart</strong>: restart the host. Actually implemented as stop, wait, status, start, wait, status.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Best practice is to test the power management configuration once when initially configuring it, and occasionally after that to ensure continued functionality.</p>
</div>
<div class="paragraph">
<p>Resilience is provided by properly configured power management devices in all of the hosts in an environment. Fencing agents allow the {virt-product-fullname} {engine-name} to communicate with host power management devices to bypass the operating system on a problem host, and isolate the host from the rest of its environment by rebooting it. The {engine-name} can then reassign the SPM role, if it was held by the problem host, and safely restart any highly available virtual machines on other hosts.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Fencing">Fencing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the context of the {virt-product-fullname} environment, fencing is a host reboot initiated by the {engine-name} using a fence agent and performed by a power management device. Fencing allows a cluster to react to unexpected host failures as well as enforce power saving, load balancing, and virtual machine availability policies.</p>
</div>
<div class="paragraph">
<p>Fencing ensures that the role of Storage Pool Manager (SPM) is always assigned to a functional host. If the fenced host was the SPM, the SPM role is relinquished and reassigned to a responsive host. Because the host with the SPM role is the only host that is able to write data domain structure metadata, a non-responsive, un-fenced SPM host causes its environment to lose the ability to create and destroy virtual disks, take snapshots, extend logical volumes, and all other actions that require changes to data domain structure metadata.</p>
</div>
<div class="paragraph">
<p>When a host becomes non-responsive, all of the virtual machines that are currently running on that host can also become non-responsive. However, the non-responsive host retains the lock on the virtual machine hard disk images for virtual machines it is running. Attempting to start a virtual machine on a second host and assign the second host write privileges for the virtual machine hard disk image can cause data corruption.</p>
</div>
<div class="paragraph">
<p>Fencing allows the {virt-product-fullname} {engine-name} to assume that the lock on a virtual machine hard disk image has been released; the {engine-name} can use a fence agent to confirm that the problem host has been rebooted. When this confirmation is received, the {virt-product-fullname} {engine-name} can start a virtual machine from the problem host on another host without risking data corruption. Fencing is the basis for highly-available virtual machines. A virtual machine that has been marked highly-available can not be safely started on an alternate host without the certainty that doing so will not cause data corruption.</p>
</div>
<div class="paragraph">
<p>When a host becomes non-responsive, the {virt-product-fullname} {engine-name} allows a grace period of thirty (30) seconds to pass before any action is taken, to allow the host to recover from any temporary errors. If the host has not become responsive by the time the grace period has passed, the {engine-name} automatically begins to mitigate any negative impact from the non-responsive host. The {engine-name} uses the fencing agent for the power management card on the host to stop the host, confirm it has stopped, start the host, and confirm that the host has been started. When the host finishes booting, it attempts to rejoin the cluster that it was a part of before it was fenced. If the issue that caused the host to become non-responsive has been resolved by the reboot, then the host is automatically set to <strong>Up</strong> status and is once again capable of starting and hosting virtual machines.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Soft-Fencing_Hosts">Soft-Fencing Hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hosts can sometimes become non-responsive due to an unexpected problem, and though VDSM is unable to respond to requests, the virtual machines that depend upon VDSM remain alive and accessible. In these situations, restarting VDSM returns VDSM to a responsive state and resolves this issue.</p>
</div>
<div class="paragraph">
<p>"SSH Soft Fencing" is a process where the {engine-name} attempts to restart VDSM via SSH on non-responsive hosts. If the {engine-name} fails to restart VDSM via SSH, the responsibility for fencing falls to the external fencing agent if an external fencing agent has been configured.</p>
</div>
<div class="paragraph">
<p>Soft-fencing over SSH works as follows. Fencing must be configured and enabled on the host, and a valid proxy host (a second host, in an UP state, in the data center) must exist. When the connection between the {engine-name} and the host times out, the following happens:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the first network failure, the status of the host changes to "connecting".</p>
</li>
<li>
<p>The {engine-name} then makes three attempts to ask VDSM for its status, or it waits for an interval determined by the load on the host. The formula for determining the length of the interval is configured by the configuration values TimeoutToResetVdsInSeconds (the default is 60 seconds) + [DelayResetPerVmInSeconds (the default is 0.5 seconds)]*(the count of running virtual machines on host) + [DelayResetForSpmInSeconds (the default is 20 seconds)] * 1 (if host runs as SPM) or 0 (if the host does not run as SPM). To give VDSM the maximum amount of time to respond, the {engine-name} chooses the longer of the two options mentioned above (three attempts to retrieve the status of VDSM or the interval determined by the above formula).</p>
</li>
<li>
<p>If the host does not respond when that interval has elapsed, <code>vdsm restart</code> is executed via SSH.</p>
</li>
<li>
<p>If <code>vdsm restart</code> does not succeed in re-establishing the connection between the host and the {engine-name}, the status of the host changes to <code>Non Responsive</code> and, if power management is configured, fencing is handed off to the external fencing agent.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Soft-fencing over SSH can be executed on hosts that have no power management configured. This is distinct from "fencing": fencing can be executed only on hosts that have power management configured.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_Multiple_Power_Management_Fencing_Agents">Using Multiple Power Management Fencing Agents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Single agents are treated as primary agents. The secondary agent is valid when there are two fencing agents, for example for dual-power hosts in which each power switch has two agents connected to the same power switch. Agents can be of the same or different types.</p>
</div>
<div class="paragraph">
<p>Having multiple fencing agents on a host increases the reliability of the fencing procedure. For example, when the sole fencing agent on a host fails, the host will remain in a non-operational state until it is manually rebooted. The virtual machines previously running on the host will be suspended, and only fail over to another host in the cluster after the original host is manually fenced. With multiple agents, if the first agent fails, the next agent can be called.</p>
</div>
<div class="paragraph">
<p>When two fencing agents are defined on a host, they can be configured to use a concurrent or sequential flow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Concurrent</strong>: Both primary and secondary agents have to respond to the Stop command for the host to be stopped. If one agent responds to the Start command, the host will go up.</p>
</li>
<li>
<p><strong>Sequential</strong>: To stop or start a host, the primary agent is used first, and if it fails, the secondary agent is used.</p>
</li>
</ul>
</div>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2776/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2776/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2776/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2776/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/documentation/doc-Technical_Reference/chap-Power_Management.html&amp;template=issue_template_documentation.md' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/documentation/doc-Technical_Reference/chap-Power_Management.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
