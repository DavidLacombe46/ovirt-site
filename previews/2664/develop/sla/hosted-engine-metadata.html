<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Hosted engine metadata | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Hosted engine metadata" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2664/develop/sla/hosted-engine-metadata.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2664/develop/sla/hosted-engine-metadata.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hosted engine metadata" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2664/images/logo.svg"}},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Hosted engine metadata","url":"https://ovirt.github.io/ovirt-site/previews/2664/develop/sla/hosted-engine-metadata.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2664/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2664/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2664/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2664/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2664/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2664/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2664/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2664/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2664/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2664/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2664/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2664/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2664/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2664/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2664/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2664/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2664/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2664/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2664/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2664/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2664/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2664/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2664/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2664/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2664/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2664/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2664/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2664/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2664/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2664/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2664/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2664/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2664/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2664/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2664/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2664//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2664//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2664/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2664/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2664/develop/sla/">
              <span property="name">Sla</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d3e5014dcc318e6606b18a8f5fd90dae?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d3e5014dcc318e6606b18a8f5fd90dae?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Martin Sivak</span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>This developer documentation is <strong>outdated</strong>, but provides historical context.<br><br>It is <strong>not</strong> user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2664/documentation/'>Documentation is available here.</a></div>

<h1 id="hosted-engine-metadata">Hosted engine metadata</h1>

<p>Hosted engine agents communicate using a shared “whiteboard”. Each agent can only write to a reserved section (protected by sanlock) and read the whole board.</p>

<h2 id="files">Files</h2>

<p>All hosted engine files related to the shared metadata are located in /rhev:</p>

<ul>
  <li>/rhev/data-center/mnt/<NFS>/<DOMAIN ID="">/ha_agent/hosted-engine.lockspace</DOMAIN></NFS></li>
  <li>/rhev/data-center/mnt/<NFS>/<DOMAIN ID="">/ha_agent/hosted-engine.metadata</DOMAIN></NFS></li>
</ul>

<p>and the formats are described below.</p>

<h3 id="ha_agentlockspace">ha_agent.lockspace</h3>

<p>This file holds the sanlock lockspace used to protect the reserved sections from concurrent writes. The default capacity is 2000 nodes (disk size is 1 MB) and the lockspace is initialized using:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  #!/usr/bin/env python
  import sanlock
  sanlock.write_lockspace(lockspace="hosted-engine", path=lockspace_file, offset=0)
</code></pre></div></div>

<h3 id="ha_agentmetadata">ha_agent.metadata</h3>

<p>This file holds the metadata published by all hosted engine agents. It is organized into 2kiB blocks where the first 512B contains the machine readable format and the rest is used for human readable and auxiliary data. The machine readable block MUST be written and distributed across network atomically.</p>

<p>The first block (index 0) is used for global cluster settings. Currently only the global maintenance flag is being saved there as:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  maintenance=1
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>The additional blocks then contain the following fields separated by ‘</td>
      <td>’ character (the pipe):</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>expected value</th>
      <th>description</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>parse version</td>
      <td>1</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>feature version</td>
      <td>1</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>collection started timestamp</td>
      <td>seconds since start</td>
      <td>start can be either epoch (1st of Jan 1970) or system start when relative time is used (default)</td>
      <td> </td>
    </tr>
    <tr>
      <td>host id</td>
      <td>&lt;unique integer 1…2000&gt;</td>
      <td>MUST match the block id (offset in the file modulo 2048)</td>
      <td> </td>
    </tr>
    <tr>
      <td>score</td>
      <td>integer</td>
      <td>usually 0 .. 2400</td>
      <td> </td>
    </tr>
    <tr>
      <td>engine health report</td>
      <td>{“reason”: “vm not running on this host”, “health”: “bad”, “vm”: “down”, “detail”: “unknown”}</td>
      <td>vm represent the state of the engine VM, health the state of the ovirt-engine service</td>
      <td> </td>
    </tr>
    <tr>
      <td>hostname</td>
      <td>the node’s hostname</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>local maintenance</td>
      <td>0</td>
      <td>1</td>
      <td> </td>
    </tr>
    <tr>
      <td>stopped</td>
      <td>0</td>
      <td>1</td>
      <td>usually 0, but is set to 1 by the agent during proper ha_agent shutdown</td>
    </tr>
    <tr>
      <td>crc32</td>
      <td>8 hex characters</td>
      <td>CRC32 checksum of the whole 512B block (without trailing zeros) with crc field set to 00000000</td>
      <td> </td>
    </tr>
  </tbody>
</table>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2664/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2664/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2664/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2664/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2021 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/sla/hosted-engine-metadata.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/sla/hosted-engine-metadata.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
