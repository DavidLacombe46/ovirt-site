<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Administering the Self-Hosted Engine | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Administering the Self-Hosted Engine" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2961/dropped/introduction_to_the_vm_portal/common/she/chap-Administering_the_Self-Hosted_Engine.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2961/dropped/introduction_to_the_vm_portal/common/she/chap-Administering_the_Self-Hosted_Engine.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Administering the Self-Hosted Engine" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Administering the Self-Hosted Engine","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2961/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2961/dropped/introduction_to_the_vm_portal/common/she/chap-Administering_the_Self-Hosted_Engine.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2961/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2961/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2961/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2961/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2961/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2961/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2961/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2961/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2961/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2961/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2961/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2961/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2961/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2961/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2961/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2961/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2961/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2961/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2961/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2961/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2961/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2961/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2961//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2961//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2961/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2961/dropped/">
              <span property="name">Dropped</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2961/dropped/introduction_to_the_vm_portal/">
              <span property="name">Introduction to the VM Portal</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2961/dropped/introduction_to_the_vm_portal/common/">
              <span property="name">Common</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2961/dropped/introduction_to_the_vm_portal/common/she/">
              <span property="name">She</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div class="sect1">
<h2 id="Maintaining_the_Self-Hosted_Engine">Maintaining the Self-hosted engine</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Self-hosted_engine_maintenance_modes_explained_SHE_admin">Self-hosted engine maintenance modes explained</h3>
<div class="paragraph">
<p>The maintenance modes enable you to start, stop, and modify the {engine-name} virtual machine without interference from the high-availability agents, and to restart and modify the self-hosted engine nodes in the environment without interfering with the {engine-name}.</p>
</div>
<div class="paragraph">
<p>There are three maintenance modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>global</code> - All high-availability agents in the cluster are disabled from monitoring the state of the {engine-name} virtual machine. The global maintenance mode must be applied for any setup or upgrade operations that require the <code>ovirt-engine</code> service to be stopped, such as upgrading to a later version of {virt-product-fullname}.</p>
</li>
<li>
<p><code>local</code> - The high-availability agent on the node issuing the command is disabled from monitoring the state of the {engine-name} virtual machine. The node is exempt from hosting the {engine-name} virtual machine while in local maintenance mode; if hosting the {engine-name} virtual machine when placed into this mode, the {engine-name} will migrate to another node, provided there is one available. The local maintenance mode is recommended when applying system changes or updates to a self-hosted engine node.</p>
</li>
<li>
<p><code>none</code> - Disables maintenance mode, ensuring that the high-availability agents are operating.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="local-maintenance-mode_SHE_admin">Setting local maintenance mode</h3>
<div class="paragraph">
<p>Enabling local maintenance mode stops the high-availability agent on a single self-hosted engine node.</p>
</div>
<div class="olist arabic">
<div class="title">Setting the local maintenance mode from the Administration Portal</div>
<ol class="arabic">
<li>
<p>Put a self-hosted engine node into local maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select a self-hosted engine node.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>. Local maintenance mode is automatically triggered for that node.</p>
</li>
</ol>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the self-hosted engine node.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Setting the local maintenance mode from the command line</div>
<ol class="arabic">
<li>
<p>Log in to a self-hosted engine node and put it into local maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=local</pre>
</div>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="global-maintenance-mode_SHE_admin">Setting global maintenance mode</h3>
<div class="paragraph">
<p>Enabling global maintenance mode stops the high-availability agents on all self-hosted engine nodes in the cluster.</p>
</div>
<div class="olist arabic">
<div class="title">Setting the global maintenance mode from the Administration Portal</div>
<ol class="arabic">
<li>
<p>Put all of the self-hosted engine nodes into global maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select any self-hosted engine node.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions" title="More Actions menu"></span>), then click <strong>Enable Global HA Maintenance</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select any self-hosted engine node.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions" title="More Actions menu"></span>), then click <strong>Disable Global HA Maintenance</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Setting the global maintenance mode from the command line</div>
<ol class="arabic">
<li>
<p>Log in to any self-hosted engine node and put it into global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Administering_the_Manager_Virtual_Machine">Administering the {engine-name} Virtual Machine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>hosted-engine</code> utility provides many commands to help administer the {engine-name} virtual machine. You can run <code>hosted-engine</code> on any self-hosted engine node. To see all available commands, run <code>hosted-engine --help</code>. For additional information on a specific command, run <code>hosted-engine --<em>command</em> --help</code>.</p>
</div>
<div class="sect2">
<h3 id="updating-the-self-hosted-engine-configuration">Updating the Self-Hosted Engine Configuration</h3>
<div class="paragraph">
<p>To update the self-hosted engine configuration, use the <code>hosted-engine --set-shared-config</code> command. This command updates the self-hosted engine configuration on the shared storage domain after the initial deployment.</p>
</div>
<div class="paragraph">
<p>To see the current configuration values, use the <code>hosted-engine --get-shared-config</code> command.</p>
</div>
<div class="paragraph">
<p>To see a list of all available configuration keys and their corresponding types, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-shared-config <em>key</em> --type=<em>type</em> --help</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>type</em></code> is one of the following:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>he_local</code>
</td>
<td class="hdlist2">
<p>Sets values in the local instance of <code class="filename">etc/ovirt-hosted-engine/hosted-engine.conf</code> on the local host, so only that host uses the new values. To enable the new value, restart the ovirt-ha-agent and ovirt-ha-broker services.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>he_shared</code>
</td>
<td class="hdlist2">
<p>Sets values in <code class="filename">etc/ovirt-hosted-engine/hosted-engine.conf</code> on shared storage, so all hosts that are deployed after a configuration change use these values. To enable the new value on a host, redeploy that host.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ha</code>
</td>
<td class="hdlist2">
<p>Sets values in <code class="filename">/var/lib/ovirt-hosted-engine-ha/ha.conf</code> on local storage. New settings take effect immediately.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>broker</code>
</td>
<td class="hdlist2">
<p>Sets values in <code class="filename">/var/lib/ovirt-hosted-engine-ha/broker.conf</code> on local storage. Restart the ovirt-ha-broker service to enable new settings.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-email-notifications">Configuring Email Notifications</h3>
<div class="paragraph">
<p>You can configure email notifications using SMTP for any HA state transitions on the self-hosted engine nodes. The keys that can be updated include: <code>smtp-server</code>, <code>smtp-port</code>, <code>source-email</code>, <code>destination-emails</code>, and <code>state_transition</code>.</p>
</div>
<div class="paragraph">
<p><strong>To configure email notifications:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On a self-hosted engine node, set the <code>smtp-server</code> key to the desired SMTP server address:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-shared-config smtp-server <em>smtp.example.com</em> --type=broker</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To verify that the self-hosted engine configuration file has been updated, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --get-shared-config smtp-server --type=broker
broker : smtp.example.com, type : broker</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check that the default SMTP port (port 25) has been configured:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --get-shared-config smtp-port --type=broker
broker : 25, type : broker</pre>
</div>
</div>
</li>
<li>
<p>Specify an email address you want the SMTP server to use to send out email notifications. Only one address can be specified.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-shared-config source-email <em>source@example.com</em> --type=broker</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the destination email address to receive email notifications. To specify multiple email addresses, separate each address by a comma.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-shared-config destination-emails <em>destination1@example.com</em>,<em>destination2@example.com</em> --type=broker</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To verify that SMTP has been properly configured for your self-hosted engine environment, change the HA state on a self-hosted engine node and check if email notifications were sent. For example, you can change the HA state by placing HA agents into maintenance mode. See <a href="#Maintaining_the_Self-Hosted_Engine">Maintaining the Self-Hosted Engine</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_Memory_Slots_Reserved_for_the_SHE">Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the {engine-name} virtual machine shuts down or needs to be migrated, there must be enough memory on a self-hosted engine node for the {engine-name} virtual machine to restart on or migrate to it. This memory can be reserved on multiple self-hosted engine nodes by using a scheduling policy. The scheduling policy checks if enough memory to start the {engine-name} virtual machine will remain on the specified number of additional self-hosted engine nodes before starting or migrating any virtual machines. See <a href="{URL_virt_product_docs}{URL_format}administration_guide/index#Creating_a_Scheduling_Policy">Creating a Scheduling Policy</a> in the <em>Administration Guide</em> for more information about scheduling policies.</p>
</div>
<div class="paragraph">
<p>To add more self-hosted engine nodes to the {virt-product-fullname} {engine-name}, see <a href="#Adding_self-hosted_engine_nodes_to_the_Manager_SHE_admin">Adding self-hosted engine nodes to the {engine-name}</a>.</p>
</div>
<div class="paragraph">
<p><strong>Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> and select the cluster containing the self-hosted engine nodes.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click the <strong>Scheduling Policy</strong> tab.</p>
</li>
<li>
<p>Click <b class="button">+</b> and select <strong>HeSparesCount</strong>.</p>
</li>
<li>
<p>Enter the number of additional self-hosted engine nodes that will reserve enough free memory to start the {engine-name} virtual machine.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Adding_self-hosted_engine_nodes_to_the_Manager_SHE_admin">Adding Self-Hosted Engine Nodes to the {virt-product-fullname} {engine-name}</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add self-hosted engine nodes in the same way as a standard host, with an additional step to deploy the host as a self-hosted engine node. The shared storage domain is automatically detected and the node can be used as a failover host to host the {engine-name} virtual machine when required. You can also attach standard hosts to a self-hosted engine environment, but they cannot host the {engine-name} virtual machine. Have at least two self-hosted engine nodes to ensure the {engine-name} virtual machine is highly available. You can also add additional hosts using the REST API. See <a href="{URL_downstream_virt_product_docs}rest_api_guide/index#services-hosts">Hosts</a> in the <em>REST API Guide</em>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All self-hosted engine nodes must be in the same cluster.</p>
</li>
<li>
<p>If you are reusing a self-hosted engine node, remove its existing self-hosted engine configuration. See <a href="{URL_virt_product_docs}{URL_format}administration_guide/index#removing_a_host_from_a_self-hosted_engine_environment">Removing a Host from a Self-Hosted Engine Environment</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click <b class="button">New</b>.</p>
<div class="paragraph">
<p>For information on additional host settings, see <a href="{URL_virt_product_docs}{URL_format}administration_guide#sect-Explanation_of_Settings_and_Controls_in_the_New_Host_and_Edit_Host_Windows">Explanation of Settings and Controls in the New Host and Edit Host Windows</a> in the <em>Administration Guide</em>.</p>
</div>
</li>
<li>
<p>Use the drop-down list to select the <strong>Data Center</strong> and <strong>Host Cluster</strong> for the new host.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and the <strong>Address</strong> of the new host. The standard SSH port, port 22, is auto-filled in the <strong>SSH Port</strong> field.</p>
</li>
<li>
<p>Select an authentication method to use for the {engine-name} to access the host.</p>
<div class="ulist">
<ul>
<li>
<p>Enter the root user&#8217;s password to use password authentication.</p>
</li>
<li>
<p>Alternatively, copy the key displayed in the <strong>SSH PublicKey</strong> field to <strong>/root/.ssh/authorized_keys</strong> on the host to use public key authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, configure power management, where the host has a supported power management card. For information on power management configuration, see <a href="{URL_virt_product_docs}{URL_format}administration_guide#Host_Power_Management_settings_explained">Host Power Management Settings Explained</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab.</p>
</li>
<li>
<p>Select <strong>Deploy</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Reinstalling_an_Existing_Host_as_a_Self-Hosted_Engine_Node_SHE_admin">Reinstalling an Existing Host as a Self-Hosted Engine Node</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can convert an existing, standard host in a self-hosted engine environment to a self-hosted engine node capable of hosting the {engine-name} virtual machine.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, {org-fullname} strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab and select <strong>DEPLOY</strong> from the drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The host is reinstalled with self-hosted engine configuration, and is flagged with a crown icon in the Administration Portal.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Booting_a_Self-Hosted_Engine_in_Rescue_Mode_SHE_admin">Booting the {engine-name} Virtual Machine in Rescue Mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This topic describes how to boot the {engine-name} virtual machine into rescue mode when it does not start. For more information, see <a href="{URL_rhel_docs_legacy}html/system_administrators_guide/ch-working_with_the_grub_2_boot_loader#sec-Terminal_Menu_Editing_During_Boot">Booting to Rescue Mode</a> in the <em>{enterprise-linux} System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to one of the hosted-engine nodes:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">$ ssh root@<em>host_address</em></code></pre>
</div>
</div>
</li>
<li>
<p>Put the self-hosted engine in global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-maintenance --mode=global</code></pre>
</div>
</div>
</li>
<li>
<p>Check if there is already a running instance of the {engine-name} virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --vm-status</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a {engine-name} virtual machine instance is running, connect to its host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># ssh root@<em>host_address</em></code></pre>
</div>
</div>
</li>
<li>
<p>Shut down the virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --vm-shutdown</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the virtual machine does not shut down, execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --vm-poweroff</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the {engine-name} virtual machine in pause mode:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">hosted-engine --vm-start-paused</code></pre>
</div>
</div>
</li>
<li>
<p>Set a temporary VNC password:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">hosted-engine --add-console-password</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command outputs the necessary information you need to log in to the Manger virtual machine with VNC.</p>
</div>
</li>
<li>
<p>Log in to the {engine-name} virtual machine with VNC. The {engine-name} virtual machine is still paused, so it appears to be frozen.</p>
</li>
<li>
<p>Resume the {engine-name} virtual machine with the following command on its host:</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After running the following command, the boot loader menu appears. You need to enter into rescue mode before the boot loader proceeds with the normal boot process. Read the next step about entering into rescue mode before proceeding with this command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># /usr/bin/virsh -c qemu:///system?authfile=/etc/ovirt-hosted-engine/virsh_auth.conf resume HostedEngine</code></pre>
</div>
</div>
</li>
<li>
<p>Boot the {engine-name} virtual machine in rescue mode.</p>
</li>
<li>
<p>Disable global maintenance mode</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-maintenance --mode=none</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now run rescue tasks on the {engine-name} virtual machine.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Removing_a_Host_from_a_Self-Hosted_Engine_Environment">Removing a Host from a Self-Hosted Engine Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To remove a self-hosted engine node from your environment, place the node into maintenance mode, undeploy the node, and optionally remove it. The node can be managed as a regular host after the HA services have been stopped, and the self-hosted engine configuration files have been removed.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Host from a Self-Hosted Engine Environment</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the self-hosted engine node.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab and select <strong>UNDEPLOY</strong> from the drop-down list. This action stops the <code>ovirt-ha-agent</code> and <code>ovirt-ha-broker</code> services and removes the self-hosted engine configuration file.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Optionally, click <b class="button">Remove</b>. This opens the <strong>Remove Host(s)</strong> confirmation window.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Updating_a_self-hosted_engine_SHE_admin">Updating a Self-Hosted Engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To update a self-hosted engine from your current version to the latest version, you must place the environment in global maintenance mode and then follow the standard procedure for updating between minor versions.</p>
</div>
<h3 id="Enabling_Global_Maintenance_Mode_SHE_minor_updates" class="discrete">Enabling global maintenance mode</h3>
<div class="paragraph">
<p>You must place the self-hosted engine environment in global maintenance mode before performing any setup or upgrade tasks on the {engine-name} virtual machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to one of the self-hosted engine nodes and enable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-maintenance --mode=global</code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the environment is in global maintenance mode before proceeding:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --vm-status</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see a message indicating that the cluster is in global maintenance mode.</p>
</div>
</li>
</ol>
</div>
<h3 id="Updating_the_Red_Hat_Virtualization_Manager_SHE_minor_updates" class="discrete">Updating the {virt-product-fullname} {engine-name}</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the {engine-name} machine, check if updated packages are available:</p>
<div class="listingblock">
<div class="content">
<pre># engine-upgrade-check</pre>
</div>
</div>
</li>
<li>
<p>Update the setup packages:</p>
</li>
<li>
<p>Update the {virt-product-fullname} {engine-name} with the <code>engine-setup</code> script. The <code>engine-setup</code> script prompts you with some configuration questions, then stops the <code>ovirt-engine</code> service, downloads and installs the updated packages, backs up and updates the database, performs post-installation configuration, and starts the <code>ovirt-engine</code> service.</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution of setup completed successfully</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-setup</code> script is also used during the {virt-product-fullname} {engine-name} installation process, and it stores the configuration values supplied. During an update, the stored values are displayed when previewing the configuration, and might not be up to date if <code>engine-config</code> was used to update configuration after installation. For example, if <code>engine-config</code> was used to update <code>SANWipeAfterDelete</code> to <code>true</code> after installation, <code>engine-setup</code> will output "Default SAN wipe after delete: False" in the configuration preview. However, the updated values will not be overwritten by <code>engine-setup</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The update process might take some time. Do not stop the process before it completes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the base operating system and any optional packages installed on the {engine-name}:</p>
<div class="listingblock">
<div class="content">
<pre># yum update --nobest</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you encounter a required Ansible package conflict during the update, see <a href="https://access.redhat.com/solutions/5480561">Cannot perform yum update on my RHV manager (ansible conflict)</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable global maintenance mode</p>
</li>
<li>
<p>Reboot the machine to complete the update.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Related Information</div>
<p><a href="#Disabling_Global_Maintenance_Mode_SHE_minor_updates">Disabling global maintenance mode</a></p>
</div>
<h3 id="Disabling_Global_Maintenance_Mode_SHE_minor_updates" class="discrete">Disabling global maintenance mode</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the {engine-name} virtual machine and shut it down.</p>
</li>
<li>
<p>Log in to one of the self-hosted engine nodes
and disable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --set-maintenance --mode=none</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you exit global maintenance mode, ovirt-ha-agent starts the {engine-name} virtual machine, and then the {engine-name} automatically starts. It can take up to ten minutes for the {engine-name} to start.</p>
</div>
</li>
<li>
<p>Confirm that the environment is running:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --vm-status</code></pre>
</div>
</div>
<div class="paragraph">
<p>The listed information includes <strong>Engine Status</strong>. The value for <strong>Engine status</strong> should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"health": "good", "vm": "up", "detail": "Up"}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the virtual machine is still booting and the {engine-name} hasn&#8217;t started yet, the <strong>Engine status</strong> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"reason": "bad vm status", "health": "bad", "vm": "up", "detail": "Powering up"}</pre>
</div>
</div>
<div class="paragraph">
<p>If this happens, wait a few minutes and try again.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Changing_FQDN_of_RHVM_self-hosted_engine">Changing the FQDN of the {engine-name} in a Self-Hosted Engine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use the <code>ovirt-engine-rename</code> command to update records of the fully qualified domain name (FQDN) of the {engine-name}.</p>
</div>
<div class="paragraph">
<p>For details see <a href="#Renaming_the_Manager_with_the_Ovirt_Engine_Rename_Tool">Renaming the {engine-name} with the Ovirt Engine Rename Tool</a>.</p>
</div>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2961/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2961/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2961/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2961/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/dropped/introduction_to_the_vm_portal/common/she/chap-Administering_the_Self-Hosted_Engine.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/dropped/introduction_to_the_vm_portal/common/she/chap-Administering_the_Self-Hosted_Engine.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
