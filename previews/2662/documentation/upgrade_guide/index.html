<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Upgrade Guide | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Upgrade Guide" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2662/documentation/upgrade_guide/" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2662/documentation/upgrade_guide/" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Upgrade Guide" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2662/images/logo.svg"}},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Upgrade Guide","url":"https://ovirt.github.io/ovirt-site/previews/2662/documentation/upgrade_guide/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2662/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2662/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2662/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2662/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2662/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2662/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2662/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2662/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2662/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2662/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2662/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2662/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2662/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2662/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2662/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2662/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2662/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2662/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2662/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2662/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2662/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2662/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2662/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2662/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2662/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2662/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2662/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2662/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2662/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2662/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2662/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2662/download/'>Download</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2662/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2662/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2662/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2662//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2662//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2662/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2662/documentation/">
              <span property="name">Documentation</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Red_Hat_Virtualization_Upgrade_Overview">1. oVirt Upgrade Overview</a></li>
<li><a href="#upgrading-a-standalone-engine-local-database-environment">Upgrading a standalone Engine, local database environment</a>
<ul class="sectlevel1">
<li><a href="#Upgrading_from_4-2">2. Upgrading from oVirt 4.2 to 4.3</a>
<ul class="sectlevel2">
<li><a href="#Upgrade_Prerequisites_4-2_local_db">2.1. Prerequisites</a></li>
<li><a href="#Updating_the_Red_Hat_Virtualization_Manager_4-2_local_db">2.2. Updating the oVirt Engine</a></li>
<li><a href="#Upgrading_the_Manager_to_4-3_4-2_local_db">2.3. Upgrading the oVirt Engine from 4.2 to 4.3</a></li>
<li><a href="#Updating_all_hosts_in_a_cluster_4-2_local_db">2.4. Updating All Hosts in a Cluster</a></li>
<li><a href="#Changing_the_Cluster_Compatibility_Version_4-2_local_db">2.5. Changing the Cluster Compatibility Version</a></li>
<li><a href="#Changing_Virtual_Machine_Cluster_Compatibility_4-2_local_db">2.6. Changing Virtual Machine Cluster Compatibility</a></li>
<li><a href="#Changing_the_Data_Center_Compatibility_Version_4-2_local_db">2.7. Changing the Data Center Compatibility Version</a></li>
<li><a href="#Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-2_local_db">2.8. Replacing SHA-1 Certificates with SHA-256 Certificates</a></li>
</ul>
</li>
<li><a href="#Upgrading_from_4-3">3. Upgrading from oVirt 4.3 to 4.4</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<h1 id="upgrade-guide" class="discrete">Upgrade Guide</h1>
</div>
</div>
<div class="sect1">
<h2 id="Red_Hat_Virtualization_Upgrade_Overview">1. oVirt Upgrade Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide explains how to upgrade the following environments to oVirt 4.3 or 4.4 :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Standalone manager, local database</strong>: Both the Data Warehouse database and the Engine database are installed on the Engine.</p>
</li>
<li>
<p><strong>Standalone manager, remote database</strong>: Either the Data Warehouse database or the Engine database, or both, are on a separate machine.</p>
</li>
<li>
<p><strong>Self-hosted engine, local database</strong>: Both the Data Warehouse database and the Engine database are installed on the Engine.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Plan any necessary downtime in advance. After you update the clusters' compatibility versions during the upgrade, a new hardware configuration is automatically applied to each virtual machine once it reboots. You must reboot any running or suspended VMs as soon as possible to apply the configuration changes.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Select the appropriate instructions for your environment from the following table. If your Engine and host versions differ (if you have previously upgraded the Engine but not the hosts), follow the instructions that match the Engine&#8217;s version.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported Upgrade Paths</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Current Engine version</th>
<th class="tableblock halign-left valign-top">Target Engine version</th>
<th class="tableblock halign-left valign-top">Relevant section</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.3</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Local database environment:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manual upgrade: <a href="#Upgrading_from_4-2">Upgrading from oVirt 4.2 to 4.3</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Remote database environment:</strong> <a href="#Remote_Upgrading_from_4-2">[Remote_Upgrading_from_4-2]</a></p>
</div>
<div class="paragraph">
<p><strong>Self-hosted engine, local database environment:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manual upgrade: <a href="#SHE_Upgrading_from_4-2">[SHE_Upgrading_from_4-2]</a></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.4</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Local database environment:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manual upgrade: <a href="#Upgrading_from_4-3">Upgrading from oVirt 4.3 to 4.4</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Remote database environment:</strong> <a href="#Remote_Upgrading_from_4-3">[Remote_Upgrading_from_4-3]</a></p>
</div>
<div class="paragraph">
<p><strong>Self-hosted engine, local database environment:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manual upgrade: <a href="#SHE_Upgrading_from_4-3">[SHE_Upgrading_from_4-3]</a></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="upgrading-a-standalone-engine-local-database-environment" class="sect0">Upgrading a standalone Engine, local database environment</h1>
<div class="sect1">
<h2 id="Upgrading_from_4-2">2. Upgrading from oVirt 4.2 to 4.3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upgrading your environment from 4.2 to 4.3 involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Upgrade_Prerequisites_4-2_local_db">Make sure you meet the prerequisites, including enabling the correct repositories</a></p>
</li>
<li>
<p><a href="#Updating_the_Red_Hat_Virtualization_Manager_4-2_local_db">Update the 4.2 Engine to the latest version of 4.2</a></p>
</li>
<li>
<p><a href="#Upgrading_the_Manager_to_4-3_4-2_local_db">Upgrade the Engine from 4.2 to 4.3</a></p>
</li>
<li>
<p><a href="#Updating_all_hosts_in_a_cluster_4-2_local_db">Update the hosts</a></p>
</li>
<li>
<p><a href="#Changing_the_Cluster_Compatibility_Version_4-2_local_db">Update the compatibility version of the clusters</a></p>
</li>
<li>
<p><a href="#Changing_Virtual_Machine_Cluster_Compatibility_4-2_local_db">Reboot any running or suspended virtual machines to update their configuration</a></p>
</li>
<li>
<p><a href="#Changing_the_Data_Center_Compatibility_Version_4-2_local_db">Update the compatibility version of the data centers</a></p>
</li>
<li>
<p>If you previously upgraded to 4.2 without replacing SHA-1 certificates with SHA-256 certificates, <a href="#Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-2_local_db">you must replace the certificates now</a>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Upgrade_Prerequisites_4-2_local_db">2.1. Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Plan for any necessary virtual machine downtime. After you update the clusters' compatibility versions during the upgrade, a new hardware configuration is automatically applied to each virtual machine once it reboots. You must reboot any running or suspended virtual machines as soon as possible to apply the configuration changes.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure your environment meets the requirements for oVirt 4.4. For a complete list of prerequisites, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#RHV_requirements"><em>Planning and Prerequisites Guide</em></a>.</p>
</li>
<li>
<p>When upgrading oVirt Engine, it is recommended that you use one of the existing hosts. If you decide to use a new host, you must assign a unique name to the new host and then add it to the existing cluster before you begin the upgrade procedure.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Updating_the_Red_Hat_Virtualization_Manager_4-2_local_db">2.2. Updating the oVirt Engine</h3>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The RPM package <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">ovirt-release44.rpm</a> is installed. This package includes the necessary repositories.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the Engine machine, check if updated packages are available:</p>
<div class="listingblock">
<div class="content">
<pre># engine-upgrade-check</pre>
</div>
</div>
</li>
<li>
<p>Update the setup packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update ovirt\*setup\*</pre>
</div>
</div>
</li>
<li>
<p>Update the oVirt Engine with the <code>engine-setup</code> script. The <code>engine-setup</code> script prompts you with some configuration questions, then stops the <code>ovirt-engine</code> service, downloads and installs the updated packages, backs up and updates the database, performs post-installation configuration, and starts the <code>ovirt-engine</code> service.</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution of setup completed successfully</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-setup</code> script is also used during the oVirt Engine installation process, and it stores the configuration values supplied. During an update, the stored values are displayed when previewing the configuration, and might not be up to date if <code>engine-config</code> was used to update configuration after installation. For example, if <code>engine-config</code> was used to update <code>SANWipeAfterDelete</code> to <code>true</code> after installation, <code>engine-setup</code> will output "Default SAN wipe after delete: False" in the configuration preview. However, the updated values will not be overwritten by <code>engine-setup</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The update process might take some time. Do not stop the process before it completes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the base operating system and any optional packages installed on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you encounter a required Ansible package conflict during the update, see <a href="https://access.redhat.com/solutions/5480561">Cannot perform yum update on my RHV manager (ansible conflict)</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated, reboot the machine to complete the update.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Upgrading_the_Manager_to_4-3_4-2_local_db">2.3. Upgrading the oVirt Engine from 4.2 to 4.3</h3>
<div class="paragraph">
<p>You need to be logged into the machine that you are upgrading.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the upgrade fails, the <code>engine-setup</code> command attempts to restore your oVirt Engine installation to its previous state. For this reason, do not remove the previous version&#8217;s repositories until after the upgrade is complete. If the upgrade fails, the <code>engine-setup</code> script explains how to restore your installation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enable the oVirt 4.3 repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm</a></pre>
</div>
</div>
<div class="paragraph">
<p>All other repositories remain the same across oVirt releases.</p>
</div>
</li>
<li>
<p>Update the setup packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update ovirt\*setup\*</pre>
</div>
</div>
</li>
<li>
<p>Run <code>engine-setup</code> and follow the prompts to upgrade
the oVirt Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Execution of setup completed successfully</pre>
</div>
</div>
</li>
<li>
<p>Update the base operating system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you encounter a required Ansible package conflict during the update, see <a href="https://access.redhat.com/solutions/5480561">Cannot perform yum update on my RHV manager (ansible conflict)</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated, reboot the machine to complete the upgrade.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Engine is now upgraded to version 4.3.</p>
</div>
<div class="paragraph">
<p>You can now update the hosts.</p>
</div>
</div>
<div class="sect2">
<h3 id="Updating_all_hosts_in_a_cluster_4-2_local_db">2.4. Updating All Hosts in a Cluster</h3>
<div class="paragraph">
<p>You can update all hosts in a cluster instead of updating hosts individually. This is particularly useful during upgrades to new versions of oVirt. See <a href="https://github.com/oVirt/ovirt-ansible-collection/blob/master/roles/cluster_upgrade/README.md" class="bare">https://github.com/oVirt/ovirt-ansible-collection/blob/master/roles/cluster_upgrade/README.md</a> for more information about the Ansible role used to automate the updates.</p>
</div>
<div class="paragraph">
<p>Update one cluster at a time.</p>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines are shut down during the update, unless you choose to skip that host instead.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> and select the cluster. The <strong>Upgrade status</strong> column shows if an upgrade is available for any hosts in the cluster.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
<li>
<p>Select the hosts to update, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Configure the options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Stop Pinned VMs</strong> shuts down any virtual machines that are pinned to hosts in the cluster, and is selected by default. You can clear this check box to skip updating those hosts so that the pinned virtual machines stay running, such as when a pinned virtual machine is running important services or processes and you do not want it to shut down at an unknown time during the update.</p>
</li>
<li>
<p><strong>Upgrade Timeout (Minutes)</strong> sets the time to wait for an individual host to be updated before the cluster upgrade fails with a timeout. The default is <code>60</code>. You can increase it for large clusters where 60 minutes might not be enough, or reduce it for small clusters where the hosts update quickly.</p>
</li>
<li>
<p><strong>Check Upgrade</strong> checks each host for available updates before running the upgrade process. It is not selected by default, but you can select it if you need to ensure that recent updates are included, such as when you have configured the Engine to check for host updates less frequently than the default.</p>
</li>
<li>
<p><strong>Reboot After Upgrade</strong> reboots each host after it is updated, and is selected by default. You can clear this check box to speed up the process if you are sure that there are no pending updates that require a host reboot.</p>
</li>
<li>
<p><strong>Use Maintenance Policy</strong> sets the cluster&#8217;s scheduling policy to <a href="https://ovirt.org/documentation/administration_guide/index#Cluster_Scheduling_Policy_Settings"><code>cluster_maintenance</code></a> during the update. It is selected by default, so activity is limited and virtual machines cannot start unless they are highly available. You can clear this check box if you have a custom scheduling policy that you want to keep using during the update, but this could have unknown consequences. Ensure your custom policy is compatible with cluster upgrade activity before disabling this option.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Review the summary of the hosts and virtual machines that will be affected.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can track the progress of host updates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> view, the <strong>Upgrade Status</strong> column shows <strong>Upgrade in progress</strong>.</p>
</li>
<li>
<p>in the <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> view</p>
</li>
<li>
<p>in the <strong>Events</strong> section of the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon"></span>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can track the progress of individual virtual machine migrations in the <strong>Status</strong> column of the <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> view. In large environments, you may need to filter the results to show a particular group of virtual machines.</p>
</div>
</div>
<div class="sect2">
<h3 id="Changing_the_Cluster_Compatibility_Version_4-2_local_db">2.5. Changing the Cluster Compatibility Version</h3>
<div class="paragraph">
<p>oVirt clusters have a compatibility version. The cluster compatibility version indicates the features of oVirt supported by all of the hosts in the cluster. The cluster compatibility is set according to the version of the least capable host operating system in the cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>To change the cluster compatibility level, you must first update all the hosts in your cluster to a level that supports your desired compatibility level. Check if there is an icon next to the host indicating an update is available.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>Virtio NICs are enumerated as a different device after upgrading the cluster compatibility level to 4.6. Therefore, the NICs might need to be reconfigured. oVirt recommends that you test the virtual machines before you upgrade the cluster by setting the cluster compatibility level to 4.6 on the virtual machine and verifying the network connection.</p>
<div class="paragraph">
<p>If the network connection for the virtual machine fails, configure the virtual machine with a custom emulated machine that matches the current emulated machine, for example pc-q35-rhel8.3.0 for 4.5 compatibility version, before upgrading the cluster.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Select the cluster to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>On the <strong>General</strong> tab, change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Cluster Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An error message might warn that some virtual machines and templates are incorrectly configured. To fix this error, edit each virtual machine manually. The <strong>Edit Virtual Machine</strong> window provides additional validations and warnings that show what to correct. Sometimes the issue is automatically corrected and the virtual machine&#8217;s configuration just needs to be saved again. After editing each virtual machine, you will be able to change the cluster compatibility version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Changing_Virtual_Machine_Cluster_Compatibility_4-2_local_db">2.6. Changing Virtual Machine Cluster Compatibility</h3>
<div class="paragraph">
<p>After updating a cluster&#8217;s compatibility version, you must update the cluster compatibility version of all running or suspended virtual machines by rebooting them from the Administration Portal, or using the REST API, instead of from within the guest operating system. Virtual machines that require a reboot are marked with the pending changes icon (<span class="image"><img src="common/images/pendingchanges.png" alt="pendingchanges"></span>).</p>
</div>
<div class="paragraph">
<p>Although you can wait to reboot the virtual machines at a convenient time, rebooting immediately is highly recommended so that the virtual machines use the latest configuration. Any virtual machine that has not been rebooted runs with the previous configuration, and subsequent configuration changes made to the virtual machine might overwrite its pending cluster compatibility changes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Check which virtual machines require a reboot. In the <strong>Vms:</strong> search bar, enter the following query:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">next_run_config_exists=True</pre>
</div>
</div>
<div class="paragraph">
<p>The search results show all virtual machines with pending changes.</p>
</div>
</li>
<li>
<p>Select each virtual machine and click <strong>Restart</strong>. Alternatively, if necessary you can reboot a virtual machine from within the virtual machine itself.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the virtual machine starts, the new compatibility version is automatically applied.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot change the cluster compatibility version of a virtual machine snapshot that is in preview. You must first commit or undo the preview.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Changing_the_Data_Center_Compatibility_Version_4-2_local_db">2.7. Changing the Data Center Compatibility Version</h3>
<div class="paragraph">
<p>oVirt data centers have a compatibility version. The compatibility version indicates the version of oVirt with which the data center is intended to be compatible. All clusters in the data center must support the desired compatibility level.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>To change the data center compatibility level, you must first update the compatibility version of all clusters and virtual machines in the data center.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Select the data center to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Data Center Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you previously upgraded to 4.2 without replacing SHA-1 certificates with SHA-256 certificates, you must do so now.</p>
</div>
</div>
<div class="sect2">
<h3 id="Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-2_local_db">2.8. Replacing SHA-1 Certificates with SHA-256 Certificates</h3>
<div class="paragraph">
<p>oVirt 4.4 uses SHA-256 signatures, which provide a more secure way to sign SSL certificates than SHA-1. Newly installed systems do not require any special steps to enable oVirt&#8217;s public key infrastructure (PKI) to use SHA-256 signatures.</p>
</div>
<h4 id="Preventing_Warning_Messages_from_Appearing_in_the_Browser_4-2_local_db" class="discrete">Preventing Warning Messages from Appearing in the Browser</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Engine machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf."$(date +"%Y%m%d%H%M%S")"
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
</li>
<li>
<p>Define the certificate that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre># names="apache"</pre>
</div>
</div>
</li>
<li>
<p>On the Engine, save a backup of the <code>/etc/ovirt-engine/engine.conf.d</code> and <code>/etc/pki/ovirt-engine</code> directories, and re-sign the certificates:</p>
<div class="listingblock">
<div class="content">
<pre># . /etc/ovirt-engine/engine.conf.d/10-setup-protocols.conf
# for name in $names; do
    subject="$(
       openssl x509 \
           -in /etc/pki/ovirt-engine/certs/apache.cer \
           -text | \
               sed \
                   -n \
                       's; *DirName:\(.*\)/CN=.*;\1;p'
   )"
   /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
        --name="${name}" \
        --password=mypass \
        --subject="${subject}" \
        --san=DNS:"${ENGINE_FQDN}" \
        --keep-key
done</pre>
</div>
</div>
</li>
<li>
<p>Restart the <strong>httpd</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
</ol>
</div>
<h4 id="Replacing_All_Signed_Certificates_with_SHA-256_4-2_local_db" class="discrete">Replacing All Signed Certificates with SHA-256</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Engine machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf."$(date +"%Y%m%d%H%M%S")"
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
</li>
<li>
<p>Re-sign the CA certificate by backing it up and creating a new certificate in <strong>ca.pem.new</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/private/ca.pem /etc/pki/ovirt-engine/private/ca.pem."$(date +"%Y%m%d%H%M%S")"
# openssl x509 -signkey /etc/pki/ovirt-engine/private/ca.pem -in /etc/pki/ovirt-engine/ca.pem -out /etc/pki/ovirt-engine/ca.pem.new -days 3650 -sha256</pre>
</div>
</div>
</li>
<li>
<p>Replace the existing certificate with the new certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/pki/ovirt-engine/ca.pem.new /etc/pki/ovirt-engine/ca.pem</pre>
</div>
</div>
</li>
<li>
<p>Define the certificates that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># names="engine apache websocket-proxy jboss imageio-proxy"</pre>
</div>
</div>
<div class="paragraph">
<p>If you replaced the oVirt Engine SSL Certificate after the upgrade, run the following instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># names="engine websocket-proxy jboss imageio-proxy"</pre>
</div>
</div>
<div class="paragraph">
<p>For more details see <a href="https://ovirt.org/documentation/administration_guide/index#Replacing_the_Manager_CA_Certificate">Replacing the oVirt Engine CA Certificate</a> in the <em>Administration Guide</em>.</p>
</div>
</li>
<li>
<p>On the Engine, save a backup of the <code>/etc/ovirt-engine/engine.conf.d</code> and <code>/etc/pki/ovirt-engine</code> directories, and re-sign the certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># . /etc/ovirt-engine/engine.conf.d/10-setup-protocols.conf
# for name in $names; do
    subject="$(
        openssl \
            x509 \
            -in /etc/pki/ovirt-engine/certs/"${name}".cer \
            -noout \
            -subject \
        | sed \
            's;subject= \(.*\);\1;' \
    )"
   /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
        --name="${name}" \
        --password=mypass \
        --subject="${subject}" \
        --san=DNS:"${ENGINE_FQDN}" \
        --keep-key
done</pre>
</div>
</div>
</li>
<li>
<p>Restart the following services:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd
# systemctl restart ovirt-engine
# systemctl restart ovirt-websocket-proxy
# systemctl restart ovirt-imageio</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
<li>
<p>Enroll the certificates on the hosts. Repeat the following procedure for each host.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Select the host and click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Once the host is in maintenance mode, click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Enroll Certificate</b></span>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Upgrading_from_4-3">3. Upgrading from oVirt 4.3 to 4.4</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upgrading your environment from 4.3 to 4.4 involves the following steps:</p>
</div>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2662/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2662/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2662/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2662/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2021 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/documentation/upgrade_guide/&amp;template=issue_template_documentation.md' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/documentation/upgrade_guide/index.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
