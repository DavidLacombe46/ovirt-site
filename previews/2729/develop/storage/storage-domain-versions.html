<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Storage Domain Versions | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Storage Domain Versions" />
<meta name="author" content="Federico Simoncelli" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2729/develop/storage/storage-domain-versions.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2729/develop/storage/storage-domain-versions.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Storage Domain Versions" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Federico Simoncelli" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Federico Simoncelli"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2729/images/logo.svg"},"name":"Federico Simoncelli"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Storage Domain Versions","url":"https://ovirt.github.io/ovirt-site/previews/2729/develop/storage/storage-domain-versions.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2729/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2729/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2729/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2729/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2729/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2729/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2729/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2729/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2729/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2729/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2729/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2729/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2729/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2729/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2729/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2729/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2729/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2729/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2729/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2729/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2729/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2729/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2729/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2729/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2729/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2729/develop/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/2cd558daf047b198cf2152940ec6a812?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/2cd558daf047b198cf2152940ec6a812?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Federico Simoncelli</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/fdf1234a96717595a057d4edb7258da2?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/fdf1234a96717595a057d4edb7258da2?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Saggi Mizrahi</span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>This developer documentation is <strong>outdated</strong>, but provides historical context.<br><br>It is <strong>not</strong> user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2729/documentation/'>Documentation is available here.</a></div>

<!-- TODO: Content review -->

<h1 id="storage-domain-version-0">Storage Domain Version 0</h1>

<h1 id="storage-domain-version-2">Storage Domain Version 2</h1>

<h1 id="storage-domain-version-3">Storage Domain Version 3</h1>

<p>The storage domain version 3 has been introduced in VDSM on the 30th of January 2012 with the commit 8665716c: Use SANLock for the SPM resource [1]. The new format has been introduced to overcome some of the limitations present in the previous formats (with regard to live snapshots, live merges and internationalization) and mainly to introduce the use of SANLock [2].</p>

<ul>
  <li><strong>Supported Domain Types:</strong> Block (iSCSI, FCP) and File (NFS, local) domains</li>
  <li><strong>Supported Domain Classes:</strong> Data, Export</li>
</ul>

<h2 id="changes">Changes</h2>

<h3 id="vdsm-and-format">VDSM and Format</h3>

<ul>
  <li>Uses SANLock to acquire the SPM resource [3]</li>
  <li>Uses SANLock to acquire the volume resources (virtualization subsystem, libvirt) [4]</li>
  <li>In block domains the permissions of the LVs in the metadata are always RW (to allow live snapshots and live merges)</li>
  <li>Unicode[5] support in the name and description of:
    <ul>
      <li>Storage Pools</li>
      <li>Storage Domains</li>
      <li>Disks and NICs</li>
      <li>Virtual Machines</li>
    </ul>
  </li>
  <li>New mailbox format (in progress)</li>
</ul>

<h3 id="engine-and-gui">Engine and GUI</h3>

<ul>
  <li>Display the Storage Domain Version (already present in the “Storage” tab)</li>
  <li>Support the creation of Storage Domain V3</li>
  <li>Accept unicode strings for the descriptions (only V3)</li>
  <li>Block the import of VM containing unicode to V2 domains</li>
  <li>Prevent moving Storage Domain Version V3 to 3.0 Data Centers</li>
</ul>

<h2 id="required-actions-on-upgrade">Required Actions On Upgrade</h2>

<h3 id="vdsm">VDSM</h3>

<ul>
  <li>Initialize the resources for all the volumes in the domain</li>
  <li>Set all the LVs to RW</li>
  <li>Check that the volume SIZE in the metadata is consistent with the block size (RAW) or with the qcow2 virtual size (COW) <a href="https://bugzilla.redhat.com/show_bug.cgi?id=811880">BZ811880</a>, <a href="https://bugzilla.redhat.com/show_bug.cgi?id=611183">BZ611183</a>, <a href="https://bugzilla.redhat.com/show_bug.cgi?id=706014">BZ706014</a></li>
</ul>

<h3 id="engine-and-gui-1">Engine and GUI</h3>

<h2 id="rest-api">REST API</h2>

<p>The operation is driven by pool compatibility change. So there is no need for a new REST API.</p>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>All nodes in the cluster must have 5a0b2c9 “Do not lock the image when preparing the VM path” (vdsm &gt;= 4.9.4) to avoid the LVM mda corruption</li>
</ul>

<h2 id="export-domains">Export Domains</h2>

<p>Export domains cannot be upgraded; they must be created in the version 3 format (and previous versions of VDSM won’t be able to attach it to a V1/V2 pool).</p>

<h2 id="upgrade">Upgrade</h2>

<p>At the moment it is planned to support an automatic upgrade to version 3 from the previous versions.</p>

<p><img src="/ovirt-site/previews/2729/images/wiki/DomainUpgrade1.png" alt="" /></p>

<h2 id="references">References</h2>

<references>
` `[6]

</references>

<p>[1]</p>

<p>[2] <a href="https://fedorahosted.org/sanlock">https://fedorahosted.org/sanlock</a></p>

<p>[3]</p>

<p>[4] <a href="http://gerrit.ovirt.org/1253">http://gerrit.ovirt.org/1253</a></p>

<p>[5] <a href="http://gerrit.ovirt.org/637">http://gerrit.ovirt.org/637</a></p>

<p>[6] <a href="http://gerrit.ovirt.org/726"><code class="language-plaintext highlighter-rouge">http://gerrit.ovirt.org/726</code></a></p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2729/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2729/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2729/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2729/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/storage/storage-domain-versions.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/storage/storage-domain-versions.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
