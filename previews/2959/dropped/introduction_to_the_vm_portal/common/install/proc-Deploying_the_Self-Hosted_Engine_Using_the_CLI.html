<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Deploying the self-hosted engine using the command line | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Deploying the self-hosted engine using the command line" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/install/proc-Deploying_the_Self-Hosted_Engine_Using_the_CLI.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/install/proc-Deploying_the_Self-Hosted_Engine_Using_the_CLI.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Deploying the self-hosted engine using the command line" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Deploying the self-hosted engine using the command line","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2959/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/install/proc-Deploying_the_Self-Hosted_Engine_Using_the_CLI.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2959/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2959/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2959/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2959/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2959/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2959/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2959/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2959/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/">
              <span property="name">Dropped</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/">
              <span property="name">Introduction to the VM Portal</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/">
              <span property="name">Common</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/install/">
              <span property="name">Install</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div class="paragraph">
<p>You can deploy a self-hosted engine from the command line. After installing the setup package, you run the command <code>hosted-engine --deploy</code>, and a script collects the details of your environment and uses them to configure the host and the {engine-name}.</p>
</div>
<div class="paragraph">
<p>You can customize the {engine-name} virtual machine during deployment, either manually, by pausing the deployment, or using automation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting the variable <code>he_pause_host</code> to <code>true</code> pauses deployment after installing the {engine-name} and adding the deployment host to the {engine-name}.</p>
</li>
<li>
<p>Setting the variable <code>he_pause_before_engine_setup</code> to <code>true</code> pauses the deployment before installing the {engine-name} and before restoring the {engine-name} when using <code>he_restore_from_file</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the <code>he_pause_host</code> or <code>he_pause_before_engine_setup</code> variables are set to true a lock file is created at <code>/tmp</code> with the suffix <code>_he_setup_lock</code> on the deployment host. You can then manually customize the virtual machine as needed. The deployment continues after you delete the lock file, or after 24 hours, whichever comes first.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Adding an Ansible playbook to any of the following directories on the deployment host automatically runs the playbook. Add the playbook under one of the following directories under <code>/usr/share/ansible/collections/ansible_collections/redhat/rhv/roles/hosted_engine_setup/hooks/</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>enginevm_before_engine_setup</code></p>
</li>
<li>
<p><code>enginevm_after_engine_setup</code></p>
</li>
<li>
<p><code>after_add_host</code></p>
</li>
<li>
<p><code>after_setup</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>FQDNs prepared for your {engine-name} and the host. Forward and reverse lookup records must both be set in the DNS.</p>
</li>
<li>
<p>When using a block storage domain, either FCP or iSCSI, a single target LUN is the only supported setup for a self-hosted engine.</p>
</li>
<li>
<p>Optional: If you want to customize the {engine-name} virtual machine during deployment using automation, an Ansible playbook must be added. See <a href="#customizing_engine_vm_during_deployment_auto_SHE_cli_deploy">Customizing the Engine virtual machine using automation during deployment</a>.</p>
</li>
<li>
<p>The self-hosted engine setup script requires ssh public key access using 2048-bit RSA keys from the engine virtual machine to the root account of its bare metal host. In <code>/etc/ssh/sshd_config</code>, these values must be set as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>PubkeyAcceptedKeyTypes</code> must allow 2048-bit RSA keys or stronger.</p>
<div class="paragraph">
<p>By default, this setting uses system-wide crypto policies. For more information, see the manual page <code>crypto-policies(7)</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>{hypervisor-shortname} hosts that are registered with the {engine-name} in versions earlier than 4.4.5.5 require RSA 2048 for backward compatibility until all the keys are migrated.</p>
</div>
<div class="paragraph">
<p>{hypervisor-shortname} hosts registered for 4.4.5.5 and later use the strongest algorithm that is supported by both the {engine-name} and {hypervisor-shortname}. The <code>PubkeyAcceptedKeyTypes</code> setting helps determine which algorithm is used.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>PermitRoolLogin</code> is set to <code>without-password</code> or <code>yes</code></p>
</li>
<li>
<p><code>PubkeyAuthentication</code> is set to <code>yes</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the deployment tool:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install ovirt-hosted-engine-setup</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>tmux</code> window manager to run the script to avoid losing the session in case of network or terminal disruption.</p>
<div class="paragraph">
<p>Install and run <code>tmux</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf -y install tmux
# tmux</pre>
</div>
</div>
</li>
<li>
<p>Start the deployment script:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, to pause the deployment after adding the deployment host to the {engine-name}, use the command line option <code class="command">--ansible-extra-vars=he_pause_host=true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --deploy --ansible-extra-vars=he_pause_host=true</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To escape the script at any time, use the <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>D</kbd></span> keyboard combination to abort deployment. In the event of session timeout or connection disruption, run <code>tmux attach</code> to recover the deployment session.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When prompted, enter <strong>Yes</strong> to begin the deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Continuing will configure this host for serving as hypervisor and will create a local VM with a running engine.
The locally running engine will be used to configure a new storage domain and create a VM there.
At the end the disk of the local VM will be moved to the shared storage.
Are you sure you want to continue? (Yes, No)[Yes]:</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the network. Check that the gateway shown is correct and press <kbd>Enter</kbd>. Enter a pingable address on the same subnet so the script can check the host&#8217;s connectivity.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please indicate a pingable gateway IP address [X.X.X.X]:</code></pre>
</div>
</div>
</li>
<li>
<p>The script detects possible NICs to use as a management bridge for the environment. Enter one of them or press <kbd>Enter</kbd> to accept the default.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please indicate a nic to set ovirtmgmt bridge on: (ens1, ens0) [ens1]:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify how to check network connectivity. The default is <code>dns</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify which way the network connectivity should be checked (ping, dns, tcp, none) [dns]:</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>ping</strong></code></dt>
<dd>
<p>Attempts to ping the gateway.</p>
</dd>
<dt class="hdlist1"><code><strong>dns</strong></code></dt>
<dd>
<p>Checks the connection to the DNS server.</p>
</dd>
<dt class="hdlist1"><code><strong>tcp</strong></code></dt>
<dd>
<p>Creates a TCP connection to a host and port combination. You need to specify a destination IP address and port. Once the connection is successfully created, the network is considered to be alive. Ensure that the given host is able to accept incoming TCP connections on the given port.</p>
</dd>
<dt class="hdlist1"><code><strong>none</strong></code></dt>
<dd>
<p>The network is always considered connected.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Enter a name for the data center in which to deploy the host for the self-hosted engine. The default name is <strong>Default</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please enter the name of the data center where you want to deploy this hosted-engine host.
Data center [Default]:</code></pre>
</div>
</div>
</li>
<li>
<p>Enter a name for the cluster in which to deploy the host for the self-hosted engine. The default name is <strong>Default</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please enter the name of the cluster where you want to deploy this hosted-engine host.
Cluster [Default]:</code></pre>
</div>
</div>
</li>
<li>
<p>If you want to use a custom appliance for the virtual machine installation, enter the path to the OVA archive. Otherwise, leave this field empty to use the {engine-appliance-name}.</p>
</li>
<li>
<p>To deploy with a custom {engine-appliance-name} appliance image, specify the path to the OVA archive. Otherwise, leave this field empty to use the {engine-appliance-name}.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">If you want to deploy with a custom engine appliance image, please specify the path to the OVA archive you would like to use.
 Entering no value will use the image from the rhvm-appliance rpm, installing it if needed.
 Appliance image path []:</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the CPU and memory configuration for the {engine-name} virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the number of virtual CPUs for the VM. The default is the appliance OVF value [4]:
Please specify the memory size of the VM in MB. The default is the maximum available [6824]:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the FQDN for the {engine-name} virtual machine, such as <code>manager.example.com</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the FQDN you would like to use for the engine.
Note: This will be the FQDN of the engine VM you are now going to launch,
it should not point to the base host or to any other existing machine.
Engine VM FQDN []:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the domain of the {engine-name} virtual machine. For example, if the FQDN is <code>manager.example.com</code>, then enter <code>example.com</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the domain name you would like to use for the engine appliance.
Engine VM domain: [example.com]</code></pre>
</div>
</div>
</li>
<li>
<p>Create the root password for the {engine-name}, and reenter it to confirm:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Enter root password that will be used for the engine appliance:
Confirm appliance root password:</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: Enter an SSH public key to enable you to log in to the {engine-name} virtual machine as the root user without entering a password, and specify whether to enable SSH access for the root user:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">You may provide an SSH public key, that will be added by the deployment script to the authorized_keys file of the root user in the engine appliance.
This should allow you passwordless login to the engine machine after deployment.
If you provide no key, authorized_keys will not be touched.
SSH public key []:

Do you want to enable ssh access for the root user (yes, no, without-password) [yes]:</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: You can apply the DISA STIG security profile on the {engine-name} virtual machine. The DISA STIG profile is the default OpenSCAP profile.</p>
<div class="listingblock">
<div class="content">
<pre>Do you want to apply a default OpenSCAP security profile? (Yes, No) [No]:</pre>
</div>
</div>
</li>
<li>
<p>Enter a MAC address for the {engine-name} virtual machine, or accept a randomly generated one. If you want to provide the {engine-name} virtual machine with an IP address via DHCP, ensure that you have a valid DHCP reservation for this MAC address. The deployment script will not configure the DHCP server for you.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">You may specify a unicast MAC address for the VM or accept a randomly generated default [00:16:3e:3d:34:47]:</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the {engine-name} virtual machine&#8217;s networking details:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">How should the engine VM network be configured (DHCP, Static)[DHCP]?</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you specified <strong>Static</strong>, enter the IP address of the {engine-name} virtual machine:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The static IP address must belong to the same subnet as the host. For example, if the host is in 10.1.1.0/24, the {engine-name} virtual machine&#8217;s IP must be in the same subnet range (10.1.1.1-254/24).</p>
</li>
<li>
<p>For IPv6, {virt-product-fullname} supports only static addressing.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please enter the IP address to be used for the engine VM [x.x.x.x]:
Please provide a comma-separated list (max 3) of IP addresses of domain name servers for the engine VM
Engine VM DNS (leave it empty to skip):</code></pre>
</div>
</div>
</li>
<li>
<p>Specify whether to add entries for the {engine-name} virtual machine and the base host to the virtual machine&#8217;s <code>/etc/hosts</code> file. You must ensure that the host names are resolvable.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Add lines for the appliance itself and for this host to /etc/hosts on the engine VM?
Note: ensuring that this host could resolve the engine VM hostname is still up to you.
Add lines to /etc/hosts? (Yes, No)[Yes]:</code></pre>
</div>
</div>
</li>
<li>
<p>Provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications. Alternatively, press <kbd>Enter</kbd> to accept the defaults:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the name of the SMTP server through which we will send notifications [localhost]:
Please provide the TCP port number of the SMTP server [25]:
Please provide the email address from which notifications will be sent [root@localhost]:
Please provide a comma-separated list of email addresses which will get notifications [root@localhost]:</code></pre>
</div>
</div>
</li>
<li>
<p>Create a password for the <code>admin@internal</code> user to access the Administration Portal and reenter it to confirm:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Enter engine admin password:
Confirm engine admin password:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the hostname of the deployment host:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the hostname of this host on the management network [hostname.example.com]:</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script creates the virtual machine. By default, the script first downloads and installs the {engine-appliance-name}, which increases the installation time.</p>
</div>
</li>
<li>
<p>Optional: If you set the variable <code>he_pause_host: true</code>, the deployment pauses after adding the deployment host to the {engine-name}. You can now log in from the deployment host to the {engine-name} virtual machine to customize it. You can log in with either the FQDN or the IP address of the {engine-name}. For example, if the FQDN of the {engine-name} is <code>manager.example.com</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">$ ssh root@manager.example.com</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the installation log, the IP address is in <code>local_vm_ip</code>. The installation log is the most recent instance of <code>/var/log/ovirt-hosted-engine-setup/ovirt-hosted-engine-setup-ansible-bootstrap_local_vm*</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Customize the {engine-name} virtual machine as needed.</p>
</li>
<li>
<p>When you are done, log in to the Administration Portal using a browser with the {engine-name} FQDN and make sure that the host&#8217;s state is <strong>Up</strong>.</p>
</li>
<li>
<p>Delete the lock file and the deployment script automatically continues, configuring the {engine-name} virtual machine.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Select the type of storage to use:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the storage you would like to use (glusterfs, iscsi, fc, nfs)[nfs]:</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>For NFS, enter the version, full address and path to the storage, and any mount options:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the nfs version you would like to use (auto, v3, v4, v4_1)[auto]:
Please specify the full shared storage connection path to use (example: host:/path): <em>storage.example.com:/hosted_engine/nfs</em>
If needed, specify additional mount options for the connection to the hosted-engine storage domain []:</code></pre>
</div>
</div>
</li>
<li>
<p>For iSCSI, enter the portal details and select a target and LUN from the auto-detected lists. You can only select one iSCSI target during the deployment, but multipathing is supported to connect all portals of the same portal group.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To specify more than one iSCSI target, you must enable multipathing before deploying the self-hosted engine. See <a href="{URL_rhel_docs_legacy}html-single/dm_multipath/"><em>{enterprise-linux} DM Multipath</em></a> for details. There is also a <a href="https://access.redhat.com/labs/multipathhelper/#/">Multipath Helper</a> tool that generates a script to install and configure multipath with different options.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>Please specify the iSCSI portal IP address:
Please specify the iSCSI portal port [3260]:
Please specify the iSCSI discover user:
Please specify the iSCSI discover password:
Please specify the iSCSI portal login user:
Please specify the iSCSI portal login password:

The following targets have been found:
	[1]	iqn.2017-10.com.redhat.example:he
		TPGT: 1, portals:
			192.168.1.xxx:3260
			192.168.2.xxx:3260
			192.168.3.xxx:3260

Please select a target (1) [1]: 1

The following luns have been found on the requested target:
  [1] 360003ff44dc75adcb5046390a16b4beb   199GiB  MSFT   Virtual HD
      status: free, paths: 1 active

Please select the destination LUN (1) [1]:</pre>
</div>
</div>
</li>
<li>
<p>For Gluster storage, enter the full address and path to the storage, and any mount options:</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only replica 1 and replica 3 Gluster storage are supported. Ensure you configure the volume as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">gluster volume set <em>VOLUME_NAME</em> group virt
gluster volume set <em>VOLUME_NAME</em> performance.strict-o-direct on
gluster volume set <em>VOLUME_NAME</em> network.remote-dio off
gluster volume set <em>VOLUME_NAME</em> storage.owner-uid 36
gluster volume set <em>VOLUME_NAME</em> storage.owner-gid 36
gluster volume set <em>VOLUME_NAME</em> network.ping-timeout 30</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the full shared storage connection path to use (example: host:/path): <em>storage.example.com:/hosted_engine/gluster_volume</em>
If needed, specify additional mount options for the connection to the hosted-engine storage domain []:</code></pre>
</div>
</div>
</li>
<li>
<p>For Fibre Channel, select a LUN from the auto-detected list. The host bus adapters must be configured and connected, and the LUN must not contain any existing data. To reuse an existing LUN, see <a href="{URL_virt_product_docs}{URL_format}administration_guide/index#Reusing_LUNs">Reusing LUNs</a> in the <em>Administration Guide</em>.</p>
<div class="listingblock">
<div class="content">
<pre>The following luns have been found on the requested target:
[1] 3514f0c5447600351   30GiB   XtremIO XtremApp
		status: used, paths: 2 active

[2] 3514f0c5447600352   30GiB   XtremIO XtremApp
		status: used, paths: 2 active

Please select the destination LUN (1, 2) [1]:</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Enter the disk size of the {engine-name} virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre>Please specify the size of the VM disk in GB: [50]:</pre>
</div>
</div>
<div class="paragraph">
<p>When the deployment completes successfully, one data center, cluster, host, storage domain, and the {engine-name} virtual machine are already running. You can log in to the Administration Portal to add any other resources.</p>
</div>
</li>
<li>
<p>Optional: Add a directory server using the <code>ovirt-engine-extension-aaa-ldap-setup</code> interactive setup script so you can add additional users to the environment. For more information, see <a href="{URL_virt_product_docs}{URL_format}administration_guide/index#sect-Configuring_an_External_LDAP_Provider">Configuring an External LDAP Provider</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Optional: Deploy Grafana so you can monitor and display reports from your {virt-product-shortname} environment.
For more information, see <a href="{URL_virt_product_docs}{URL_format}administration_guide/index#configuring_grafana">Configuring Grafana</a> in the <em>Administration Guide</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The {engine-name} virtual machine, the host running it, and the self-hosted engine storage domain are flagged with a gold crown in the Administration Portal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Both the {engine-name}'s I/O scheduler and the hypervisor that hosts the {engine-name} reorder I/O requests. This double reordering might delay I/O requests to the storage layer, impacting performance.</p>
</div>
<div class="paragraph">
<p>Depending on your data center, you might improve performance by changing the I/O scheduler to <code>none</code>. For more information, see <a href="{URL_rhel_docs_latest}html/monitoring_and_managing_system_status_and_performance/setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance">Available disk schedulers</a> in <em>Monitoring and managing system status and performance</em> for RHEL.</p>
</div>
</td>
</tr>
</table>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2959/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2959/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2959/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2959/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/dropped/introduction_to_the_vm_portal/common/install/proc-Deploying_the_Self-Hosted_Engine_Using_the_CLI.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/dropped/introduction_to_the_vm_portal/common/install/proc-Deploying_the_Self-Hosted_Engine_Using_the_CLI.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
