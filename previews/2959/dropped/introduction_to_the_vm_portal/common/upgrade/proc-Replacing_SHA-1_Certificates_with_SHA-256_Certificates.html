<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Replacing SHA-1 Certificates with SHA-256 Certificates | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Replacing SHA-1 Certificates with SHA-256 Certificates" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Replacing_SHA-1_Certificates_with_SHA-256_Certificates.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Replacing_SHA-1_Certificates_with_SHA-256_Certificates.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Replacing SHA-1 Certificates with SHA-256 Certificates" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Replacing SHA-1 Certificates with SHA-256 Certificates","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2959/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Replacing_SHA-1_Certificates_with_SHA-256_Certificates.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2959/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2959/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2959/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2959/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2959/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2959/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2959/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2959/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/">
              <span property="name">Dropped</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/">
              <span property="name">Introduction to the VM Portal</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/">
              <span property="name">Common</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/">
              <span property="name">Upgrade</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div class="paragraph">
<p>{virt-product-fullname} {vername_rhv} uses SHA-256 signatures, which provide a more secure way to sign SSL certificates than SHA-1. Newly installed systems do not require any special steps to enable {virt-product-fullname}'s public key infrastructure (PKI) to use SHA-256 signatures.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do <em>NOT</em> let certificates expire. If they expire, the environment becomes non-responsive and recovery is an error prone and time consuming process. For information on renewing certificates, see <a href="{URL_virt_product_docs}{URL_format}administration_guide/index#chap-Renewing_certificates_RHV_backup_restore">Renewing certificates before they expire</a> in the <em>Administration Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<h2 id="Preventing_Warning_Messages_from_Appearing_in_the_Browser_{context}" class="discrete">Preventing Warning Messages from Appearing in the Browser</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the {engine-name} machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cat /etc/pki/ovirt-engine/openssl.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf.&quot;$(date +&quot;%Y%m%d%H%M%S&quot;)&quot;
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Define the certificate that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre># names="apache"</pre>
</div>
</div>
</li>
<li>
<p>On the {engine-name}, save a backup of the <code>/etc/ovirt-engine/engine.conf.d</code> and <code>/etc/pki/ovirt-engine</code> directories, and re-sign the certificates:</p>
<div class="listingblock">
<div class="content">
<pre># . /etc/ovirt-engine/engine.conf.d/10-setup-protocols.conf
# for name in $names; do
    subject="$(
       openssl x509 \
           -in /etc/pki/ovirt-engine/certs/apache.cer \
           -text | \
               sed \
                   -n \
                       's; *DirName:\(.*\)/CN=.*;\1;p'
   )"
   /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
        --name="${name}" \
        --password=mypass \
        --subject="${subject}" \
        --san=DNS:"${ENGINE_FQDN}" \
        --keep-key
done</pre>
</div>
</div>
</li>
<li>
<p>Restart the <strong>httpd</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
</ol>
</div>
<h2 id="Replacing_All_Signed_Certificates_with_SHA-256_{context}" class="discrete">Replacing All Signed Certificates with SHA-256</h2>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the {engine-name} machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cat /etc/pki/ovirt-engine/openssl.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf.&quot;$(date +&quot;%Y%m%d%H%M%S&quot;)&quot;
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Re-sign the CA certificate by backing it up and creating a new certificate in <strong>ca.pem.new</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cp -p /etc/pki/ovirt-engine/private/ca.pem /etc/pki/ovirt-engine/private/ca.pem.&quot;$(date +&quot;%Y%m%d%H%M%S&quot;)&quot;
# openssl x509 -signkey /etc/pki/ovirt-engine/private/ca.pem -in /etc/pki/ovirt-engine/ca.pem -out /etc/pki/ovirt-engine/ca.pem.new -days 3650 -sha256</code></pre>
</div>
</div>
</li>
<li>
<p>Replace the existing certificate with the new certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># mv /etc/pki/ovirt-engine/ca.pem.new /etc/pki/ovirt-engine/ca.pem</code></pre>
</div>
</div>
</li>
<li>
<p>Define the certificates that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># names=&quot;engine apache websocket-proxy jboss imageio-proxy&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you replaced the {virt-product-fullname} {engine-name} SSL Certificate after the upgrade, run the following instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># names=&quot;engine websocket-proxy jboss imageio-proxy&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details see <a href="{URL_virt_product_docs}{URL_format}administration_guide/index#Replacing_the_Manager_CA_Certificate">Replacing the {virt-product-fullname} {engine-name} CA Certificate</a> in the <em>Administration Guide</em>.</p>
</div>
</li>
<li>
<p>On the {engine-name}, save a backup of the <code>/etc/ovirt-engine/engine.conf.d</code> and <code>/etc/pki/ovirt-engine</code> directories, and re-sign the certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># . /etc/ovirt-engine/engine.conf.d/10-setup-protocols.conf
# for name in $names; do
    subject=&quot;$(
        openssl \
            x509 \
            -in /etc/pki/ovirt-engine/certs/&quot;${name}&quot;.cer \
            -noout \
            -subject \
        | sed \
            's;subject= \(.*\);\1;' \
    )&quot;
   /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
        --name=&quot;${name}&quot; \
        --password=mypass \
        --subject=&quot;${subject}&quot; \
        --san=DNS:&quot;${ENGINE_FQDN}&quot; \
        --keep-key
done</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the following services:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd
# systemctl restart ovirt-engine
# systemctl restart ovirt-websocket-proxy
# systemctl restart ovirt-imageio</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
<li>
<p>Enroll the certificates on the hosts. Repeat the following procedure for each host.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Select the host and click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Once the host is in maintenance mode, click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Enroll Certificate</b></span>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2959/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2959/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2959/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2959/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Replacing_SHA-1_Certificates_with_SHA-256_Certificates.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Replacing_SHA-1_Certificates_with_SHA-256_Certificates.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
