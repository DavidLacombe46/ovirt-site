<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Monitoring snapshot health with the image discrepancies tool | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Monitoring snapshot health with the image discrepancies tool" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Image_discrepancies_tool.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Image_discrepancies_tool.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Monitoring snapshot health with the image discrepancies tool" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Monitoring snapshot health with the image discrepancies tool","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2959/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Image_discrepancies_tool.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2959/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2959/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2959/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2959/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2959/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2959/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2959/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2959/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2959/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2959/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2959//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/">
              <span property="name">Dropped</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/">
              <span property="name">Introduction to the VM Portal</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/">
              <span property="name">Common</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2959/dropped/introduction_to_the_vm_portal/common/upgrade/">
              <span property="name">Upgrade</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div class="paragraph">
<p>The <strong>{virt-product-shortname} Image Discrepancies</strong> tool analyzes image data in the Storage Domain and RHV Database. It alerts you if it finds discrepancies in volumes and volume attributes, but does not fix those discrepancies.
Use this tool in a variety of scenarios, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Before upgrading versions, to avoid carrying over broken volumes or chains to the new version.</p>
</li>
<li>
<p>Following a failed storage operation, to detect volumes or attributes in a bad state.</p>
</li>
<li>
<p>After restoring the {virt-product-shortname} database or storage from backup.</p>
</li>
<li>
<p>Periodically, to detect potential problems before they worsen.</p>
</li>
<li>
<p>To analyze a snapshot- or live storage migration-related issues, and to verify system health after fixing these types of problems.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Required Versions: this tool was introduced in {virt-product-shortname} version 4.3.8 with <code>rhv-log-collector-analyzer-0.2.15-0.el7ev</code>.</p>
</li>
<li>
<p>Because data collection runs simultaneously at different places and is not atomic, stop all activity in the environment that can modify the storage domains. That is, do not create or remove snapshots, edit, move, create, or remove disks. Otherwise, false detection of inconsistencies may occur. Virtual Machines can remain running normally during the process.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To run the tool, enter the following command on the {virt-product-shortname} {engine-name}:</p>
<div class="listingblock">
<div class="content">
<pre># rhv-image-discrepancies</pre>
</div>
</div>
</li>
<li>
<p>If the tool finds discrepancies, rerun it to confirm the results, especially if there is a chance some operations were performed while the tool was running.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This tool includes any Export and ISO storage domains and may report discrepancies for them. If so, these can be ignored, as these storage domains do not have entries for images in the {virt-product-shortname} database.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Understanding the results</div>
<p>The tool reports the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If there are volumes that appear on the storage but are not in the database, or appear in the database but are not on the storage.</p>
</li>
<li>
<p>If some volume attributes differ between the storage and the database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sample output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> Checking storage domain c277ad93-0973-43d9-a0ca-22199bc8e801
    Looking for missing images...
    No missing images found
    Checking discrepancies between SD/DB attributes...
    image ef325650-4b39-43cf-9e00-62b9f7659020 has a different attribute capacity on storage(2696984576) and on DB(2696986624)
    image 852613ce-79ee-4adc-a56a-ea650dcb4cfa has a different attribute capacity on storage(5424252928) and on DB(5424254976)

 Checking storage domain c64637b4-f0e8-408c-b8af-6a52946113e2
    Looking for missing images...
    No missing images found
    Checking discrepancies between SD/DB attributes...
    No discrepancies found</pre>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2959/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2959/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2959/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2959/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Image_discrepancies_tool.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/dropped/introduction_to_the_vm_portal/common/upgrade/proc-Image_discrepancies_tool.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
